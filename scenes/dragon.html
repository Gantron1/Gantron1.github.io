<!DOCTYPE html>
<html>
<!--
Copyright 2010 by Dan Fabulich.

Dan Fabulich licenses this file to you under the
ChoiceScript License, Version 1.0 (the "License"); you may
not use this file except in compliance with the License. 
You may obtain a copy of the License at

 http://www.choiceofgames.com/LICENSE-1.0.txt

See the License for the specific language governing
permissions and limitations under the License.

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied.
-->
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name = "viewport" content = "width = device-width, initial-scale = 1.0, maximum-scale = 1.0">
<!-- INSERT correct meta values -->
<title>SeductQuest: The Dragon and the Princess</title>

<script>window.version="UNKNOWN"</script>










<!--[if IE 6]><style>.alertify-logs { position: absolute; }</style><![endif]-->

<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="apple-touch-icon-precomposed" href="mobile-icon.png"/>

<script>
// INSERT store name; disabled by default because it's confusing for newbie authors
window.storeName = null;
//Scene.generatedFast = true;
var rootDir = "../";
</script><script> allScenes = {"startup":{"crc":-1723122674,"labels":{"startchoice":220,"listen":233,"investigate":241,"camp":260,"eat":266,"watch":271,"stepout":290},"lines":["*comment *********************","*comment **     HEADER      **","*comment *********************","","*title SeductQuest: The Dragon and the Princess","*author Frankie Lee","","*scene_list","\tstartup","\tcheck_achievements","\tadj_respect","\tmeet_tamara","\tagreement","\tchardell","\tchardell_alone","\tlilypad","\thoneypot","\toldman","\tlilypad2","\thill_duel","\tcamp1","\tmorning_alone","","*create debug true","","*comment *********************","*comment **  ACHIEVEMENTS   **","*comment *********************","","*achievement dragonname visible 10 Name of the Dragon","\tLearn the dragon's name.","\tYou learn the dragon's name is Myrristicor.","\t","*achievement weakness visible 10 Secret Weakness","\tLearn the dragon's secret weakness.","\tThe dragon has no secret weakness.","\t","*achievement contest hidden 1 Sit-in","\thidden","\tYou engaged in a stupid sitting contest.","\t","*achievement woncontest hidden 1 Won Sit-in","\thidden","\tYou actually \"won\" the stupid sitting contest.","\t","*achievement angrykiss visible 5 Angry Kiss","\tShare an angry kiss with Tamara.","\tYou shared an angry kiss with Tamara.","\t","*achievement dragoneye visible 10 DragonEye","\tUse the DragonEye.","\tYou peered into the DragonEye.","\t","*achievement money visible 10 \"Show me the money!\"","\tWhat movie was that from?","\tFrom \"Jerry Mcguire.\"","\t","*achievement honey visible 10 Honey","\tHarvest some honey.","\tYou harvested honey.","","*achievement honeypot visible 20 Honeypot","\tDrink from Tamara's honeypot.","\tYou drank from Tamara's honeypot.","\t","*achievement sugarhoney hidden 20 Second Honeypot","\thidden","\tYou drank from Tamara's honeypot. (Second time.)","\t","*achievement sugar hidden 20 Sugar","\thidden","\tYou gave Tamara some sugar.","\t","*achievement beg visible 30 Begging","\tMake Tamara beg.","\tTamara begged on her knees.","\t","*achievement blow visible 50 The Dive","\tMake Tamara take the dive.","\tTamara gave you a blowjob to show her sincerity.","\t","*achievement ending5 hidden 1 Ending #5: Meaningless Duel","\thidden","\tYou died in a meaningless duel.","","*achievement ending6 hidden 1 Ending #6: Over-Confident","\thidden","\tYou gave up on your quest after a particular embarrassing incident.","\t","*achievement height visible 10 Height Advantage","\tGain the height advantage in a duel with Tamara.","\tYou gained the height advantage... briefly.","\t","*achievement duelsex visible 20 Duel Sex","\tNo, Tamara is not a hermaphrodite.","\tYou had sex with Tamara during a duel.","\t","*achievement backrub visible 10 Backrub","\tGive Tamara a long backrub.","\tYou gave Tamara a backrub with more than just your hands.","\t","*achievement deepthroat visible 50 Deepthroat","\tDeepthroat Tamara.","\tYou deepthroated Tamara.","\t","*achievement doggie visible 50 Doggie Style","\tDo Tamara doggie style.","\tYou did Tamara doggie style.","\t","*achievement potion_victim visible 10 Up Against a Tree","\tFuck Tamara up against a tree.","\tYou fucked Tamara up against a tree... or was it the other way around?","","*achievement fulltamara visible 100 Full Carnal Knowledge of Tamara","\tIt will take several playthroughs.","\tYou possess full carnal knowledge of Tamara.","\t","*comment *********************","*comment **      STATS      **","*comment *********************","\t","*create esteem 80","","*comment *********************","*comment **  RELATIONSHIPS  **","*comment *********************","","*comment REL: 0 to 100, 50 being neutral","*comment tamara_respect: Starts at 0. Above X, and she starts to actually like him.","","*create met_tamara false","*create rel_tamara 50","*create tamara_respect 0","","*comment *********************","*comment **  SITUATIONALS   **","*comment *********************","","*create learned_dragon_sense false","*create had_pro_talk false","*create has_honey true","*create tamara_spat false","*create with_tamara false","*create tamara_laughed false","*create lilypad1_followed false","*create looked_ass false","*create was_polite false","*create past_path false","*create tracking_speech false","*create honey_breeches false","*create bee_sex false","*create banes_love_talk false","*create banes_sex_talk false","*create tamara_enemy false","*create hill_duel_outcome \"nothing\"","*create pommelpummeled false","*create deepthroat false","*create left_crying false","","*comment *************************","*comment *************************","*comment ****    TEST GOTO    ****","*comment *************************","*comment *************************","","*if debug","\t*comment *set has_honey false","\t*choice","\t\t#With Tamara","\t\t\t*set with_tamara true","\t\t\t*goto_scene lilypad2","\t\t#No with Tamara","\t\t\t*set with_tamara false","\t*comment *goto_scene  morning_alone","\t*goto_scene lilypad2","","","*comment *********************","*comment **    THE GAME!    **","*comment *********************","","*image http://herbaloutfitters.com/textimage/text_image.php?font=MervaleScript-Regular&fontsize=40&text=SeductQuest:&color=000000&matte=F0D6AD&shadow=inv","*image http://herbaloutfitters.com/textimage/text_image.php?font=MervaleScript-Regular&fontsize=30&text=The%20Dragon%20and%20the%20Princess&color=000000&matte=F0D6AD&shadow=inv","*image http://herbaloutfitters.com/textimage/text_image.php?font=MervaleScript-Regular&fontsize=25&text=by&color=000000&matte=F0D6AD&shadow=inv","*image http://herbaloutfitters.com/textimage/text_image.php?font=MervaleScript-Regular&fontsize=25&text=Frankie%20Lee&color=000000&matte=F0D6AD&shadow=inv","","[b]WARNING: [/b]This game is a work of erotica and contains explicit sexual content. Reader discretion is advised. ","","Do not play this game if you are a minor.","","[b]Features: [/b]","","[b]*[/b] Hot sex scenes!","","[b]*[/b] Realistic female characters with different personalities.","","[b]*[/b] An interesting plot that could stand on its own. (Because of this, the really juicy sex scenes might come later on. I guarantee the wait will be worth it!)","","[b]*[/b] Target Audience: Male, Straight.","","[b]*[/b] Fetish Level: Very light if any.","","*page_break","*image http://herbaloutfitters.com/textimage/text_image.php?font=MervaleScript-Regular&fontsize=30&text=Prologue&color=000000&matte=F0D6AD&shadow=inv","","You remember well the moment your life changed forever. You were crossing the Corkish Mountains and just cresting the summit of Mt. Everhorn when the entire valley below became visible. You could see the walled capital city of the Kingdom of Zhan sitting in the middle of the plain, its magnificent spires thrusting skyward.","","Then, from the northeast, the dragon came. ","*page_break","Even from afar, it's terrible magnificence was dreadfully clear, and you saw its fiery breath, bright in your eyes, even in broad daylight. The knights who rode out to meet it looked like tiny ants from your vantage point, and they were just as feeble against the dragon's might.","","The dragon then rose to the highest tower, the one you knew housed the chambers of the princess Elsbeth, and with a sweep of its tail sundered with ease the stone wall capable of withstanding one hundred sieges. You watched in horror as it reached in with its claw and extracted the princess, dressed in all her finery, and then the dragon was gone, returning to its aerie atop the far mountain range, DragonKeep.","*page_break","*image http://herbaloutfitters.com/textimage/text_image.php?font=MervaleScript-Regular&fontsize=30&text=Chapter%20One:&color=000000&matte=F0D6AD&shadow=inv","*image http://herbaloutfitters.com/textimage/text_image.php?font=MervaleScript-Regular&fontsize=25&text=Chance%20Encounters&color=000000&matte=F0D6AD&shadow=inv","Since that day, you made it your sole mission in life to rescue Princess Elsbeth, to succeed where so many have failed, and you now find yourself in the wooded foothills below the great DragonKeep itself, having already braved much hardship and difficulty, though the final test lies ahead. ","","It's sunrise, and you've left last night's campsite to scout ahead a bit as your breakfast cooks. You've been following the known path leading toward the dragon's lair, but your habit has been to camp a little ways off the path. Now that you're quite close to the lair (perhaps fifteen miles, as the crow flies), you feel it prudent to look around a bit before returning to the path.","*page_break","You stroll for approximately ten minutes, enjoying the cool morning air, not really expecting to find anything. The ground is rocky and uneven, and there are many trees, boulders, and outcroppings. You find nothing of note and are about to head back when you hear a faint female voice from somewhere up ahead, perhaps just over a fairly steep ridge fifty feet ahead.","*label startchoice","*choice","\t*disable_reuse #Stop and listen.","\t\t*goto listen","\t#Quietly move forward to investigate.","\t\tYou move forward as quickly as you can while remaining quiet, and you carefully climb to the top of the ridge until just your head is peeking over the top.","\t\t","\t\t*goto investigate","\t#Quickly move forward to investigate.","\t\tYou move forward as quickly as you can, not worrying about stepping on any twigs or rustling any leaves. Most likely, whoever or whatever is on the other side of the ridge wouldn't hear such noises anyway, but it's still definitely possible that they could. You reach the ridge and climb to the top until just your head is peeking over.","\t\t","\t\t*goto investigate","\t","*label listen","You pause for a moment but hear nothing more. The voice didn't seem distressed, but from the inflection, it sounded like perhaps it was making a request to another person. However, it was too faint to be sure even of that.","","You wonder if it could be a trap. Perhaps a faerie's prank? It's odd for a woman to be found this close to the dragon's lair, lest it kidnap her too.","","Despite these concerns, you decide you must investigate, for isn't it better to know what you're dealing with? Besides, you're confident you could handle whatever comes your way. Afterall, compared to a dragon's might, how bad could it really be? Also, it's a woman--maybe you could get lucky!","*goto startchoice","","*label investigate","On the other side of the ridge is a small ravine with a gentle wooded slope leading down to a dry creekbed. There are small trees here that provide you with some cover, but you can still see the ravine bottom perhaps fifty feet ahead.","","The other side of the dry creekbed is the base of a small cliff, and there are many jagged boulders of various size littering the area. Someone seems to have camped here last night, and you can see the still smoking remains of a campfire, two bedrolls, and other equipment.","","A woman is leaning against a three-foot tall, square-ish boulder, and her plate armor dazzles you in the early morning sunlight. It's incredibly finely wrought and probably covered with silver veneer to make it glitter as it does, and you marvel at how it conforms to her body's curves, maintaining her femininity while sacrificing nothing in the way of protection in combat. Her helm is silver too, with little golden wings on each side. She has a royal blue cape, and next to her, leaning against the boulder is a fine broadsword in an embroidered leather scabbard and a metal shield bearing the crest of a noble family.","","Next to her is an elderly man in old gray robes who looks like he must be her manservant.","","The woman is working at something just below waist-level and then removes the part of her armor covering the crotch area, revealing her naked sex. She spreads her legs to shoulder width, and the man kneels, placing his head between her legs. You see her body stiffen just then, and she puts her mailed but still dainty hand on the back of his head, closes her eyes.","","*choice","\t#It's probably a good idea not to disturb them, and your breakfast is definitely overcooked by now. Go back to your camp.","\t\t*goto camp","\t#You can't help yourself and watch a bit longer, even if it risks being discovered and burning your breakfast.","\t\t*goto watch","\t#Step out and say hello. (WARNING: Great self-esteem risk if this goes badly.)","\t\t*goto stepout","\t","*label camp","*set has_honey false","You ease yourself up, preparing to go back down the ridge, and though doing so causes a small avalanche of dirt and stones, the couple below is so absorbed in what they're doing that they don't notice.","","You carefully climb down the ridge, and in perhaps ten minutes, you are back in your camp. The oatmeal you left cooking is burned on the bottom but otherwise edible, and you use the last of your honey to sweeten it.","","*label eat","You eat quickly, hoping to catch up with the two strangers, and are packing your supplies when...","*page_break","*goto_scene meet_tamara","","*label watch","You see the man's head undulate rhythmically between the female knight's legs while she remains stock still as if resisting the impulse to show any sign of the pleasure so obviously coursing through her body. She doesn't even move to spread her legs further apart.","","In a few moments, however, her back arches slightly, and she emits a tiny, half-stifled gasp. The hand on the back of the man's head pulls him closer, and her other hand is grasping frantically at the edge of the boulder she's leaning/half-sitting against.","","\"Faster...\" she gasps. \"I'm close!\"","","The man grabs the knight by the hips and redoubles his efforts, and she begins to emit a few more moans and soft cries despite her attempts to suppress them. She's close, but it's not orgasm yet.","","You tear yourself away, knowing that this is the best time to leave. If you wait any longer, the act will be finished, and, resting in the aftermath, they'd likely hear any sound you make.","","As you climb down the ridge, you cause a small avalanche of dirt and small stones, but the woman's cries of mounting orgasm tell you they have remained oblivious to your presence.","","Having descended the ridge, you begin to return to your camp, listening as the woman's ecstasy finally spills over into orgasm. You've been traveling by yourself a long time, and this makes you long desperately for the company of a woman. Oh well. You think of how wonderful it will be after you rescue the princess and how grateful she will be.","","Back in camp, you find the oatmeal mostly burned, and you scrape the small amount that's still edible from the top. It's not a full breakfast, but it'll have to do.","","*goto eat","","*label stepout","You climb over the ridge and emerge from the trees.","","\"Hello,\" you say, hoping maybe the female knight will find you more attractive than her elderly companion.","","The man tries to spring to his feet, but his weak legs cause him to fall to his hands and knees.","","The knight grabs for her sword and cries, \"Begone, you lecher! I'll teach you to interrupt private moments.\"","","She advances upon you, her sex still exposed, but as beautiful as it may be, all you can see is the hatred in her eyes and the point of her broadsword.","","*set esteem 20","Your self-esteem crumbles:","*stat_chart","\tpercent esteem Self-Esteem","\t","*line_break","Your self-esteem is now too low to fight or even to remain where you are, for that matter. You flee and now must give up your quest, lacking the self-confidence to continue.","","THE END.","","You have reached Ending #6: Over-confident.","*page_break","*achieve ending6","*ending"]},"choicescript_stats":{"crc":753544720,"labels":{},"lines":["*temp dragon \"\"","*check_achievements","*if choice_achieved_dragonname","\t*set dragon \"Myrristicor,\"","","You are on a quest to rescue Princess Elsbeth from ${dragon} the ancient dragon who lives atop Mt. DragonKeep.","","*stat_chart","\tpercent esteem Self-Esteem","","*temp tamara_desc \"\"","*set tamara_desc tamara_desc & \"a master thief\"","*if tracking_speech","\t*set tamara_desc tamara_desc & \" and tracker\"","*set tamara_desc tamara_desc & \", expert on dragonlore.\"","*if met_tamara","\tYou have met Tamara, ${tamara_desc}","\t*stat_chart","\t\tpercent tamara_respect Tamara's Respect","\t","","\t",""]},"check_achievements":{"crc":1956812760,"labels":{},"lines":["*check_achievements","*if (((((choice_achieved_angrykiss and choice_achieved_honeypot) and choice_achieved_sugarhoney) and choice_achieved_sugar) and choice_achieved_blow) and choice_achieved_duelsex)","\t*achieve fulltamara","\t","*return"]},"adj_respect":{"crc":1227262863,"labels":{"5":3,"10":11,"20":19,"30":27,"40":35,"-5":43,"-10":51,"-20":59,"-30":67,"-40":75},"lines":["*bug adj_respect subroutine called without parameter.","*return","","*label 5","*set tamara_respect %+5","Tamara's respect for you rises very slightly:","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","","*label 10","*set tamara_respect %+10","Tamara's respect for you rises slightly:","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","","*label 20","*set tamara_respect %+20","Tamara's respect for you rises.","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","","*label 30","*set tamara_respect %+30","Tamara's respect for you rises significantly.","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","","*label 40","*set tamara_respect %+40","Tamara's respect for you rises greatly!","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","","*label -5","*set tamara_respect %-5","Tamara's respect for you falls very slightly:","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","","*label -10","*set tamara_respect %-10","Tamara's respect for you falls slightly:","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","","*label -20","*set tamara_respect %-20","Tamara's respect for you falls.","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","","*label -30","*set tamara_respect %-30","Tamara's respect for you falls significantly.","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","","*label -40","*set tamara_respect %-40","Tamara's respect for you falls greatly.","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","*return","",""]},"meet_tamara":{"crc":972929158,"labels":{"startchoice":5,"look":16,"handweapon":28,"draw":38,"willingsafe":48,"attack":57,"tryfind":82,"callout":87,"continue":92,"guarded":99,"friendly":107,"tellrescue":118,"disdain":121,"ownreasons":128,"reverie":133,"continuereverie":145,"ceasereverie":156,"honestignorance":164,"ignorance2":170,"agree":188,"thepath":191,"caveats":196,"nodeal":208,"proposal":219,"continuequest":232,"walk":235,"walkoff":240,"lieignorance":245,"ignorance":253,"pause":256,"lie2":261,"lie3":276,"howknows":292,"dragonname":301,"secretname":310,"weakness":319,"noweakness":324},"lines":["*set met_tamara true","\"Are you here to slay the dragon?\" says a voice, making you whirl around in surprise.","","Before you, you see yet another woman, and how she managed to get so close to you without your hearing is a mystery. ","","*label startchoice","*choice","\t*disable_reuse #Look her over.","\t\t*goto look","\t#Put a hand on your weapon and tell her to step back.","\t\t*goto handweapon","\t#Guardedly ask what she wants.","\t\t*goto guarded","\t#Be friendly.","\t\t*goto friendly","\t","*label look","This woman is very different from the knight, for the knight was tall, perhaps close to six feet, and everything about her positively glittered. This woman stands perhaps five feet six inches, slender but muscular, and dressed in earth-tones, she looks as if she could easily fade into the underbrush and disappear. ","","She's wearing tan, skin-tight leather breeches that do well to show off her figure. Her boots are knee-high, fashioned from expensive leather, and she seems to have a custom-made leather vest inlaid with an intricate pattern in silver and a beautiful deep red color. It must've cost a fortune, but it's also practical, affording more than a small amount of protection in battle.","","Her breasts are a small, shapely pair, showing just a hint of cleavage in the vest's neckline. Her arms are bare, but she's wearing doe-skin gloves that go up to her elbows.","","She has a backpack and belt pouch, and by her side is a slender, wicked-looking sword. A crossbow is draped over her back with quarrels at the ready.","","Her hair's a deep reddish-brown and falls to her shoulders. Her eyes are a piercing green, and when she looks at you, her intensity makes you nervous. You don't know if she's going to snap at you or simply turn away in disdain.","*goto startchoice","","*label handweapon","\"Go ahead and draw,\" the woman says. \"I could've killed you already.\" She taps the crossbow on her back.","","\"Besides,\" she goes on. \"I'm not in sword range, so I shouldn't have to step back. This is normal talking range.\"","*choice","\t#Draw!","\t\t*goto draw","\t#Ask her what she wants.","\t\t*goto guarded","\t","*label draw","As soon as you begin to draw, the woman leaps backwards into a back handspring that takes her even further out of range. She draws her weapon, a wicked-looking scimitar.","","\"I just wanted to talk, but if you want to fight, bring it,\" she says.","*choice","\t#Tell her you're willing to talk, just didn't feel safe after she snuck so close to you.","\t\t*goto willingsafe","\t#Attack.","\t\t*goto attack","\t","*label willingsafe","*set tamara_respect %+20","\"Fair enough,\" the woman says. \"Now, am I right to assume you're here to slay the dragon?\"","*choice","\t#\"I'm here to rescue the princess.\"","\t\t*goto tellrescue","\t#\"My reasons are my own.\"","\t\t*goto ownreasons","","*label attack","*set tamara_enemy true","The woman stands her ground as you advance upon her and meets your attack sword to sword. You find that she's a skilled fighter, and though you're stronger and have the reach advantage, her speed makes her an even match for you. The duel could go either way.","","\"You're a better swordsman than you look,\" the woman laughs. \"You might even be better than I am.\" She continues to fence with you, unconcerned.","","\"Shouldn't you be more worried?\" you ask.","","\"I would be, except...\" ","","She makes an especially strong attack which puts you on the defensive for a split-second, and then she springs backwards.","","\"I'm a thief,\" she says, \"Not a warrior. Sleep with one eye open tonight.\"","","She bounds off into the forest, and you know you won't be able to catch her.","","\"The name's Tamara, by the way,\" her voice comes from somewhere beyond the veil of leaves, and then, silence. She's gone.","*choice","\t#Try to find her.","\t\t*goto tryfind","\t#Call out to her.","\t\t*goto callout","\t#Continue your journey.","\t\t*goto continue","\t","*label tryfind","You hurry forward in the direction she ran, but there's no sign of her. You have no choice but to continue your journey.","","*goto continue","","*label callout","Only silence answers your call. You have no choice but to continue your journey.","","*goto continue","","*label continue","You gather your belongings, extinguish the campfire, and resume walking along the path that leads toward the dragon's lair.","","You walk for awhile, always wondering if Tamara's not trailing you just out of sight. You turn around from time to time but see nothing.","","*goto_scene chardell_alone","","*label guarded","\"Like I just asked,\" the woman says. \"I want to know what you're doing here. I'm here to plunder the dragon's hoard, and a stupid adventurer bumbling in could get me killed. Is that why you're here?\"","*choice","\t#\"I'm here to rescue the princess.\"","\t\t*goto tellrescue","\t#\"My reasons are my own.\"","\t\t*goto ownreasons","\t","*label friendly","\"Oh, hello,\" you say. \"Fancy meeting you out here in the middle of nowhere. May I ask what you are doing so far from civilization and so near to the dragon's lair?\"","","\"You can ask,\" the woman responds, not returning your friendliness but not hostile either. \"The dragon's lair is exactly why I'm here. What of yourself?\"","","*choice","\t#\"I'm here to rescue the princess.\"","\t\t*goto tellrescue","\t#\"My reasons are my own.\"","\t\t*goto ownreasons","\t","*label tellrescue","\"How noble of you,\" the woman says. \"Do you expect me to be impressed?\"","","*label disdain","She looks you up and down disdainfully.","","\"Well, at least you have a rope, so you must know the climb is difficult. However, do you know that the dragon can hear each stroke of your hammer when you're pounding in your mountain-climbing stakes? Do you know how it's watching all the time, and even now, from so far away, through tons of rock, it can probably sense us to at least some extent?\"","","*goto reverie","","*label ownreasons","\"Are they now?\" the woman smirks. \"Not really. No one comes here but for the dragon, so I can safely assume that's why you're here.\" ","","*goto disdain","","*label reverie","In the days following the dragon sighting, you attempted to garner aid, both in the form of companions and information, to help you on your quest, but very little was forthcoming. Everyone with whom you spoke told you were crazy, and almost none had any helpful information. A ranger told you about the mountain and the need for ropes to climb it, and though he taught you the rudiments of mountain climbing, he too attempted to dissuade you from your quest. So far, even the most skilled knights have not been able to best this particular dragon.","","You heard it's a very old one, has roosted in DragonKeep for as long as anyone can remember, and over time, the kings learned that they could appease the dragon by offering it maidens, gold, and jewels. Each spring, a maiden and a large chest of treasure is brought to a special place for the dragon to collect, and this has reduced but not eliminated its depredations of the countryside.","","Continue your reverie?","*choice","\t#Yes.","\t\t*goto continuereverie","\t#No.","\t\t*goto ceasereverie","","*label continuereverie","Because of this evil pact, the royal court felt secure, so it was a great horror when the dragon attacked the capital city itself, for that had not happened since the very first offering, 150 years ago.","","It was surmised (by the sages who studied dragonlore) that the dragon was incensed by the audacity of the princess's high tower, a magnificent structure twice as tall as any ever built before. ","","A tradition had developed in Zhan where the higher a lady's bower, the more desired she was purported to be, and thus all ladies, when the became of age, lived in the highest one their family could afford to build. The princesses had the highest of all, and the king, who loved this particular daughter to an unusually great extent, undertook the task of building an impossibly tall tower to match her peerless beauty--and in so doing, unintentionally brought about the greatest tragedy the kingdom had ever known.","","Such is the price of arrogance... a warning that you too, it could be said, have not heeded.","","*goto ceasereverie","","*label ceasereverie","So, what is your answer to the woman's question? Did you know that dragons can sense things around their lair?","*choice","\t#\"No,\" you admit.","\t\t*goto honestignorance","\t#\"Of course, I do,\" you lie.","\t\t*goto lieignorance","\t","*label honestignorance","*set learned_dragon_sense true","\"Well, you may be a fool, but at least you're an honest fool,\" the woman says. \"Then can. Sounds. Smells. Their senses are extraordinarily powerful, but they also extend into the psychic realm. They can sense magic, so if you're carrying any magic items, they will give you away once you're close. They can also sense our very emotions, but only the negative ones. Greed. Anger. Jealousy. These a dragon can sense even miles away.\"","","She pauses as if mulling something over.","","*label ignorance2","\"My name's Tamara,\" she says finally, \"And unlike you, I have no silly notions about rescuing the princess. I'm here for the treasure plain and simple. I'm a thief, master-class, my quest under sanction by the thieves guild, for imagine the glory--the thief who robbed a dragon!\"","","Speaking thusly, she raises a clenched fist mightly before her and gazes purposefully off into the distance in imitation of a knight in victory. She smiles sheepishly at her own overenthusiasm and then continues, \"I, in the noble tradition of thieves everywhere, plan to sneak in, and I know the location of the hidden entrance. I can't have you alerting the dragon to our presence, so I propose we work together. I will get you in without the dragon knowing, but after that, you're on your own. I steal the treasure, and you, if you're truly serious about your silly quest, can go rescue the princess, if she's even still alive. Is it a deal?\"","","*set tamara_respect %+10","Tamara's respect for you rises slightly:","*stat_chart","\tpercent tamara_respect Tamara's Respect","","*choice","\t#\"Okay, deal.\"","\t\t*goto agree","\t#\"Okay, but do you think you could stop insulting me all the time?\"","\t\t*goto caveats","\t#\"No deal.\"","\t\t*goto nodeal","\t","*label agree","*gosub_scene agreement","\t","*label thepath","The two of you continue to walk down the path together in silence for a good bit. ","","*goto_scene chardell","","*label caveats","*set tamara_respect %+5","Tamara's respect for you rises very slightly:","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","\"Yes,\" Tamara says. \"I will certainly stop 'insulting you,' because I never have. Speaking honestly, that's another matter.\" She laughs. \"Well, I'm glad we have a deal. Right? We have a deal?\"","*fake_choice","\t#Right.","*gosub_scene agreement","*goto thepath","","*label nodeal","Tamara exhales loudly in frustration. \"Look,\" she says, \"You're going to get yourself killed, and while I normally laugh at fools getting their comeupance, in this case, your blunder will interfere with my plans. Only the gods know why, but I'm offering to help you. If you refuse, you will have to wait until I'm finished before making your own approach, but I don't trust you enough for that. You might race ahead or do some other stupid thing to get me killed. Unless we work together, I'll have to kill you, but that would alert the dragon. There's no choice. We MUST agree to work together. Now, IS IT A DEAL?\"","","*choice","\t#\"Okay, deal.\"","\t\t*goto agree","\t#Propose that you go first. That'll distract the dragon and make it easier for Tamara to steal the treasure.","\t\t*goto proposal","\t#\"No deal.\" You're tired of Tamara's nonsense and walk off.","\t\t*goto walkoff","\t","*label proposal","\"Okay, fine,\" Tamara says. \"You can go first if you want. That also works if that's what you really want to do.\"","","She looks at you and waits.","","\"Well? Go on then. Go rescue your princess.\"","","*choice","\t#Continue your quest.","\t\t*goto continuequest","\t#Change your mind and agree to work together.","\t\t*goto agree","\t","*label continuequest","Tamara shrugs. \"Fool,\" you hear her say just before losing sight of her among the trees.","","*label walk","You walk for awhile, always wondering if Tamara's not trailing you just out of sight. You turn around from time to time but see nothing.","","*goto_scene chardell_alone","","*label walkoff","Surprisingly, Tamara doesn't protest, and the last you see of her is her shaking her head at your foolishness.","","*goto walk","","*label lieignorance","\"Yeah?\" the woman says, her eyes narrowing suspiciously. \"Well, then, do you know that it can smell you from a hundred yards off?\"","*choice","\t#Admit you didn't know that.","\t\t*goto ignorance","\t#Lie and say you knew that too.","\t\t*goto lie2","\t","*label ignorance","\"As you can see,\" the woman says, \"I have done my preparations. There are other things I know too, secrets greater even than these.\" ","","*label pause","She pauses for a moment, and you wonder if she's going to tell you more. Instead, she looks at you a moment as if coming to a decision.","","*goto ignorance2","","*label lie2","\"Then I hope you've brought something to mask your scent,\" the woman says, and you frantically start to think what you have that might work.","","If she's noticed the consernation she's caused, she shows no sign.","","\"Do you know that they can sense our very emotions, but only bad ones?\" she asks, continuing her grilling of you.","","*choice","\t#Admit you didn't know that.","\t\t*goto ignorance","\t#Lie and say you knew that too.","\t\t*goto lie3","\t#Ask how she knows all this stuff.","\t\t*goto howknows","","*label lie3","\"I'm sure you do,\" the woman says, but it's obvious she doesn't believe you. ","","\"Do you know this dragon's name?\"","","*choice","\t#Claim you do.","\t\t*goto dragonname","\t#Admit you don't know it.","\t\t*achieve dragonname","\t\t\"It's Myrristicor,\" the woman says dramatically. \"I might be the only one who's not a sage who knows that.\"","\t\t","\t\tShe smiles proudly but then feels vulnerable and shrugs instead.","\t\t","\t\t*goto ignorance","","*label howknows","\"How did YOU learn all this stuff?\" she asks, turning the tables.","","You hesitate, trying to think of how to answer, and she laughs. ","","\"I know you don't really know all this stuff,\" she smiles. \"Suffice it to say, I've done my preparations.\"","","*goto pause","","*label dragonname","\"What is it, then?\" the woman asks.","","*choice","\t#\"I can't say. It's a secret.\"","\t\t*goto secretname","\t#Admit you don't know.","\t\t*goto ignorance","\t","*label secretname","\"Of course it is,\" the woman says. \"I can't tell you what it is either. Well, since you know that secret, do you know the dragon's secret weakness?\"","","*choice","\t#Claim you do.","\t\t*goto weakness","\t#Admit you don't know.","\t\t*goto noweakness","\t","*label weakness","\"Then I don't have to tell you what it is, do I?\" the woman says and winks. \"Look, I can tell when someone's lying. I know a lot more secrets than these.\"","","*goto pause","","*label noweakness","*achieve weakness","\"I don't know its secret weakness either. Was hoping you could tell me,\" the woman laughs.","","*goto pause"]},"agreement":{"crc":-399701163,"labels":{"agree":0,"followchoice":29},"lines":["*label agree","\"Good,\" Tamara says. \"Oh, but now that I'm supposed to help you, I'll need you to agree to do everything I say, no questions asked, got it? If I say to step where I step, you do it. If I say to be quiet, even if you don't know why, you do it without a word. Understand? This is very important.\"","","*fake_choice","\t#Agree.","\t\t","\"Good,\" Tamara says and holds out her hand for you to shake.","","*fake_choice","\t#Shake it.","\t\t","\"There, now the deal is sealed,\" Tamara says, trying to hide a smirk. \"There's no going back on your word once you've shaken on it, right?\"","","*fake_choice","\t#Right.","\t\t","\"Good,\" Tamara says. \"Well, let's be off then. Time is not of the essence to me, but it is to you. I'd hate for us to get there one minute after the dragon tires of Elsbeth and eats her, wouldn't you?\"","","*fake_choice","\t#Agree.","\t\t","\"See,\" Tamara says. \"I look out for you. We're a team now, and that means IMPLICIT TRUST.\"","","*if past_path","\tShe resumes climbing the slope, seeming unusually happy. In fact, she's nearly bounding up like a little girl.","\t*goto followchoice","*else","\tShe turns and hurries down the path, seeming unusually happy. In fact, she's almost skipping along like a little girl.","","*label followchoice","*fake_choice","\t#Follow.","\t\t","*set with_tamara true","By the time you catch up to her, she's back to her sullen self.","","\"You walk too loud, you know that?\" she says, barely glancing at you in acknowledgement. \"I could track you blindfolded, and that's the first thing we need to change. Walk softly. ","*if learned_dragon_sense","\tRemember, the dragon senses things.\"","\t","\t*return","*else","\t*temp distance \"fifteen miles\"","\t*if past_path","\t\t*set distance \"six miles\"","\tThe dragon is watching all the time, and even now, from perhaps ${distance} away, through tons of rock, it can probably sense us to at least some extent. Did you know that? Sounds. Smells. Their senses are extraordinarily powerful, but they also extend into the psychic realm. They can sense the negative emotions of all who approach from miles away. Greed. Anger. Jealousy. This is only one of the many things I know about dragons, and I know many secrets about this one in particular.\"","\t","\t*choice","\t\t#Ask her what else she knows.","\t\t\t\"You're supposed to be working on your silent walking,\" Tamara says. \"Be silent. Talking is not silence.\"","\t\t\t","\t\t\t*return","\t\t#Just walk silently.","\t\t\t*return"]},"chardell":{"crc":1814409676,"labels":{"tell":11,"tellcun":35,"juicy":39,"agreeflirt":54,"noagreeflirt":59,"not":76,"disdain":91,"sit":100,"keepsitting":117,"keepsittingchoice":122,"what":131,"whatchoice":139,"staysilent":152,"staysilent2":156,"staysilent3":182,"givein":186,"getup":202,"ignore":211,"smirk":219,"nosmirk":224,"walkoff":232,"winstupidity":244,"staysilent4":254,"onown":262,"quitstupidity":271,"agreeflirt2":276,"agreeflirt3":279,"sarcasm":296,"notellcun":305,"details":318,"chardell":322,"aghast":345,"speculation":360,"cross":369,"eats":374,"leavechardell":379,"steep":411,"hoist":422,"polite":428,"slight":429},"lines":["*temp told_about_knight false","","The knight and old man will probably be just ahead on this path, as it's the only one in the area. ","","*choice","\t#Take this opportunity to tell Tamara about the two people you saw.","\t\t*set told_about_knight true","\t\t*goto tell","\t#Keep quiet about it and say nothing about having seen them earlier if you do catch up with them.","\t\t*goto chardell","\t","*label tell","*set tracking_speech true","\"By the way, you say, \"Perhaps it would be good for me to tell you that just before I met you, while scouting, I saw from a distance two people and their campsite. We will likely catch up with them soon.\"","","\"Was one a woman in armor and the other an old man?\" Tamara asks, her tone of voice making it sound like she already knows all about them.","","\"Why yes! How did you know?\" you exclaim.","","\"I've been tracking them the same as I've been tracking you, of course, dummy. How could I know about you but not them?\"","","\"You saw them already, then? Have you talked to them?\"","","\"No, of course not. They're ahead of you.\"","","\"But how then did you know what they look like?\"","","\"By the gods, how stupid can one person be?\" she spats. \"Women's feet are smaller proportioned than men's, but hers leave a heavy indention in the earth. The way the man shuffles along tells me he's elderly. I can tell a lot of other things about them from the sign they leave as well, and... I know what they do every morning. What did you see?\"","","*choice","\t#Tell her you saw the man perform cunnilingus on the knight.","\t\t*goto tellcun","\t#Be discreet. ","\t\t*goto notellcun","","*label tellcun","\"Well, since you already know, I suppose there's no reason not to tell,\" you say. \"It seems the old man pleasures the woman.\"","","\"It must be nice having that service available at your beck and call, isn't it?\" Tamara laughs. ","*label juicy","\"It's always the same. She leans up on something, and he kneels before her. It takes, maybe, three minutes, and she tries not to move or cry out very much.\"","","\"How in the world do you know all that?\" What she described is exactly what you saw!","","\"I told you,\" Tamara says. \"I read the signs. It's all there if you know how to look. Anyway...\"","","Tamara signs dejectedly. \"I'm going to have to help them as well, for a knight will certainly bungle a stealthy approach if left on her own. She seems to like a man's touch, so it'd be nice if you flirt with her and otherwise do what you can to make a good impression.\"","","*choice","\t#\"Sure!\" You would anyway.","\t\t*goto agreeflirt","\t#Tell Tamara you will do as you see fit.","\t\t*goto noagreeflirt","\t","*label agreeflirt","\"I see we make a good team when you do everything I say,\" Tamara says, pleased with herself.","","*goto chardell","","*label noagreeflirt","\"What?\" Tamara says and punches you on the arm. It wasn't hard enough to injure you, but it did hurt. \"Didn't we agree you'd do everything I asked? I even asked nicely. That's the last time I'm ever doing THAT! ","","\"Some people... show any kindness, any kindness at all, and they see it as weakness. ","","\"Iron hand... that's what my mother always used to tell me, 'Rule with an iron hand.' ","","Look, we HAVE TO get them to cooperate. I know the area. I know this dragon. I have devised an intricate strategy that covers all contingencies, and the presence of bumbling fools, which it seems I just had to have the misfortune to encounter, requires... REQUIRES their cooperation. It's IN THE PLAN. It's the only way. Will you do it or not?\"","","*choice","\t#Not.","\t\t*goto not","\t#\"Fine, fine, if it means that much to you, I will, but no guarantees.\"","\t\t*goto agreeflirt2","\t#\"So in this great,all-mighty plan of yours, does it say that when you meet 'bumbling fool #1' you are to cajole him and demand that he get 'bumbling fool #2' to also agree to become a subservient slave subject to endless abuse and do anything you say?\"","\t\t*goto sarcasm","\t","*label not","\"Not?!?\" Tamara cries, eyes bulging out in disbelief. \"Okay, that's it. I'm not helping you anymore. You and the idiot knight can go get yourselves killed, and I'll be sitting there laughing. This is actually in my plan too. If the bumbling fools become even bigger fools by not accepting my help, I let them distract the dragon, which makes things even better for me. See how masterfully crafted my plan is? I just be a little snarky, and it's like pulling a puppet's strings--you go and do exactly what I really wanted all along. Muhahahahahahahaha!\"","","Tamara erupts into maniacal laughter and can't stop for several minutes.","","*choice","\t#Announce that you'll never let her snarkiness affect you again.","\t\t*goto disdain","\t#Sit down and tell her you're now waiting for HER to go first and distract the dragon for YOU.","\t\t*goto sit","\t#Just ignore her when she gets like this.","\t\t*goto ignore","\t#Walk off. She said she won't help you anymore, and you're holding her to it.","\t\t*goto walkoff","","*label disdain","\"I guess I'll have to stop being snarky, then,\" Tamara says.","","\"And sarcastic,\" you add.","","\"That too!\" she says.","","*goto chardell","","*label sit","You sit down.","","Tamara turns around, confused. \"What are you doing?\" ","","\"I am sitting here, and I won't get up until YOU go first. Is THAT in your plan?\"","","\"What?!?\" Tamara says, aghast. \"Wait, no, yes. It actually IS in the plan. See?\"","","She walks off, and soon, you're by yourself.","","*choice","\t#Just wait.","\t\t*goto keepsitting","\t#Ok, this is silly. Get up and follow her.","\t\t*goto getup","","*label keepsitting","It feels like a long time, but it's probably only a minute or two before Tamara comes back. You suppress a smile, thinking you've won, but then you see that she herself is barely suppressing a grin. Oh, no... What is she up to now?","","She sits in front of you and just stares at you.","","*label keepsittingchoice","*choice","\t#\"What?\"","\t\t*goto what","\t#Stay silent.","\t\t*goto staysilent","\t#Give in and agree to flirt with the stupid knight.","\t\t*goto givein","\t","*label what","\"What?\" you say after the silence gets unbearable.","","\"Oh, nothing,\" Tamara says. \"I was just sitting here thinking about what might be happening to the princess.\"","","She stops talking, and it's silent again, except now you are worrying about the princess. Tamara stares at you, doing nothing, saying nothing, her face expressionless.","","*temp silentcount 1","*label whatchoice","*choice","\t*if (silentcount = 2) #Fight fire with fire: \"If the knight sees me as a big baby, I guess my flirting chances are ruined, huh?\"","\t\t\"It'd be worth it, though,\" Tamara says. \"I'm telling the princess how big a baby you were too, so unless you get up right now, your chances with both with be ruined. Ruined!\"","\t\t*set silentcount +1","\t\t*goto whatchoice","\t#Stay silent.","\t\t*goto staysilent2","\t#Give in and agree to flirt with the stupid knight.","\t\t*goto givein","\t*if (silentcount > 2) #Get up and walk away from this silly game.","\t\t*goto quitstupidity","\t","*label staysilent","You sit and stare at Tamara. Tamara sits and stares at you.","*goto keepsittingchoice","","*label staysilent2","*if silentcount = 1","\t*achieve contest","\t\"What if the knight shows up and sees you being a big baby like this?\" Tamara asks, almost as if talking to herself.","\t","\tNow you're worrying about the princess AND the knight.","\t*goto staysilent3","*elseif silentcount = 2","\tTamara yawns and stretches. The sit-in continues.","\t*goto staysilent3","*elseif silentcount = 3","\tTamara lays on her side. \"This is me being the dragon,\" she says, and she starts imitating a dragon lying on its pile of treasure. \"Oh, look at all my pretty baubles,\" she goes on, looking around at the imaginary pile of treasure under her. \"Oh, and here comes the princess,\" she says, glancing over to one side. \"What shall I do with her?\"","\t*goto staysilent3","*elseif silentcount = 4","\t\"Shall I eat her?\" Tamara says, licking her chops, staring at the imaginary, tiny princess.","\t*goto staysilent3","*elseif silentcount = 5","\t\"Yes! I WILL eat her!\"","\t*goto staysilent3","*elseif silentcount = 6","\tTamara is making eating sounds and pretending to rip apart the pretend princess with her pretend claws.","\t*goto staysilent3","*elseif silentcount = 7","\t\"Ok, this is stupid. Stupid!\" Tamara says, gets up, and kicks some dirt in your general direction. \"I'm leaving. Bye!\"","\t","\t*goto winstupidity","*label staysilent3","*set silentcount +1","*goto whatchoice","","*label givein","You realize you're just wasting precious time, and flirting with the knight was probably something you would've done anyway.","","\"Okay, okay,\" you say. \"I'll flirt with the stupid knight, but no guarantees.\"","","\"Good,\" Tamara says, standing up. \"You're a big baby, you know that?\"","","*set tamara_respect %-5","Tamara's respect for you falls very slightly:","*stat_chart","\tpercent tamara_respect Tamara's Respect","*line_break","The two of you continue your journey.","","*goto agreeflirt3","","*label getup","You catch up to Tamara and say, \"Look, I was just making a point. I don't like you bossing me around all the time.\"","","\"I'm not bossing you around,\" she says. \"I just know more than you, devised an elaborate plan, and it messes things up when you, in total ignorance of the hours of planning and lifetime of research I've done, you try to think for yourself. Stop it!\"","","Tamara glares at you and stomps off.","","*goto chardell","","*label ignore","Tamara's maniacal laughter abates eventually until all that's left is an uncomfortable silence. For her, that is. You're feeling pretty good about yourself.","*choice","\t#Smirk.","\t\t*goto smirk","\t#Show no sign.","\t\t*goto nosmirk","\t","*label smirk","Tamara walks in silent shame, and you start to feel a little bad.","","*goto chardell","","*label nosmirk","*set esteem %+5","Your self-esteem rises very slightly:","*stat_chart","\tpercent esteem Self-Esteem","*line_break","*goto chardell","","*label walkoff","You quicken your pace.","","Tamara stops cackling and says, \"Hey, where are you going?\"","","\"I'm going on ahead,\" you retort, not even turning around. \"Isn't it in your plan that I go get myself killed and distract the dragon?\"","","\"Oh,\" Tamara says. \"Good, then.\"","*set with_tamara false","*set tamara_spat true","*goto_scene chardell_alone","","*label winstupidity","*achieve woncontest","*choice","\t#Keep sitting.","\t\t*goto staysilent4","\t#Get up and follow her.","\t\t*goto getup","\t#Get up and go off on your own.","\t\t*goto onown","","*label staysilent4","You're taking this whole thing a little too seriously, don't you think? What is this? The third grade in grammar school?","*choice","\t#Get up and see if you can catch up with Tamara.","\t\t*goto getup","\t#Get up and go off on your own.","\t\t*goto onown","\t","*label onown","Enough is enough. You resume your quest and don't look for Tamara, walking down the path, enjoying the peaceful silence. Ahhhh...","\t\t","Tamara is nowhere to be seen. Good. Good riddance.","","*set tamara_spat true","*set with_tamara false","*goto_scene chardell_alone","\t","*label quitstupidity","You get up, and Tamara instantly ceases her silly antics. The two of you walk in silence, neither mentioning the outburst of immaturity that just occurred.","","*goto chardell","","*label agreeflirt2","\"Good,\" Tamara sighs, her irritation dissipating. ","","*label agreeflirt3","She walks in silence a moment, and then a smirk appears on her face.","","\"No guarantees?\" she says, still smirking. \"That's fine. My plan covers your inadequacies, whatever they are. It might be this--\"","","She holds her hands in front of her, palms facing each other around seven inches apart and then moves them closer to more like three.","","\"Or this--\"","","She holds her hand up, fingers together, and then makes it droop flaccidly.","","\"Or...\"","","She goes on making all kinds of hand gestures, some of which you understand and some you don't. Obviously, she's an encyclopedia of male inadequacies, but you refrain from speculating as to how she might've acquired her wealth of knowledge. (Because it's obvious. Sadly.) Most of them don't apply to you, but you stop looking just in case.","*page_break","*goto chardell","","*label sarcasm","\"Why yes,\" Tamara says. \"That's exactly what the plan says.\"","","\"Like you really thought of all that beforehand...\" ","","\"I did,\" Tamara says, totally serious. \"Once I saw there were two, that is. A good plan is one that is always subject to amendment.\" She giggles.","","*goto chardell","","*label notellcun","\"Well, since you already know all about it, I don't need to tell you all the sordid details, do I?\" you say.","","\"Nope, you don't,\" Tamara smiles. \"And I won't tell you any of the details either. It took them three days on this road, so the other two times... well, no details for you!\"","","*choice","\t#Tell her you were just trying to be discreet but would like to hear the details.","\t\t*goto details","\t#Act like you don't care.","\t\tYou let Tamara have her smug little fun and say nothing. If you don't encourage her, maybe she'll shut up.","\t\t","\t\t*goto chardell","","*label details","\"Actually, there's not much to tell,\" Tamara says, still smiling, obviously enjoying gossiping about other people's juicy details. ","*goto juicy","\t","*label chardell","In a little while, the path descends into a small wooded valley, and at the bottom, you find a small clearing with a large stake in the center. ","","\"This is Chardell,\" Tamara whispers softly.","","You recognize the name. Chardell is the place where the annual sacrifice was made, and you realize with horror that over a hundred maidens were in turn chained to that stake to await the dragon. You wonder how many are still alive and of those, how many will let you boink them.","","Some of the surrounding trees are charred, and the burned areas are higher up with the lower branches untouched. It's obviously from dragonfire, but why? ","","\"Sad isn't it?\" Tamara says, gazing at the now empty clearing. ","","\"Yes,\" you agree, glad to see that Tamara has a softer side.","","\"Yeah,\" Tamara says. \"A hundred and fifty chests of treasure, now just sitting up in DragonKeep doing nobody any good.\"","","*choice","\t#\"By the gods, woman! Don't you think at all of the poor maidens?\"","\t\t*goto aghast","\t#\"What do you think charred the trees like this?\"","\t\t*goto speculation","\t#There's nothing more to say. Continue the journey.","\t\t*goto leavechardell","\t","*label aghast","\"You sentimental fool,\" Tamara snaps. \"It could easily have been me being sacrificed, so yeah, I have thought about it. A lot, but you know what? In the end we all have to die sometime, some just sooner rather than later. These girls at least lived long enough to see the flowering of their womanhood, something not everyone does.\"","","She walks up to the stake and spits.","","\"To hell with you, dragon!\" she says. \"And to hell with all the kings who fed you our daughters.\"","","*choice","\t#\"You don't think the dragon eats the girls, do you?\"","\t\t*goto eats","\t#\"What do you think charred the trees like this?\"","\t\t*goto speculation","\t#Continue on.","\t\t*goto leavechardell","\t","*label speculation","Tamara inspects one of the charred trees.","","\"This is old,\" she says. \"It must've happened a hundred years ago. I guess people wised up after that.\"","","\"But what happened to cause it?\" you ask. \"Was the dragon displeased for some reason? Or perhaps it was from a battle as some would-be hero attempted to rescue that year's sacrifice?\"","","Tamara laughs. \"More likely the battle was with a band of thieves after the treasure... and the girl too, I suppose.\"","","*label cross","Tamara crosses the clearing and jerks her head to indicate that you should follow.","","*goto leavechardell","","*label eats","\"No, he feeds them tenderly, and DragonKeep is full of white-haired old ladies,\" Tamara spats sarcastically. \"Regardless of what it does with them, I'm sure it's not fun, so let's waste no time.\"","","*goto cross","","*label leavechardell","*set past_path true","\"There's no path from here on, for obvious reasons,\" she says. \"Only heroes and fools pass this point, and it remains to be seen which we are.\"","","\"The foothills get steeper past this point,\" Tamara says. \"I'd estimate that if we travel at your speed, we'll reach the foot of the mountain sometime tomorrow, though I could make it on my own in one day. I hope you're up for it. Try and keep up, but don't let yourself get too tired. There probably won't be any hostile encounters here, but it's always good to maintain vigilance.\"","*page_break Onward!","You make your way up the rocky slope, making slow but steady progress. You have a hard trek ahead of you today, but you're up to the task. Tamara, carrying a lighter load, wearing more nimble boots, is having an easier time of it, but even she is a bit breathless. Because of this, she's not talking much, and you enjoy the respite from her normally constant assessment and advice. You can't help but notice the sheen of a thin layer of sweat on her skin and her chest heaving while she breathes, pulling tight on her vest's laces--she's attractive when her lips aren't moving! ","","*if told_about_knight","\t\"We're catching up to them,\" Tamara says, panting a bit. \"The knight is weighed down by her armor, but judging by the tracks, it's really the old man who's holding them back.\" You look down but can't for the life of you see any sign or tracks.","\t*page_break","\t*goto steep","*else","\t*set tamara_respect %-10","\t*set tracking_speech true","\t\"By the way, I know you're following two people,\" Tamara says. \"You're walking faster than you did yesterday. Remember what I said about 'implicit trust'? Isn't this something you should've told me about?\"","\t","\tTamara's respect for you falls slightly:","\t*stat_chart","\t\tpercent tamara_respect Tamara's Respect","\t*line_break","\tShe goes on, \"I assume you learned of their presence on your morning walk earlier, but it seems you haven't yet talked with them, for why would you be so far behind them now?\"","\t","\tShe thinks a moment, then says, \"Ah, I suppose you must've come upon them during a private moment. Your stealth skill might be better than I gave you credit for then. Did the knight lean against something, and the man kneel before her?\"","\t","\t\"Why yes! How did you know?\" you exclaim.","\t","\t\"Without training, you won't be able to see what I see,\" Tamara says. \"But a good tracker can tell a lot about his quarry. They performed this ritual without variation every morning I've been tracking them, so I assumed today would be no different. I've never seen it, but the signs are there. Anyway, we're catching up with them. The knight is weighed down by her armor, but judging by the tracks, it's really the old man who's holding them back.\" ","\t","\tYou look down but can't for the life of you see any sign or tracks.","\t*page_break","\t","*label steep","At a particularly steep point, Tamara grabs onto the trunk of a small tree and reaches back, offering you her hand to help hoist you over the steep part.","","*choice","\t#Accept the help.","\t\t*goto hoist","\t#Politely decline.","\t\t*goto polite","\t#Trudge by, saying nothing.","\t\t*goto slight","\t","*label hoist","*set tamara_laughed true","Tamara pulls hard and propels you over the steep part and several feet in front of her, making the both of you laugh.","","*goto_scene lilypad","","*label polite","*label slight","\"Just trying to help the slow poke,\" Tamara shrugs. \"Get ya to the princess faster that way, but have it your way.\"","","*goto_scene lilypad",""]},"chardell_alone":{"crc":-1979774862,"labels":{"sad":11,"following":19,"aghast":40,"speculation":59,"leavechardell":76,"threat":92,"ultimatum":100,"tamarajoins":118,"hoist":135,"polite":148,"slight":149,"proposal":154,"eats":161,"reconcile":170},"lines":["In a little while, the path descends into a small wooded valley, and at the bottom, you find a small clearing with a large stake in the center. This must be Chardell, the place where the annual sacrifice was made, and you realize with horror that over a hundred maidens were in turn chained to that stake to await the dragon. You wonder how many are still alive and of those, how many will let you boink them.","","Some of the surrounding trees are charred, and the burned areas are higher up with the lower branches untouched. It's obviously from dragonfire, but why? ","","\"Sad isn't it?\" says a familiar voice behind you. ","*if tamara_spat ","\tYou groan. She's baaaaack!","\t*goto sad","*else","\tYou whirl for the second time today, and of course, it's Tamara again.","\t","*label sad","*if tamara_spat","\t\"Are you following me?\" you ask.","\t","\t*goto following","*else","\t\"I thought you might be following me, and I see that I was right,\" you say.","","*label following","\"Oh, not following,\" she says. \"Just that we're both going the same way.\"","","You shrug.","","\"Yes, it is sad,\" you say, thinking again of all the maidens. It seems such a cruel tradition.","","\"Yeah,\" Tamara says. \"A hundred and fifty chests of treasure, now just sitting up in DragonKeep doing nobody any good.\"","","*choice","\t#\"By the gods, woman! Don't you think at all of the poor maidens?\"","\t\t*goto aghast","\t#\"What do you think charred the trees like this?\"","\t\t*goto speculation","\t#\"I'm leaving now. Don't follow me.\"","\t\t*goto leavechardell","\t*if (not(tamara_spat) and (not(tamara_enemy))) #\"Since we're going the same direction anyway, why not travel together?\"","\t\t*goto proposal","\t*if (tamara_spat) #\"Well, let's get going.\"","\t\t*goto reconcile","\t","*label aghast","\"You sentimental fool,\" Tamara snaps. \"It could easily have been me being sacrificed, so yeah, I have thought about it. A lot, but you know what? In the end we all have to die sometime, some just sooner rather than later. These girls at least lived long enough to see the flowering of their womanhood, something not everyone does.\"","","She walks up to the stake and spits.","","\"To hell with you, dragon!\" she says. \"And to hell with all the kings who fed you our daughters.\"","","*choice","\t#\"You don't think the dragon eats the girls, do you?\"","\t\t*goto eats","\t#\"What do you think charred the trees like this?\"","\t\t*goto speculation","\t#\"I'm leaving now. Don't follow me.\"","\t\t*goto leavechardell","\t*if (not(tamara_spat) and (not(tamara_enemy))) #\"Since we're going the same direction anyway, why not travel together?\"","\t\t*goto proposal","\t*if (tamara_spat) #\"Well, let's get going.\"","\t\t*goto reconcile","\t","*label speculation","Tamara inspects one of the charred trees.","","\"This is old,\" she says. \"It must've happened a hundred years ago. I guess people wised up after that.\"","","\"But what happened to cause it?\" you ask. \"Was the dragon displeased for some reason? Or perhaps it was from a battle as some would-be hero attempted to rescue that year's sacrifice?\"","","Tamara laughs. \"More likely the battle was with a band of thieves after the treasure... and the girl too, I suppose.\"","","*choice","\t#\"I'm leaving now. Don't follow me.\"","\t\t*goto leavechardell","\t*if (not(tamara_spat) and (not(tamara_enemy))) #\"Since we're going the same direction anyway, why not travel together?\"","\t\t*goto proposal","\t*if (tamara_spat) #\"Well, let's get going.\"","\t\t*goto reconcile","\t","*label leavechardell","*set past_path true","\"Not my fault I happen to catch up to you when you decide to waste time,\" you hear Tamara say as you're leaving the clearing.","","Shaking your head, you go on, and though the path ended at Chardell, you know which direction to go even when the mountain range is hidden from view, for the only way forward is up. You know that climbing the foothills will eventually lead you to the base of the mountain, and from there, well, you'll figure it out.","","You walk for a few minutes, look back, and see Tamara following along behind you.","","\"I'm not following you,\" she says. \"We're just going in the same direction. That's all.\"","","*choice","\t#Tell her not to follow you or you'll attack.","\t\t*goto threat","\t#Shrug and continue on.","\t\t*goto tamarajoins","","*label threat","Really? Remember, the dragon can sense negative emotions around its lair (or so Tamara says). Even if she's wrong or lying, do you really want to risk injury? If you wind up fighting, even if you win, you might be injured and in worse shape for when you reach the dragon's lair.","*choice","\t#You really threaten violence. Tamara needs to learn you're no one to be trifled with.","\t\t*goto ultimatum","\t#It's not worth it. Let her follow you. Maybe she will prove herself useful at some point.","\t\t*goto tamarajoins","","*label ultimatum","You put your hand on the pommel of your sword. \"Keep following me and you'll be sorry,\" you say.","","Tamara stops in her tracks. \"Like I said...\" she says.","","A staring contest ensues. An impasse.","","\"Well?\" Tamara says. \"Go on then.\"","","You take a step, look back, and Tamara hasn't moved.","","You take another, and now you aren't sure. She might've taken a small step while you weren't looking.","","You quickly walk a good distance, turn around, and though she's further back, almost lost among the trees, it looks like she did move forward some also.","","You suppose this'll have to do.","*goto_scene lilypad","","*label tamarajoins","You continue making your way up the rocky slope, making slow but steady progress, and each time you look behind you, Tamara is a little closer. Eventually she's hiking along beside you.","","\"You're just slower than me, so I caught up. That's all,\" she says, a bit breathlessly. You can't help but notice the sheen of a thin layer of sweat on her skin and her chest heaving while she breathes, pulling tight on her vest's laces--she's attractive when her lips aren't moving!  ","","The two of you continue up the slope together, and you estimate that you'll reach the mountain proper sometime tomorrow. You have a hard trek ahead of you today, but you're up to the task.","","At a particularly steep point, Tamara grabs onto the trunk of a small tree and reaches back, offering you her hand to help hoist you over the steep part.","","*choice","\t#Accept the help.","\t\t*goto hoist","\t#Politely decline.","\t\t*goto polite","\t#Trudge by, saying nothing.","\t\t*goto slight","\t","*label hoist","*set with_tamara true","*set tamara_laughed true","Tamara pulls hard and propels you over the steep part and several feet in front of her. The two of you laugh.","","Later, Tamara says, \"Well, I guess we're traveling together now, aren't we?\"","","*fake_choice","\t#\"Yeah, I guess that's how it turned out in the end.\"","\t\t","*gosub_scene agreement","*goto_scene lilypad","","*label polite","*label slight","\"Just trying to help the slow poke,\" Tamara shrugs. \"Get ya to the princess faster that way, but have it your way.\"","","*goto_scene lilypad","","*label proposal","\"That's what I was proposing from the very beginning, you dummy,\" Tamara says. \"Well, I'm glad you finally came to your senses. We are now officially traveling companions now, right?\"","*fake_choice","\t#Yes.","*gosub_scene agreement","*goto_scene lilypad","","*label eats","\"No, he feeds them tenderly, and DragonKeep is full of white-haired old ladies,\" Tamara spats sarcastically. \"Regardless of what it does with them, I'm sure it's not fun, so don't you think you should be hurrying along now? For every second you waste here, that's another second she spends in the beast's clutches.\"","","*choice","\t#She's right. Resume your journey.","\t\t*goto leavechardell","\t#Propose you travel together since you're going the same way anyway.","\t\t*goto proposal","\t","*label reconcile","*set tamara_spat false","*set with_tamara true","\"Yes,\" Tamara says. You guess you're traveling together again.","","*goto_scene lilypad"]},"lilypad":{"crc":1388018523,"labels":{"lilypad":14,"continuebyself":24,"tamaraback":27,"stealth":40,"creep":57,"didntsee":80,"invite":91,"whytell":101,"whathand":108,"sameway":111,"dropmatter":116,"sneaksecret":132,"suspicions":140,"looklily":151,"stammer":159,"peeupslope":165,"catchupa":176,"catchupn":187,"slap":198,"slapcatchup":210,"slapapol":218,"slapkeepapol":226,"slapnothing":251,"slapkiss":260,"whynoromance":269,"slappush":284,"slapreasonable":299,"dragonwait":302,"slapweak":309,"slapkiss2":325,"slapbye":331,"noslap":337,"follow":342,"gotcha":349,"sphere":359,"agreetrust":367,"nomorespeak":370,"keepingsecrets":375,"testing":380,"testingchoice":386,"squat":395,"vigil":407,"askhold":415,"nopeer":419,"headback":429,"keepwatching":454,"show":463,"hide":482,"sawtrees":503,"sawbody":504,"sawnothingmore":514,"peeapologize":525,"resistpee":534,"peesuspicious":539,"probe":549,"peeresume":565,"waitpee":570},"lines":["A few minutes later, ","*if with_tamara","\tTamara pauses and thinks a moment.","\t","\t\"Wait here,\" she says. \"I need to shake the dew from my lily pad.\"","","\tShe goes off into the forest by herself.","\t","\t*goto lilypad","*else","\tfrom out of the blue, Tamara says, \"I'm going off to 'shake the dew from my lily pad,' but since we're not traveling together or anything, you don't have to wait for me or anything like that. Bye.\"","\t","\tShe turns around and goes off into the forest by herself.","\t","*label lilypad","*choice","\t#Stealthily follow her.","\t\t*set lilypad1_followed true","\t\t*goto stealth","\t#Wait","\t\t*goto waitpee","\t*if (not (with_tamara)) #Continue on by yourself.","\t\t*goto continuebyself","\t","*label continuebyself","You feel yourself relax now that Tamara's not around, but your relief is short-lived. After only a little while, Tamara appears a little ways ahead of you. She glances at you, then at the ground.","","*label tamaraback","\"You're following two people, aren't you?\" she says. \"I can tell because you're walking faster than you did yesterday.\"","","She starts heading on. \"This way,\" she says, pointing up the slope. \"You were going fifteen degrees off their course. Now that there's no path anymore, and your tracking skills are non-existent, don't you think you should man up and just accept that you could use my help?","*choice","\t#\"Fine,\" you say, just to shut her up.","\t\t*gosub_scene agreement","\t\t*goto_scene oldman","\t#\"No, I'm going it alone.\"","\t\t\"Fine,\" Tamara says. \"That's actually better for me anyway.\"","","*goto_scene oldman","\t","*label stealth","You wait a moment, then follow her, being as quiet as you can. You marvel at how quietly she's able to walk, never rustling leaves or grass, nor stepping on any twigs. Maybe she really is a master thief like she claims? You do your best to move quietly as well, and you are, for the most part, successful. At least, Tamara doesn't show any sign that she knows you're following her.","","Eventually, she stops, and you watch her from behind a tree a few dozen yards away.","","She fumbles with her belt a little, then squats on the other side of a tree which partially obstructs your view of her. You can't really see much more than her left arm and shoulder.","","*choice","\t#Creep up closer","\t\t*goto creep","\t*if (with_tamara) #Walk up and say, \"Gotcha!\"","\t\t*goto gotcha","\t#Head back","\t\t*goto headback","\t#Keep watching","\t\t*goto keepwatching","\t","*label creep","You, creep, begin to creep in a small arc in order to see more of her body, but you just begin to see the back-left side of her head when a twig snaps underfoot. Tamara is up like a shot, her pants already up, belt fastened, and her hand whips to the pommel of her sword.","","*if with_tamara","\tWhen she sees that it's you, she sighs irritably. \"What in the world do you think you're doing???\" she hisses.","\t","\t*choice","\t\t#\"Look, I don't know you well yet, so I was just making sure you were really doing what you claimed to be doing.\"","\t\t\t*goto suspicions","\t\t#\"I was just looking for my own place to shake my lilypad.\"","\t\t\t*goto looklily","\t\t#Stammer","\t\t\t*goto stammer","*else","\t\"Here to rape me?\" Tamara sneers. \"Well, you can certainly try. In fact, I want you to.\" Her sword arm jerks in anticipation, as if desperately wanting to draw. She's also holding a round object in her left hand which she could throw with deadly force.","\t*choice","\t\t#Tell her you didn't see anything.","\t\t\t*goto didntsee","\t\t#Tell her you thought she was inviting you.","\t\t\t*goto invite","\t\t#Tell her you thought she was sneaking off to do something secret.","\t\t\t*goto sneaksecret","\t\t","*label didntsee","\"I didn't see anything, honest!\" you say.","","\"But you wanted to, didn't you?\" Tamara sneers. \"You men are all alike, pervs and lechers every single one. I should cut you down where you stand, but unfortunately, that might attract the dragon's attention.\"","","Before you can protest your innocence, she turns and disappears into the underbrush.","","You resume your journey, catching sight of her hiking ahead of you. She's fast, however, and the distance between you gradually increases.","","*goto_scene oldman losesight","","*label invite","\"Do I look that coy?\" Tamara says, exasperated. \"If I wanted some sugar, I'd just ask for it.\"","*choice","\t#\"If that's the case, why did you feel the need to tell me what you were doing?\"","\t\t*goto whytell","\t#\"What's that in your hand?\"","\t\t*goto whathand","\t#Let the matter drop.","\t\t*goto dropmatter","\t","*label whytell","\"No reason,\" Tamara says and turns to go.","","You resume your journey, Tamara hiking ahead of you, and gradually the distance between you increases.","","*goto_scene oldman losesight","","*label whathand","\"Nothing,\" Tamara says and slips whatever it was back into her belt pouch. She then turns to go, resuming the journey.","","*label sameway","Since you're going the same way, you follow behind her, but gradually the distance between you increases because she's able to hike faster than you.","","*goto_scene oldman losesight","","*label dropmatter","\"A misunderstanding, then,\" you say.","","\"Very much so,\" Tamara says. \"Well? Shall we resume the journey?\"","*choice","\t#\"You can. We're not traveling companions.\"","\t\t\"Of course we're not,\" Tamara says and turns to go.","\t\t","\t\t*goto sameway","\t#\"Yes.\" You walk together.","\t\t\"Does this mean we're traveling together now?\" Tamara asks.","\t\t*fake_choice","\t\t\t#\"I guess...\"","\t\t*gosub_scene agreement","\t\t*goto_scene oldman","","*label sneaksecret","\"Yeah,\" Tamara retorts. \"I was 'sneaking off' to do my private feminine business. My, aren't you the suspicious one.\" She turns to go.","*choice","\t#\"What's that in your hand then?\"","\t\t*goto whathand","\t#Let the matter drop.","\t\t*goto dropmatter","","*label suspicions","\"It wasn't just an excuse to spy on me during a private moment?\" Tamara asks, her eyes narrowed suspiciously.","","\"No, of course not!\" you say.","","\"Then... I guess I'll let you off the hook this one time,\" she says. \"I'd have done the same thing, but if you do it again, I'll show you no mercy.\"","","*gosub_scene adj_respect 10","","*goto_scene oldman","","*label looklily","*set had_pro_talk true","\"Oh my gods,\" Tamara cries. \"Do you really expect me to believe that? Look, you and I have a professional relationship, so I expect there to be NO funny business between us. Understand?\"","","She puts something she was holding back into her belt pouch and stomps off, making as much noise as a normal person stomping around in the woods. I guess when she's mad, she no longer uses her thieves step.","","*goto peeupslope","","*label stammer","*set had_pro_talk true","\"I thought so,\" Tamara says. \"You men are all alike. Look, you and I have a professional relationship, so I expect there to be NO funny business between us. Understand?\"","","She puts something she was holding back into her belt pouch and stomps off, making as much noise as a normal person stomping around in the woods. I guess when she's mad, she no longer uses her thieves step.","","*label peeupslope","She's heading up the slope of the foothill, so you assume she's resuming the journey.","","*choice","\t#Catch up with her and apologize.","\t\t*goto catchupa","\t#Catch up but say nothing.","\t\t*goto catchupn","\t#Follow from a distance.","\t\t*goto follow","\t","*label catchupa","You hurry to catch up.","","\"I'm sorry, Tamara,\" you say. \"It won't happen again.\"","","Tamara's face softens, and she smiles. \"Oh, it's all right,\" she says. \"I'm not a priss like I'm sure your princess is going to be. Just don't do it again, or I'll cut something off.\"","","*gosub_scene adj_respect 10","","*goto_scene oldman","","*label catchupn","As soon as you're in range, Tamara slaps you on the cheek.","","\"That's for trying to spy on a lady,\" she says.","","*choice","\t#Slap her back","\t\t*goto slap","\t#Do nothing","\t\t*goto noslap","\t","*label slap","Tamara's face becomes a mixture of disbelief and fury.","","\"How dare you!\" she cries. \"That's it. We're done. You go rescue your princess by yourself.\"","","She stalks off into the woods.","*choice","\t#Catch up to her.","\t\t*goto slapcatchup","\t#Good riddance.","\t\t*goto slapbye","\t","*label slapcatchup","You quickly catch up to Tamara, but she refuses to acknowledge you and continues to stomp her way through the forest.","*choice","\t#Apologize.","\t\t*goto slapapol","\t#Say nothing. Just continue to follow her.","\t\t*goto slapnothing","\t","*label slapapol","\"What part of 'we're done,' don't you understand?\" Tamara spats. \"Stop following me or face my wrath!\"","*choice","\t#Stop following.","\t\t*goto slapbye","\t#Keep apologizing.","\t\t*goto slapkeepapol","\t","*label slapkeepapol","Finally Tamara stops walking, but she still doesn't acknowledge you or your apologetic words. Instead, she just stares at the ground, shaking with anger.","","It takes a long time, but it seems she finally calms down.","","\"Okay,\" she says. \"Let's forget this ever happened. We need to work together on our assault on DragonKeep, and that's the only reason you're not dead right now.\"","","She holds out her hand.","","\"Shake it before I change my mind.\"","","*fake_choice","\t#Shake it.","\t\t","Tamara smiles and even seems to almost giggle now, as if now that it's over, the whole incident seems silly to her. She shakes her head, rolling her eyes.","","\"Come on. We've wasted enough time, and if the dragon didn't know we were here before, it does now.\"","","You ask her if this changes things.","","\"Yes, but it's not enough for us to abort the endeavor,\" she replies. \"I know what I'm doing.\"","*gosub_scene adj_respect 20","","*goto_scene oldman","","*label slapnothing","\"Why are you following me!\" Tamara cries and slaps you again. She grips you by the shoulders and shakes you, overcome with rage, and slaps you again. She stares into your eyes, utterly consumed with the emotions roiling in her body, not knowing what to do with them, and finally the overflow, transforming into a passionate, angry kiss! Her hands snake around you and pull you into a bone-crushing embrace, and her pelvis is pressing aggressively into yours, almost like an attack.","","*choice","\t#Kiss her back.","\t\t*goto slapkiss","\t#Push her away.","\t\t*goto slappush","\t","*label slapkiss","*achieve angrykiss","*gosub_scene check_achievements","You wrap your arms around Tamara just as passionately, returning her kiss with equal intensity.","","Her kisses come fast and hard, anger quickly melting away into passion. She moans. She wraps one leg around yours, desperately pulling your bodies together, but just when she seems ready to take things to the next level, she suddenly she pushes you away. Hard. Both fall backward a few steps.","","\"No,\" she says, panting to catch her breath. \"We mustn't. We're here for one reason only, and that's the dragon.\"","","*label whynoromance","*choice","\t#Agree.","\t\tYou know it's for the best. She's here to rob the beast, and your quest is to rescue Princess Elsbeth. To get involved romantically would complicate matters too much.","\t\t","\t\tYou nod reluctantly, and silently the two of you resume your journey, neither speaking for a long time.","\t\t","\t\t*goto_scene oldman","\t#Ask why you can't have a relationship and continue your quest at the same time.","\t\t\"Because,\" Tamara says, \"My aid to you extends only to the point of our entrance into the lair. After that, we part ways, each left to their own fate. I still think you're going to die in your foolish quest, and even if you succeed, having the princess, you'll have no more need of me.\"","\t\t","\t\tChastened by her frank honesty, you can do nothing other than nod in silent acknowledgment of her hard truths. Silently, the two of you resume your journey, neither speaking for a long time.","\t\t","\t\t*goto_scene oldman","\t","*label slappush","\"What are you doing, Tamara?\" you cry, startled by her sudden, amorous transformation.","","Your push causes her to take a few step back, and when she recovers her balance, she smiles disdainfully.","","\"You weak man,\" she sneers. \"Am I too much woman for you?\"","","*choice","\t#Be reasonable: Tell her that's not it. You're just trying to maintain a professional relationship.","\t\t*goto slapreasonable","\t#Get angry: Tell her no one calls you weak and gets away with it.","\t\t*goto slapweak","\t#Change your mind: Tell her she's not too much woman and kiss her.","\t\t*goto slapkiss2","\t","*label slapreasonable","Tamara tosses her head to one side disdainfully. \"That's a noble idea,\" she says, \"But I still think you're weak.\"","","*label dragonwait","She turns and starts walking away.","","\"Come on,\" she says. \"The dragon won't wait forever.\"","","*goto_scene oldman","","*label slapweak","\"Then prove it,\" Tamara says, standing ready as if for either an amorous advance or physical assault. Before you can react, however, she changes her mind. \"No, wait,\" she says, strength in her voice. \"We can't.\"","","\"Can't what?\" ","","\"I don't know,\" Tamara says. \"What were you going to do?\"","*choice","\t#She insulted you. You were going to slap her.","\t\t\"That's what I thought,\" Tamara says. \"We can't fight. The dragon senses negative emotions, and that would surely summon its attention.\"","\t\t","\t\t*goto dragonwait","\t#She wanted a kiss. You were going to kiss her.","\t\t\"That's what I thought,\" Tamara says. \"We can't get involved romantically. My aid to you extends only to the point of our entrance into the lair. After that, we part ways, each left to their own fate. I still think you're going to die in your foolish quest, and even if you succeed, having the princess, you'll have no more need of me.\"","\t\t","\t\t*goto dragonwait","","*label slapkiss2","\"No,\" Tamara says, holding you back before your lips can reach hers. She wanted it before, but now that moment's passed.","","\"We can't get involved romantically,\" she says. \"We're here for one reason only, the dragon.\"","*goto whynoromance","","*label slapbye","*set with_tamara false","You stop walking, and Tamara continues on without a backward glance.","","*goto sameway","","*label noslap","Tamara steps back, looking at you, almost as if she's sorry, but it could also just be that she's wondering what you will do. When she sees that you do nothing, she says, \"We're even now. Come on.\"","","*goto_scene oldman","","*label follow","You follow from a distance, giving Tamara time to cool off before gradually catching up to her. ","","\"Took you long enough,\" is all she has to say.","","*goto_scene oldman","","*label gotcha","Tamara leaps to her feet and lets out a little scream. Strangely, her breeches are still up, belt buckle still fastened, but she drops what looks like a small glassy sphere. She quickly snatches it up and puts it in her belt pouch.","","\"Why did you do that?\" she cries.","*choice","\t#\"Just a joke, but... what was that glass sphere?\"","\t\t*goto sphere","\t#\"I was testing you. You're not a master-thief, are you?\"","\t\t*goto testing","\t","*label sphere","\"None of your spying-business,\" Tamara snaps. \"What did we just say about implicit trust?\"","*choice","\t#Agree that you should've trusted her more.","\t\t*goto agreetrust","\t#\"If we have implicit trust, why are you keeping secrets?\"","\t\t*goto keepingsecrets","\t","*label agreetrust","\"Good,\" Tamara says. ","","*label nomorespeak","The two of you resume your journey, and she speaks no more about the sphere you saw. ","","*goto_scene oldman","","*label keepingsecrets","Tamara sighs with frustration. \"Implicit trust is what YOU have to have because I'm the master of dragonlore. The glass sphere you saw is part of that dragonlore but is on a need-to-know basis. I snuck away to use it for a reason, and now you've messed that up. Don't let it happen again.\"","","*goto nomorespeak","","*label testing","Tamara is silent a long time. Finally she speaks. \"You're wrong,\" she says. \"I am a master-thief. You were able to sneak up and startle me because I was peering into the DragonEye.\"","","She reaches into her belt pouch and removes the glass sphere, and you see that contained within is indeed what looks like a dragon's eye.","","\"I'm vulnerable when I use it,\" Tamara goes on. \"That's why I snuck off, but by peering into it, I enter a trance and can find out the degree to which the dragon is watching. Look into it now and see for yourself.\"","*label testingchoice","*choice","\t#Squat against the tree and peer into the DragonEye while Tamara holds it.","\t\t*goto squat","\t*hide_reuse #Ask to hold it yourself.","\t\t*goto askhold","\t#Tell her you don't want to peer into the eye.","\t\t*goto nopeer","","*label squat","Tamara instructs you to squat leaning against the tree she was just using, and she squats next to you, holding the DragonEye before you. You peer into it, and after a minute or so, you feel yourself entering a trance. You lose sensation of your body, but the tree keeps you from falling over. Gradually, a light begins to grow inside the dragon eye within, and you get the creepy feeling of being watched. However, the light never grows above a dull glow, and you have the feeling the dragon's attention is diffuse, spread out evenly around the lair for many miles.","*choice","\t#Keep looking.","\t\tTamara nudges you. \"That's enough,\" she says, \"Strange things start to happen when you look longer, and it's not safe.\"","\t\t","\t\tYou tell her what you saw.","\t\t","\t\t*goto vigil","\t#Stop looking and tell Tamara what you saw.","\t\t*goto vigil","\t","*label vigil","*achieve dragoneye","\"Good,\" Tamara says. \"Neither the knight nor ourselves have done enough for it to pinpoint our location. It knows we're here, just not exactly where, and it will wait, watching vigilantly.\"","","As the two of you resume your journey, you look at your surroundings in a new light, almost as if you can sense the dragon everywhere, all around you. It makes you want to walk and speak more quietly.","\t\t","*goto_scene oldman","","*label askhold","\"This thing is worth half the plunder up on DragonKeep,\" Tamara says. \"I don't let anyone else touch it, let alone use it, and I'm only letting you use it now because we're so close to the lair. Will you look in it or not?\"","*goto testingchoice","\t","*label nopeer","\"The I guess we'll have to press on in ignorance,\" Tamara says. \"It's not my fault if the dragon swoops down and catches us unawares.\"","*choice","\t#Change your mind. You do want to peer into the DragonEye.","\t\t*goto squat","\t#Press on unawares.","\t\tTamara puts the DragonEye back in her belt pouch. \"Come on,\" she says, and the two of you resume your journey.","\t\t","\t\t*goto_scene oldman","","*label headback","*if with_tamara","\tSatisfied that Tamara's not up to something nefarious, you sneak back.","\t","\tIn a few minutes, Tamara returns, and it seems like she was gone for longer than she should have been.","\t*choice","\t\t#Ask her about it.","\t\t\t\"It always seems a long time for the one waiting,\" Tamara says, blithely walking by you. \"Come on. The dragon awaits.\"","\t\t\t","\t\t\tYou resume your journey.","\t\t\t","\t\t\t*goto_scene oldman","\t\t#Ignore it. Maybe she freshened up to be amorous later. (Yay!) Or had to go #2 also. (Ew!)","\t\t\t\"Come on,\" Tamara says. \"The dragon awaits.\"","\t\t\t","\t\t\t*goto_scene oldman","*else","\t*comment Not with Tamara","\tSatisfied that Tamara's not up to something nefarious, you sneak back.","\t*choice","\t\t#Continue the journey without her.","\t\t\t*goto continuebyself","\t\t#Wait for her.","\t\t\t*goto waitpee","\t\t","*label keepwatching","In a few moments, Tamara stands and begins returning the way she came, adjusting the pouch on her belt while she walks, seeming completely oblivious to your presence. She's coming right towards you.","\t","*choice","\t#OH NO, why didn't you realize this would happen??? Hide!","\t\t*goto hide","\t#Show yourself","\t\t*goto show","\t","*label show","*if with_tamara","\tYou know hiding would be useless. Tamara's heading right toward you, so to save the last bit of dignity you have, you stand and show yourself.","","\t\"What did you see!\" Tamara demands.","\t","\t*choice","\t\t#Tell her you saw nothing, the trees were in the way.","\t\t\t*goto sawtrees","\t\t#Tell her you saw her beautiful body.","\t\t\t*goto sawbody","*else","\t*comment Not with Tamara","\t\"Yeah, yeah, I knew you were there,\" Tamara says. \"For someone not traveling with me, you sure hang around a lot. Too chicken to creep closer? Too bad for you!\"","\t","\tShe walks past you, continuing the journey.","\t","\t*goto tamaraback","\t","*label hide","*if with_tamara","\tYou try to hide, but it's no use. Tamara sees you, and you cringe, ready for a tongue-lashing or even a blow. ","","\t\"What did you see!\" she demands.","\t","\t*choice","\t\t#Tell her you saw nothing, the trees were in the way.","\t\t\t*goto sawtrees","\t\t#Tell her you saw her beautiful body.","\t\t\t*goto sawbody","*else","\t*comment Not with Tamara","\tYou try to hide, but it's no use. Tamara sees you, jumps back, and puts her hand to the hilt of her sword until she sees it's you.","\t","\t\"Oh, it's just you,\" she says. \"For someone not traveling with me, you sure hang around a lot. Too chicken to creep closer? Too bad for you!\"","\t","\tShe walks past you, continuing the journey.","\t","\t*goto tamaraback","\t","*label sawtrees","*label sawbody","\"But nothing more?\" Tamara questions, her eyes narrowed suspiciously.","","*choice","\t#\"Nothing more.\"","\t\t*goto sawnothingmore","\t#\"What were you doing there?\"","\t\t*goto peesuspicious","\t","","*label sawnothingmore","\"Why did you follow me when I told you to stay put?\" she asks, obviously very angry with you. \"Can't a lady make water in peace?\"","","*choice","\t#Apologize","\t\t*goto peeapologize","\t#Tell her it's been a long time since you've been with a woman, and even a glimpse of her peeing was too hard to resist.","\t\t*goto resistpee","\t#Tell her you just met her, so you needed to make sure she wasn't up to anything suspicious.","\t\t*goto peesuspicious","\t","*label peeapologize","\"That's it?\" Tamara asks in disbelief. \"You hide to watch me pee and think just an apology is good enough?\"","","Tamara stares at you for a long time, thinking. Finally, she seems to have come to a decision.","\t","\"All right,\" she says. \"I'll let you off the hook this one time, but if you ever do anything like that again, I'll cut something off.\"","\t","*goto peeresume","","*label resistpee","\"Men are all alike,\" Tamara says, shaking her head. \"I was kinda liking you before, was even gonna make a pass at you in a bit, but now, no way. No nookie for you ever!\"","","*goto peeresume","\t","*label peesuspicious\t","\"Why are you asking if you didn't see anything?\" Tamara asks, eyes still narrow. ","*choice","\t#\"Because there was no 'lilypad shaking,' if you know what I mean.\"","\t\t*goto probe","\t#Let the matter drop.","\t\t\"Oh, no reason,\" you say and start to resume the journey. Tamara watches you suspiciously for awhile, but eventually the matter drops.","\t\t","\t\t*goto_scene oldman","\t","*label probe","\"Maybe not,\" Tamara says, \"But it's none of your concern. Remember how we just talked about implicit trust? Some things about dragonlore are on a need-to-know basis, and at this point, that's all you need to know.\"","*choice","\t#\"It was about dragonlore then?\"","\t\t\"Yes,\" Tamara says. \"And now you've messed it up, putting us both in unnecessary danger. We should be all right... this time, but don't do it again.\"","\t\t","\t\tShe turns to resume the journey.","\t\t","\t\t*goto_scene oldman","\t#\"How can I trust you if you're sneaking off and keeping secrets from me?\"","\t\t\"You don't have a choice,\" Tamara says. \"It's necessary precautions. It's in The Plan.\"","\t\t","\t\tShe turns to resume the journey.","\t\t","\t\t*goto_scene oldman","\t","*label peeresume","She walks past you, resuming the journey, and you walk in silence for about an hour, making slow progress through the thick forest foliage.","","*goto_scene oldman","","*label waitpee","*if with_tamara","\tYou wait, and you wait. It always seems a long time when you're waiting.","","\tFinally, she returns, sees you, and says, \"Good. I'm glad you didn't follow me in there to rape me when I had my pants down.\"","","\t*if tamara_laughed","\t\tShe smiles at her joke, and you realize she's actually a little charming when she's not her normal, ever-insulting self.","\t\t","\t\t*goto_scene oldman","\t*else","\t\tShe smiles at her joke, and you realize it's the first time you've seen her smile. She's pretty when she does that, but the smile's woefully shortlived.","\t","\t*goto_scene oldman","*else","\tYou decide to wait for Tamara, though you're not sure why. Maybe it's the fact that she really might be able to help you on your quest or maybe it's just the vague possibility you might get lucky. It's certainly not her charming personality.","\t","\tIn a few minutes, she finally comes back.","\t","\t\"Hey, you're still here,\" she says. \"Does that mean we're traveling together now?\"","\t","\t*fake_choice","\t\t#\"Yeah, I guess...\"","\t*gosub_scene agreement","\t*goto_scene oldman","",""]},"honeypot":{"crc":627431070,"labels":{"notworth":7,"whatabout":12,"howmuch":26,"keeptalking":36,"keeptalking2":53,"hashoney":64,"showhoney":76,"moneyquestion":88,"moneyquestion2":94,"ask":134,"smear":141,"lick":160,"steady":168,"dripdown":175,"tongueon":187,"dab":194,"stand":214,"boobsfirst":224,"permission":269,"liedown":274,"lap":286,"myturn":302,"slow":316,"breeches":330,"liedone":335,"justkeep":349,"sneakback":357,"climb":369,"reach":379,"fist":387,"fall":390,"fall2":392,"answers":414,"noanswers":421,"feelfurther":428,"anotherpiece":438,"oneonly":442,"knock":454,"empty":458,"throw":472,"focus":492},"lines":["\"Ohh! Look, a beehive,\" Tamara says suddenly, pointing into the boughs of a nearby tree. Indeed, you see a beehive up there.","*choice","\t#You like honey, but it's not worth getting stung.","\t\t*goto notworth","\t#\"What about it?\"","\t\t*goto whatabout","\t","*label notworth","You continue on, and the hive is not mentioned again.","","*return","","*label whatabout","\"Oh, nothing, nothing,\" Tamara says, but she gives the hive a wistful glance as you pass it.","","\"What? Do you like honey or something?\" you ask.","","\"Yes, but we can't stop for silly things like that, can we?\"","*choice","\t#\"How much do you like honey?\"","\t\t*goto howmuch","\t#Agree and continue on.","\t\tThe two of you continue on, and the hive is not mentioned again.","\t\t","\t\t*return","\t\t","*label howmuch","\"A lot,\" Tamara says, \"But stop talking about it!\" She glares at you with her piercing green eyes, and her intensity almost scares you. You better not talk about it anymore.","*choice","\t#Keep talking about it.","\t\t*goto keeptalking","\t#Stay silent.","\t\tThe two of you continue on, and the hive is not mentioned again.","\t\t","\t\t*return","\t\t","*label keeptalking","\"Okay, dammit!\" Tamara says. \"My weakness is honey. Smear some on me, and I'll let you lick it off.\"","","\"Smear some on you where?\" you ask.","","\"Anywhere, but there's no time now. ","*if had_pro_talk","\tRemember our little talk? Put it OUT of your mind.\"","\t","\t*goto keeptalking2","*else","\tEven if there was, you and I have a professional relationship, so I expect there to be NO funny business between us. Understand?\"","\t*set had_pro_talk true","","*if not (has_honey)","\tYou kick yourself. If only you hadn't eaten the last of your honey at breakfast!","\t","*label keeptalking2","*choice","\t*selectable_if (has_honey) #\"I have some honey!\"","\t\t*goto hashoney","\t*if (not (has_honey)) #Sneak back later, climb the tree, and get some honey.","\t\t*goto sneakback","\t*if (not (has_honey)) #Stay focused on the journey.","\t\t*goto focus","\t*if (has_honey) #Better not mention that you have honey.","\t\t*goto focus","\t","*label hashoney","\"You do???\" Tamara says, eyes wide with excitement at first, but she quickly controls herself. \"Well, good for you. Make sure you eat it. We don't need any temptation.\"","","She seems pensive and upset now, increases her pace, and just concentrates on looking at the ground.","*choice","\t#Show her the honey. (Ten points if you know where that's from.)","\t\t*goto showhoney","\t#Ask nicely.","\t\t*goto ask","\t#Smear honey on her boobs.","\t\t*goto smear","\t","*label showhoney","*set has_honey false","You \"show her the honey.\"","","\"That's nice,\" Tamara says and bats the honey from your hand. It falls to the ground, gets dirty, and now you have no more honey.","*temp moneyquestion","*temp moneyhint 0","*temp another \"a\"","*choice","\t#Continue on.","\t\t*goto focus","\t#Answer the question for ten points.","\t\t*label moneyquestion","\t\t*if moneyhint = 1","\t\t\t*set another \"another\"","\t\t\t*goto moneyquestion2","\t\t*elseif moneyhint = 2","\t\t\t*set another \"yet another\"","\t\t*label moneyquestion2","\t\tWhat is your final answer?","\t\t*input_text moneyquestion","\t\t*if moneyquestion = \"Jerry Mcguire\"","\t\t\t*achieve money","\t\t\tYes! Ten points for you!","\t\t\t*page_break","\t\t\t*goto focus","\t\t*else","\t\t\tSorry that is not the correct answer. Try again?","\t\t\t*choice","\t\t\t\t#Yes.","\t\t\t\t\t*goto moneyquestion","\t\t\t\t#Yes, but I need ${another} hint.","\t\t\t\t\t*set moneyhint +1","\t\t\t\t\t*if moneyhint = 1","\t\t\t\t\t\tHINT: Exact capitalization is important.","\t\t\t\t\t\t","\t\t\t\t\t\t*goto moneyquestion","\t\t\t\t\t*elseif moneyhint = 2","\t\t\t\t\t\tHINT: It's a movie.","\t\t\t\t\t\t","\t\t\t\t\t\t*goto moneyquestion","\t\t\t\t\t*elseif moneyhint = 3","\t\t\t\t\t\tHINT: Cuba Gooding Jr. is in it.","\t\t\t\t\t\t","\t\t\t\t\t\t*goto moneyquestion","\t\t\t\t\t*else","\t\t\t\t\t\tAll three hints:","\t\t\t\t\t\t","\t\t\t\t\t\t1. Exact capitalization is important.","\t\t\t\t\t\t*line_break","\t\t\t\t\t\t2. It's a movie.","\t\t\t\t\t\t*line_break","\t\t\t\t\t\t3. Cuba Gooding Jr. is in it.","\t\t\t\t\t\t","\t\t\t\t\t\t*goto moneyquestion","\t\t\t\t#No.","\t\t\t\t\t*goto focus","","*label ask","\"No, no, no, dammit, no!\" Tamara shouts, stomping her feet.","","I guess that's it then.","","*goto focus","","*label smear","*set has_honey false","You carefully take out your honey, making sure Tamara doesn't see. You sneak up behind her, and...","*page_break","SLAM! You slap the honey right on her chest!","","\"Oh no, you didn't!\" Tamara cries as the honey begins to ooze between her luscious globes. \"This vest cost 10,000 gold pieces!\" She quickly unties its strings and rips it open, and the honey continues to travel down her body onto her stomach. Her honey covered breasts stand before you in all their heavenly glory.","","\"Well?\" Tamara says. \"Are you going to finish what you started or not?\"","","\"Really?\" you stammer.","","\"Yes,\" Tamara says. \"It's my fetish, but don't get any funny ideas. After this, nothing changes, got it?\"","*choice","\t#Go at it!","\t\t*goto lick","\t#Ask her to lie down first.","\t\t*goto liedown","\t","*label lick","You can't believe such a fierce woman would allow it, but she lets you come right up to her and put your face right into her bosom. ","*choice","\t#Put your arms around her to hold her steady.","\t\t*goto steady","\t#Better not touch her without permission.","\t\t*goto permission","\t","*label steady","You gently place your hands on Tamara's shoulder blades, wondering if she will allow it or not.","","She allows it!","","You bend and begin licking the honey from Tamara's breasts. Her hands reach around and pull your face into her body, smearing it with honey. \"That's what you get for being naughty,\" she says.","*page_break","*label dripdown","\"Oooh!\" she says and begins undoing her belt. You look down and realize the honey has flowed down her body and has reached her navel. She pulls down her breeches just in time, for the honey is beginning to flow past her navel toward her mound of venus.","","\"Now look what you have to do,\" she says and pushes you down her body until you're on your knees. Her sex is right before you, but the honey has not yet reached it.","*choice","\t#Put your tongue on her sex, waiting for the honey to come. (Either one.)","\t\t*goto tongueon","\t#Dab at her navel with your tongue.","\t\t*goto dab","\t#Stand back up to finish her boobs first.","\t\t*goto stand","\t","*label tongueon","Neither one comes just yet, though Tamara's sex is engorged and overflowing copiously. She pulls your head off of her. \"There's no honey there,\" she says. ","","Reluctantly, you depart from heaven and go to the purgatory of her navel. ","","*goto dab","","*label dab","\"Yesss...\" Tamara purrs as you begin dabbing at her navel with your tongue.","","First you clean the honey from its rim, and as you start to push your tongue further in, she giggles. \"It tickles, but I like it,\" she says, holding your head hard against her belly. It's warm from the exertion of the hike, and you can feel her muscles tensing and relaxing as well as the rise and fall of her breath. You look up, and her chest is heaving. You time your licks to the mesmerizing rhythm of the rise and fall of her breasts, working your way back up to them when all the honey is gone from below.","","\"Oh gods,\" Tamara moans when your tongue plays over her breasts again. \"That feels so good.\"","","She falls to her knees and takes you with her, her hands holding your head tight against her chest. She cradles it like a baby as you finish your ministrations, finally finding no more honey no matter where your tongue roves.","","\"Ohhh... that was good,\" Tamara says, releasing your head and starting to ease her mammaries back into her vest, pulling the strings taut once again. She stands and pulls her breeches back up, and you wonder if you'll ever see again that alluring sight she keeps hidden in there.","","\"Well, let's get going,\" she says.","*choice","\t#What about your turn?","\t\t*goto myturn","\t#That's it then?","\t\tYes, you can tell Tamara's no longer in an amorous mood, and in fact, she seems a little standoff-ish now. You fall in behind her as she resumes the climb up the foothill.","\t\t*page_break","\t\t*return","\t\t","*label stand","\"Quick. It's dripping down,\" Tamara says and pushes you back down.","*choice","\t#Tell her you want to finish her boobs first.","\t\t*goto boobsfirst","\t#Put your tongue on her sex, waiting for the honey to come. (Either one.)","\t\t*goto tongueon","\t#Dab at her navel with your tongue.","\t\t*goto dab","","*label boobsfirst","*set tamara_respect %+5","Tamara's respect for you goes up slightly:","*stat_chart","\tpercent tamara_respect Tamara's Respect","\t","*line_break","\"Okay...\" Tamara says, too turned on to resist further. \"But get it before any drips on my breeches.\"","","You watch the honey creep ever so slowly down her lower stomach and onto her mound of venus, but you continue running your tongue all over her breasts, left to right and up and down in long slow strokes slowly but surely finding every last trace of honey. Tamara moans and keeps running her fingers through your hair, and you watch the honey finally reach the very top of her vulva.","","You begin following the honey trail downward over her quivering stomach and finally to her navel, while meanwhile, the honey below infuses into the folds of her inner and outer lips.","","You use your lips and tongue on her navel, making Tamara giggle. \"It tickles,\" she says, \"But I like it.\"","","*set honey_breeches true","A drip of honey falls from her sex and onto her breeches, and you decide it's time. You move down her body, your tongue never leaving her, and that makes her shiver.","","You feel your tongue leave the softness of her stomach, reach her mound, crest it, and continue down into the mystery of mysteries below. You put your mouth over her clitoral nub and dab it gently with your tongue while simultaneously mouthing it with your lips, and the honey thins, dripping more into her breeches. You look up at her face, and she either hasn't notice or no longer cares, her head thrown back, eyes closes, mouth open. She breathes heavily and moves her head from side to side in ecstasy.","*page_break","*achieve honeypot","*gosub_scene check_achievements","You extend your tongue so that it covers the whole of her opening and lick the honey from the outer lips. She's so soft and engored, and sopping wet too. You cover her entire sex with your mouth and use your tongue to tease the honey from her folds. Then you begin to probe deeper, first between her inner and outer lips, then between the inner lips themselves. Tamara gasps then, and a hand snakes around your neck to pull your head into her crotch.","","\"Use your tongue! Use your tongue!\" she cries, and you push it forward into her gushy softness again and again until she's screaming with pleasure.","","You feel her body begin to crumple to the ground, but she keeps your head locked in place. \"Don't stop!\" she cries as she falls to her knees, and by twisting your head upside-down, you're able to maintain constant contact with your tongue throughout the maneuver. ","","Tamara leans back, her legs still bent under her, until her shoulders touch the ground, her back arched. \"Keep going,\" she begs, and you move so that you're hovering over her, your hands on the ground to either side of her. She bucks her hips wildly, all the while locking your head to her sex, your tongue squirming all about until she shudders for nearly an entire minute. It seemed it would never end, but at long last, the spasms wracking Tamara's body subside. She releases your head, and her hands fall to either side as she collapses into profound relaxation. You watch her chest as it still heaves in her contorted position, and finally she rolls to one side to pull her feet out from under her.","","\"Wow,\" she says finally. \"I never had a fun honey time like that before.\"","*choice","\t#And... now is it your turn?","\t\t*goto myturn","\t#I guess we're done?","\t\tYes, you can tell Tamara's no longer in an amorous mood, and in fact, she seems a little standoff-ish now. You fall in behind her as she resumes the climb up the foothill.","\t\t*page_break","\t\t*return","\t#Apologize for letting some honey drip into her breeches.","\t\t\"Oh, don't worry about that,\" Tamara says. \"It wasn't much, and I kind of like it now. It'll make me think of you while I walk today.\"","\t\t","\t\tShe stands and pulls her breeches back up, and you watch her sex, that which you just touched so intimately, disappear, perhaps never to be seen again by you. She then eases her mammaries back into her vest, and as she refastens the strings, you wonder if you'll ever see them again as well. You wish you had more honey!","\t\t*page_break","\t\t*return","\t\t\t","*label permission","Good thinking. You bend at the knees and keep your hands well off her as you start to lick the honey from her breasts. Sometimes she sways on her feet, causing you to break contact, and after this happens a few times, she encircles your head with her arms and holds it against her body. You feel the softness of her breast against your cheek and rest it there, cradled like a baby, as you slowly move your tongue up and down, gradually removing the sticky sweet honey.","*page_break","*goto dripdown","","*label liedown","\"Oh, you!\" Tamara says, but she does indeed lie down, gently easing her body down onto a nearby patch of grass. \"Hurry up,\" she says.","","You kneel beside her and lower your head to her chest, savoring the sight of that which you may never see again. ","","Tamara grabs your head and shoves it right between her bosoms and smears they honey all over your face. \"That's what you get for not hurrying up,\" she says.","*choice","\t#Start lapping.","\t\t*goto lap","\t#Lick her sensually and slowly.","\t\t*goto slow","\t","*label lap","You start licking Tamara's boobs like a dog cleaning its bowl. Her breasts are so soft under your tongue you can hardly stand it! You make long strokes to get most of the honey, then give special attention to the heavy spots, sucking and slurping and having a grand 'ol time. Tamara seems to enjoy it too, moaning softly from time to time, and she puts a hand on your back.","","All too soon, it's over, and you can taste no more honey on her body no matter where you try to find it.","","\"That's it, then?\" Tamara asks, and sadly, you have to agree.","","\"Thanks!\" she says as she eases her mammaries back into her vest and pulls the strings tight once again. \"That was fun.\" She stands and gets ready to resume the hike.","*choice","\t#And... now is it your turn?","\t\t*goto myturn","\t#I guess we're done?","\t\tYes, you can tell Tamara's no longer in an amorous mood, and in fact, she seems a little standoff-ish now. You fall in behind her as she resumes the climb up the foothill.","\t\t*page_break","\t\t*return","","*label myturn","It looks like you don't get a turn.","*choice","\t#Push it.","\t\t\"I don't see any honey on your dick,\" Tamara says. \"And besides, it's a one-way fetish.\"","\t\t","\t\tI guess that's that. Well, it was still fun, right?","\t\t*page_break","\t\t*return","\t#Accept your sad fate.","\t\tThoughts of Princess Elsbeth and her overflowing gratitude console you as you ruefully resume your hike up the foothill.","\t\t*page_break","\t\t*return","\t\t","*label slow","*set tamara_respect %+5","Tamara's respect for you goes up slightly:","*stat_chart","\tpercent tamara_respect Tamara's Respect","\t","*line_break","Though you enjoy the sweet taste, you enjoy Tamara's body more, and it shows as you take your time exploring every inch of her chest with your lips and tongue. Her breasts are so soft under your tongue you can hardly stand it! You make long strokes to get most of the honey, then give special attention to the heavy spots, sucking and slurping and having a grand 'ol time. Tamara seems to enjoy it too, moaning softly from time to time, and she puts a hand on your back. She runs her hands up and down your spine, neck, and head, her fingers playing in your hair. She stretches her body and arches her back, pressing upward into the pleasure your tongue is giving her.","*choice","\t#Remove her breeches.","\t\t*goto breeches","\t#Just keep licking her chest.","\t\t*goto justkeep","\t","*label breeches","\"No, there's no honey there,\" Tamara breathes softly, grasping your hands but not even opening her eyes. \"Stay up here...\" She pulls your head back down onto her chest.","","You resume licking, and she resumes her caresses up and down your back until finally, you can find no more trace of sweetness despite where you search all over her luscious mounds.","","*label liedone","Tamara stirs and starts to sit up. \"Thank you,\" she says and kisses you on the lips before starting to ease her mammaries back into the confines of her vest and refasten the strings.","*choice","\t#Keep kissing her.","\t\tTamara pulls away and looks at you funny. \"Come on,\" she says. \"We've wasted enough time as it is.\"","\t\t*page_break","\t\t*return","\t#Ask if it's your turn now.","\t\t*goto myturn","\t#I guess we're done?","\t\tYes, you can tell Tamara's no longer in an amorous mood, and in fact, she seems a little standoff-ish now. You fall in behind her as she resumes the climb up the foothill.","\t\t*page_break","\t\t*return","\t\t","*label justkeep","\"Oh gods,\" she moans. \"I don't know why I like this so much.\"","","Her body continues to writhe sensually beneath you, but if ever you put a hand on her body, she stops you. You have no choice but to focus on the honey until finally, sadly, it's all gone.","","At long last, ","*goto liedone","","*label sneakback","In a short while, you say, \"Um, Tamara? I have to go shake the dew of MY lilypad, now.\"","","\"You don't have to announce it to the whole world. Just go do it,\" Tamara retorts.","","You go back to the beehive, and it seems Tamara has not shadowed you.","*choice","\t#Climb the tree.","\t\t*goto climb","\t#Throw a rock at the hive to knock it down.","\t\t*goto throw","\t","*label climb","You climb the tree and reach the beehive. The bees buzz about lazily, ignoring your presence. You wish you had time to light a fire and smoke them out, but you don't. Even so, you believe that if you're careful enough, you should be able to break off a piece of honeycomb without angering the bees.","*choice","\t#Reach in and break off a piece of honeycomb.","\t\t*goto reach","\t#Knock the hive down.","\t\t*goto knock","\t#Think better of this plan and climb back down empty-handed.","\t\t*goto empty","\t","*label reach","You carefully reach inside the hive and feel a solid wall of honeycomb as well as bees crawling all over your hand.","*choice","\t#Push your fingers in and rip off a fistful of honeycomb.","\t\t*goto fist","\t#Feel around further.","\t\t*goto feelfurther","\t","*label fist","*set bee_sex true","As you begin to push your fingers into the honeycomb, you feel a sting, ","*label fall","which makes you jerk. This makes your hand hit other bees who also sting you. ","*label fall2","Bees begin to cover your body, all stinging you, and you fall from the tree. You feel bees stinging you as you're falling, and then the ground hits you. As you're losing consciousness, you feel your throat swelling shut.","","\"Well, looks like this is the end,\" you think to yourself. \"The risk was worth it, though.\"","*page_break","Consciousness returns... Hey! You can breathe again. How did that happen? And your body is no longer covered in bee stings.","","Tamara's sitting nearby licking honey off her fingers. When she sees you're awake, she stands and says, \"Good. Let's get going.\"","","A few bees, no longer hostile, waft by on a gentle breeze.","","\"What happened?\" you ask","","\"Nothing,\" Tamara says, obviously impatient to resume your journey. She's already walking on ahead.","","As you're standing up, you feel something odd in your trousers. They're on funny, and your belt seems hastily refastened. Your penis too... it feels like it just had sex.","*choice","\t#Push Tamara for answers.","\t\t*goto answers","\t#Better not.","\t\t*goto noanswers","","*label answers","You start to ask Tamara for answers, but before half your sentence is out of your mouth, she launches into a half-hour long tirade about how \"men are all alike,\" \"only want one thing,\" \"do such stupid things to get it,\" and \"make women clean up after them.\"","","In the end, you get no answer.","*page_break","*return","","*label noanswers","You silently join Tamara, resuming your hike.","","\"We will not speak of this ever,\" Tamara says and then says nothing more, just keeps walking.","*page_break","*return","","*label feelfurther","You reach deeper in and feel where someone in the past has already broken off a piece of honeycomb, and you're able to break off another piece from the same place, which you wrap in a leaf and put in your pack. ","","You believe you could break off a second piece from the same place just as easily.","*choice","\t#Break off another piece.","\t\t*goto anotherpiece","\t#One is enough.","\t\t*goto oneonly","","*label anotherpiece","You reach back into the hole in the hive, but this time you accidentally squash a bee. It stings you, ","*goto fall","","*label oneonly","*set has_honey true","*achieve honey ","Best not to take too many chances however tempting it may be to have two sessions of honey-licking with Tamara. You climb down the tree, and return to find Tamara waiting for you.","","\"You take too long,\" she says and resumes the journey.","*choice","\t#Slap the honey on her chest.","\t\t*goto smear","\t#Save it for later.","\t\t*return","","*label knock","You hit the hive with a big stick, but it doesn't fall. Bees swarm out and attack you! Several sting you, and you try to ignore the pain while climbing down, being careful not to slip. ","*goto fall2","","*label empty","Really? Isn't it worth braving a few stings for the prospect of licking honey off Tamara's luscious flesh? The bees don't seem to be defending their hive, and the honeycomb inside is easy to see through a gap you can easily reach into.","*choice","\t#Nope, too risky, even if honey is Tamara's fetish.","\t\tYou climb back down and return to find Tamara waiting.","\t\t","\t\t\"You take too long,\" she says. ","\t\t","\t\tThe two of you resume your journey.","\t\t*page_break","\t\t*return","\t#Change your mind. Get some honey!","\t\t*goto reach","","*label throw","You find a nice hefty rock and launch it at the hive. Direct hit! However, the hive doesn't fall, but now the bees are angry.","*choice","\t#Throw another.","\t\tYou throw an even bigger rock this time, but still, the hive doesn't fall. Bees are beginning to fly fast in your direction, and you run to escape them.","\t\t","\t\tYou get stung once or twice on the arms, but once you're far enough away, the bees stop chasing you. You return to where Tamara's waiting for you, and she glances at the welt on your arm.","\t\t","\t\t\"Good thing they didn't get you on the 'lilypad,'\" she says and resumes walking.","\t\t*page_break","\t\t*return","\t#Go back to Tamara.","\t\tYou return to find Tamara waiting.","\t\t","\t\t\"You take too long,\" she says. ","\t\t","\t\tThe two of you resume your journey.","\t\t*page_break","\t\t*return","","*label focus","*return","",""]},"oldman":{"crc":-665621467,"labels":{"ass":9,"noass":14,"honeypot":25,"oldman":31,"losesight":56,"hug":64,"boobgraze":70,"hello":76,"lookoldman":95,"hail":116,"catchup":131,"catchupchoice":146,"apologize":155,"intro":160,"death":165,"next":173,"deathchoice":183,"why":194,"allright":198,"ally":204,"save":229,"save2":237,"silenttorture":241,"revelation":251,"resume":269},"lines":["You hike another fifteen minutes, Tamara a few feet in front of you.","","*choice","\t#Look at her ass.","\t\t*set looked_ass true","\t\t*goto ass","\t#Refrain.","\t\t*goto noass","\t","*label ass","You enjoy watching Tamara's ass muscles working as she climbs the foothill, and it makes your climb easier. If she notices, she doesn't let on.","","*goto honeypot","","*label noass","It's hard, but you keep your eyes averted. Are you being polite or...","","*fake_choice ","\t#Yes, it's out of politeness.","\t\t*set was_polite true","\t\tWhat a gentleman! Where's your armor? You could be a knight yourself.","\t\t","\t#Maybe some politeness, but mostly to avoid her wrath.","\t\tThat's probably a good policy.","\t\t","*label honeypot","*if with_tamara","\t*gosub_scene honeypot","","You walk for perhaps another two miles, steadily hiking up the steep slope of the foothill.","","*label oldman","*if with_tamara","\tTamara raises her fist, the universal hand signal for, \"Stop.\"","\t","\t\"I see the old man ahead,\" she whispers.","\t","\tShe motions you forward to see for yourself, and to do so, you have to move quite close to her. Do you...","\t","\t*choice","\t\t#Take the opportunity to put an arm around her, just to steady yourself on the rocky slope, of course.","\t\t\t*goto hug","\t\t*selectable_if (was_polite = false) #Take the opportunity to slide in and try to cop a surrepetitious boob graze.","\t\t\t*goto boobgraze","\t\t#Just move in close but do nothing sleazy.","\t\t\t*goto lookoldman","\t\t#Decide the old man isn't a threat. Boldly show yourself and say hello.","\t\t\t*goto hello","*else","\t*comment not with tamara","\tSince Tamara's able to climb faster than you, the distance between you increases until she's quite a bit ahead of you. ","\t*if looked_ass","\t\tNow that your \"motivation\" is gone, the climb begins to tire you again, but you trudge on. ","\t\t","\t*goto losesight","\t\t","*label losesight","You eventually lose sight of her, but in a few moments, you hear her (all too familiar) voice from somewhere up ahead. It seems she's talking to someone, and it's not you for a change.","\t","Climbing for a few more minutes, you see Tamara again, and she's talking with the manservant of the female knight. He introduces himself as Banes, and you learn that the knight, named Juliette, has left him here because he was too frail to continue the journey. He's obviously distraught at this, and they loved each other very much.","\t","*goto catchup","","\t\t","*label hug","*set tamara_respect %-10","Tamara looks at you askance but doesn't say anything.","","*goto lookoldman","","*label boobgraze","*set tamara_respect %-15","You manage to nudge one of her boobs with your shoulder and sliiide across it. It feels great! Tamara seems nonplussed, but in the current situation, she's unable to give you her normal tongue-lashing.","","*goto lookoldman","","*label hello","Tamara frowns at your usurpation of her command.","","*gosub_scene adj_respect -10","","\"Hail to thee!\" you call. \"May we approach?\"","","The old man's head jerks up, and he struggles to his feet as fast as he can, needing to brace one hand against the rock he was sitting on.","","\"Yes, yes, of course, stranger!\" he calls back. \"Welcome!\"","","Shaking her head, Tamara begins the hike toward the old man ahead of you, and as it's some distance, she makes the introductions along the way, announcing your quest to assault the dragon's lair.","","You see the old man wipe his eyes, and he forces an overly friendly demeanor to hide his grief. \"My name is Banes,\" he says. \"Manservant to the knight-errant, Juliette, who has continued on...\" ","","It's pitifully obvious what happened. When the slope of the foothills increased, the old man simply could not go on. In fact, it's a wonder he's made it as far as he has.","","*goto catchup","","*label lookoldman","From your new vantage point, you're able to see the old man, as well as enjoy being so close to Tamara's hot body. Literally. You can feel the heat emanating from it in waves of hot, moist air, and you can even smell her sweat. You sense her breathing, still a bit heavily from the climb, her breasts rising and falling so near to you.","","Tearing your attention away from Tamara, you focus on the old man. He's sitting on a boulder, eyes cast downward, apparently doing nothing. The knight is nowhere to be seen, and nothing seems amiss.","","*choice","\t#Whisper to Tamara, \"Should we hail him?\"","\t\t\"It seems safe,\" Tamara replies. \"Yes, let's hail him.\"","\t\t","\t\t*goto hail","\t#Ask Tamara what to do.","\t\t*set tamara_respect %-5","\t\tTamara seems irritated by your indecisiveness. \"I'll handle it,\" she says.","\t\t","\t\t*goto hail","\t#\"Let's rob him!\"","\t\t*set tamara_respect %-20","\t\t\"Oh my gods,\" Tamara hisses fiercely, keeping her voice down. \"Don't you remember my plan?!? We need to ally with these people.\"","","\t\t*goto hail","\t","*label hail","Tamara stands. \"Hail to thee!\" she calls. \"May we approach?\"","","Wow. Tamara being polite. That's a first.","","The old man's head jerks up, and he struggles to his feet as fast as he can, needing to brace one hand against the rock he was sitting on.","","\"Yes, yes, of course, stranger!\" he calls back. \"Welcome!\"","","Tamara begins the hike toward the old man, and as it's some distance, she makes the introductions along the way, announcing your quest to assault the dragon's lair.","","You see the old man wipe his eyes, and he forces an overly friendly demeanor to hide his grief. \"My name is Banes,\" he says. \"Manservant to the knight-errant, Juliette, who has continued on...\" ","","It's pitifully obvious what happened. When the slope of the foothills increased, the old man simply could not go on. In fact, it's a wonder he's made it as far as he has.","","*label catchup","Banes can no longer control his tears, and his voice breaks. \"Her... quest... is similar... to yours...\" he manages through his sobs. \"I'm sorry,\" he says. \"It's just that I've known her since she was born, and I so wanted to be with her in her moment of glory.\"","","\"Or death,\" Tamara says, and Banes' tear-filled eyes widen in astonishment.","","\"How can you say such a thing?\" Banes says.","","*if with_tamara","\tApparently now that Tamara knows that Juliette has abandoned Banes, she has returned to her ordinary demeanor.","\t*goto catchupchoice","*else","\tBanes sees you approaching and looks quizzically at Tamara.","\t","\t\"Oh him,\" Tamara says. \"Just ignore him. He's not important.\"","","*label catchupchoice","*choice","\t*if (not (with_tamara)) #Introduce yourself to Banes.","\t\t*goto intro","\t#Apologize to Banes for Tamara's insult.","\t\t*goto apologize","\t#Let her speak for herself.","\t\t*goto death","\t","*label apologize","\"I apologize for her,\" you say and try to step in front of Tamara, but she doesn't let you.","","*goto death","","*label intro","You introduce yourself to Banes and tell him of your quest.","","*goto death","","*label death","*if with_tamara","\t\"In matters like these, ignoring the truth is a liability,\" Tamara says matter-of-factly, completely ignoring Banes' pain. \"Alone as she is, it's a fool's errand, and you are wise to leave her. Though you are in your last days, you will likely outlive her, that is, unless she accepts my help, which we are endeavoring to offer.\"","\t","\t*goto next","*else","\tTamara ignores you and just keeps speaking. \"In matters like these, ignoring the truth is a liability,\" she says matter-of-factly, completely ignoring Banes' pain. \"Alone as she is, it's a fool's errand, and you are wise to leave her. Though you are in your last days, you will likely outlive her, that is, unless she accepts my help, which we are endeavoring to offer.\"","","*label next","\"You would do that?\" Banes says, hope returning to his features.","","\"Yes,\" Tamara says, \"If she will accept it. Knights are very proud, aren't they?\"","","\"That is true,\" Banes says, easing himself back down onto the rock, a pensive look on his face.","","\"Well, we are off,\" Tamara says. \"Good luck, old man.\"","","Is there anything you wish to ask the old man?","*label deathchoice","*choice","\t*disable_reuse #\"What made Juliette undertake a quest like this?\"","\t\t*goto why","\t*disable_reuse #\"Do you know anything about Juliette that might help us convince her to ally with us?\"","\t\t*goto ally","\t*disable_reuse #\"Are you going to be all right?\"","\t\t*goto allright","\t#Continue on.","\t\t*goto resume","\t","*label why","\"Oh, I tried to talk her out of it,\" Banes says. \"But she would hear none of it. When she gets an idea in her head, there's no stopping her, and her skill in arms has always been enough to carry her through, despite her stubbornness. I think she's doing it because of her brother. She's one of the best knights in the kingdom, but she was unfortunate enough to have been born the little sister of a truly gifted warrior. She's lived in his shadow her whole life, and I believe she became a knight-errant to try and get out from under it, traveling the countryside, engaged in noble deeds, rather than the stuffy affairs of court. Still, it gnawed at her, and when she heard the dragon assaulted the castle, she vowed to kill it. 'To fight the unbeatable foe,' was how she put it, 'for honor in either glory or death.'\"","*goto deathchoice","","*label allright","\"Oh, I'll be fine,\" Banes says. \"I have enough food, and I'll wind my way down, back to Chardell. I'll wait there for you.\"","","\"Don't wait too long,\" Tamara says, several yards up the slope already, tapping her foot impatiently.","*goto deathchoice","","*label ally","*set banes_love_talk true","\"Make friends with her,\" Banes offers. \"She seems strong and aloof on the surface, but don't let that put you off. Underneath...\"","","He bursts into tears again and speaks through the sobs wracking his body. \"She...\" he manages. \"has a heart... of gold!\"","","Tamara, who was already walking ahead, turns around. \"Are there any other body parts of hers that might help us reach that heart of gold, old man?\" she asks suggestively.","","Once again, Banes' eyes open wide in shock.","","\"Like I said before, this is not the time for modesty,\" Tamara says. \"Do you know something or not?\"","","Banes seems reluctant to engage in such a lewd subject, so Tamara continues. \"Look,\" she says. \"I'm a master tracker. I've seen all your sign and your tracks, and I know what goes on every morning. You had rabbit last night, and for two days, you've rationed your water. Juliette has an old injury just above the left knee. You love each other deeply and never argue.\"","","\"How in the world could you know all that?\" Banes cries, his face reddening.","","\"Easy,\" Tamara says. \"You walk side by side a bit too close together for full freedom of movement. Only people who love each other do that for a whole journey, and it never wavered once. On a hard journey, especially with you slowing her down like you have, your spacing would have increased during testy times, but even that never happened. So anyway, with privacy already lost, you can tell us anything. It might save her life. Probably not, but if you really love her that much, I'm sure the small impropriety is worth it, no?\"","","*choice","\t#Save the old man from Tamara's torture.","\t\t*set tamara_respect %+15","\t\t*goto save","\t#Stay silent.","\t\t*goto silenttorture","","*label save","*if with_tamara","\t\"Tamara!\" you cry. \"This is going too far. We'll make friends with Juliette, not seduce her.\"","\t","\t*goto save2","*else","\t\"Tamara!\" you cry. \"You go too far. You've been insulting me all day, but I will not have you insult an old man by asking him for advice on seduction!\"","","*label save2","\"No, no, I'll tell you!\" Banes quickly protests. \"It might be important, and... 'seduction...'\" The word is hard for him to say. \"The... animal... passions are powerful in all of us, but they run especially powerful in Juliette. ","*goto revelation","\t","*label silenttorture","Banes is silent a long time. \"Yes, we did love each other...\" he says quietly at last.","","\"Yes, yes, we know that,\" Tamara spats, getting impatient. \"Now out with the huicy details or we can just move on with out them. Your choice.\"","","\"No, no, please don't leave,\" Banes quickly protests. \"I'll tell you.\"","","He inhales deeply, face very red, but with reluctance he finally speaks. \"The... animal... passions...\" he begins. The words are hard for him to say. \"They're powerful in all of us but are especially so in Juliette. ","*goto revelation","","*label revelation","*set banes_sex_talk true","Why else would she stoop to be with a tired old man like myself? I think of her as my own daughter, so it gave me no pleasure to do what we did. Her love for me was no more than as for a father figure either.\"","","\"Well, that explains why she never gave full rein to her passions then,\" Tamara says. \"But it wasn't her who did the stooping.\" She laughs.","","Banes turns red again but is mostly astonished once again at how much Tamara is able to discern merely from the nearly imperceptible signs they left behind.","","\"Well, so now we know. We'll sex her up. Thanks, old man,\" Tamara says and turns to go.","","\"Wait,\" Banes says. \"There's one more thing, a little embarrassing detail...\"","","\"Oh, I think I already know,\" Tamara says without turning around, her interest fading fast. \"Is it THIS?\" She spins around, forms the fingers of one hand into a \"V\" and lewdly darts her tongue between.","","\"Why yes!\" Banes cries. \"You can see THAT too, just from our sign?\"","","\"Yah,\" Tamara says and is already walking off.","","*label resume","\"Goodbye, Banes,\" you say. \"Until we meet again.\"","","He smiles kindly and nods. \"Take care of your firecracker of a girlfriend,\" he says. ","","You look back just before he fades from view, and he's still sitting on the rock. He waves goodbye, and you return it, then turn to go.","","\"How touching,\" Tamara snorts. \"Now, come on, save that mushy stuff for the girl-knight you have to seduce.\"","","A few steps later, she turns and says, \"And I'm not your girlfriend.\"","*page_break","*goto_scene lilypad2","",""]},"lilypad2":{"crc":-851022746,"labels":{"lilypad_alone":22,"lilypad":35,"speculation":38,"stealth":53,"showself":65,"whatswrong":75,"nextleavealone":92,"approachafterask":97,"hilarious":106,"askapproach":136,"askapproachchoice":146,"approach":162,"laugh":166,"laughapol":176,"drawweapon":187,"nodraw":197,"hiltaway":207,"notfunny":219,"reallydraw":227,"keephiding":242,"keephiding2":255,"waitpee":271,"continue":282,"keepwaiting":291,"changeofheart":302,"changeofheartchoice":311,"agree":318,"disagree":325,"doit":335,"disagree2":347,"notgoodenough":356,"notgoodenough2":364,"stillnotgoodenough":372,"begchoice":381,"ruse":390,"nooral":398,"noproof":408,"secondthought":417,"kneels":428,"deepthroat":435,"blueballs":453,"belt":476,"really":481,"letshearit2":486,"letshearit":496,"letshearitchoice":498,"apolnotgoodenough":505,"parleyafterduel":514,"parleyafterdragon":517,"questdiff":529,"impossible":539,"triedkill":547,"dragontalk":555},"lines":["*temp stoodupforself false","*temp smallfire false","*temp booboffer false","*temp was_eager false","*temp gabriella_mad false","","*image http://herbaloutfitters.com/textimage/text_image.php?font=MervaleScript-Regular&fontsize=30&text=Chapter%20Two:&color=000000&matte=F0D6AD&shadow=inv","*image http://herbaloutfitters.com/textimage/text_image.php?font=MervaleScript-Regular&fontsize=30&text=The%20Ascent&color=000000&matte=F0D6AD&shadow=inv","","*if with_tamara","\t*goto lilypad","*else","\tTamara is climbing ahead of you again, but she seems slower than before, distracted.","\t*if looked_ass","\t\tIt's easier to keep up with her now, and this makes it even easier to enjoy the view.","\t\t","\t\t*goto lilypad_alone","\t*else","\t\tShe's moving at your speed now, and you follow her for no real reason other than that you're both going in the same direction. After all, she's able to track Juliette, while you cannot.","\t\t","\t\t*goto lilypad_alone","\t","*label lilypad_alone","\"You've been trying to lose me all day,\" Tamara suddenly turns and shouts. \"Why are you following me now? I'm going to pee again, and I don't want to see you when I get back!\"","\t","Something is very odd. There's no way she should need to pee again so soon. Either the first time was a ruse, this time's a ruse, or both times were ruses for some reason.","","*choice","\t#Stealthily follow her.","\t\t*goto stealth","\t#Wait.","\t\t*goto waitpee","\t#Continue on.","\t\t*goto continue","\t\t","*label lilypad","You climb for about an hour, and Tamara's uncharacteristically quiet. At first, you didn't question it, just enjoyed the peacefulness of it, but eventually, you realize something's off. She seems distracted, steps carelessly, making more noise than usual, and sometimes she climbs slow enough that you actually overtake her for a short while.","\t","*label speculation","Tamara stops and thinks a moment. ","","\"Wait here,\" she says. \"I need to shake the dew from my lily pad again.\"","","\"Already?\" you ask, not remembering her drinking a lot of water recently. ","","\"Yeah...\" she says distractedly and hurries off into the forest by herself.","","*choice","\t#Stealthily follow her.","\t\t*goto stealth","\t#Wait","\t\t*goto waitpee","\t","*label stealth","As soon as Tamara's out of sight, you hurry after her, hiding behind trees and being careful not to step on any twigs or upset any stones. You catch sight of her scurrying down the hill, making sobbing sounds. Is she crying?","","You see her crumple against a tree, and indeed she is crying.","*choice","\t#Show yourself.","\t\t*goto showself","\t#Laugh at her.","\t\t*goto laugh","\t#Keep hiding.","\t\t*goto keephiding","\t","*label showself","The rustling of pine needles underfoot gives you away, and Tamara's head jerks up as she hastily wipes away her tears.","","\"What do you want?\" she says angrily, embarrassed to be caught in such a vulnerable moment.","*choice","\t#Ask what's wrong.","\t\t*goto whatswrong","\t#Approach nearer.","\t\t*goto approach","\t\t","*label whatswrong","\"Nothing,\" Tamara says, still angry, staring fixedly at the space between her boots.","*choice","\t#Approach nearer.","\t\t*goto approachafterask","\t#Ask if it's okay if you come closer.","\t\t*goto askapproach","\t#Decide to leave her alone. ","\t\t\"Nothing, just making sure you're all right,\" you say, deciding maybe it wasn't the best idea to come barging in on Tamara at a time like this.","\t\t","\t\t\"I'm fine,\" she says sullenly. \"Just give me a minute, ","\t\t*if lilypad1_followed","\t\t\tand QUIT FOLLOWING ME ALL THE TIME!\"","\t\t\t*goto nextleavealone","\t\t*else","\t\t\tplease.\" Wow, Tamara being polite. Something really is weird with her.","\t\t\t","\t\t*label nextleavealone","\t\tYou go back and wait for her where you were before.","\t\t","\t\t*goto keepwaiting","","*label approachafterask","Tamara glances at you when she sees that you're coming but doesn't say anything. ","","You sit next to her.","","\"If you laugh at me, it'll be the last thing you do,\" she says. \"So make sure you enjoy it.\"","*fake_choice","\t#\"I'd never laugh at you,\" you say, glancing at her sword, which looks even more wicked this close up.","\t#Smirk.","*label hilarious","\"I bet you think this is just hilarious, don't you?\" Tamara goes on. \"The great master-thief sitting by herself crying. That's what you're thinking, isn't it?\"","*fake_choice","\t#\"No, of course, not.\"","\t\t\"I doubt that,\" Tamara says, not looking up. \"It's what I'd think if you did it, that's for sure. I'm thinking it about myself right now, if you want to know the truth. I feel so damn weak!\"","\t#\"A little, yes.\"","\t\tTamara rolls her eyes. \"Yeah, I can't believe it myself. I feel so damn weak!\"","*fake_choice","\t#\"How could you possibly think you're weak?\"","\t\t","\t#Feel her arm to see if it feels weak.","\t\tTamara looks at you funny as you start squeezing her bicep.","\t\t","\t\t\"Yup, you do feel weak,\" you joke.","\t\t","\t\tTamara punches your arm.","","*if not(banes_love_talk) ","\t\"I saw something today I didn't think could exist,\" Tamara says. \"I've tracked Banes and Juliette for over a week, and a tracker sees such intimate details that it's almost like getting into the mind and heart of the prey. They walk side by side a bit too close together for full freedom of movement, and only people who love each other do that for a whole journey. It never wavered once, and that's even more odd because it shows they never bickered. Never. I put all this out of my mind, but then seeing him today... It was too much.","\t","\"I can't believe I'm going to say this, but I've decided I'm going to help you and Juliette, not just with the secret entrance but your full quests, to the death if need be. I saw what she had with Banes, and I never thought a love like that could exist. I can't let it die.\"","","She gazes at the peak of DragonKeep in the distance a moment, then locks eyes with you. \"Will you let me help you?\" she asks. \"I will make you my apprentice and teach you all I know of dragonlore. Then, when we join forces with Juliette, nothing can stop us. Do you agree?\"","","*choice","\t#You are inspired by her change of heart. Agree.","\t\t*goto agree","\t#You don't trust her. Disagree.","\t\t*goto disagree","","*label askapproach","\"No, you may not approach,\" Tamara snaps. ","*if lilypad1_followed","\t\"Why are you always following me???\"","\t","\t*goto nextaskapproach","*else","\t\"I went off by myself for a reason!\"","\t","She gets up and begins walking further downhill.","*label askapproachchoice","*choice","\t#Follow.","\t\t\"Someone needs to teach you manners,\" Tamara says, spinning around and drawing her sword. \"I'm giving you one last chance.\"","\t\t*choice","\t\t\t#Whoa, she's really serious this time. Let her go.","\t\t\t\tYou leave Tamara alone and return to where you were before.","\t\t\t\t","\t\t\t\t*goto keepwaiting","\t\t\t#Draw your sword.","\t\t\t\t*goto drawweapon","\t#Let her go.","\t\tYou return to where you were before.","\t\t","\t\t*goto keepwaiting","","*label approach","Tamara stands when she sees you approaching. \"Can't you give a person the least bit of privacy?\" she snaps. She turns and begins to go further downhill.","*goto askapproachchoice","","*label laugh","Tamara's head jerks up when she hears your laugh, and she quickly wipes her eyes. \"You dare laugh at me?!?\" she cries and whips out her wicked blade.","","*gosub_scene adj_respect -20","*choice","\t#Apologize.","\t\t*goto laughapol","\t#Draw your weapon.","\t\t*goto drawweapon","\t","*label laughapol","\"Whoa, Tamara,\" you say, raising your hands to show you intend no harm. \"I didn't mean it that way, really I didn't.\"","","\"Why did you do it then?\" Tamara demands.","","\"Well,\" you say, walking down to where she is. \"You've always presented such a strong image, so it was nice to see that you actually have a softer side. I didn't mean to laugh AT you, just that I was happy.\" It's not totally true, but it's partially true.","","Tamara sighs and puts her sword away. ","","*goto hilarious","","*label drawweapon","Are you sure you want to do that? Remember that the dragon senses negative emotions around its lair, so fighting with Tamara here could very well summon the beast. Also, do you really want to make an enemy of Tamara? You may be bigger and stronger than her, but she's a very cunning opponent. You can take her, but it certainly won't be easy.","","Do you still draw your weapon?","*choice","\t#Yes.","\t\t*goto reallydraw","\t#No, you change your mind.","\t\t*goto nodraw","\t","*label nodraw","You think better of drawing your weapon, but what do you do instead?","*choice","\t#Apologize for laughing at her.","\t\t*goto laughapol","\t#Put your hand on the hilt of your weapon and say, \"Put your sword away, Tamara.\"","\t\t*goto hiltaway","\t#\"That's not funny, Tamara.\"","\t\t*goto notfunny","\t","*label hiltaway","\"Not until you apologize,\" Tamara growls. It's all she can do to hold herself back from charging you immediately.","*choice","\t#Fine, fine, you apologize.","\t\t*goto laughapol","\t#Refuse to apologize.","\t\t*set tamara_enemy true","\t\t\"Then you and I are no longer friends,\" Tamara says. \"If I see you again, I'll kill you.\"","\t\t","\t\tShe turns and stalks off, sword still in her hand.","\t\t*goto_scene camp1","","*label notfunny","\"Who's laughing now?\" Tamara barks. \"Put your money where your mouth is and fight me. Either that or apologize. I don't care which.\"","*choice","\t#Apologize.","\t\t*goto laughapol","\t#Draw your sword.","\t\t*goto reallydraw","","*label reallydraw","*set tamara_respect %-40","\"I'll teach you to laugh at me!\" Tamara cries and charges.","","You're standing uphill and so have the advantage, but Tamara quickly shifts direction to circle around you and claim the high ground for herself.","","*gosub_scene hill_duel","","*if hill_duel_outcome = \"parley\"","\t*goto parleyafterduel","*elseif hill_duel_outcome = \"dragon\"","\t*goto dragontalk","*else","\t*goto_scene camp1","","*label keephiding","You hide successfully. Tamara continues to sit by herself and sob.","","\"This is weak. Weak! Weak!\" she says, talking to herself, raising both hands and looking skyward as if beseeching the gods. \"How can you do this to me on the eve of my triumph? I could have gotten away clean if I left them to die. I didn't even have to trick them; they're marching in all by themselves, so why? Why punish me like this when I did nothing wrong?\"","*choice","\t#Show yourself.","\t\tTamara jumps to her feet when she sees you. \"Can't you give a person the least bit of privacy?\" she snaps. She turns and begins to go further downhill.","\t\t*goto askapproachchoice","\t#Laugh at her.","\t\t*goto laugh","\t#Keep hiding.","\t\t*goto keephiding2","\t","*label keephiding2","You manage to stay quiet, and Tamara still doesn't notice you.","","\"You silly sentimental girl!\" she says and bashes herself in the side of the head with her fist.","*choice","\t#Show yourself.","\t\t\"Spying on me?\" Tamara cries, getting to her feet and wiping her eyes to hide her tears. \"Can't you give a person the least bit of privacy?\" She turns and begins to go further downhill.","\t\t*goto askapproachchoice","\t#Laugh at her.","\t\t*goto laugh","\t#Keep hiding.","\t\tYour footing on the pine-needle-laden slope slips, and Tamara's head jerks up at the sound.","\t\t","\t\t\"Spying on me?\" she cries, getting to her feet and wiping her eyes to hide her tears. \"Can't you give a person the least bit of privacy?\" She turns and begins to go further downhill.","\t\t*goto askapproachchoice","","*label waitpee","*if not(with_tamara)","\tEven though she told you she didn't want to see you again, she's acting so strangely, you decide to stick around. Besides, if she really wanted to avoid you, she could just sneak off.","\t","You find a place to sit and wait. In a little while, you hear what sounds like Tamara crying.","*choice","\t#Go see what's wrong.","\t\t*goto stealth","\t#Keep waiting.","\t\t*goto keepwaiting","","*label continue","You resume the climb up the foothill, but before you get very far, you hear what sounds like Tamara crying.","*choice","\t#Go see what's wrong.","\t\t*goto stealth","\t#Keep going.","\t\t*set left_crying true","\t\t*goto_scene camp1","","*label keepwaiting","After a long time, Tamara returns, and while before, she was distracted and perhaps a bit distressed, now she's focused and deadly calm. Her eyes are still wet with tears, but she's no longer crying.","","\"I'm going to save Juliette,\" she announces solemnly, standing before you, conviction burning in her eyes. \"Are you with me?\"","","*choice","\t#\"Whoa! Why the change of heart?\"","\t\t*goto changeofheart","\t#\"Yes, let's do it.\"","\t\t*goto doit","\t","*label changeofheart","*if not(banes_love_talk) ","\t\"I saw something today I didn't think could exist,\" Tamara says. \"I've tracked Banes and Juliette for over a week, and a tracker sees such intimate details that it's almost like getting into the mind and heart of the prey. They walk side by side a bit too close together for full freedom of movement, and only people who love each other do that for a whole journey. It never wavered once, and that's even more odd because it shows they never bickered. Never. I put all this out of my mind, but then seeing him today... It was too much. I see now what he and Juliette have, and I won't stand idle and watch it die, not for all the treasure in the world. Until them, I didn't know a love like that could exist in this world.\"","\t*goto changeofheartchoice","*else","\t\"It was the old man,\" Tamara says. \"I see now what he and Juliette have, and I won't stand idle and watch it die, not for all the treasure in the world. Until them, I didn't know a love like that could exist in this world.\"","","She gazes at the peak of DragonKeep in the distance a moment, then locks eyes with you. \"I've grown fond of you as well. If you wish, I can make you my apprentice and teach you all I know of dragonlore. Then, when we join forces with Juliette, nothing can stop us. Do you agree?\"","","*label changeofheartchoice","*choice","\t#You are inspired by her change of heart. Agree.","\t\t*goto agree","\t#You don't trust her. Disagree.","\t\t*goto disagree","\t","*label agree","*comment need to write not with_tamara part","*set with_tamara true","\"Good,\" Tamara says, getting to her feet and resuming the journey. \"Remember, now that you're my apprentice, our agreement that you do everything I say is even stronger. There are things you just don't know yet, dangerous things.\"","*page_break","*goto_scene camp1","","*label disagree","*if with_tamara","\t\"No, Tamara,\" you say. \"Let's stick to our original agreement, which, I must say, you somewhat forced me into. I'm not ready for more than that right now.\"","\t","\t*goto disagree2","*else","\t\"No, Tamara,\" you say. \"All this time, you've done nothing to earn my trust. I'm safer on my own.\"","\t","\t*goto disagree2","","*label doit","*comment need to write not with_tamara part","*set with_tamara true","\"I knew I could count on you!\" Tamara says beaming.","*gosub_scene adj_respect 20","","She gets up and turns to resume the journey.","","As you walk, she says, \"Remember, now that you're my apprentice, our agreement that you do everything I say is even stronger. There are things you just don't know yet, dangerous things.\"","*page_break","*goto_scene camp1","","*label disagree2","\"What if I apologize?\" Tamara says, and she seems genuinely humble.","","*choice","\t#\"Not good enough.\"","\t\t*goto notgoodenough","\t#\"Let's hear it.\"","\t\t*goto letshearit","\t","*label notgoodenough","\"What if I apologize and say please?\" Tamara says, looking you straight in the eye.","*choice","\t#\"Not good enough.\"","\t\t*goto notgoodenough2","\t#\"Let's hear it.\"","\t\t*goto letshearit2","","*label notgoodenough2","\"What if I get on my knees, apologize, and say please?\" Tamara says, and it seems like she really means it.","*choice","\t#\"Still not good enough. It could all be faked.\"","\t\t*goto stillnotgoodenough","\t#\"You'd really get on your knees for this?\"","\t\t*goto really","\t","*label stillnotgoodenough","*achieve beg","Tamara shifts from the stone you're sitting on to the rocky ground beneath onto her knees, and she puts her hands supplicatingly on your thighs. ","","\"Do you know what it means to me to do this?\" she asks. \"Never in a thousand years did I think I'd kneel before any man. I beg you, sir, please consider my proposal. My plan is in ruins. Juliette will likely refuse me because I'm a thief, and because of it, I think I will die tomorrow. I need you. What more can I do to show you my sincerity? Perhaps...\"","","She glances at your belt buckle and then reaches forward tenderly to touch it with her fingertips, looking up at you, her eyes shining.","","Well, she certainly seems sincere!","*label begchoice","*choice","\t*disable_reuse #\"No good. This could all still be a ruse!\"","\t\t*goto ruse","\t#\"You've convinced me. You don't have to do anything more to prove it to me.\"","\t\t*goto noproof","\t#Undo your belt.","\t\t*goto belt","\t","*label ruse","Really? You'd turn down oral sex?","*choice","\t#Yup","\t\t*goto nooral","\t#On second thought...","\t\t*goto begchoice","\t","*label nooral","You are a man of iron will.","","Tamara rises silently to her feet and walks away. ","","\"To hell with you then,\" she says and resumes climbing the foothill with a conviction that makes you think she really intends to die tomorrow if she must.","*page_break","*set tamara_enemy true","*goto_scene camp1","","*label noproof","Tamara smiles and says, \"I didn't know you had such honor.\"","*gosub_scene adj_respect 30","*choice","\t#On second thought... ","\t\t*goto secondthought","\t#Be a gentleman... with blue balls.","\t\t*goto blueballs","\t","*label secondthought","You can't stand it. Now that Tamara's offered you oral sex, your hormones are raging. \"Tamara...\" you say sheepishly, \"I know what I just said, but now...\"","","\"I know, I know,\" Tamara says. \"You men are all alike. Take off your pants.\"","","\"Really?\"","","\"Yes, I want to,\" she says.","","You slip your pants down to your ankles, and the stone is cold on your naked buttocks.","","*label kneels","Tamara kneels between your legs. ","","\"This doesn't make me your girlfriend,\" she says, looking up at you. \"You're still my apprentice and have to do everything I say. Also, since we need to maintain a professional relationship, this is the LAST time anything like this will ever happen, so enjoy it.\" ","","Then her mouth is upon you, moving up and down your rock-hard shaft. She makes long strokes in a slow, languid rhythm for a long, long time, her hands resting gently on each of your thighs. Slowly the pleasure builds in you, reaches a plateau, and just can't quite cross it. She keeps you in this maddening place for almost too long, but then...","","*label deepthroat","*set deepthroat true","She slides her hands to your waist and pulls your hips toward her, pressing her face deep into your crotch. You feel your member push down and into her throat, and she holds it there a long time, her body making her try to swallow, causing her tongue and all the muscles to move in involuntary convusions. Her body stiffens as she strains to maintain this position as long as she can. Her fingernails dig into your flesh, but you hardly feel it for the incredible pleasure the convulsions of her throat are giving you. She pulls you into her even deeper, and you nearly explode but hold back. She starts rocking gently, her larynx moving over your glans again and again, your cock never leaving her throat. Her hands grasp wildly at you now as she reaches the limit of endurance, roving over both legs and back. ","","\"Nnnnggghhhh!\" she cries out, choking, but still she keeps you inside her.","","You explode at the same moment she can take no more, and as your seed shoots down her throat, her tongue thrashes wildly on your frenelum, taking you to even greater heights. Seed drips from her lips, and you continue to shoot it in her mouth as she moves her tongue up and down and all around your shaft.","","Finally the spasms subside, but Tamara keeps her mouth glued to the side of your shaft, for there's still pleasure flowing in your body. Slowly, this subsides into a great relaxation, and Tamara's grip on your body relaxes too, her body sliding to the ground. She lays her head against your thigh and looks up at you for a tender moment. She kisses your inner thigh, licks your scrotum, and her tongue lingers upon it for a moment like she doesn't want the moment to end.","","At long last, she pulls away, smiles up at you, and rises to her feet. She wipes some seed from her lips and licks her hand clean.","","If there was any doubt of her sincerity before, it's all gone now.","","\"I'm sorry for how mean I've been to you,\" she says. \"I drive away the people I like, but that ends as of now. You're still my apprentice, though, and still have to do everything I ask. That hasn't changed.\"","*page_break","*goto_scene camp1","","*label blueballs","You stand as best you can, your member rock-hard in your pants and getting in the way. Tamara smiles mischievously as she urges you along, pushing on your shoulder, laughing as you can hardly walk.","","\"Come on, come on,\" she says and prances a little prance beside you to show you how easy it is.","","She puts an arm around your shoulder and walks with you to make sure you don't stop, so you have no choice but to lurch along beside her, each step stimulating you greatly, though not in a good way.","","The two of you walk a little ways like this before she shifts her arm from your shoulder to holding onto your belt to pull you along. You take a couple difficult steps. Her hand moves a little closer to your buckle as she continues to pull you along. You take a few more steps. She pushes her fingers a little way into your pants, but at the same time continues to pull you along. Your heart thrills at the thought that she might actually give you relief, and you hope it's not all just a big tease. She slips her thumb into your pants too, and pushes her hand down. You feel it slide next to your raging member, and you almost explode right then. She, however, just continues to pull you along.","","\"Undo your belt,\" she says nonchalantly, not even looking at you, still just gazing ahead in the direction she's pulling you. You feel her hand wrap around your member and have to clench your muscles hard to keep from exploding. ","","You do as you're told, undoing your belt without a word. She lets you stop walking now and turns toward you. With her one free hand, she pulls your body against hers into a tight embrace and looks firmly into your eyes. ","","\"I'm going to move down your body now,\" she says breathily, slowly, enunciating each word. \"Then...\" She pauses. \"Then I'm going to take you into my mouth.\" She pauses again, still looking deep into your eyes. You can hardly breathe for the anticipation. \"I'm going to swallow you...\"","","Still looking in your eyes, removing her hand from your pants, she slowly moves down your body just like she said she would until she's squatting before you, her knees spread wide. She pulls down your pants, and your member spills forth into the warm sunlight. ","","\"This doesn't make me your girlfriend,\" she says, looking up at you. \"You're still my apprentice and have to do everything I say. Also, since we need to maintain a professional relationship, this is the LAST time anything like this will ever happen, so enjoy it.\" ","","She'd spoken these words slowly, and she moved slowly after, her open mouth moving toward the head of your rock-hard member. Finally, it makes contact, sending a wave of warm bliss through your body. You relax and put a hand on the back of her head. She closes her eyes as she takes you in and out again and again, and as she does so, you feel her tongue roving about, up and down the full length of your shaft. ","","*goto deepthroat","","*label belt","You half-expect all this to be some sort of sick joke, but as you undo your belt, Tamara's already helping you pull down your pants.","","*goto kneels","","*label really","\"I will,\" Tamara says seriously.","","*goto stillnotgoodenough","","*label letshearit2","\"You drive a hard bargain,\" Tamara says, sighing. \"But I'll do it.\"","","She takes a deep breath and pauses a moment to swallow her pride. Then she looks up at you straight in the eyes and says, \"I've been mean to you all day long, and I'm sorry. I really am. Things are different now, and I promise not to treat you that way anymore. Is it a deal?\"","","A moment passes. ","","\"Please?\" she adds meaningfully, still looking you straight in the eye.","*goto letshearitchoice","","*label letshearit","Tamara sighs. \"Calling my bluff, I see,\" she says. \"But it's not a bluff at all. If an apology is what it takes, I'll give it to you.\" She takes a deep breath and pauses a moment to swallow her pride. Then she looks up at you straight in the eyes and says, \"I've been mean to you all day long, and I'm sorry. I really am. Things are different now, and I promise not to treat you that way anymore. Is it a deal?\"","*label letshearitchoice","*choice","\t#Tamara actually sounded sincere. \"Deal,\" you say.","\t\t*goto agree","\t#\"Still not good enough. It could all be faked.\" She certainly sounded sincere, but maybe they teach acting at the thieves guild?","\t\t*goto apolnotgoodenough","\t","*label apolnotgoodenough","\"What more do you need???\" Tamara cries. \"Can't you see how hard this is for me? That can't be faked! Well, what if I get down on my knees? Would you believe me then?\"","","*choice","\t#\"Still not good enough. It could all be faked.\"","\t\t*goto stillnotgoodenough","\t#\"You'd really get on your knees for this?\"","\t\t*goto really","\t","*label parleyafterduel","\"Do you want to know why I was crying?\" she asks, and you nod.","","*label parleyafterdragon","\"It was the old man,\" Tamara says, her voice catching, tears almost welling up again. \"I see now what he and Juliette have, and I won't stand idle and watch it die, not for all the treasure in the world. Until them, I didn't know a love like that could exist in this world.\"","","She gazes at the peak of DragonKeep in the distance a moment, then locks eyes with you. \"For that, I'm willing to risk my life and die if need be. I can't believe I'm saying that. All my life, it's been kill or be killed. Friends are just people who fight at your side until they no longer have use for you, and so that's why I made the deal with you that I did. We help each other until it's no longer convenient, and then we go our separate ways. Now... now it seems so pointless to live that way, and though I don't know if I'll ever find a love like they have, I will leave the door open to it no matter what. For this reason, I now offer you my full aid. We will aid Juliette in her quest, which is the same as yours, and I promise, if need be, I will die for either one of you. I will teach you all I know of dragonlore, and you will be my apprentice, bearing all the rights and responsibilities thereof. Do you agree?\"","*choice","\t#\"Juliette's quest is likely to slay the dragon, while I'm here just for the princess.\"","\t\t*goto questdiff","\t#\"Yes, I agree.\"","\t\t*goto agree","\t#\"No, I cannot agree. You just tried to kill me. I can't trust you.\"","\t\t*goto triedkill","\t","*label questdiff","\"No,\" Tamara says. \"It's the same. Elsbeth's a princess, so she'll be unskilled in wilderness travel. She'll be frightened, and the dragon will sense it and be able to track you by it. Your quest is doomed unless the beast is slain.\"","*choice","\t#\"But isn't it nearly impossible to slay this dragon?\"","\t\t*goto impossible","\t#\"Okay, then I agree.\"","\t\t*goto agree","\t#\"No, I cannot agree. You just tried to kill me. I can't trust you.\"","\t\t*goto triedkill","","*label impossible","Tamara laughs. \"Yes,\" she says. \"Like I've been saying all along, but who knows what the three of us together could accomplish? Though we will likely perish, it will be a death that means something.\"","*choice","\t#\"Okay, then I agree.\"","\t\t*goto agree","\t#\"No, I cannot agree. You just tried to kill me. I can't trust you.\"","\t\t*goto triedkill","\t","*label triedkill","\"I'm sorry about that,\" Tamara says. \"I lost my head, but can't you understand why? I would never have fought you except that you drew your weapon too. I know I've treated you poorly all day, and I'm willing to apologize for that too. Can we not put the past behind us?\"","*choice","\t#\"I suppose. Okay, I agree.\"","\t\t*goto agree","\t#\"No, I still don't trust you.\"","\t\t*goto notgoodenough","","*label dragontalk","*achieve duelsex","As much as you want to chase her down and rape her, you control yourself, get up and follow.","","Tamara's standing next to the part of the forest that's on fire.","","\"It looks like it'll go out,\" she says, and you wish the fire in your pants would go out too. \"And there goes the dragon.\" She points, and you see the drake small in the sky, returning to its roost on DragonKeep. \"It worked! I didn't think it would, but we did it. We survived!\"","","She turns to you, regards you for a moment, then says, \"You look like you need to walk it off. Come on.\"","","The two of you walk for awhile.","","\"Here's Juliette's tracks again,\" Tamara says, pointing at the ground. She studies them a moment and says, \"We ought to catch up with her tomorrow morning, right at her morning sex time. You need to save yourself for then anyway, so stop looking so glum. Really, it's for the best.\"","*page_break","The two of you walk a few hours more, and finally, the exertion of climbing the hill burns off your frustrated sexual energy. Tamara, wisely stayed behind you the whole time.","","\"Do you want to know why I was crying before?\" Tamara says, seeing that now you're once again able to think about something other than raping her.","","You nod, glad to have something to take your mind off things.","","*goto parleyafterdragon"]},"hill_duel":{"crc":700401922,"labels":{"lethave":12,"finishing":24,"defend":25,"sorryam":35,"putswordaway":49,"stupidduel":51,"waitswordaway":61,"tellswordaway":67,"funny":81,"backuptaunt":93,"taunt":96,"moretaunt":107,"backroll":119,"backrollchoice":121,"waitmove":132,"circle":136,"coward":148,"stupidattack":158,"makemove":161,"weakcry":166,"cowardattack":174,"cryout":181,"dropsword":195,"takeadvantage":203,"muscle":215,"grabhers":223,"surrenderground":235,"reversal":247,"curpeace":261,"explain":271,"deadlyforce":279,"notdeadly":283,"neverkill":287,"whydraw":289,"whydraw2":292,"laughchoice":296,"funnyup":303,"chargedown":312,"swordplay":324,"letgofirst":329,"lashout":333,"unawares":338,"attackalready":343,"crazy":347,"charge":352,"flank":364,"midsection":372,"standground":380,"grabarm":392,"letgo":402,"peace":418,"talkback":428,"deadlyrain":432,"toying":440,"surrender":447,"askapol":453,"apollaugh":465,"dropswordchoice":475,"refusedrop":482,"droptalk":489,"askaway":497,"wheretrust":505,"trusther":512,"parley":515,"trust":519,"nomore":524,"holdon":528,"crush":538,"maneuver":549,"maneuverchoice":556,"pummel":569,"pummelchoice":576,"getoff":585,"keeppummel":589,"riseup":600,"handsaway":606,"bearhug":618,"hugchoice":623,"kiss":636,"kissarms":650,"freearms":657,"freearmschoice":659,"keepkissing":668,"getoffkiss":673,"nofreearms":684,"nowfreearm":692,"stillnoarm":696,"boner":700,"coming":710,"keephugging":725,"stab":738,"surrenderprone":748,"lyingskewer":764,"end5":768,"getup":777,"spare":782,"fighton":789,"slam":794,"aimbody":797,"vuleg":800,"fall":803,"leg":806,"skewer":809,"bodycheck":812,"downstroke":815,"dragonkiss":818,"dragonsex":825,"dragonwhy":834,"notit":889,"dragonsex2":912},"lines":["*temp gained_height_advantage false","*temp blinded false","*temp hug_time 0","*temp kissed false","*temp arm_trapped false","You know you're too slow to prevent this, so it's now or never.","*choice","\t#Charge her before she gets the high ground.","\t\t*goto charge","\t#Let her have the high ground. You can still take her.","\t\t*goto lethave","","*label lethave","Tamara races uphill, circles around you, and takes the high ground.","","\"You really want to do this?\" she barks.","*choice","\t#\"I'm just finishing what you started.\"","\t\t*goto finishing","\t#\"I only drew to defend myself.\"","\t\t*goto defend","\t#\"No, Tamara, this is crazy!\"","\t\t*goto crazy","","*label finishing","*label defend","\"Nobody laughs at me!\" Tamara cries. \"YOU started this.\"","*choice","\t#\"I'm sorry about that. I really am.\"","\t\t*goto sorryam","\t#\"But it was just too funny!\"","\t\t*goto funny","\t#\"You drew on me, so if you're going to attack, stop talking and just do it already.\"","\t\t*goto attackalready","","*label sorryam","\"Why did you do it then?\" Tamara demands.","","\"Well,\" you say, \"You've always presented such a strong image, so it was nice to see that you actually have a softer side. I didn't mean to laugh AT you, just that I was happy.\" It's not totally true, but it's partially true.","","Tamara seems to relax a little but is still on guard. \"I'll put my sword away if you do likewise,\" she says finally.","*choice","\t#Put your sword away.","\t\t*goto putswordaway","\t#Wait for her to put her sword away first.","\t\t*goto waitswordaway","\t#Tell her to put hers away first.","\t\t*goto tellswordaway","","*label putswordaway","As soon as you start to put your sword away, Tamara shealths hers as well. Then she laughs. ","*label stupidduel","\"This was the stupidest duel I have ever fought,\" she says. \"What are we? Little children? Come sit by me, and let's talk.\"","","*temp down \"\"","*if gained_height_advantage","\t*set down \"down\"","You climb ${down} the hill and sit next to her.","","*goto parley","","*label waitswordaway","She moves her sword toward her shealth, sees that you aren't moving yours, so she stops. You move yours a little closer to your shealth, so she moves hers a little closer. Inch by inch, the two of you gradually ease your swords back into their shealths, all the time eye-balling each other warily.","","Finally, the extreme silliness of it all becomes clear to both of you, and you laugh. ","*goto stupidduel","","*label tellswordaway","\"Nay,\" Tamara says. \"I would, but your request makes me suspect a trap.\"","","\"Then we are at an impasse,\" you say.","","\"Seems like,\" Tamara says, and the two of you continue to stare at each other, swords drawn.","","Tamara glares at you. You glare back. It turns into a staring contest. The minutes tick by, neither of you giving ground.","","Slowly, a grin begins to play at the corner of Tamara's lips, the utter stupidity of this battle of wills finally creeping into her consciousness. \"Okay,\" she says, half-grinning, \"I will move the tip of my sword one inch toward my scabbard. You do the same, and inch by inch, we will put our swords away.\"","","She moves her sword tip and inch. You move yours an inch. She moves hers another inch, and slowly but surely, you both find that your swords are easing back into their shealths, all the while, the two of you eye-balling each other warily. Finally, Tamara bursts out laughing.","*goto stupidduel","","*label funny","Good idea. You goad her, trying to make her angrier in order to make her more reckless. That was your intention, wasn't it? Not that you're just a big meanie?","","\"I'll show you what else is funny,\" Tamara says and begins advancing upon you. She's moving with measured steps on the steep incline and uneven ground.","*choice","\t#Stand your ground, ready to parry and counterattack.","\t\t*goto deadlyrain","\t#Back up, taunting her, hoping to make her charge.","\t\t*goto backuptaunt","\t#Charge uphill. It might catch her unawares.","\t\t*goto unawares","","*label backuptaunt","You take a step back, careful not to trip on the uneven terrain.","","*label taunt","\"I always knew you were a weak little person,\" you sneer. \"Your bawling just now only proves it.\"","","Tamara doesn't take the bait, makes no reply and merely continues her advance. Though her eyes are aglow with anger, you can see she's not stupid enough to let herself lose control, at least not yet.","*choice","\t#Keep backing up and try to think of another taunt.","\t\t*goto moretaunt","\t#Time to man up. Stand and ready yourself for her assault.","\t\tOnce within sword range, ","\t\t*goto deadlyrain","","*label moretaunt","You can't think of anything in the spur of the moment, take another step, and because you were distracted, miss seeing a tree root, partially obscured by leaves. You stumble, and though you catch your balance, Tamara seizes the tiny gap in your defense, charging in.","","While you could have turned her charge to your advantage when you had stable footing, now your options are more limited.","*choice","\t#Fall and then roll backwards. It will take you out of range.","\t\t*goto backroll","\t#Cry out, \"No, Tamara, wait!\"","\t\t*goto cryout","\t#Blindly lash out with your sword.","\t\t*goto lashout","","*label backroll","Your roll takes you well out of the danger zone, and Tamara checks her advance, leaving a safe gap between you. The two of you stand facing each other, swords ready.","*label backrollchoice","*choice","\t#Try to make peace with her.","\t\t*goto peace","\t#Charge uphill.","\t\t*goto unawares","\t*disable_reuse #Wait for her to make a move.","\t\t*goto waitmove","\t#Try and circle around her to get the high ground.","\t\t*goto circle","","*label waitmove","Tamara remains motionless, knowing this duel is stupid but too angry to make the first move toward contrition. She's waiting for you to make the first move, either in aggression or reconciliation.","*goto backrollchoice","","*label circle","Two can play the strategy game. You begin to circle her the same way she circled you to get the advantage, but Tamara moves to prevent you. With her greater agility, she manages to keep pace with you, and the two of you wind up maneuvering in a horizontal line across the hillside with you remaining just out of sword range downhill from her.","","\"I can do this all day,\" Tamara says. \"Make your move.\"","*choice","\t#\"Fight fair, you coward!\"","\t\t*goto coward","\t#Make your move, charging uphill at her.","\t\t*goto makemove","\t#Try to make peace with her.","\t\t*goto peace","","*label coward","\"Proper strategy is not cowardice,\" Tamara says, not taking the bait, still matching you step for step. \"But confusing the two is stupidity.\"","*choice","\t#She's called you stupid for the last time. Attack!","\t\t*goto stupidattack","\t#\"Be that as it may, I'm not the weak little person caught crying in the woods.\"","\t\t*goto weakcry","\t#Try to make peace with her.","\t\t*goto peace","","*label stupidattack","Stupid is as stupid does.","","*label makemove","You charge up the hill and engage Tamara in a sword-to-sword duel.","","*goto deadlyrain","","*label weakcry","\"You'll pay for that,\" Tamara says, \"Just as soon as you have the balls to engage me. Who's the coward now?\"","*choice","\t#Show her you're no coward. Attack!","\t\t*goto cowardattack","\t#Try to make peace with her.","\t\t*goto peace","","*label cowardattack","Well, you're definitely not a coward...","","You advance up the hill and engage Tamara in a sword-to-sword duel.","","*goto deadlyrain","","*label cryout","You cringe defensively, holding your sword over your head in a desperate bid to block a coming strike you're not truly ready for. ","","Tamara, however, listens to your plea, and checks the downward movement of her sword, instead plowing her body into yours. Despite her smaller stature, because of your poor position, this bowls you over, and the two of you roll down the hill in a tight clinch.","","\"Don't make me regret showing you this mercy,\" Tamara hisses. \"Drop your sword now, or I will kill you!\"","*choice","\t#Drop your sword.","\t\t*goto dropsword","\t#Take advantage of her mercy. You may be on the bottom now, but with your superior size and strength, you ought to be able to win a wrestling match.","\t\t*goto takeadvantage","\t#Tell her to let go of you first.","\t\t*goto letgofirst","","*label dropsword","*set tamara_respect %+10","You honorably let go of your sword, though you suspect you could've eventually overpowered Tamara in a ground duel. Tamara holds her sword to your throat. \"Do you surrender?\" she asks, and you nod.","","She gets off you and moves to a sitting position up the slope from you, but in her haste, distracted by her anger, she leaves your sword next to you. You're able to pick it up again.","","*goto askapol","","*label takeadvantage","*set pommelpummeled true","*set tamara_respect %-40","Tamara wraps her legs around you and holds your sword arm's wrist with one hand while she tries to pummel you with the butt of her sword's handle with the other.","*choice","\t#Muscle your sword arm free.","\t\t*goto muscle","\t#Grab the wrist of her swordarm.","\t\t*goto grabhers","\t#Try to throw her off you or get on top of her.","\t\t*goto reversal","","*label muscle","While trying to muscle your sword arm free, you can only block some of her blows. One smashes into your face, stunning you, and this gives Tamara the chance she needs. She lands several more vicious blows, and you lose consciousness. ","","You awaken later still lying in the same place where you were, but your sword is staked into the earth between your legs. Tamara is nowhere to be seen.","*set duel_outcome \"knockedout\"","*set tamara_enemy true","*return","","*label grabhers","Tamara manages to avoid your grasp, and because your hand is extended, she's able to cut your fingers with the blade. It's just a surface wound, but your hand is less functional now. Tamara is then able to put the blade of her sword against your throat.","","\"Surrender or die, cur!\" she sneers.","*choice","\t#Surrender.","\t\t*goto surrenderground","\t#Die.","\t\t\"Die!\" you say, and Tamara doesn't hesitate to rake her blade across your throat.","\t\t","\t\t*goto end5","","*label surrenderground","*set tamara_enemy true","\"Surrender,\" you say and raise your hands in submission.","","Tamara pushes your sword out of your grasp and carefully gets off you, only removing the blade of her sword from your throat when she's well out of range of a grab.","","\"You took advantage of my mercy,\" she says. \"We are no longer friends, and if I see you again, I will kill you.\"","","She turns around and walks away.","","*return","","*label reversal","*set gained_height_advantage true","*achieve height","By pushing with your feet and arching your back, you're able to off-balance Tamara enough to reduce her attacks, but she still has a hold of your wrist. She manages to get one hit in, which stuns you, but you're able to turn over and get on top of her. She still has her legs wrapped around you, restricting your movement, but because your arms are stronger, you're able to trap her arms beneath your weight. Before you can turn this to your advantage, however, Tamara thrusts with both her legs against your hips, freeing herself. She scrambles out from under you, and you're both on your feet again, except this time you have the hill advantage.","","Tamara stands below you, breathing heavily, sword in her hand by her side.","*choice","\t#Charge downhill. ","\t\t*goto chargedown","\t#Engage in swordplay while trying to prevent her from circling around to higher ground.","\t\t*goto swordplay","\t#Try to make peace.","\t\t*goto curpeace","","*label curpeace","\"You want to make peace now?\" Tamara cries, aghast. \"You just took advantage of my mercy. I should kill you. Kill you!\"","","She speaks aggressively, but she doesn't move, still remains standing downhill from you.","*choice","\t#Explain that you were just scared and were acting on instinct. You didn't mean to take advantage.","\t\t*goto explain","\t#\"You were so angry that I thought you might kill me. I couldn't drop my sword just then, but I didn't mean to take advantage.\"","\t\t*goto neverkill","","*label explain","\"I guess that makes sense,\" Tamara says, \"But supposing you got the upperhand, would you have killed me? You turned this silly fight into mortal combat when you took the first swing.\"","*choice","\t#\"If you kept fighting back with deadly force then yes. Otherwise, no.\"","\t\t*goto deadlyforce","\t#\"No, of course not.\"","\t\t*goto notdeadly","\t","*label deadlyforce","\"I can accept that,\" Tamara says, \"But why did you laugh at me in the first place?\"","*goto laughchoice","","*label notdeadly","\"I hope you know I wouldn't have killed you either, even after your great insult. I didn't mean to fight you when I drew my sword. ","*goto whydraw","","*label neverkill","\"I would never kill you,\" Tamara says. \"I didn't even want to fight you. ","*label whydraw","Why did you draw your sword when I drew mine? I wasn't close enough to be a threat.\"","","*label whydraw2","\"Why did you draw yours???\" you cry.","","\"Look,\" Tamara says. \"I was angry. It was a meaningless gesture. Why did you laugh at me?\"","*label laughchoice","*choice","\t#\"I'm sorry about that. I really am.\"","\t\t*goto sorryam","\t#\"Because it was just too funny!\"","\t\t*goto funnyup","\t","*label funnyup","*set gained_height_advantage false","\"I'll show you what else is funny,\" Tamara says and begins advancing, angling to the right again to regain the hill advantage. \"I just said I wouldn't kill you. I lied.\"","*choice","\t#Charge downhill. ","\t\t*goto chargedown","\t#Engage in swordplay while trying to prevent her from circling around to higher ground.","\t\t*goto swordplay","","*label chargedown","You barrel down the hill, knowing that unless you act now, she'll likely be able to circle around to higher ground again. You get one attack before losing the height advantage, and just like at the very beginning of the battle, Tamara begins running to the side to circle around.","*choice","\t#Attack her flank. It won't be a strong blow, but it has the best chance of hitting. ","\t\t*goto flank","\t#Skewer her as you barrel down on her from above.","\t\t*goto skewer","\t#Slam your body into her.","\t\t*goto bodycheck","\t#Attack straight on with a powerful downward stroke, maximizing your height advantage.","\t\t*goto downstroke","","*label swordplay","It doesn't work. She's just too nimble, and Tamara manages to gain the higher ground again.","","*goto deadlyrain","","*label letgofirst","Tamara sees that you're not fighting back, so slowly she eases her body off yours, all the while keeping her sword between you, blocking both a grab attempt or strike. Once out of range, she says, \"Okay, now drop your sword.\"","*goto dropswordchoice","","*label lashout","Against a lesser opponent, a blind attack like that might've worked, but Tamara parries it easily. You regain your footing eventually but can never recover.","","*goto deadlyrain","","*label unawares","Just before Tamara enters sword range, you charge. The slope slows you, but you still cross the distance quickly and slash at her legs. Tamara quickly ceases her advance and parries. ","","*goto deadlyrain","","*label attackalready","\"I never meant to actually fight you,\" Tamara says. \"I drew my sword in anger, and it was a meaningless gesture. Why did you laugh at me?\"","*goto laughchoice","","*label crazy","\"Why did you draw your sword then?\" Tamara asks.","","*goto whydraw2","","*label charge","By running at an angle along the slope, you're able to reach Tamara with a slight height advantage, but after this attack, you will lose it. Tamara, running perpendicular to your charge, is forced to leave her right flank slightly vulnerable. She was smart enough to have run to her left, so now, her sword, being in her right hand, is on the side of her body that's facing you. She's holding it in a position where you don't yet know what she plans to do with it.","*choice","\t#Attack her flank. It won't be a strong blow, but it has the best chance of hitting. ","\t\t*goto flank","\t#Skewer her as you barrel down on her from above.","\t\t*goto skewer","\t#Slam your body into her.","\t\t*goto bodycheck","\t#Attack straight on with a powerful downward stroke, maximizing your height advantage.","\t\t*goto downstroke","","*label flank","Just as you enter sword range with her, you quickly change direction to slip behind her. This gives away the high ground, but for a brief moment, you can attack from the rear. Already Tamara is beginning to spin to turn and face you.","*choice","\t#Attack her mid-section.","\t\t*goto midsection","\t#Attack her leg.","\t\t*goto leg","","*label midsection","Tamara ducks lower than you though she could by lunging into a very deep stance and putting her left hand on the ground. She swings at you with her other hand.","*choice","\t#Stand your ground and try to block it.","\t\t*goto standground","\t#Let gravity help move you back. You'll fall, but you'll be safe.","\t\t*goto fall","","*label standground","Tamara's stroke is too low, and you are too close to properly defend. Her sword bashes into your shin, but it wasn't a strong stroke, mostly a defensive one. The cut hardly phases you.","*choice","\t#Grab her sword arm while it's still extended.","\t\t*goto grabarm","\t#Move forward and slam her into the ground while she's in such a low, immobile stance.","\t\t*goto slam","\t#Aim a finishing blow to her body.","\t\t*goto aimbody","\t#Hit her vulnerably extended leg.","\t\t*goto vuleg","","*label grabarm","You check her extended sword hand with your sword hand and manage to grab her wrist with your left.","","\"Damn you!\" Tamara cries, turns onto her back, and kicks out with both her legs into your mid-section.","*choice","\t#Let go. You'll fall downhill, but you'll be safe.","\t\t*goto letgo","\t#Hold on. Her kicks won't hurt much. You might be vulnerable briefly, but after that, your sword arm will be free while hers isn't.","\t\t*goto holdon","","*label letgo","Because you let go, Tamara's kicks do no damage, merely propelling you down the hill. You fall but manage to tuck and do a backward roll, returning to your feet. ","","Tamara also regains her feet, and the two of you stand facing each other, swords ready.","*choice","\t#Try to make peace with her.","\t\t*goto peace","\t#Charge uphill.","\t\t*goto chargeuphill","\t#Taunt her.","\t\t*goto taunt","\t#Wait for her to make a move.","\t\t*goto waitmove","\t#Try and circle around her to get the high ground.","\t\t*goto circle","","*label peace","\"Why are we doing this, Tamara?\" you say, trying to make peace. \"Let's stop this foolishness.\"","","\"You're only saying that because I'm at the advantage,\" she retorts and raises her sword to one side. \"En garde!\"","*choice","\t#\"I will still beat you even downhill!\"","\t\t*goto talkback","\t#\"No, Tamara. I don't want to fight anymore.\"","\t\t*goto nomore","","*label talkback","\"You can try,\" Tamara says and begins advancing down upon you.","","Even enraged, ","*label deadlyrain","Tamara fights with discipline, raining blows upon you with deadly precision, never over-extending herself. You do your best to block but can mount only a feeble counterattack. Perhaps on level ground, the two of you would be evenly matched, but here, Tamara presses her advantage for all its worth. In a little while, you begin to tire, and she manages a solid blow to your forearm, making you nearly drop your sword. Blood gushes from the nasty gouge, and after the searing pain, your arm goes numb. You could fight on, but you doubt you'd win. Tamara backs off slightly, her attacks coming a bit less furiously, enabling you to still block.","*choice","\t#\"Stop toying with me, Wench. Let's finish this!\"","\t\t*goto toying","\t#Surrender.","\t\t*goto surrender","","*label toying","With a bone-chilling glare, Tamara raises her sword. You lift yours to block, too weak to attack. Tamara swings in a cunning arc, bypassing your sword and slamming hers into your neck and shoulder. ","","It's a mortal wound, and you fall, finally defeated.","","*goto end5","","*label surrender","\"Tamara, enough,\" you say and lower your sword.","","Tamara, who had just been raising hers to attack again, checks her movement and quickly steps out of range. \"You surrender?\" she asks.","*fake_choice","\t#Yes.","*label askapol","She studies you a moment, deciding how angry she still is. \"Do you apologize for laughing at me?\"","*choice","\t#Yes.","\t\t*goto apollaugh","\t#\"I apologize to no one. Do what you will.\"","\t\t*set tamara_enemy true","\t\t\"I should kill you right here,\" Tamara hisses coldly. \"If I ever see you again, I will.\"","\t\t","\t\tShe turns around and walks away.","\t\t*return","","*label apollaugh","Tamara exhales with relief. \"Okay,\" she says. \"I'm still angry, but okay.\"","","She looks down at you for a moment, and you look up at her, both wondering what comes next.","","\"And to think I was about to offer to make you my apprentice, to teach you dragonlore,\" she says ruefully. \"Why did you have to do that?\"","","She sits down on the side of the hill.","","\"Drop your sword downhill and come talk to me,\" she says.","*label dropswordchoice","*choice","\t#\"I drop my sword for no one. We can speak like this.\"","\t\t*goto refusedrop","\t#Do as she says.","\t\t*goto droptalk","","*label refusedrop","*set tamara_enemy true","\"I could have just killed you!\" Tamara says. \"I could still kill you, and you have the nerve to talk back to me? I have nothing more to say to you.\"","","Tamara gets up and walks away.","*return","","*label droptalk","You put your sword on the ground and climb up to where Tamara's sitting. You notice she's still holding her sword and could easily swipe your head off.","*choice","\t#Ask her to put her sword away.","\t\t*goto askaway","\t#Keep going. If she was going to kill you, she'd have done it already.","\t\t*goto trust","","*label askaway","\"No,\" Tamara says. \"There's implicit trust between us, isn't there, since we shook hands this morning?\"","*choice","\t#\"Then where's your trust, making me drop my sword?\"","\t\t*goto wheretrust","\t#Trust her.","\t\t*goto trusther","","*label wheretrust","\"I'm following the rules of honorable combat,\" Tamara says. \"The loser leaves his weapon to parley.\"","","You've never heard of such rules, but you suppose it makes sense. You continue climbing up to where Tamara's sitting, enter sword range, and sit downhill from her a few feet away.","","*goto parley","","*label trusther","You hesitate only a moment before entering sword range and sitting downhill from her a few feet away.","","*label parley","*set hill_duel_outcome \"parley\"","*return","","*label trust","You knowingly take your life into your own hands as you step into sword range, but Tamara doesn't attack, just keeps holding her sword, resting it against her shoulder. You sit downhill a few feet away.","","*goto parley","","*label nomore","\"Why did you laugh at me?\" Tamara asks, face red with rage.","*goto laughchoice","","*label holdon","One of Tamara's feet slams into your stomach, and the other goes straight for your balls. You bend at the waist to absorb as much of the force as you can, but both blows still hurt. You're able to maintain your grip on her wrist.","","Tamara pulls herself forward, curling into a ball beneath you, making you too close to swing on her, though you could still draw back and stab. Closer now, she's able to begin to wrench her sword arm free, but for the time being, the advantage is still yours.","*choice","\t#Fall upon her.","\t\t*goto crush","\t#Stab.","\t\t*goto stab","","*label crush","*set arm_trapped true","You trap Tamara's sword arm between your two bodies while yours is still free. Tamara's legs are wrapped around you, preventing you from drawing back to stab, but you could still try to place the blade against her throat.","*choice","\t#Maneuver to place your blade against her throat.","\t\t*goto maneuver","\t#Pummel her with the butt of your sword's handle.","\t\t*goto pummel","\t#Bearhug her.","\t\t*goto bearhug","\t","*label maneuver","*if arm_trapped","\t*set arm_trapped false","\tTamara sees she's at a disadvantage, so she places both feet against your hips and kicks strongly. This pushes you off her body freeing her sword arm, and you find yourself lying on your stomach downhill between her spread legs.","\t*goto maneuverchoice","*else","\tTamara sees she's at a disadvantage, so she places both feet against your hips and kicks strongly. This pushes you off her body, and you find yourself lying on your stomach downhill between her spread legs.","*label maneuverchoice","*choice","\t*disable_reuse #Enjoy the view.","\t\tThat goes without saying. Now try something else.","\t\t*goto maneuverchoice","\t*disable_reuse #Perform cunnilingus.","\t\tBetter not. She's about to clobber you. Still... it's very tempting...","\t\t*goto maneuverchoice","\t#Poke her with your sword. It won't be a strong attack, but it's something.","\t\t*goto poke","\t#Crawl back and away, sword ready.","\t\t*goto distance","\t","*label pummel","*if arm_trapped","\t*set arm_trapped false","\tYou rise up slightly in order to raise your sword arm, and this frees Tamara's arm. She lets go of her sword in order to push up on your chin, twisting your head upward and to one side, making it impossible to strike down with anything close to full force. You do get a few hits in, but instead of knocking her out, they only seem to enrage her further. You feel the fingers of her other hand snaking toward your eyes to poke at them.","\t*goto pummelchoice","*else","\tAs you rise up to raise your sword arm, Tamara pushes up on your chin, twisting your head upward and to one side, making it impossible to strike down with anything close to full force. You do get a few hits in, but instead of knocking her out, they only seem to enrage her further. You feel the fingers of her other hand snaking toward your eyes to poke at them.","*label pummelchoice","*choice","\t#Try to get off and away from her.","\t\t*goto getoff","\t#Keep pummeling.","\t\t*goto keeppummel","\t#Fight to get her hands away from your face.","\t\t*goto handsaway","\t","*label getoff","You try to rise, but it's difficult because Tamara's holding you with her legs. You manage to get to your feet, but just as you do, Tamara grabs you behind the heel and pulls, causing you to tumble backwards downhill. Tamara lets go with her legs, picks up her sword, and stands. She lets you get to your feet, as she's now well out of sword range, uphill from you.","*goto backrollchoice","","*label keeppummel","*set blinded true","Tamara starts poking you in the eyes but seems to be holding back. Probably she could permanently blind you if she wanted, but even so, it hurts. Your eyes water, and temporarily, you can no longer see. You continue to try and hit her head with the hilt of your sword, but not being able to see, you fail to penetrate her defense.","*choice","\t#Rise up and strike down hard with the hilt of your sword.","\t\t*goto riseup","\t#Try to get off and away from her.","\t\t*goto getoff","\t#Fight to get her hands away from your face.","\t\t*goto handsaway","\t","*label riseup","You rise up, and in so doing, free yourself from Tamara's hands on your face. You intend to strike down hard, crush any defense she can mount, and slam your hilt into her face, but before you can, the heel of her right foot slams into your chin. It doesn't knock you out, but you are stunned, enabling Tamara to scramble free.","","She stands uphill, her figure blurry through your watery eyes at first, but she waits until you can see again.","*goto backrollchoice","","*label handsaway","You get Tamara's hand off your chin and can now avoid further eye-gouges, allowing you to regain your vision. However, Tamara begins to rabbit punch you on the back of the head and hit your kidneys with her heels. Neither hurt you very much, but you better do something before the damage starts to add up.","*choice","\t#Maneuver to place your blade against her throat.","\t\t*goto maneuver","\t#Bearhug her.","\t\t*goto bearhug","\t#Rise up and strike down hard with the hilt of your sword.","\t\t*goto riseup","\t#Try to get off and away from her.","\t\t*goto getoff","","*label bearhug","*if arm_trapped","\tYour bearhug keeps Tamara's sword arm trapped, and her left arm, though still free, is ineffectual. She tries to rabbit punch you on the back of the head, but they're not strong blows. She also hits your kidneys with her heels, but this doesn't bother you much.","*else","\tYou wrap your arms around Tamara, pulling her close, but she begins to rabbit punch you on the back of the head and hit your kidneys with her heels. Neither hurt you very much, but over time the damage will start to add up.","*label hugchoice","*choice","\t#Maneuver to place your blade against her throat.","\t\t*goto maneuver","\t#Pummel her with the butt of your sword's handle.","\t\t*goto pummel","\t#Kiss her.","\t\t*goto kiss","\t#Grow a boner.","\t\t*goto boner","\t#Just keep hugging her.","\t\t*goto keephugging","","*label kiss","*if hug_time > 1","\t*set kissed true","\tTamara fights against your kiss at first, but you keep your lips pressed against hers. She turns her head from side to side to try and get away, but she can't. Then you feel her melt beneath you, her lips purse, and she returns your kiss.","\t","\t\"Let my arms free,\" she says.","\t*goto kissarms","*else","\tTamara thrashes her head violently from side to side to escape your lips. \"How dare you!\" she cries. ","\t","\tHer fist bashes into the side of your head, and though she's unable to put her weight behind it, it does jar you a bit. You grip on her eases just enough for her to free her sword arm, but she has to let go of her sword to do so. She presses up on your chin, wrenching you head up and to one side, and with the fingers of her other hand, she goes for your eyes.","\t","\t*goto keeppummel","","*label kissarms","*choice","\t#Let her arms free.","\t\t*goto freearms","\t#Not just yet.","\t\t*goto nofreearms","\t","*label freearms","Tamara lets her sword fall by her side as her arms circle around you in an embrace.","*label freearmschoice","*choice","\t#Grow a boner.","\t\t*goto boner","\t#Keep kissing her.","\t\t*goto keepkissing","\t#Get off her.","\t\t*goto getoffkiss","\t","*label keepkissing","The two of you kiss for a long time.","","*goto dragonkiss","","*label getoffkiss","You lift your body from Tamara's, and she releases the hold she has on you with her legs. She sits up and draws her knees to her chest, looking at you.","*fake_choice","\t#Apologize for laughing at her. ","\t\t\"I don't care about that anymore,\" Tamara says. ","\t#Ask why she was crying.","\t\t\"Don't you know?\" Tamara says.","\t#Ask if she wants to fight some more.","\t\t\"No,\" Tamara says. \"But if you want, you can stab me with your 'sword' again and again in a special place.\"","*goto dragon_kiss","\t\t","*label nofreearms","Tamara lets go of her sword and pushes to try and free her arm, but you don't let her.","*choice","\t#Let her now.","\t\t*goto nowfreearm","\t#Still don't let her.","\t\t*goto stillnoarm","\t","*label nowfreearm","Tamara's arm snakes around your neck, and she runs her fingers through your hair as she kisses you.","*goto freearmschoice","","*label stillnoarm","Tamara relaxes her struggle and lets you keep her arm where you want it while the two of you continue to kiss.","*goto freearmschoice","","*label boner","*if (hug_time > 1) and (kissed)","\t*goto coming","*else","\t\"Eww!!!\" Tamara screams, feeling your sex pressing against hers.","\t","\tHer fist bashes into the side of your head, and though she's unable to put her weight behind it, it does jar you a bit. You grip on her eases just enough for her to free her sword arm, but she has to let go of her sword to do so. She presses up on your chin, wrenching you head up and to one side, and with the fingers of her other hand, she goes for your eyes.","\t","\t*goto keeppummel","\t","*label coming","\"I feel something growing between us,\" Tamara whispers, eyes closed, but a little sly grin on one side of her mouth.","","\"Is it love?\" you ask, grinning.","","\"I think it's a little more cylindrical,\" Tamara laughs.","","You push your hips forward rhythmically a few times and feel yourself grow even more.","","\"Don't stop,\" Tamara says, putting a hand on your tailbone and pulling toward herself.","","\"Yesssss....\" she breathes, feeling you push your now fully hard member against her sex. Her legs entwine with yours, and she stretches her body.","","*goto dragonsex","","*label keephugging","*if hug_time = 0","\tTamara keeps up the rabbit punches and kidney kicks, and though they don't hurt too much at first, powered by her fury, it starts to add up. ","\t*set hug_time +1","\t*goto hugchoice","*elseif hug_time = 1","\tYou're only a little light-headed, and yeah, you might pee red tomorrow. Tamara seems to tire, or maybe it's just that her rage is calming. Slightly. She keeps up the attacks with as much viciousness as she can muster.","\t*set hug_time +1","\t*goto hugchoice","*elseif hug_time = 2","\tYou struggle to minimize Tamara's little bee-sting-like blows, and your vise-like grip on her wavers only for a moment. However, that's all Tamara needs to free one arm and go for your eyes with her fingers. ","\t*goto keeppummel","","*label stab","You move your sword into position to stab, but just before you can, Tamara swipes the heel of your right foot out from under you with her still free, left hand. As you tumble down the hill, she manages to wrench her sword arm free from your grasp and stand.","","Prone and downhill, with Tamara advancing upon you, do you continue the fight?","*choice","\t#Surrender.","\t\t*goto surrenderprone","\t#Fight on.","\t\t*goto fighton","","*label surrenderprone","\"Stop! Tamara, stop!\" you cry. \"What are we doing?\"","","Tamara stops just out of range of your weapon.","","\"Nobody laughs at me!\" she cries.","","She leaps into the air and raises her sword above her head.","*choice","\t#Skewer her as she comes down.","\t\t*goto lyingskewer","\t#Block her blow and try to get to your feet.","\t\t*goto getup","\t#Do nothing and hope she decides to spare your life.","\t\t*goto spare","","*label lyingskewer","*achieve ending5","Tamara kicks out with one of her feet and dashes your sword out of the way, but it still rakes against her leg, opening a nasty-looking gash. Her blow, however, comes full force and cracks your skull wide-open, powered by her descent and her rage in equal measure.","","*label end5","Thus ends your quest, a meaningless duel because you mocked a woman in her moment of vulnerability. Perhaps someone knows the fate that befell Princess Elsbeth and Juliette the knight, but it's not you. At least not in this life.","","You have reached Ending #5 of 5: Meaningless duel.","","THE END","*page_break","*ending","","*label getup","Tamara's blow, powered by the downward force of gravity, is extra strong, but you still manage to block it. Uphill, with the advantage already, she allows you to get to your feet before continuing the duel.","","*goto deadlyrain","","*label spare","You know you're at an extreme disadvantage, so all that's left is to beg for mercy. You drop your sword and raise your hands in surrender.","","Tamara checks her downward stroke at the last minute and lands on top of you, knocking the wind from your lungs. She puts her sword to your throat and sneers, \"I should kill you right here!\" She glares at you and fights the urge to kill you for a long moment before she finally calms. She gets off you, climbs the hill a ways and sits down.","","*goto askapol","","*label fighton","You're only half on your feet when Tamara reaches you and never lets you regain your balance.","","*goto deadlyrain","","*label slam","With your wounded leg, you're not quite fast enough. You do manage to get on top of Tamara and make her fall, but she kicks free, pulls herself up the hill, and stands once again.","","*label aimbody","[This option is yet to be written.]","","*label vuleg","[This option is yet to be written.]","","*label fall","[This option is yet to be written.]","","*label leg","[This option is yet to be written.]","","*label skewer","[This option is yet to be written.]","","*label bodycheck","[This option is yet to be written.]","","*label downstroke","[This option is yet to be written.]","","*label dragonkiss","A shadow passes overhead, momentarily darkening everything around you.","","\"By the gods!\" Tamara cries in a panicked whisper. \"You made me angry enough that the dragon has found us. Quick, take off your pants!\"","","*goto dragonwhy","","*label dragonsex","A shadow passes overhead, momentarily darkening everything around you.","","\"By the gods!\" Tamara cries in a panicked whisper. \"You made me angry enough that the dragon has found us.\"","","She quickly undoes her belt and pulls her breeches down to her ankles.","","\"Fuck me,\" she whispers urgently. \"Now!\"","","*label dragonwhy","\"Why?\" you whisper back confusedly.","","\"We can hide from the dragon if we feel only positive emotions!\" Tamara says, speaking quickly. \"It obviously hasn't pinpointed our location because if it did, we'd be roasted by now. It's sensing our fear. Banish it from your mind by fucking me. Hurry!\"","","You rip off your pants but find your manhood unfortunately shrunken and unable to perform.","","\"Laugh!\" Tamara commands. \"Laugh at the irony of this situation. Remember, positive emotions only. Me, I like sucking dicks back to life. Not really, but today, yes. This is a happy day!\"","","She literally flies at your crotch and takes your flaccid little member into her mouth. You feel it flopping all around inside her as her tongue goes to work on it, and it just doesn't return to life.","","\"That's it. We're dead,\" you say apologetically.","","Tamara looks up at you, your cock falling from her mouth. She inhales deeply, closes her eyes, and a profound relaxation moves over her body. She opens her eyes, and looking right into yours says, \"I'm going to lick your cock like the inside of a ripe mango.\" (Ten points if you know where that's from.)","*choice","\t#Go for the ten points.","\t\tIn what movie is the line, \"I'm going to lick your cock like the inside of a ripe mango?\"","\t\t*choice","\t\t\t#The Devil in Ms. Jones","\t\t\t\t\"That's not iiiiiit!\" (Ten points if you know where that's from.)","\t\t\t\t*choice","\t\t\t\t\t#Go for the ten points","\t\t\t\t\t\t*goto notit","\t\t\t\t\t#Just get me back to the sex scene already.","\t\t\t\t\t\t*goto dragonsex2","\t\t\t#Talk Dirty to Me","\t\t\t\t\"That's not iiiiiit!\" (Ten points if you know where that's from.)","\t\t\t\t*choice","\t\t\t\t\t#Go for the ten points","\t\t\t\t\t\t*goto notit","\t\t\t\t\t#Just get me back to the sex scene already.","\t\t\t\t\t\t*goto dragonsex2","\t\t\t#The Opening of Misty Beethoven","\t\t\t\tYou must be a true connoisseur of vintage pornography!","\t\t\t\t*achieve mango","\t\t\t\t*goto dragonsex2","\t\t\t#Ten Thousand Illustrious Fruitcakes","\t\t\t\tHuh? There was never a porno named that, was there???","\t\t\t\t*goto dragonsex2","\t\t\t#Behind the Green Door","\t\t\t\t\"That's not iiiiiit!\" (Ten points if you know where that's from.)","\t\t\t\t*choice","\t\t\t\t\t#Go for the ten points","\t\t\t\t\t\t*goto notit","\t\t\t\t\t#Just get me back to the sex scene already.","\t\t\t\t\t\t*goto dragonsex2","\t\t\t#Caligula","\t\t\t\t\"That's not iiiiiit!\" (Ten points if you know where that's from.)","\t\t\t\t*choice","\t\t\t\t\t#Go for the ten points","\t\t\t\t\t\t*goto notit","\t\t\t\t\t#Just get me back to the sex scene already.","\t\t\t\t\t\t*goto dragonsex2","\t#Go back to the sex scene.","\t\t*goto dragonsex2","*label notit","What comedian said, \"That's not iiiiiit?\"","*choice","\t#Bill Cosby","\t\tSorry, no.","\t\t*goto dragonsex2","\t#Eddie Murphy","\t\tBingo! Yes.","\t\t*achieve eddiemurphy","\t\t*goto dragonsex2","\t#Ellen Degeneres","\t\tSorry, no.","\t\t*goto dragonsex2","\t#Brittany Murphy","\t\tShe did comedy?","\t\t*goto dragonsex2","\t#Bing Crosby","\t\tSorry, he was a singer, not a comedian.","\t\t*goto dragonsex2","\t#Tamara the Generous","\t\tRight now she is. Very... but let's hope she doesn't say that.","\t\t*goto dragonsex2","\t\t\t","*label dragonsex2","Slowly, without a care in the world, Tamara begins to run her tongue up and down your flaccid member, and she's so carefree that you relax too and get into it, forgetting for a moment there's a giant, fire-breathing lizard roaming the skies right above you. Your member grows again as long as you focus on Tamara, not the dragon.","","When you're marginally hard again, Tamara pushes you down and climbs on top of you, pushing you inside of her even though she's not very wet. You feel your member pushing into her dry hole, and then she begins to bounce up and down furiously.","","\"Look at this!\" she says and rips open her vest, her two breasts spilling forth and starting to bounce. It works. You aren't thinking about the dragon...","","That is, until it makes another pass.","*page_break","\"Oh, hmmm... must be a big bird going by,\" Tamara says. \"That's not scary or anything. You feel so good inside me. It's good. No negative emotions I'm feeling at all!\"","","Soon, Tamara's inner walls wetten, and you're sliding in and out of her easily, as she continues to bounce up and down on you. Her breathing quickens as the pleasure fills her body, and she closes her eyes, concentrating only on that.","","You hear a roaring sound coming from somewhere above, and the trees in a nearby part of the forest burst into flame.","","\"Ignore that,\" Tamara says, her voice strained from the sensations coursing in her body. A wave of heat reaches you, and Tamara says, \"That's just the heat of our lust, nothing to worry about.\"","*page_break","She starts to move faster and faster. \"Cover my mouth!\" she cries. ","","You quickly cover her mouth with one hand, and hold the back of her head with the other as she explodes into a violent orgasm that rocks her whole body. You feel her thrashing on top of you, and all your strength is barely enough to prevent her from ripping free of your grasp.","","Finally, the spasms subside, and she lowers herself on top of you.","","\"I think the dragon's gone,\" she says, \"And I came.\"","","As if that wasn't obvious.","","\"You didn't finish, did you?\" she says. \"Impressive.\" ","","Yeah, fear will do that to you.","","She climbs off you. \"We better get going,\" she says, pulling her breeches on, and you watch her luscious sex disappear again under her breeches. \"The fire might head our way.\"","","She picks up her sword and starts walking away, putting her breasts back in her vest and re-tying the strings.","","\"Are you coming?\" she asks.","","You wish.","","\"Look,\" she says. \"We really gotta get going, and well, this was just a one time thing. It was just to save us from the dragon, and we need to maintain a professional relationship. Save the lust you're feeling now for the princess. Yes? Now come on!\"","","She walks away.","*page_break","","*set hill_duel_outcome \"dragon\"","*return"]},"camp1":{"crc":-1088977426,"labels":{"69":928,"camp_alone":12,"followtamara":24,"headtolair":27,"camp":34,"protestwood":52,"continueprotest":64,"firewoodtogether":75,"pushit":82,"dotold":91,"bigfire":104,"smallfire":112,"obeysmall":121,"obeybig":126,"explainbig":131,"explainbigchoice":133,"explainsmall":148,"explainchoice":150,"bigwink":165,"askbig":169,"keepherwarm":173,"insistsmall":177,"insistbig":188,"nipbud":199,"angry":207,"givesin":215,"nextgivesin":228,"challenge":233,"nextchallenge":243,"nofight":249,"yourstupid":257,"sayagain":265,"insensitive":270,"apolagain":282,"alreadyanswered":292,"geez":298,"readytodraw":301,"bringit":310,"bringitchoice":316,"backdown":326,"reasonsmall":334,"reasonbig":343,"backandfoot":352,"backandfootchoice":356,"refusepolitely":365,"refusegruffly":382,"teachthings":397,"footrub":412,"nofetish":426,"denyit":435,"longtime":442,"shoulderrub":447,"noshame":456,"rubshoulders":461,"tight":474,"abs":489,"thighs":498,"thighschoice":506,"stare":516,"peek":531,"noboobs":537,"massagedone":548,"massagedone2":551,"professional":564,"professionalchoice":566,"grudgeagree":576,"complaintease":583,"boobslater":588,"dinner":593,"cupbreasts":602,"massage":611,"trylookboobs":619,"frottage":631,"humpback":639,"technique":652,"wavetech":662,"whystop":670,"stopwave":676,"apolostopwave":685,"quitmassage":692,"nofrot":707,"avoidbosom":718,"sleep":723,"sleepchoice":728,"try2sleep":735,"pretendsleep":754,"trysee":765,"nextpommel":793,"barbknock":816,"fuckagain":836,"blowjob":839,"deepthroat":849,"deepthroat2":859,"deep69":862,"comethroat":872,"turnover":884,"doggie":892,"rearentry":896,"rear2":906,"siderear":909,"finishbehind":919,"behindbelow":922,"comeface":925,"pound":932,"justkeeplistening":935,"askfun":938,"peeksleep":941,"lilydew":944,"looksee":947,"asksword":958,"stilltrying":961,"lookseeagain":974,"peefollow":991,"peenofollow":1003,"checkup":1012,"bearnofollow":1034,"bearsaynothing":1045,"stillsaynothing":1054,"pretend2sleep":1065,"bearopeneyes":1068,"bearadmitawake":1071,"bearsayyes":1074,"try2talk":1077,"askhowgood":1090,"declinehunting":1093,"gabrielleappearance":1096,"questions":1107,"lethergo":1110,"really":1121,"journey":1124,"climbdown":1133,"staypath":1138,"wagon":1141,"investigate":1156,"goaround":1159,"watchwagon":1162,"walkby":1165,"chase":1168},"lines":["*temp planned_fire_size \"\"","*temp stoodupforself false","*temp smallfire false","*temp booboffer false","*temp was_eager false","*temp tamara_mad false","","*if with_tamara","\t*goto camp","*else ","\t*goto camp_alone","","*label camp_alone","*comment Bed down. Water laced with love potion!","*if left_crying","\t*goto headtolair","*else","\tYou sit and think for a moment, watching Tamara walking away. Even if you don't want to join with her and become her apprentice, without a path to follow, it might be hard for you to find the knight.","\t*choice","\t\t#Follow Tamara.","\t\t\t*goto followtamara","\t\t#Decide to just head toward the dragon's lair. If you meet Juliette, fine, but if not, that's fine too.","\t\t\t*goto headtolair","\t","*label followtamara","Tamara never even turns around, and soon she disappears into the forest foliage.","","*label headtolair","Unable to track Juliette yourself, you head toward DragonKeep itself, keeping a good pace despite the upward slope, and by nightfall, you've greatly closed the distance. The mighty peaks that you gazed upon from afar now look almost close enough to touch, and there was no sign of Tamara all day, which you find quite uncharacteristic. Could she have finally given up on getting you to join her?","\t","You find a good place to camp and pass an uneventful evening alone.","","*goto_scene morning_alone","","*label camp","Tamara starts walking again, and you see her studying the ground more intensely than usual. \"It's odd,\" she says finally. \"Now that Juliette is away from Banes, her pace has picked up to a degree impossible for one so heavily-laden with armor. It will be difficult, but we can still catch her, probably early tomorrow.\"","","You groan inwardly, knowing this means a long day of hard trekking.","","\"That's not the worst part, though,\" Tamara goes on. \"I suspect it means she's magically-aided, perhaps with Boots of Haste. The dragon senses magic, not to the same degree as negative emotions, but it will be able to locate her when she's probably still a mile out. We'll catch up to her before that, but convincing her to leave all her magic items behind might prove difficult. I hope your seduction skills are up to the task.\"","*page_break","After a few hours of forced march, as the sun begins to get lower in the sky, Tamara says, \"Well, we made good time. Juliette is very close, and this looks like a good place to make camp.\"","","Relieved that the day of heavy exertion is finally coming to a close, you look forward to a nice hot meal and well-earned sleep.","","\"You're my apprentice, so go gather a bunch of firewood,\" Tamara calls as she builds a little circle of stones for a firepit. \"Then come back and rub my feet and shoulders.\"","*choice","\t#Protest.","\t\t*goto protestwood","\t#Do as you're told.","\t\t*goto dotold","\t","*label protestwood","Rub her feet and shoulders?!? You understand that this is standard duty for apprentices, but in the current circumstances it seems like asking too much. Not only has it been a day of hard travel, your apprenticeship relationship with Tamara is hardly standard. In exchange for their complete servitude, apprentices can expect food, lodging, and years of training, culminating in the creation of a masterpiece and lucrative career. Will Tamara give you all this? You think not and tell her so.","","\"Are you sure you'll mind rubbing my feet and shoulders so much?\" is all she says in reply, a slight smile on her face as, firepit completed, she spreads her bedroll.","","Perhaps you might not want to protest so much?","*choice","\t#Yeah, you might get lucky. Obey.","\t\t*goto dotold","\t#Continue to protest.","\t\t*goto continueprotest","\t","*label continueprotest","It's always nice to get lucky, but unless it's guaranteed, it's not worth being somebody's slave. \"Look, Tamara,\" you say. \"Can we ease up on the whole master-apprentice thing? We're on a hard journey, so shouldn't we help each other instead of me being your slave?\"","","\"How about I help you gather firewood, but you still rub my feet and shoulders?\" Tamara asks. Wow, how uncharacteristically reasonable. Maybe Banes really did make her see the light?","*gosub_scene adj_respect 10","*choice","\t#Agree.","\t\t*goto firewoodtogether","\t#Push it: Ask for a foot and shoulder rub for yourself too.","\t\t*goto pushit","\t","*label firewoodtogether","You and Tamara gather firewood and quickly amass a pile of wood to last all night.","","Back at camp, the two of you stoke the fire until it's nice and stable. You like watching her poking a stick in and out, but when she sees you watching, she throws the stick into the fire. You like watching the stick burn and shrivel up a lot less.","","*goto backandfoot","","*label pushit","\"What do we look like, a lovey-dovey couple?\" Tamara says. \"Come on.\"","","She heads into the forest, picking up twigs for kindling.","","Well, I guess that's that.","","*goto firewoodtogether","","*label dotold","You start gathering firewood, making a big pile that you have to keep coming back to, grumbling that it'd be much easier with two people because that way, one person can hold their arms out while the other loads it with sticks. It's much more efficient, but it seems like Tamara wants to treat you like a slave. She's probably back there doing her nails or something, but still, you know how master and apprentices work. The apprentice is expected to do whatever the master wants, keyword: whatever. To pass the time, you fantasize about what it'd be like if you had an apprentice, and you hope it's a hot girl like Tamara. You wonder what she was like when she was younger and just starting out, imagining all the ways she had to serve her master.","","Finally, you have a pile that seems enough to last all night and bring it back to the campsite in only three trips. You wonder if Tamara will be impressed by how much you manage to carry each time, but nope, she doesn't even seem to look up, just points at the circle of stones she's made.","","*choice","\t#Make a big fire","\t\t*set planned_fire_size \"big\"","\t\t*goto bigfire","\t#Make a small fire","\t\t*set planned_fire_size \"small\"","\t\t*goto smallfire","\t","*label bigfire","You start to make a big fire, knowing that a small fire won't last all night, but Tamara says, \"You're wasting wood. Plus, let's try not to broadcast our presence to all dragons everywhere in the whole world.\"","*choice","\t#Do as she says and make a small fire, even though it means you'll have to wake up to add more logs in the middle of the night.","\t\t*goto obeybig","\t#Explain that you want to make a bigger fire and why.","\t\t*goto explainbig","","*label smallfire","You start to make a small fire, knowing that it'll make less smoke and use less wood, but Tamara says, \"That fire has to last all night, you know.\"","","*choice","\t#Make a big fire, even though it means you have to go back out and find a few more logs if it's to last all night.","\t\t*goto obeysmall","\t#Explain that you want to make a small fire and why.","\t\t*goto explainsmall","\t","*label obeysmall","You and your tired feet go back out into the forest YET AGAIN with no help YET AGAIN and bring back more wood, receiving no thanks YET AGAIN.","","*goto backandfoot","","*label obeybig","You take some of the bigger logs out of the firepit and place them next to your bedroll, which you ruefully notice is on the opposite side of the fire than Tamara's. Looks like she plans to maintain proper professional distance.","","*goto backandfoot","","*label explainbig","\"How about *I* wake up in the middle of the night and add YOUR log to the fire?\" Tamara spats and glances at your crotch. \"Oh, because it's so small it won't last more than a minute.\"","*label explainbigchoice","*choice","\t*hide_reuse #Explain how sometimes logs only seem small when they're thrown down grand castle hallways.","\t\t\"Then I really will put it in the fire,\" Tamara says.","\t\t*goto explainbigchoice","\t*hide_reuse #Ask if she'll keep you warm if it gets too cold tonight.","\t\t\"Sure,\" Tamara says. \"Do you like yourself roasted or totally charred?\"","\t\t*goto explainbigchoice","\t#Be a good apprentice and make a small fire like she asked.","\t\t*goto obeybig","\t#Tell her if she wants a small fire, she can do it herself. You're making the fire the way you like it.","\t\t*goto insistbig","\t#Try to reason with her, saying why you want a big fire.","\t\t*goto reasonbig","","*label explainsmall","\"Oh pooh,\" Tamara spats. \"The size of the fire won't matter to the dragon, and I like big fires. Keeps me warm.\"","*label explainchoice","*choice","\t*hide_reuse #\"How big do you want it?\" Wink, wink.","\t\t*goto bigwink","\t*hide_reuse #Ask her if she made big fires when she was on her own.","\t\t*goto askbig","\t*hide_reuse #Tell her you'll keep her warm.","\t\t*goto keepherwarm","\t#Be a good apprentice and go get more logs.","\t\t*goto obeysmall","\t#Tell her if she wants a big fire, she can do it herself. You're making a fire the way you like it.","\t\t*goto insistsmall","\t#Try to reason with her, saying why you want a small fire.","\t\t*goto reasonsmall","\t","*label bigwink","\"Way bigger than you even on your best day,\" Tamara says, her face deadpan. She can't be... But she hasn't even seen your... She can't mean... She does! You make a mental note to yourself not to ever challenge Tamara to a battle of sexual innuendos.","*goto explainchoice","\t","*label askbig","\"Nope,\" Tamara says. \"I'm too lazy, but now I have you!\"","*goto explainchoice","","*label keepherwarm","\"You could...\" Tamara says, \"IF I let you in my bedroll. Who says I am?\"","*goto explainchoice","","*label insistsmall","\"That's not the way this works,\" Tamara says, her voice growing severe. \"I'm teaching you dragonlore and showing you the secret entrance. A few extra logs is not a big deal.\"","","*choice","\t#Go get more logs.","\t\t*goto obeysmall","\t#No. You need to nip this in the bud or else she might abuse her position.","\t\t*goto nipbud","\t#Get angry.","\t\t*goto angry","","*label insistbig","\"That's not the way this works,\" Tamara says, her voice growing severe. \"I'm teaching you dragonlore and showing you the secret entrance. Is it really such a big deal to make the fire how I want?\"","","*choice","\t#Make the fire how she wants.","\t\t*goto obeybig","\t#No. You need to nip this in the bud or else she might abuse her position.","\t\t*goto nipbud","\t#Get angry.","\t\t*goto angry","\t","*label nipbud","*set stoodupforself true","You drop the piece of wood you're holding and stand up, inhale deeply, and pause to collect your thoughts.","","\"Look, Tamara,\" you say. \"I appreciate your teaching me dragonlore, but I don't like being bossed around. If you really wanted the fire a certain way, you could've asked me nicely.\"","","*goto givesin","","*label angry","*set stoodupforself true","You drop the piece of wood you're holding and stand up.","","\"Dammit, woman!\" you retort. \"I'm an apprentice not a slave. I got the wood, and now I'm building the fire. If that's not good enough, too bad!\"","","*goto challenge","","*label givesin","\"Fair enough,\" Tamara grumbles. \t","*gosub_scene adj_respect 10","*if planned_fire_size = \"small\"","\t","\tShe gets up and gets more logs herself, comes back, and adds them to your fire, making it bigger.","\t","\t\"See, now, was that so hard?\" she says. \"Don't be lazy.\"","\t","\t*goto nextgivesin","*else","\t\"I'll add the logs to the fire, okay? Try not to be so lazy in the future.\"","\t","*label nextgivesin","The two of you stoke the fire until it's nice and stable. You like watching her poking a stick in and out, but when she sees you watching, she throws the stick into the fire. You like watching the stick burn and shrivel up a lot less.","","*goto backandfoot","","*label challenge","Tamara stands up too.","","*if planned_fire_size = \"small\"","\t\"Yeah, I saw you grumbling the whole time gathering the wood, and it took you forever too. Either you make that fire bigger or I'll slice you open and make YOU bigger.\"","\t","\t*goto nextchallenge","*else","\t\"Yeah, I saw you grumbling the whole time gathering the wood, and it took you forever too. If you don't make that fire smaller, I'll cut you in half and make YOU smaller.\"","","*label nextchallenge","*if hill_duel_outcome = \"nothing\"","\t*goto readytodraw","*else","\t*goto nofight","","*label nofight","She looks you squarely in the eyes, a fierce look on her face, sword arm poised to draw on you. \"Are you really going to bring the dragon down on us again for yet another stupid reason?\"","*choice","\t#\"It was YOUR stupid reason that brought the dragon down on us!\"","\t\t*goto yourstupid","\t#\"Okay, okay, if it means that much to you, I'll make the fire the way you want. Geez.\"","\t\t*goto geez","\t","*label yourstupid","\"Say that again, I dare you,\" Tamara says quietly.","*choice","\t#Say it again.","\t\t*goto sayagain","\t#Realize you're being insensitive.","\t\t*goto insensitive","\t","*label sayagain","Oh, man, you really like prodding dragons with a stick, don't you? ...And in this case, it's almost literal.","","*goto bringit","","*label insensitive","\"Okay, okay, I'm sorry,\" you say. \"We both were pretty stupid, can we agree on that?\"","","\"I guess,\" Tamara says, \"But why did you laugh at me?\"","","Oh, no, not this conversation again.","*choice","\t#Aplogize for laughing at her AGAIN. ","\t\t*goto apolagain","\t#Tell her you already answered that question.","\t\t*goto alreadyanswered","\t","*label apolagain","\"Like I said before,\" you say, \"You always come on so strong that it was nice to see a softer side. I didn't mean to laugh AT you. Really, I didn't.\"","","\"So you say,\" Tamara says and goes about the business of setting up camp, ignoring you.","*choice","\t#Make the fire how she wanted it.","\t\tIf Tamara notices you finally made the fire how she wanted it, she doesn't say anything.","\t\t","\t\t*goto backandfoot","","*label alreadyanswered","\"Yeah, but it's still bothering me,\" Tamara says. ","*choice","\t#Tell her people aren't allowed to \"act like a chick\" and carry a sword at the same time. It's against the rules of the Swordsman's Guild.","\t\t*goto chick","","*label geez","[This option is yet to be written.]","","*label readytodraw","She looks you squarely in the eyes, a fierce look on her face, sword arm poised to draw on you.","","*choice","\t#\"Bring it.\"","\t\t*goto bringit","\t#Back down","\t\t*goto backdown","\t","*label bringit","Tamara starts to reach for her sword but then stops. With great force of will, she pulls her arm back to her side.","","\"No,\" she says through gritted teeth. \"As much as I'd like to, we can't fight. This close to the dragon's lair, it would summon it for sure. You're a big baby, bickering with me over something as stupid as the size of a fire. Make it however you want.\"","","She turns and resumes setting up camp.","*label bringitchoice","*choice","\t#Make the fire your way.","\t\tTamara glances over and sees you making a ${planned_fire_size) fire and shakes her head. \"No foot and backrub for you and your stubborn self. Too bad. So sad. You gonna do me or what?\"","\t\t*goto backandfootchoice","\t#Make the fire her way.","\t\tTamara glances at the fire you're making and doesn't say anything.","\t\t","\t\t*goto backandfoot","","*label backdown","\"Whoa, whoa!\" you say taking a step back. \"No need to get violent.\" ","","For a long minute, Tamara's body remains tense, ready to spring, but when you don't instigate, she finally she relaxes. She sits back down.","","\"Sorry about that,\" she says. \"I've just got a temper on me.\"","*goto bringitchoice","\t","*label reasonsmall","You start to reason with Tamara, but you get no more than a few words out of your mouth before she cuts you off. \"Don't make me repeat myself,\" she says coldly.","","*choice","\t#Better go get that wood.","\t\t*goto obeysmall","\t#Get angry.","\t\t*goto angry","","*label reasonbig","You start to reason with Tamara, but you get no more than a few words out of your mouth before she cuts you off. \"Don't make me repeat myself,\" she says coldly.","","*choice","\t#Just make the fire smaller.","\t\t*goto obeybig","\t#Get angry.","\t\t*goto angry","","*label backandfoot","\"Okay, how about that back rub and foot rub?\" Tamara says once the fire's going well.","","She takes off both her boots and presents her feet to you. She wiggles her toes at you, and you notice they're painted sapphire blue, same as her fingernails.","*label backandfootchoice","*choice","\t#Refuse politely","\t\t*goto refusepolitely","\t#Refuse gruffly","\t\t*goto refusegruffly","\t#Get on your knees and get rubbing","\t\t*goto footrub","\t\t","*label refusepolitely","\"But you're my apprentice,\" Tamara says.","*choice","\t#Well, in THAT case...","\t\t*goto footrub","\t#\"I may be your apprentice, but there are limits.\"","\t\t\"Come on,\" Tamara says. \"You might like it too.\"","\t\t*choice","\t\t\t#Well, in THAT case...","\t\t\t\t*goto footrub","\t\t\t#\"Yeah, I might like it too much is what I'm thinking.\"","\t\t\t\t\"Fine, fine,\" Tamara says, putting her boots back on. \"But this does not bode well for our master-apprentice relationship.\"","\t\t\t\t","\t\t\t\tYou and Tamara cook a few things over the fire and eat in silence.","\t\t\t\t","\t\t\t\t*goto sleep","","*label refusegruffly","\"Hey!\" Tamara snaps. \"Apprentices aren't allowed to talk back to their master. Are you going to massage me or not?\"","*choice","\t#Not.","\t\t\"Not?!?\" Tamara says incredulously. \"Fine. I was going to teach you some things in my bedroll later, but now that lesson is canceled. Too bad for you!\"","\t\t*goto teachthings","\t#Ask if you get a turn.","\t\t\"No, sorry,\" Tamara says. \"That'd be against the traditions of apprenticeship, but come on, please, please, please?\"","\t\t*choice","\t\t\t#\"Well, okaaay, since you said please.\"","\t\t\t\t*goto footrub","\t\t\t#\"Nope. Sorry, it's not fair.\"","\t\t\t\t\"Too bad for you then,\" Tamara says. \"I was going to teach you some things in my bedroll later, but now that lesson is canceled.\"","\t\t\t\t*goto teachthings","\t\t\t","*label teachthings","*choice","\t#Change your mind.","\t\t\"Too late,\" Tamara says, turning away and continuing to set up her side of the camp.","\t\t\t","\t\tYou and Tamara cook a few things over the fire and eat in silence.","\t\t\t\t","\t\t*goto sleep","\t#Offer to teach HER some things.","\t\t\"Like how to be a bumbling idiot?\" Tamara says. \"No thanks, and I'm not interested in your lessons on how to not be a good apprentice either.\"","\t\t\t\t","\t\tYou and Tamara cook a few things over the fire and eat in silence.","\t\t\t\t","\t\t*goto sleep","","*label footrub","You wash her feet first, and Tamara says, \"That cool water feels nice.\" This makes you start imagining all the other things you could be doing that would feel nice.","","\"Why you being so gentle?\" Tamara asks, breaking you out of your lustful reverie. \"You're not a foot fetishist, are you?\"","","*choice","\t#Yes","\t\tTamara yanks her foot away from your hands. ","\t\t","\t\t\"Okay, my feet feel much better now. Thanks. Now how about that shoulder rub?\"","\t\t*goto shoulderrub","\t#No","\t\t*goto nofetish","\t","*label nofetish","\"Good,\" Tamara says. \"I never understood why guys would be into that, but then why are you getting turned on? It seems like you're getting turned on.\"","","*choice","\t#Deny it.","\t\t*goto denyit","\t#Tell her it's been a long time.","\t\t*goto longtime","\t","*label denyit","\"No, why would I be getting turned on?\" you say, acting innocent. You start squeezing her feet a little harder and press your thumbs into her tendons.","","\"Good,\" Tamara says. \"We need to keep our relationship strictly professional. Now, how about that shoulder rub?\"","","*goto shoulderrub","","*label longtime","\"It's been a long time for me too,\" Tamara says, \"But you don't see me turning ent-like, do you? Why do guys have such one track minds?\"","","\"Don't answer that,\" she says quickly before you can say anything. \"How about that shoulder rub?\"","","*label shoulderrub","She takes off her top and turns around, presenting her back and shoulders to you. It was so fast that you hardly saw it, but for a brief moment, you got to see her breasts. You can't believe it! Has she no shame?","","*choice","\t#Ask her if she has no shame.","\t\t*goto noshame","\t#Just give her the shoulder rub.","\t\t*goto rubshoulders","\t","*label noshame","\"Not out here,\" Tamara says, looking at you as if you're crazy. \"Don't be a silly-willy.\"","","You wonder if she really doesn't know how much all this is turning you on.","","*label rubshoulders","You start to knead her shoulders, and they're like steel springs, large for such a small-framed woman. You've got a good grip, but even so, you can barely squeeze them. It must be from all her training with the sword.","","Tamara laughs. \"Tight, huh? That's what I get for carrying a heavy backpack around all day.\"","","*choice","\t#Ask if that's the only thing that's tight.","\t\t*goto tight","\t#Reach around and cup her breasts","\t\t*goto cupbreasts","\t#Just keep working them","\t\t*goto massage","\t","*label tight","\"My abs are pretty tight too,\" Tamara replies, and it somehow seems she totally missed your double entendre. Either that or she's teasing you. ","","\"And my thighs.\" She MUST be teasing you!","","*choice","\t#Ask to feel her abs","\t\t*goto abs","\t#Ask to feel her thighs","\t\t*goto thighs","\t#Reach around and cup her breasts","\t\t*goto cupbreasts","\t#Just keep working her shoulder muscles","\t\t*goto massage","\t","*label abs","\"Only my boyfriend gets to feel those,\" Tamara says, and once again, she seems totally oblivious to both your hints and current state of extreme arousal. She's a big tease!","","*choice","\t#Reach around and cup her breasts","\t\t*goto cupbreasts","\t#Just keep working her shoulder muscles","\t\t*goto massage","","*label thighs","\"Sure,\" she says, \"But then you gotta massage them too. And my calfs. Don't forget the calfs.\"","","She lies down and squeezes the big, bunched up muscles near her knees. \"These,\" she says. \"Especially these.\"","","Her boobs are now in plain view, the sunlight beating right down on them!","","*temp peeked false","*label thighschoice","*choice","\t*if (peeked = false)","\t\t*disable_reuse #Stare.","\t\t\t*goto stare","\t*disable_reuse #Sneak a peek while massaging her thighs.","\t\t*goto peek","\t#Force yourself not to look at her boobs.","\t\t*goto noboobs","\t","*label stare","You stare at the sun, burning your retinas. Now you're blind. JUST KIDDING! But you're not very much better off staring at Tamara's boobs, to tell the truth. It's turning you on so much, you're about to explode.","","\"Yeah, right there...\" Tamara says as you start to knead her tight thigh muscles. \"Hey!\"","","She notices you looking at her boobs. ","","\"You can look at those later. Right now, concentrate on your work.\"","","Oh man, did she just give you permission to look at her boobs later? Maybe this means you're gonna get lucky tonight!","","*set booboffer true","*page_break","*goto massagedone","","*label peek","*set peeked true","\"Hey, no peeking!\" Tamara says.","*page_break","*goto massagedone","","*label noboobs","It takes great willpower, but you manage to finish massaging her thighs while not looking at her boobs.","","Ok, no. I lied. It didn't take any willpower. No man has that much willpower. You managed to not look at her boobs by staring at her crotch. You undressed it with your eyes. You imagined what it looks like, what it feels like, what it feels like to push inside it! ","","It got so intense that you squeezed her thigh muscles really hard.","","\"Yeah!\" Tamara exclaims. \"Now you're putting your weight into it.\"","","That's not all you want to put your weight into.","","*label massagedone","\"Okay, that's good enough. Thanks,\" Tamara says, sits up, and puts her top back on.","","*label massagedone2","\"Hey, I got some smoked pork. You wanna share?\" she asks.","","ARE YOU KIDDING ME???","","*choice","\t#Tell her to smoke YOUR pork.","\t\t*goto professional","\t#Tell her yes, you want to share. Now. Badly.","\t\t*goto professional","\t#Help her cook dinner","\t\t*goto dinner","\t","*label professional","\"That sounds fun and all,\" Tamara says, \"But don't you think we need to keep a professional relationship? Things get messed up if you're hot for teacher.\"","*label professionalchoice","*choice","\t#Grudgingly agree","\t\t*goto grudgeagree","\t#Complain that she teased you shamelessly!","\t\t*goto complaintease","\t*if (booboffer)","\t\t#\"But didn't you say I could look at your boobs later?\"","\t\t\t*goto boobslater","\t\t","*label grudgeagree","\"Good,\" Tamara says. \"I can see you're going to learn a lot of things.\"","","Too bad dragonlore is so much more boring than the other things you want to learn from her.","","*goto dinner","","*label complaintease","\"I did not!\" Tamara cries, turns around, and bends over her pack to get her cooking utensils out. You suppose this also does not qualify as shameless teasing.","","*goto dinner","","*label boobslater","\"I did,\" Tamara admits, forehead creasing. She's silent and tense for a minute but then she brightens up and says, \"After this quest, when you're no longer my apprentice, I'll show them to you then.\"","","Nice save.","","*label dinner","You can hardly move, your dick is so hard in your pants, and your blue balls are terrible too. However, you force yourself to help cook dinner, even offering up some of your beef jerky.","","\"Oh yeah! I love beef jerky,\" Tamara says, taking it from you. ","","You hand it over, wondering how you're going to beef jerky yourself later.","","*goto sleep","","*label cupbreasts","After squeezing her shoulder muscles for awhile, you extend to nearby areas, first her arms, then upper back. Tamara moans and seems to be really getting into it. Your fingers inch past her collarbones to the tops of her pectorals. ","","\"Yes, that's nice,\" Tamara sighs.","","You move your hands a bit further down, just touching the beginning of the fleshy globes of her breasts. She doesn't say anything! You go further, swirling your fingers around her mounds, then cupping them gently. She still doesn't say anything!","","\"That feels so good...\" Tamara murmurs. Then suddenly she jerks with a start. \"Whoa! What are you doing?\" she cries, yanking your hands off her. \"I kinda drifted into a daze there for a bit, but don't take advantage!\" She plants your hands firmly back on her shoulders.","","*label massage","You continue squeezing Tamara's coiled shoulder muscles.","*choice","\t#Try to look at her boobs.","\t\t*goto trylookboobs","\t#Avoid looking at her bare bosom.","\t\t*goto avoidbosom","\t","*label trylookboobs","You rise up on your knees, ostensibly to be able to bear down onto her shoulder muscles with greater force.","","\"Yeah,\" Tamara says. \"Push in there hard.\"","","From your new vantage point, you're able to surrepetitiously glance down and see her boobs, and the lust level rises in your body. You feel something grow in your pants, and if you move your body just an inch or two forward, you can brush it against Tamara's spine.","*choice","\t#Do it.","\t\t*goto frottage","\t#That might be pushing it.","\t\t*goto nofrot","\t","*label frottage","Pretending to press down into her shoulder muscles at a different angle, you pull back slightly on Tamara's body while simultaneously moving yours forward until contact is made. It feels great, and so far, Tamara says nothing. You continue working her muscles while rubbing yourself on her back, and you start to get harder. You need more. Bad.","*choice","\t#Hump her back a little.","\t\t*goto humpback","\t#You can't take anymore. It's either quit or explode, so... quit.","\t\t*goto quitmassage","\t","*label humpback","*achieve backrub","With every pull on her muscles, you press forward with your hips, and soon you have a nice rhythm going. Your desire makes you pull hard on Tamara's muscles, making her moan appreciatively. ","","\"That's not where that goes, but I still like this technique,\" she says.","*choice","\t#Put it where it goes, and show her your better technique.","\t\t*goto technique","\t#Keep going.","\t\t*goto wavetech","\t#Apologize and stop.","\t\t*goto apolostopwave","\t","*label technique","One the next pull of her body, instead of pressing forward with your hips, you let Tamara's body continue falling back, and surprisingly, she doesn't resist, letting you push her all the way down until she's lying on her back looking up at you. ","*fake_choice","\t#It goes in her mouth.","\t#It goes in her pussy.","You start to undo your belt buckle, but Tamara quickly sits up. ","","\"Okaaaaay,\" she says. \"We better stop now. I want it too, but we can't. We really need to maintain our professional relationship.\"","*goto professionalchoice","","*label wavetech","\"Stop...\" Tamara says weakly. \"Stop... This is turning me on too much.\"","*choice","\t#Stop.","\t\t*goto stopwave","\t#Ask why you need to stop.","\t\t*goto whystop","\t","*label whystop","Tamara doesn't say anything at first, but then she forces herself to pull away and turn to face you.","","\"Because we really need to maintain a professional relationship,\" she says, grabbing clumsily for her top, and as she puts it back on, you take a last, lingering look at her luscious boobies.","*goto professionalchoice","","*label stopwave","Reluctantly, with great force of will, you stop your rocking motion, and Tamara sits still for awhile, unable to move.","","Finally, she grabs clumsily for her top, and as she puts it back on, you take a last, lingering look at her luscious boobies.","","Her hands shake a bit as she rummages through her pack for her cooking utensils and ration packs, and you catch her looking at you from time to time.","","*goto massagedone2","","*label apolostopwave","\"No need to apologize,\" Tamara says. \"I kinda liked it!\"","","She puts her top back on and rummages through her pack for her cooking utensils and ration packs.","","*goto massagedone2","","*label quitmassage","\"I have to stop,\" you say.","","\"Aww, already?\" Tamara says. \"It was feeling so good, though!\"","","You know. Boy, do you know.","","\"Well, all right,\" she goes on. \"I guess I'll let you off.\"","","Get you off? No... sadly.","","She puts her top back on and rummages around in her pack for her cooking utensils and ration packs.","","*goto massagedone2","","*label nofrot","You settle for just staring at her boobs while you massage her shoulders, and mesmerized, you go on and on.","","Finally Tamara stops you. \"Wow, that was almost an hour,\" she says. \"I didn't know you had such strong hands, but thanks!\"","","She picks up her top, but before putting it on, she bounces her shoulders a bit and says, \"Oh, I feel so nice and relaxed. You're the greatest!\"","","She gives you a hug, pushing her still naked boobs against your body and then puts her top on like it was nothing.","","*goto massagedone2","","*label avoidbosom","Constantly fighting the urge to peek at her boobs, you can manage on distracted squeezes on Tamara's tight shoulder muscles.","","*goto massagedone","","*label sleep","Slowly, the sun sets, and it gets colder.","","Tamara sets up her bedroll on the opposite side of the fire as you and lies down facing away from you. All you have is your thin blanket, but you're used to camping out. ","","*label sleepchoice","*choice","\t#Go to sleep","\t\t*goto try2sleep","\t*disable_reuse #See if Tamara wants to talk for a bit","\t\t*goto try2talk","\t","*label try2sleep","You try to sleep, but it's no use. You can't stop thinking about Tamara over there and how you want so badly to go climb into the bedroll with her. It's too embarrassing to masturbate, so you just lie there in agony. ","","The minutes tick by slowly, the crackles of the fire marking time. One crackle. You're in agony. Two crackle. You're still in agony. Three crackle. Why did Tamara insist on this professional relationship??? Four crackle. Maybe I really should quit. Five crackle. That does it! I'm gonna go out into the forest and masturbate.","","You're about to sneak away, claiming you had to \"shake dew off your lily pad\" if she happens to notice, but you're pretty sure she's asleep. She hasn't moved in a long time. ","","You carefully roll over to your side and are just beginning to slooooowly push yourself up to a sitting position when you hear Tamara changing positions.","","*choice","\t#Freeze. Pretend to sleep.","\t\t*goto pretendsleep","\t#Peek.","\t\t*goto peeksleep","\t#Keep going.","\t\t*goto lilydew","\t#Look to see what she's doing.","\t\t*goto looksee","\t","*label pretendsleep","You lie there, eyes closed, listening. You can't tell what Tamara's doing, but there's a lot of rustling of fabric as she's moving about. You can tell she's trying to be quiet, but still, you're able to hear a lot. Eventually the rustling sounds become rhythmic, like she's moving something under the covers in the same way again and again.","","*choice","\t#Try to see what's going on.","\t\t*goto trysee","\t#Just keep listening.","\t\t*goto justkeeplistening","\t#Ask if she's having fun.","\t\t*goto askfun","\t","*label trysee","Unfortunately, you were facing the other way when you froze, so to see, you're going to have to roll over. You try to make it sound like you're just shifting in your sleep, but when you move, you hear all sound stop.","","Carefully you slit one eye open, and you see Tamara on the other side of the fire staring straight at you. You almost scream but hold it in, composing yourself, and resume studying the situation. You can't see much more than her upper body, so it looks like she's just lying there looking at you.","","After a few moments when you don't move again, she turns away and closes her eyes. The rhythmic sound starts again, and you see that she has both arms under the covers, hands perhaps between her legs. It looks like she's pulling something towards her again and again.","","Soon, the tempo increases, and she begins to move a little, shifting the position of her legs. Her back arches, and her head occasionally rolls from side to side. Finally, a soft moan escapes her lips.","","*fake_choice","\t#Stand up.","\t#Masturbate too. She won't hear you, with all the noise she's making.","\t#Force yourself to do nothing and just wait for it to be over.","","\"I'm ready to rethink this master/apprentice thing,\" you hear her say.","","You're up in a flash and by her bedside.","","You see that she's spread her legs, one leg almost completely out of her bedroll. Her lower body is completely naked, and you can nearly see her crotch. She peels back the covers, and you see that she's hiked her nightshirt up (she's taken off the vest and is just sleeping in a white shirt) over her breasts. Her sword is between her legs, the pommel almost entirely inside her. She slides it out until only the tip is still inside her.","","\"Did you notice before?\" she asks, \"My sword has a phallic-shaped pommel.\" She grins.","","You see that it indeed looks exactly like a penis, carved from ivory,","*if pommelpummeled","\tbut you hadn't noticed before, not even when she was pummeling you with it before. Ew!","\t*goto nextpommel","*else","\tbut all this time, you hadn't noticed. You just thought it was oddly decorative.","*label nextpommel","","\"I don't know why, but it gives me comfort in battle to grip it,\" she says. \"And then there's this use.\" She smiles up at you, and her eyes twinkle.","","Slowly, she slips it back into herself, closing her eyes and starts to move it in and out in a hypnotic rhythm.","","\"I do this alone just about every night,\" she says. \"But now I have you.\"","","She pulls the pommel out again, slides the sword up her body, and softly licks the glistening shaft.","","\"Does it make you hard? Do you want to be inside me?\"","","You climb on top of her, your member already rock-hard. It's been so for the last half-hour! It feels so good inside her, her snatch already in full slipperiness from the motions of the sword.","","You begin to move in and out of her, sometimes with long strokes, other times short, sometimes fast, other times slow. You alternate this with grinding your hips, mashing her sex between you.","","\"Oh, apprentice,\" Tamara cooes, \"You've learned your lessons well.\"","*choice","\t#Tease her.","\t\t*goto barbknock","\t#Pound her.","\t\t*goto pound","","*label barbknock","You pull out all the way and make Tamara wait for you to put it back in. ","","\"I feel so empty without you inside me,\" she says. \"Please fill me again.\"","","You move forward and just the tip of your member barely penetrates her opening. There you stay, rocking back and forth, never fully entering her.","","\"You drive me crazy,\" she says. \"My body longs for you so bad.\"","","You pick up speed but still do not fully enter.","","\"Please...\" she begs.","","You increase your speed yet again, entering slightly further each time, and Tamara's whole body tenses in anticipation. Finally, you plunge in completely, all the way to the hilt, and Tamara cries out, her desperate need filled at last. She wraps her legs around you, holding you inside her, and she continues to moan and shudder. She's coming already! You pound her, pulling out as far as she'll let you before slamming home again. Whap! Whap! Whap! Your pelvis slaps into hers again and again as she fills the night with her moans. You nearly explode yourself, but with great force of will, you hold it in. Finally, Tamara's body relaxes beneath you.","*choice","\t#Start to fuck her again.","\t\t*goto fuckagain","\t#Pull out, move up her body, and put it in her mouth.","\t\t*goto blowjob","","*label fuckagain","[This option is yet to be written.]","","*label blowjob","Walking on your knees, you move slowly up Tamara's body, relishing how it feels between your legs. The hairs of her mound tickle you; then, the softness of her belly. You push your dick between her breasts, feeling their softness give way under your rod of steel. You push it against her throat and chin, feeling it press against her pipes and bones. You lift her head, and though her body is still languid from her orgasm, she moves to cooperate, to let you into her mouth.","*choice","\t*if (deepthroat) #Push your cock down her throat.","\t\t*goto deepthroat","\t#Come on her face.","\t\t*goto comeface","\t#69 her.","\t\t*goto 69","\t","*label deepthroat","You remember how good it felt when Tamara deepthroated you before, and you wonder if she'll let you do that again. You push in, sliding easily down her throat, and though she makes a gagging sound, she allows it. You move in and out of her for a few strokes, before finally retreating past the epiglottis and letting her breathe. Her chest heaves under you, and you allow her only a few breaths before you push in again. You hold yourself fully inside her and push in deeper a few times, jamming your pube hard against her face. Tamara's body stiffens, but she allows it, keeping her hands raised by her head in surrender. ","","It feels so good inside her, but you fight the urge to plunge in again to let her breathe. ","*choice","\t#Plunge in again.","\t\t*goto deepthroat2","\t#69 her.","\t\t*goto deep69","\t","*label deepthroat2","[This option is yet to be written.]","","*label deep69","While Tamara lies there, chest heaving, you move around her body. She turns her head and looks up, enabling you to enter her mouth once again. You sit and look at her body laying before you, chest heaving, legs spread, and you watch her stiffen as you push down her throat again. You lay on top of her and begin to move back and forth, fucking her mouth, her pussy right in front of your face. You wrap your arms around her body like you do during regular sex, kiss her lips like in regular sex too, treating her crotch like her face and her face like her crotch. You're nearly ready to come.","*choice","\t#Come on her face.","\t\t*goto comeface","\t#Shoot your come down her throat.","\t\t*goto comethroat","\t#Turn her over.","\t\t*goto turnover","","*label comethroat","*achieve deepthroat","Tamara's body is bucking, her body screaming for air, but you stay inside her, humping in small furious strokes until her desperate movements send you over the edge. You feel your hot jizz shoot deep inside her, past the vestibular fold. You pull out finally, and Tamara's gasping under you. You press your cock flat against her whole face, humping it, shooting more onto her lips and cheeks until her whole face is covered in it. You remain collapsed on top of her, and she lies under you, doing nothing, breathing gradually returning to normal.","","Finally, you roll to one side, and Tamara curls her body to rest her head on your chest.","","\"You used me like a ragdoll, but I liked it,\" she whispers, looking up at you. She swirls her fingers in the come you've left on her face, pushing some into her mouth.","","The two of you fall asleep backwards in her bedroll.","*page_break","*goto_scene juliette","","*label turnover","You pull out of Tamara's mouth and twist her body at the shoulders to turn her over. She lets you and is now lying on her belly, head and torso raised on her elbows.","*choice","\t#Lift her hips, push her head down, and do her doggie style.","\t\t*goto doggie","\t#Lay on top of her.","\t\t*goto rearentry","\t","*label doggie","*achieve doggie","[This option is yet to be written.]","","*label rearentry","You slide your body on top of Tamara's, and she lets her arms collapse, resting her head on her hands. You slip your arms under hers into a loose full-nelson, and your cock slips between her cheeks. Slowly you move your body down, sliding your cock down until it falls into the space between her legs. Hands still on her head, you use your knees to force her legs further apart, and you move your body to help your cock find its way into her slippery hole. You push a few times before it finally slides in, and you move back up her body until it's fully inside her. ","","You slip your hands under her, and she raises herself up to let you cup her breasts. You hold them, fondling them gently as you begin thrusting in and out of her without any hurry. ","*choice","\t#Stay in this position.","\t\t*goto rear2","\t#Turn her on her side.","\t\t*goto siderear","\t","*label rear2","[This option is yet to be written.]","","*label siderear","You lay on top of Tamara and, still cupping her breasts, roll to one side, taking her with you so that she's laying on her side too with you behind her. You enfold her in your arms, your left hand on her right breast now and vice versa as you resume your unhurried thrusting.","","Tamara bends her top leg at the knee, spreading her legs a little and allowing her to touch herself with her fingers. You feel her make broad circles on her clitoris which pulls her outer lips against first one side of you, then the other. She reaches down and touches you, her fingers playing over your scrotum and shaft, stimulating you and making you want to go faster. Tamara sighs, the pleasure building in her body too.","*choice","\t#Put her on her stomach again to finish inside her from behind.","\t\t*goto finishbehind","\t#Roll on your back, Tamara lying on top of you.","\t\t*goto behindbelow","\t","*label finishbehind","[This option is yet to be written.]","","*label behindbelow","[This option is yet to be written.]","","*label comeface","[This option is yet to be written.]","","*label 69","[This option is yet to be written.]","","come on her face, 69, or ?. ","*label pound","[This option is yet to be written.]","","*label justkeeplistening","","","*label askfun","","","*label peeksleep","","","*label lilydew","","","*label looksee","You see Tamara sit up and reach over to her belongings. She lifts her sword from where it was sitting and carefully lies back down with it. She glances over in your direction and cries out in surprise when she sees you watching her.","","\"I just like to sleep with my sword,\" she says and quickly turns her back to you, hugging her sword like a teddy bear.","","*choice","\t#Ask her if her sword is as rock-hard as your sword.","\t\t*goto asksword","\t#Try to sleep.","\t\t*goto stilltrying","\t","*label asksword","\"Yes, now go to sleep,\" Tamara says. \"You're bothering me.\"","","*label stilltrying","You go back to trying to sleep, and now, even the idea of sneaking off to masturbate is too embarrassing. You lie there ready to explode.","","You hear Tamara moving again.","","*choice","\t#Pretend to sleep","\t\t*goto pretendsleep","\t#Peek","\t\t*goto peek","\t#Look to see what she's doing","\t\t*goto lookseeagain","\t","*label lookseeagain","You see Tamara slowly moving her sword from where it was on the outside of her covers to under the covers. She glances over at you, sees you watching her, and sighs.","","\"Why are you watching me all night long?\" she complains, gets up, and stalks off into the forest, taking her sword with her. ","","\"I'm going to pee,\" she says, \"Want to watch that too? Don't answer that.\"","","She takes a few steps, turns around, and says, \"That question was completely rhetorical. I don't want you to watch me pee. Seriously, do not follow me.\"","","She turns and stalks off into the forest, shaking her head.","","*choice","\t#Follow","\t\t*goto peefollow","\t#Don't follow","\t\t*goto peenofollow","\t","*label peefollow","You wait a little while, then, as quietly as you can, get up and follow Tamara into the forest. It's dark, but the light of the moon guides your way. You can see her ghostly form making its way ahead of you.","","She turns, sees you, but just keeps walking.","","You keep following, and she keeps walking, eventually making a big circle. You arrive back at camp, and she climbs into bed.","","\"Good night,\" she says sullenly.","","*page_break Morning","*goto morning","","*label peenofollow","She's gone an awfully long time. Do you go check up on her?","","*choice","\t#Check up on her. Maybe something happened to her.","\t\t*goto checkup","\t#She said not to follow, so you're not going to follow, not even if you hear a bear roaring and her screaming.","\t\t*goto bearnofollow","\t","*label checkup","You head off into the forest in the direction she was going when you last saw her, wondering if you'll even be able to find her in the dark. In a moment, you hear a sound and head toward it, and as you get closer, you realize that it's the leaves of a tree rustling rhythmically intermixed with the sound of deep breathing and soft moans.","","You round a bend and come face to face with Tamara, but somehow she's grown taller. Her face is a foot above you! She's completely nude and hanging onto the branches of a tree, her legs splayed apart, each foot on a low branch. Her sword is staked into the earth at the base of the tree, and she's riding the pommel of it, the tree branches shuddering with each bounce.","","When she sees you she screams and tries to leap off, but the sword's still inside her, making her fall backwards instead. She lands hard on her buttocks and scrambles backwards with her legs to get the sword out of her.","","\"What are you doing here!\" she demands, and even in the dim light of the half-moon, you see her turning red.","","*fake_choice","\t#\"Um... shaking the dew off my lily pad?\"","\t#\"You were taking way too long, so I thought something happened.\"","\t#\"Let me finish the job!\"","\t\t","\"Shut up and get down here!\" Tamara cries and grabs you by the waistband, pulling you on top of her. Her hands are scrambling to free your cock from your trousers.","","\"Get inside me before I change my mind,\" she says, finally pulling your swollen member free. ","","She grabs your collar and pulls your head down for a passionate kiss while simultaneously wrapping her legs around your waist. Pulling with her legs and guiding your cock with one hand, it easily slips inside her.","","\"Ride me!\" she screams.","","*label bearnofollow","You wait for Tamara to return, and just when you think it's been so long something MUST'VE happened, you see her finally come back into camp. She's quiet and seems pensive. She stands by her bedroll for awhile, staring out into the night, then glances at you.","","\"You awake?\" she finally says.","","*choice","\t#Say nothing.","\t\t*goto bearsaynothing","\t#Say yes.","\t\t*goto bearsayyes","\t","*label bearsaynothing","\"Oh, come on, I know you're awake!\" Tamara shouts.","","*choice","\t#Still say nothing.","\t\t*goto stillsaynothing","\t#Admit to being awake.","\t\t*goto bearadmitawake","\t","*label stillsaynothing","You pretend to be asleep, watching Tamara through slitted eyelids. She's standing by the fire, facing you fully now, just looking at you, wondering what she should do. After a minute or so, she tosses her sword on her bedroll, removes all her clothes, and is standing there naked, just in her knee-high leather boots.","","She sidles over to you, steps over you with one foot, and kneels down, giving you a fantastic view of her pussy. Slowly, she moves it closer and closer to your face.","","*choice","\t#Pretend to sleep.","\t\t*goto pretend2sleep","\t#Open your eyes.","\t\t*goto bearopeneyes","\t","*label pretend2sleep","","","*label bearopeneyes","","","*label bearadmitawake","","","*label bearsayyes","","","*label try2talk","\"Hey, Tamara,\" you say. \"You want to talk for a bit?\"","","*if (Tamara_mad)","\tShe doesn't say anything.","\t","\t*goto try2sleep","","\"What? No,\" Tamara says and seems startled. \"I was... thinking, and you disturbed me.\"","","*goto sleepchoice","\t","","*label askhowgood","","","*label declinehunting","","","*label gabrielleappearance","The woman's perhaps 5'6\" tall, slender but muscular. She's wearing tan, skin-tight corduroy breeches that does well to show off her shapely behind. Her boots are knee-high, fashioned from expensive leather, and she seems to have a custom-made padded leather vest that's a beautifully deep red color. It must've cost a fortune. ","","Her breasts are small enough that they show no cleavage in the vest's neckline, but they are still a shapely pair. Her arms are bare, but she's wearing doe-skin gloves that go up to her elbows.","","She has a backpack and belt pouch, and by her side is a slender, wicked-looking sword. A crossbow is draped over her back with quarrels at the ready.","","Her hair's chestnut brown and falls to her shoulders. Her eyes are a piercing green, and when she looks at you, her intensity makes you nervous sometimes. You don't know if she's going to snap at you or simply turn away in disdain.","","*return","","*label questions","","\t","*label lethergo","Are you nuts? This woman is beautiful, and not only that, in a way, you helped her catch the faerie. Maybe she owes you at least an explanation, if not even... \"gratitude.\" Wink, wink.","","Are you sure?","","*choice","\t#Really let her go.","\t\t*goto really","\t#Chase after her.","\t\t*goto chase","\t","*label really","I don't know why you just let her leave, but I suppose your reasons are your own. Maybe she gave you the creeps. Maybe you're afraid of hot women, but whatever your reason, you find yourself alone again and resume your journey.","","*label journey","The path, no wider than an ox cart, continues its windy journey through Orlon Forest, rounding boulders and rock outcroppings here and there. You come to a point where the path takes a long detour, avoiding a small cliff with a drop of only ten feet or so, and you feel you could easily climb down, saving yourself a good ten minutes.","","*choice","\t#Climb down","\t\t*goto climbdown","\t#Stay on the path","\t\t*goto staypath","\t","*label climbdown","You easily climb down the small cliff, and nothing happens. No faerie waylaid you or anything. You didn't even slip. The path goes around simply because the road is used by farmers with their wagons, and you wonder just how serious the admonishment against leaving the path is.","","*goto wagon","","*label staypath","Better to be safe than sorry, for though you can see the path below, who knows what could happen. Not only might you slip, but you've heard that going off path is dangerous. The path's slope is gradual, and it shortly makes a hairpin turn, bringing you to the section you saw earlier.","","*label wagon","In another ten minutes or so, you round a bend and see a wagon sitting in the middle of the road. It seems to be abandoned, its horse missing.","","*choice","\t#Investigate","\t\t*goto investigate","\t#Go off path to go around it, avoiding it completely.","\t\t*goto goaround","\t#Hide and watch it for awhile","\t\t*goto watchwagon","\t#Just walk on by","\t\t*goto walkby","\t","You have sex with 1000 beautiful maidens, but you never know it because this code is never reached in the game.\t","\t","*label investigate","","","*label goaround","","","*label watchwagon","","","*label walkby","","","*label chase"]},"morning_alone":{"crc":-1400075172,"labels":{"search":11,"searchbelongings":19,"nofood":31,"nowater":34,"both":37,"ignore":40,"nohoney":49,"grill":67,"grillchoice":69,"lustcheck":108,"next":120,"hike":124,"hikechoice":136,"askdone":143,"walkoff":146,"desperation":149,"askfuck":157,"jerkoff":160,"masturtam":168,"tamaraanswer":241,"vague":244,"honest":247,"faceother":278},"lines":["*temp lust 0","*temp admit_water false","*temp admit_potion false","*temp admit_love_potion false","Early the next morning, you awaken with a start, sure you'd heard something, but when you look around, you see nothing amiss.","*choice","\t#Search the area.","\t\t*goto search","\t#Ignore it.","\t\t*goto ignore","\t","*label search","You spend fifteen minutes scrutinizing the ground, but you find nothing amiss.","*choice","\t#Search your belongings.","\t\t*goto searchbelongings","\t#Ignore it, eat breakfast, and get going.","\t\t*goto ignore","\t","*label searchbelongings","You rifle through your belongings, but everything seems totally fine. ","*choice","\t#Throw away your food just to be safe.","\t\t*goto nofood","\t#Empty your waterskin just to be safe.","\t\t*goto nowater","\t#Throw away both your food and water.","\t\t*goto both","\t#Have a normal breakfast and get going.","\t\t*goto ignore","\t","*label nofood","[This option is yet to be written.]","","*label nowater","[This option is yet to be written.]","","*label both","[This option is yet to be written.]","","*label ignore","You cook up a quick breakfast of oatmeal again.","*if has_honey","\t*choice","\t\t#Put the last of your honey on it.","\t\t\t*set has_honey false","\t\t\t*goto nohoney","\t\t#Save your honey for later.","\t\t\t*goto nohoney","*label nohoney","You eat quickly, eager to resume your journey. Just as you gulp down some water and begin the day's hike, you hear a voice. A female voice. A very Tamara-like, female voice.","","\"Hey,\" she says, sauntering into your camp like she belongs there. \"Getting ready for a hike?\"","","\"Yes. What do you want?\" you ask, warily. She's acting funny, smirking, almost gleeful.","","\"You sure you want to do that?\" she asks, grinning. \"There's not something else you'd like to do?\"","","\"No. Why?\"","","\"Oh, no reason,\" she says, suppressing a giggle.","*choice","\t#Grill her for answers.","\t\t*goto grill","\t#Start your hike.","\t\t*goto hike","\t","*label grill","You decide you need to know what's going on.","*label grillchoice","","What do you ask her?","*choice","\t*hide_reuse #Ask what she's done.","\t\t\"Oh, I trailed you all yesterday,\" Tamara says. \"I'm not going to let you mess up my plans. You and Juliette moved in generally the same direction, so she's actually pretty close. We're going to catch up with her and get her to join us.\"","\t\t","\t\t*gosub lustcheck","\t\t*goto grillchoice","\t*hide_reuse #Ask how long she's been hiding nearby.","\t\t\"Not long,\" Tamara says. \"I camped nearby, got up before dawn, then came here.\"","\t\t","\t\t*gosub lustcheck","\t\t*goto grillchoice","\t*hide_reuse #Ask if she watched you sleep.","\t\t*set admit_water true","\t\t\"What? No!\" Tamara says. \"I'm not into things like that. All I did was add something to your water.\"","\t\t","\t\t*gosub lustcheck","\t\t*goto grillchoice","\t*if admit_water","\t\t*hide_reuse #Ask what she added to your water.","\t\t\t*set admit_potion true","\t\t\t\"A drop of a magic potion,\" Tamara says.","\t\t\t","\t\t\t*gosub lustcheck","\t\t\t*goto grillchoice","\t*if admit_potion","\t\t*hide_reuse #Ask what kind of potion.","\t\t\t*set admit_love_potion true","\t\t\t\"A love potion, of course,\" Tamara says. \"A very special, unique one though. It also has charm and polymorph magic in it as well.\"","\t\t\t","\t\t\t*gosub lustcheck","\t\t\t*goto grillchoice","\t*if (lust > 1) #Make a pass.","\t\t*goto pass","\t#No more questions.","\t\t*goto hike","","*label lustcheck","*if lust = 0","\tYou have morning wood. It's not going away.","\t*goto next","*elseif lust = 1","\tYour morning wood grows stronger, and Tamara starts looking mighty sexy.","\t*goto next","*elseif lust = 2","\tYou start to be unable to think of anything other than how much you want to throw Tamara down and fuck her right on the forest floor.","\t*goto next","*else ","\t*goto desperation","*label next","*set lust +1","*return","\t","*label hike","*if lust = 0","\tYou start the day's journey, once again heading toward DragonKeep, the dragon and the princess. Tamara trails along behind you, and after a few minutes, she asks, \"Have any morning wood today?\"","","\tStrange... you do still have your morning erection, and usually it'd be gone by now. As you walk, instead of dissipating, your cock only gets harder and harder.","","\t\"Bet I'm looking pretty good right about now, huh?\" Tamara says nonchalantly, looking up at the trees.","","\tHer voice, which normally you find grating, turns you on.","\t*goto hikechoice","*else","\tYou try to focus on the journey despite your raging erection, but all you can think about is Tamara. She's fifteen feet behind you, but you think you can somehow smell her scent even from that distance. It's driving you crazy with desire.","*label hikechoice","*choice","\t#Ask her what the &#%@%# she's done to you.","\t\t*goto askdone","\t#Try to walk it off.","\t\t*goto walkoff","\t\t","*label askdone","[This option is yet to be written.]turns to see her, visual stim","","*label walkoff","[This option is yet to be written.]gets worse until can only think about one thing. masturbate?","","*label desperation","You can't take it anymore. You need relief NOW or you'll go stark raving mad. ","*choice","\t#Ask Tamara to fuck you.","\t\t*goto askfuck","\t#Masturbate.","\t\t*goto jerkoff","\t","*label askfuck","[This option is yet to be written.]If made her beg, pay back time","","*label jerkoff","You try to head off into the forest for privacy, but Tamara easily keeps up with you. It's no use. You need relief so urgently, that you don't care anymore. ","*choice","\t#Look at Tamara while doing it.","\t\t*goto masturtam","\t#Face the other direction.","\t\t*goto faceother","\t","*label masturtam","Oh man, that was a mistake. As soon as you look at Tamara, the urge to fuck her is irresistable. Your legs seem to take on a life of their own and start walking toward her.","","\"Rape, rape, oh no,\" Tamara says passionlessly, smirking.","","You start to rip open her breeches like a starving man and a package of food, while Tamara half-heartedly undoes your belt for you. You get her pants down as far as they'll easily go, whip out your rock-hard member, and thrust it into her. ","","Man, it feels good, but you don't care. All you care about is relief, so you begin pounding her so hard it starts driving her backwards.","","\"Whoa, slow down there,\" Tamara says, not really meaning it, as she half-falls/half-steps backwards until you have her up against a tree.","","Your hands dig into the bark like claws, desperately trying to get a better grip to pound her even more mercilessly.","","\"Oh, oh, oh yeah,\" Tamara says. \"I'm actually kinda getting turned on now from all this friction. Good thing I lubed myself first or this would be kinda bad.\"","","You jackhammer away.","","\"I used tallow,\" she goes on. \"Was meant for cooking. Say, wouldn't you like some boob action?\"","","While you continue humping her furiously, unable to think of anything else, she casually unties the laces of her vest and opens it up. You dive in without missing a beat and begin simultaneously fucking and sucking her.","","Tamara stops talking, now just leans against the tree, enjoying the sensations you're stimulating in her body like her own personal little pleasure machine.","","\"I'll get you for this,\" you mutter.","","Tamara just giggles.","*page_break","Slowly, your feelings toward Tamara begin to shift. Anger and distrust dissolve, replaced by attraction and affection, and your thrusting slows as you begin to caress and kiss her. Instead of desperation, you begin to enjoy the process, the exquisite pleasure her body is giving you.","","Tamara begins to kiss you back with real feeling and runs her hands up and down your body. Your thrusts become long and powerful, slamming again and again into her, and with each one, Tamara moans with pleasure, her hands beginning to grasp at your flesh longingly.","","You pull away from her, so you can look into her eyes, maintaining the strong, powerful thrusts. She looks back at you, her whole body wracked each time you plunge into her again. She closes her eyes in bliss. ","","Placing a hand on each shoulder, you gradually increase your pace until Tamara's body is bouncing before you. \"Ohhhhh... uhhhhhh......\" she says.","","You find yourself falling in love with her. This is not good.","","\"I love you,\" you hear yourself say involuntarily.","","\"I know,\" Tamara says with a touch of resignation. She knows it's just the effect of her magic potion, but to you it feels intensely real. You express this love growing in your heart through your body, and Tamara's body responds. The pleasure grows and grows, each thrust strengthening the emotional bond between you. ","","Finally, the pleasure grows unbearable, and both of you cannot help crying out at the top of your lungs. You grasp each other as orgasmic spasms wrack both your bodies, and as you feel your seed shoot deep inside her, it feels like you're now joined in love forever.","*page_break","*achieve potionvictim","When finally it subsides, you regain enough composure to ask, \"Uh, how long does this spell last, anyway?\"","","Tamara doesn't speak for awhile, just remains clinging to you, and you have to admit that holding each other like this feels very nice. You wish you could stay this way forever.","","Finally, Tamara releases you and pulls away slightly, and at the sight of her breasts, you feel your spent member begin to rise again.","","\"Like it or not,\" Tamara says. \"We're lifelong friends now. That's why I try not to use this potion on people. Now get outta me. You gotta save some of that for Juliette.\"","","Reluctantly, you ease yourself from her body and separate, feeling lonely for her touch already.","*page_break","\"Hey, what's going on here?\" says a voice behind you.","","Tamara pushes you off her, and pants around your ankles, you fall. She whips out her deadly blade, and you struggle to do the same.","","You turn and see that it's Juliette, standing with her hand on the pommel of her sword, looking curious rather than threatening.","","\"It sounded like you were dying,\" she says. \"I thought an animal was mauling two people.\"","","\"That's not too far off,\" Tamara says laughing while she pulls up her pants. She puts her sword away.","","\"What do you have to save for me?\" Juliette asks, addressing the question to both of you.","*choice","\t#Let Tamara answer.","\t\t*goto tamaraanswer","\t#Try to answer in a non-insulting, vague way.","\t\t*goto vague","\t#Come clean and answer honestly.","\t\t*goto honest","\t","*label tamaraanswer","[This option is yet to be written.]","","*label vague","[This option is yet to be written.]","","*label honest","\"I guess you heard the whole conversation, huh?\" you ask, and Juliette nods.","","\"Then I won't try to hide anything,\" you say. \"We talked with Banes earlier and decided we want to join forces with you. My friend here, Tamara, is a master of dragonlore, and she knows the secret entrance.\"","","Tamara nods.","","\"But what's this you're saving for me?\" Juliette asks.","","\"A personal love machine,\" Tamara chimes in. \"My friend here is a master cunnilinguist.\"","","\"Oh, but I'm a lesbian,\" Juliette says. \"No thank you, anyway. I plan to fight chivalrously, not sneak in like a thief in the night. Now that I see no one is being mauled, I'll be on my way. Goodbye.\"","","She turns to go.","","You look at Tamara. Tamara looks at you. You stare at each other for a long moment, and finally Tamara mouths the words, \"She's... a... lesbian...\" Her mouth drops open.","*fake_choice","\t#Sing the Batman theme song except change the lyrics to, \"Nuh nuh nuh nuh nuh... Seduction time... Seduction time... Nuh nuh nuh nuh... Seduction time!\" and point at Tamara.","\t\t","\t#Just laugh.","\"But... but... but... I don't like girls in that way,\" Tamara says, mouth still open in shock, eyes bugging out at the horror of it all. \"No, no, no, I can't do it. You still have to do it. It's too disgusting to me. I only like men, men, MEN!\"","*fake_choice","\t#\"Too bad. You have to do it.\"","\t\t\"Why do I have to do it, though?\" Tamara says. \"Would you do it if you were as straight as I am, and it was some other man? No. No way would you do it, so I'm not doing it.\"","\t\t*fake_choice","\t\t\t#Sing the Batman theme song except change the lyrics to, \"Nuh nuh nuh nuh nuh... Too bad... Too bad... Nuh nuh nuh nuh... Too bad!\"","\t\t\t#Just laugh.","\t#\"So it was okay forcing ME to seduce her, but now when the tables are turned you won't?","\t\t\"But it's different, though!\" Tamara insists. \"You're a man. ","\t\t*gosub_scene piglist","\t\t","*label faceother","[This option is yet to be written.]","","","",""]}}</script><script>//
// Copyright (c) 2008, 2009 Paul Duncan (paul@pablotron.org)
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
//


/* 
 * The contents of gears_init.js; we need this because Chrome supports
 * Gears out of the box, but still requires this constructor.  Note that
 * if you include gears_init.js then this function does nothing.
 */
(function() {
  // We are already defined. Hooray!
  if (window.google && google.gears)
    return;

  // factory 
  var F = null;

  // Firefox
  if (typeof GearsFactory != 'undefined') {
    F = new GearsFactory();
  } else {
    // IE
    try {
      F = new ActiveXObject('Gears.Factory');
      // privateSetGlobalObject is only required and supported on WinCE.
      if (F.getBuildInfo().indexOf('ie_mobile') != -1)
        F.privateSetGlobalObject(this);
    } catch (e) {
      // Safari
      if ((typeof navigator.mimeTypes != 'undefined')
           && navigator.mimeTypes["application/x-googlegears"]) {
        F = document.createElement("object");
        F.style.display = "none";
        F.width = 0;
        F.height = 0;
        F.type = "application/x-googlegears";
        document.documentElement.appendChild(F);
      }
    }
  }

  // *Do not* define any objects if Gears is not installed. This mimics the
  // behavior of Gears defining the objects in the future.
  if (!F)
    return;

  // Now set up the objects, being careful not to overwrite anything.
  //
  // Note: In Internet Explorer for Windows Mobile, you can't add properties to
  // the window object. However, global objects are automatically added as
  // properties of the window object in all browsers.
  if (!window.google)
    google = {};

  if (!google.gears)
    google.gears = {factory: F};
})();

/**
 * Persist - top-level namespace for Persist library.
 * @namespace
 */
Persist = (function() {
  var VERSION = '0.2.0', P, B, esc, init, empty, ec;

  // easycookie 0.2.1 (pre-minified)
  // (see http://pablotron.org/software/easy_cookie/)
  ec = (function(){var EPOCH='Thu, 01-Jan-1970 00:00:01 GMT',RATIO=1000*60*60*24,KEYS=['expires','path','domain'],esc=escape,un=unescape,doc=document,me;var get_now=function(){var r=new Date();r.setTime(r.getTime());return r;}
var cookify=function(c_key,c_val){var i,key,val,r=[],opt=(arguments.length>2)?arguments[2]:{};r.push(esc(c_key)+'='+esc(c_val));for(i=0;i<KEYS.length;i++){key=KEYS[i];if(val=opt[key])
r.push(key+'='+val);}
if(opt.secure)
r.push('secure');return r.join('; ');}
var alive=function(){var k='__EC_TEST__',v=new Date();v=v.toGMTString();this.set(k,v);this.enabled=(this.remove(k)==v);return this.enabled;}
me={set:function(key,val){var opt=(arguments.length>2)?arguments[2]:{},now=get_now(),expire_at,cfg={};if(opt.expires){cfg.expires=new Date(now.getTime()+opt.expires*RATIO);cfg.expires=cfg.expires.toGMTString();}
var keys=['path','domain','secure'];for(i=0;i<keys.length;i++)
if(opt[keys[i]])
cfg[keys[i]]=opt[keys[i]];var r=cookify(key,val,cfg);doc.cookie=r;return val;},has:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+'='),len=ofs+key.length+1,sub=c.substring(0,key.length);return((!ofs&&key!=sub)||ofs<0)?false:true;},get:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+'='),len=ofs+key.length+1,sub=c.substring(0,key.length),end;if((!ofs&&key!=sub)||ofs<0)
return null;end=c.indexOf(';',len);if(end<0)
end=c.length;return un(c.substring(len,end));},remove:function(k){var r=me.get(k),opt={expires:EPOCH};doc.cookie=cookify(k,'',opt);return r;},keys:function(){var c=doc.cookie,ps=c.split('; '),i,p,r=[];for(i=0;i<ps.length;i++){p=ps[i].split('=');r.push(un(p[0]));}
return r;},all:function(){var c=doc.cookie,ps=c.split('; '),i,p,r=[];for(i=0;i<ps.length;i++){p=ps[i].split('=');r.push([un(p[0]),un(p[1])]);}
return r;},version:'0.2.1',enabled:false};me.enabled=alive.call(me);return me;}());

  // wrapper for Array.prototype.indexOf, since IE doesn't have it
  var index_of = (function() {
    if (Array.prototype.indexOf)
      return function(ary, val) { 
        return Array.prototype.indexOf.call(ary, val);
      };
    else
      return function(ary, val) {
        var i, l;

        for (i = 0, l = ary.length; i < l; i++)
          if (ary[i] == val)
            return i;

        return -1;
      };
  })();


  // empty function
  empty = function() { };

  /**
   * Escape spaces and underscores in name.  Used to generate a "safe"
   * key from a name.
   *
   * @private
   */
  esc = function(str) {
    return 'PS' + str.replace(/_/g, '__').replace(/ /g, '_s');
  };

  C = {
    /* 
     * Backend search order.
     * 
     * Note that the search order is significant; the backends are
     * listed in order of capacity, and many browsers
     * support multiple backends, so changing the search order could
     * result in a browser choosing a less capable backend.
     */ 
    search_order: [
      // TODO: air
      'cefStorage',
      'winOldStorage',
      'winStoreStorage',
      'macStorage',
      'iosStorage',
      'localChromeStorage',
      'androidStorage',
      'whatwg_db', 
      'localstorage',
      'globalstorage', 
      'cookie',
      'gears',
      'ie', 
      'flash'
    ],

    // valid name regular expression
    name_re: /^[a-z][a-z0-9_ -]+$/i,

    // list of backend methods
    methods: [
      'init', 
      'get', 
      'set', 
      'remove', 
      'load', 
      'save'
      // TODO: clear method?
    ],

    // sql for db backends (gears and db)
    sql: {
      version:  '1', // db schema version

      // XXX: the "IF NOT EXISTS" is a sqlite-ism; fortunately all the 
      // known DB implementations (safari and gears) use sqlite
      create:   "CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",
      get:      "SELECT v FROM persist_data WHERE k = ?",
      set:      "INSERT INTO persist_data(k, v) VALUES (?, ?)",
      remove:   "DELETE FROM persist_data WHERE k = ?" 
    },

    // default flash configuration
    flash: {
      // ID of wrapper element
      div_id:   '_persist_flash_wrap',

      // id of flash object/embed
      id:       '_persist_flash',

      // default path to flash object
      path: 'persist.swf',
      size: { w:1, h:1 },

      // arguments passed to flash object
      args: {
        autostart: true
      }
    } 
  };

  // built-in backends
  B = {
    // gears db backend
    // (src: http://code.google.com/apis/gears/api_database.html)
    gears: {
      // no known limit
      size:   -1,

      test: function() {
        // test for gears
        return (window.google && window.google.gears) ? true : false;
      },

      methods: {
        transaction: function(fn) {
          var db = this.db;

          // begin transaction
          db.execute('BEGIN').close();

          // call callback fn
          fn.call(this, db);

          // commit changes
          db.execute('COMMIT').close();
        },

        init: function() {
          var db;

          // create database handle (TODO: add schema version?)
          db = this.db = google.gears.factory.create('beta.database');

          // open database
          // from gears ref:
          //
          // Currently the name, if supplied and of length greater than
          // zero, must consist only of visible ASCII characters
          // excluding the following characters:
          //
          //   / \ : * ? " < > | ; ,
          //
          // (this constraint is enforced in the Store constructor)
          db.open(esc(this.name));

          // create table
          db.execute(C.sql.create).close();
        },

        get: function(key, fn, scope) {
          var r, sql = C.sql.get;

          // if callback isn't defined, then return
          if (!fn)
            return;

          // begin transaction
          this.transaction(function (t) {
            var is_valid, val;
            // exec query
            r = t.execute(sql, [key]);

            // check result and get value
            is_valid = r.isValidRow();
            val = is_valid ? r.field(0) : null;

            // close result set
            r.close();

            // call callback
            fn.call(scope || this, is_valid, val);
          });
        },

        set: function(key, val, fn, scope) {
          var rm_sql = C.sql.remove,
              sql    = C.sql.set, r;

          // begin set transaction
          this.transaction(function(t) {
            // exec remove query
            t.execute(rm_sql, [key]).close();

            // exec set query
            t.execute(sql, [key, val]).close();
            
            // run callback (TODO: get old value)
            if (fn)
              fn.call(scope || this, true, val);
          });
        },

        remove: function(key, fn, scope) {
          var get_sql = C.sql.get;
              sql = C.sql.remove,
              r, val = null, is_valid = false;

          // begin remove transaction
          this.transaction(function(t) {
            // if a callback was defined, then get the old
            // value before removing it
            if (fn) {
              // exec get query
              r = t.execute(get_sql, [key]);

              // check validity and get value
              is_valid = r.isValidRow();
              val = is_valid ? r.field(0) : null;

              // close result set
              r.close();
            }

            // exec remove query if no callback was defined, or if a
            // callback was defined and there was an existing value
            if (!fn || is_valid) {
              // exec remove query
              t.execute(sql, [key]).close();
            }

            // exec callback
            if (fn)
              fn.call(scope || this, is_valid, val);
          });
        } 
      }
    }, 

    cefStorage: {
      size:   -1,

      test: function() {
        return !!window.cefQuery;
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {

        },

        query: function(method, paramString, callback) {
          cefQuery({request:method+" "+paramString,
            onSuccess: function(response) {
              callback(true, response);
            },
            onFailure: function(error_code, error_message) {
              console.error(method + " error: " + error_message);
              callback(false);
            }
          });
        },

        get: function(key, fn, scope) {
          key = this.key(key);

          // if callback isn't defined, then return
          if (!fn)
            return;

          // get callback scope
          scope = scope || this;

          this.query("StorageGet", key, function(ok, results) {
            fn.call(scope, ok, results);
          });
        },

        set: function(key, val, fn, scope) {
          key = this.key(key);
          scope = scope || this;
          this.query("StorageSet", key + " " + val, function(ok){
            if (fn) fn.call(scope, ok, val);
          });
          return val;
        },

        // begin remove transaction
        remove: function(key, fn, scope) {
          key = this.key(key);
          scope = scope || this;
          this.query("StorageRemove", key, function(ok) {
            // return original value? meh
            if (fn) fn.call(scope, ok);
          });
        }
      }
    },

    // whatwg db backend (webkit, Safari 3.1+)
    // (src: whatwg and http://webkit.org/misc/DatabaseExample.html)
    whatwg_db: {
      // size based on DatabaseExample from above (should I increase
      // this?)
      size:   200 * 1024,

      test: function() {
        var name = 'PersistJS Test', 
            desc = 'Persistent database test.';

        // test for openDatabase
        if (!window.openDatabase)
          return false;

        // make sure openDatabase works
        // XXX: will this leak a db handle and/or waste space?
        if (!window.openDatabase(name, C.sql.version, desc, B.whatwg_db.size))
          return false;

        // return true
        return true;
      },

      methods: {
        transaction: function(fn) {
          // lazy create database table;
          // this is done here because there is no way to
          // prevent a race condition if the table is created in init()
          if (!this.db_created) {
            this.db.transaction(function(t) {
              // create table
              t.executeSql(C.sql.create, [], function() {
                this.db_created = true;
              });
            }, empty); // trap exception
          } 

          // execute transaction
          this.db.transaction(fn);
        },

        init: function() {
          // create database handle
          this.db = openDatabase(
            this.name, 
            C.sql.version, 
            this.o.about || ("Persistent storage for " + this.name),
            this.o.size || B.whatwg_db.size 
          );
        },

        get: function(key, fn, scope) {
          var sql = C.sql.get;

          // if callback isn't defined, then return
          if (!fn)
            return;

          // get callback scope
          scope = scope || this;

          // begin transaction
          this.transaction(function (t) {
            t.executeSql(sql, [key], function(t, r) {
              if (r.rows.length > 0)
                fn.call(scope, true, r.rows.item(0)['v']);
              else
                fn.call(scope, false, null);
            });
          });
        },

        set: function(key, val, fn, scope) {
          var rm_sql = C.sql.remove,
              sql    = C.sql.set;

          // begin set transaction
          this.transaction(function(t) {
            // exec remove query
            t.executeSql(rm_sql, [key], function() {
              // exec set query
              t.executeSql(sql, [key, val], function(t, r) {
                // run callback
                if (fn)
                  fn.call(scope || this, true, val);
              });
            });
          });

          return val;
        },

        // begin remove transaction
        remove: function(key, fn, scope) {
          var get_sql = C.sql.get;
              sql = C.sql.remove;

          this.transaction(function(t) {
            // if a callback was defined, then get the old
            // value before removing it
            if (fn) {
              // exec get query
              t.executeSql(get_sql, [key], function(t, r) {
                if (r.rows.length > 0) {
                  // key exists, get value 
                  var val = r.rows.item(0)['v'];

                  // exec remove query
                  t.executeSql(sql, [key], function(t, r) {
                    // exec callback
                    fn.call(scope || this, true, val);
                  });
                } else {
                  // key does not exist, exec callback
                  fn.call(scope || this, false, null);
                }
              });
            } else {
              // no callback was defined, so just remove the
              // data without checking the old value

              // exec remove query
              t.executeSql(sql, [key]);
            }
          });
        } 
      }
    }, 
    
    // globalstorage backend (globalStorage, FF2+, IE8+)
    // (src: http://developer.mozilla.org/en/docs/DOM:Storage#globalStorage)
    // https://developer.mozilla.org/En/DOM/Storage
    //
    // TODO: test to see if IE8 uses object literal semantics or
    // getItem/setItem/removeItem semantics
    globalstorage: {
      // (5 meg limit, src: http://ejohn.org/blog/dom-storage-answers/)
      size: 5 * 1024 * 1024,

      test: function() {
        try {
          if (window.globalStorage && window.globalStorage[this.o.domain]) return true;
        } catch (e) {}
        return false;
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = globalStorage[this.o.domain];
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.getItem(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setItem(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store[key];

          // delete value
          this.store.removeItem(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 
    
    // localstorage backend (globalStorage, FF2+, IE8+)
    // (src: http://www.whatwg.org/specs/web-apps/current-work/#the-localstorage)
    // also http://msdn.microsoft.com/en-us/library/cc197062(VS.85).aspx#_global
    localstorage: {
      // (unknown?)
      // ie has the remainingSpace property, see:
      // http://msdn.microsoft.com/en-us/library/cc197016(VS.85).aspx
      size: -1,

      test: function() {
        try {
          return window.localStorage ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = localStorage;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.getItem(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setItem(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.getItem(key);

          // delete value
          this.store.removeItem(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

    // chrome packaged app storage
    // http://developer.chrome.com/stable/apps/storage.html
    localChromeStorage: {
      // (unknown?)
      // ie has the remainingSpace property, see:
      // http://msdn.microsoft.com/en-us/library/cc197016(VS.85).aspx
      size: -1,

      test: function() {
        try {
          return window.chrome && window.chrome.storage && window.chrome.storage.local;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = chrome.storage.local;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          scope = scope || this;
          this.store.get(key, function(val){
            if (fn) fn.call(scope, true, val[key]);
          });
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          var out = {};
          out[key] = val;
          if (fn) {
            scope = scope || this;  
            this.store.set(out, function(){
              fn.call(scope, true, val);
            });
          } else {
            this.store.set(out);
          }
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          if (fn) {
            // get value first
            scope = scope || this;
            this.store.get(key, function(val){
              this.store.remove(key, function(){
                fn.call(scope, (val[key] !== null), val[key]);
              });
            });
          } else {
            this.store.remove(key);
          }
        } 
      }
    }, 
    
    // DGF Fake local storage
    androidStorage: {
      // (unknown?)
      // ie has the remainingSpace property, see:
      // http://msdn.microsoft.com/en-us/library/cc197016(VS.85).aspx
      size: -1,

      test: function() {
        try {
          return window.androidStorage ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = androidStorage;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.getItem(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setItem(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.getItem(key);

          // delete value
          this.store.removeItem(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

    // DGF iOS managed storage
    iosStorage: {
      size: -1,

      test: function() {
        try {
          return window.isIosApp ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {

        },

        callIos: function(url) {
          var iframe = document.createElement("IFRAME");
          iframe.setAttribute("src", url);
          document.documentElement.appendChild(iframe);
          iframe.parentNode.removeChild(iframe);
          iframe = null;
        },

        get: function(key, fn, scope) {
          if (!fn) return;
          // expand key
          key = this.key(key);

          var nonce = "storageget" + key + (+new Date);
          window[nonce] = function(value) {
            delete window[nonce];
            fn.call(scope || this, true, value);
          }
          this.callIos("storageget://" + key + " " + nonce);
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          var nonce = "storageset" + key + (+new Date);
          window[nonce] = function() {
            delete window[nonce];
            if (fn) fn.call(scope || this, true, val);
          }
          this.callIos("storageset://" + key + " " + nonce + " " + encodeURIComponent(encodeURIComponent(val)));
        },

        remove: function(key, fn, scope) {
          if (fn) {
            this.get(key, function(val) {
              this._remove(key, fn, scope, val);
            }, this);
          } else {
            this._remove(key, fn, scope);
          }
        },

        _remove: function(key, fn, scope, val) {
          var val;

          // expand key
          key = this.key(key);

          // delete value
          var nonce = "storagerem" + key + (+new Date);
          window[nonce] = function() {
            delete window[nonce];
            if (fn) fn.call(scope || this, (val !== null), val);
          }
          this.callIos("storagerem://" + key + " " + nonce + " " + encodeURIComponent(val));
        } 
      }
    }, 

    // DGF OSX managed storage
    macStorage: {
      size: -1,

      test: function() {
        try {
          return window.macStorage ? true : false;
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = macStorage;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.objectForKey_(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.setObject_forKey_(val, key);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.objectForKey_(key)

          // delete value
          this.store.removeObjectForKey_(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

    // DGF Old win app managed storage
    winOldStorage: {
      size: -1,

      test: function() {
        try {
          return window.external.IsWinOldApp();
        } catch (e) {
          return false;
        }
      },

      methods: {
        key: function(key) {
          return esc(this.name) + esc(key);
        },

        init: function() {
          this.store = window.external;
        },

        get: function(key, fn, scope) {
          // expand key
          key = this.key(key);

          if (fn)
            fn.call(scope || this, true, this.store.GetValue(key));
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = this.key(key);

          // set value
          this.store.SetValue(key, val);

          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = this.key(key);

          // get value
          val = this.store.GetValue(key)

          // delete value
          this.store.DeleteValue(key);

          if (fn)
            fn.call(scope || this, (val !== null), val);
        } 
      }
    }, 

      // DGF WinStore managed storage
    winStoreStorage: {
        size: -1,

        test: function () {
            try {
                return Windows.Storage.ApplicationData.current.roamingFolder;
            } catch (e) {
                return false;
            }
        },

        methods: {
            key: function (key) {
                return esc(this.name) + esc(key);
            },

            init: function () {
                var self = this;
                function doneLoadingWinStore() {
                  self.loaded = true;
                  for (var i = self.loadListeners.length - 1; i >= 0; i--) {
                    setTimeout(self.loadListeners[i], 0);
                  }
                }
                this.loaded = false;
                this.loadListeners = [];

                Windows.Storage.ApplicationData.current.roamingFolder
                  .createFileAsync("data.txt", Windows.Storage.CreationCollisionOption.openIfExists)
                  .then(function (file) {
                    self.file = file;
                    return Windows.Storage.FileIO.readTextAsync(file);
                  }).done(function (data) {
                    self.store = {};
                    if (data && typeof data == "string") {
                      var rows = data.split("\n");
                      for (var i = rows.length - 1; i >= 0; i--) {
                        var row = rows[i].split("\t");
                        self.store[row[0]] = decodeURIComponent(row[1]);
                      }
                    }
                    doneLoadingWinStore();
                  },
                  function(){
                    self.store = {};
                    doneLoadingWinStore();
                  });
            },

            get: function (key, fn, scope) {
                if (!this.loaded) {
                  var self = this;
                  this.loadListeners.push(function() {self.get(key, fn, scope)});
                  return;
                }
                // expand key
                key = this.key(key);

                if (fn)
                    fn.call(scope || this, true, this.store[key]);
            },

            set: function (key, val, fn, scope) {
                if (!this.loaded) {
                  var self = this;
                  this.loadListeners.push(function() {self.set(key, val, fn, scope)});
                  return;
                }
                // expand key
                key = this.key(key);

                // set value
                this.store[key] = val;
                this.writeAsync();

                if (fn)
                    fn.call(scope || this, true, val);
            },

            remove: function (key, fn, scope) {
                if (!this.loaded) {
                  var self = this;
                  this.loadListeners.push(function() {self.remove(key, fn, scope)});
                  return;
                }
                var val;

                // expand key
                key = this.key(key);

                // get value
                val = this.store[key];

                // delete value
                delete this.store[key];
                this.writeAsync();

                if (fn)
                    fn.call(scope || this, (val !== null), val);
            },

            writeAsync: function() {
              var output = [];
              for (var key in this.store) {
                output.push(key, '\t', encodeURIComponent(this.store[key]), '\n');
              }
              Windows.Storage.FileIO.writeTextAsync(this.file, output.join(''));
            }
        }
    },

    // IE backend
    ie: {
      prefix:   '_persist_data-',
      // style:    'display:none; behavior:url(#default#userdata);',

      // 64k limit
      size:     64 * 1024,

      test: function() {
        // make sure we're dealing with IE
        // (src: http://javariet.dk/shared/browser_dom.htm)
        return window.ActiveXObject ? true : false;
      },

      make_userdata: function(id) {
        var el = document.createElement('div');

        // set element properties
        // http://msdn.microsoft.com/en-us/library/ms531424(VS.85).aspx 
        // http://www.webreference.com/js/column24/userdata.html
        el.id = id;
        el.style.display = 'none';
        el.addBehavior('#default#userdata');

        // append element to body
        document.body.appendChild(el);

        // return element
        return el;
      },

      methods: {
        init: function() {
          var id = B.ie.prefix + esc(this.name);

          // save element
          this.el = B.ie.make_userdata(id);

          // load data
          if (this.o.defer)
            this.load();
        },

        get: function(key, fn, scope) {
          var val;

          // expand key
          key = esc(key);

          // load data
          if (!this.o.defer)
            this.load();

          // get value
          val = this.el.getAttribute(key);

          // call fn
          if (fn)
            fn.call(scope || this, val ? true : false, val);
        },

        set: function(key, val, fn, scope) {
          // expand key
          key = esc(key);
          
          // set attribute
          this.el.setAttribute(key, val);

          // save data
          if (!this.o.defer)
            this.save();

          // call fn
          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // expand key
          key = esc(key);

          // load data
          if (!this.o.defer)
            this.load();

          // get old value and remove attribute
          val = this.el.getAttribute(key);
          this.el.removeAttribute(key);

          // save data
          if (!this.o.defer)
            this.save();

          // call fn
          if (fn)
            fn.call(scope || this, val ? true : false, val);
        },

        load: function() {
          this.el.load(esc(this.name));
        },

        save: function() {
          this.el.save(esc(this.name));
        }
      }
    },

    // cookie backend
    // uses easycookie: http://pablotron.org/software/easy_cookie/
    cookie: {
      delim: ':',

      // 4k limit (low-ball this limit to handle browser weirdness, and 
      // so we don't hose session cookies)
      size: 4000,

      test: function() {
        // XXX: use easycookie to test if cookies are enabled
        return P.Cookie.enabled ? true : false;
      },

      methods: {
        key: function(key) {
          return this.name + B.cookie.delim + key;
        },

        get: function(key, fn, scope) {
          var val;

          // expand key 
          key = this.key(key);

          // get value
          val = ec.get(key);

          // call fn
          if (fn)
            fn.call(scope || this, val != null, val);
        },

        set: function(key, val, fn, scope) {
          // expand key 
          key = this.key(key);

          // save value
          ec.set(key, val, this.o);

          // call fn
          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, val, fn, scope) {
          var val;

          // expand key 
          key = this.key(key);

          // remove cookie
          val = ec.remove(key)

          // call fn
          if (fn)
            fn.call(scope || this, val != null, val);
        } 
      }
    },

    // flash backend (requires flash 8 or newer)
    // http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_16194&sliceId=1
    // http://livedocs.adobe.com/flash/8/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002200.html
    flash: {
      test: function() {
        // TODO: better flash detection
        if (!window.deconcept || !window.deconcept.SWFObjectUtil)
          return false;

        // get the major version
        var major = deconcept.SWFObjectUtil.getPlayerVersion().major;

        // check flash version (require 8.0 or newer)
        return (major >= 8) ? true : false;
      },

      methods: {
        init: function() {
          if (!B.flash.el) {
            var o, key, el, cfg = C.flash;

            // create wrapper element
            el = document.createElement('div');
            el.id = cfg.div_id;

            // FIXME: hide flash element
            // el.style.display = 'none';

            // append element to body
            document.body.appendChild(el);

            // create new swf object
            o = new deconcept.SWFObject(this.o.swf_path || cfg.path, cfg.id, cfg.size.w, cfg.size.h, '8');

            // set parameters
            for (key in cfg.args)
              o.addVariable(key, cfg.args[key]);

            // write flash object
            o.write(el);

            // save flash element
            B.flash.el = document.getElementById(cfg.id);
          }

          // use singleton flash element
          this.el = B.flash.el;
        },

        get: function(key, fn, scope) {
          var val;

          // escape key
          key = esc(key);

          // get value
          val = this.el.get(this.name, key);

          // call handler
          if (fn)
            fn.call(scope || this, val !== null, val);
        },

        set: function(key, val, fn, scope) {
          var old_val;

          // escape key
          key = esc(key);

          // set value
          old_val = this.el.set(this.name, key, val);

          // call handler
          if (fn)
            fn.call(scope || this, true, val);
        },

        remove: function(key, fn, scope) {
          var val;

          // get key
          key = esc(key);

          // remove old value
          val = this.el.remove(this.name, key);

          // call handler
          if (fn)
            fn.call(scope || this, true, val);
        }
      }
    }
  };

  /**
   * Test for available backends and pick the best one.
   * @private
   */
  var init = function() {
    var i, l, b, key, fns = C.methods, keys = C.search_order;

    // set all functions to the empty function
    for (i = 0, l = fns.length; i < l; i++) 
      P.Store.prototype[fns[i]] = empty;

    // clear type and size
    P.type = null;
    P.size = -1;

    // loop over all backends and test for each one
    for (i = 0, l = keys.length; !P.type && i < l; i++) {
      b = B[keys[i]];

      // test for backend
      try {
        if (b.test()) {
          // found backend, save type and size
          P.type = keys[i];
          P.size = b.size;

          // extend store prototype with backend methods
          for (key in b.methods)
            P.Store.prototype[key] = b.methods[key];
        }
      } catch (e) {}
    }

    // mark library as initialized
    P._init = true;
  };

  // create top-level namespace
  P = {
    // version of persist library
    VERSION: VERSION,

    // backend type and size limit
    type: null,
    size: 0,

    // XXX: expose init function?
    // init: init,

    add: function(o) {
      // add to backend hash
      B[o.id] = o;

      // add backend to front of search order
      C.search_order = [o.id].concat(C.search_order);

      // re-initialize library
      init();
    },

    remove: function(id) {
      var ofs = index_of(C.search_order, id);
      if (ofs < 0)
        return;

      // remove from search order
      C.search_order.splice(ofs, 1);

      // delete from lut
      delete B[id];

      // re-initialize library
      init();
    },

    // expose easycookie API
    Cookie: ec,

    // store API
    Store: function(name, o) {
      // verify name
      if (!C.name_re.exec(name))
        throw new Error("Invalid name");

      // XXX: should we lazy-load type?
      // if (!P._init)
      //   init();

      if (!P.type)
        throw new Error("No suitable storage found");

      o = o || {};
      this.name = name;

      // get domain (XXX: does this localdomain fix work?)
      o.domain = o.domain || location.host || 'localhost';
      
      // strip port from domain (XXX: will this break ipv6?)
      o.domain = o.domain.replace(/:\d+$/, '')

      // append localdomain to domains w/o '."
      // (see https://bugzilla.mozilla.org/show_bug.cgi?id=357323)
      // (file://localhost/ works, see: 
      // https://bugzilla.mozilla.org/show_bug.cgi?id=469192)
/* 
 *       if (!o.domain.match(/\./))
 *         o.domain += '.localdomain';
 */ 

      this.o = o;

      // expires in 2 years
      o.expires = o.expires || 365 * 2;

      // set path to root
      o.path = o.path || '/';

      // call init function
      this.init();
    } 
  };

  // init persist
  init();

  // return top-level namespace
  return P;
})();
</script><script>/**
 * alertify
 * An unobtrusive customizable JavaScript notification system
 *
 * @author Fabien Doiron <fabien.doiron@gmail.com>
 * @copyright Fabien Doiron 2012
 * @license MIT <http://opensource.org/licenses/mit-license.php>
 * @link http://fabien-d.github.com/alertify.js/
 * @module alertify
 * @version 0.3.0
 */
(function(e,t){"use strict";var n=e.document,r;r=function(){var r={},i={},s=!1,o={ENTER:13,ESC:27,SPACE:32},u=[],a,f,l,c,h;return i={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok" />{{ok}}</button>',ok:'<a href="#" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</a>',cancel:'<a href="#" class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</a>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},a=function(e){return n.getElementById(e)},r={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,addListeners:function(r){var i=a("alertify-resetFocus"),s=a("alertify-ok")||t,u=a("alertify-cancel")||t,f=a("alertify-text")||t,l=a("alertify-form")||t,c=typeof s!="undefined",h=typeof u!="undefined",p=typeof f!="undefined",d="",v=this,m,g,y,b,w;m=function(e){typeof e.preventDefault!="undefined"&&e.preventDefault(),y(e),typeof f!="undefined"&&(d=f.value),typeof r=="function"&&r(!0,d)},g=function(e){typeof e.preventDefault!="undefined"&&e.preventDefault(),y(e),typeof r=="function"&&r(!1)},y=function(e){v.hide(),v.unbind(n.body,"keyup",b),v.unbind(i,"focus",w),p&&v.unbind(l,"submit",m),c&&v.unbind(s,"click",m),h&&v.unbind(u,"click",g)},b=function(e){var t=e.keyCode;t===o.SPACE&&!p&&m(e),t===o.ESC&&h&&g(e)},w=function(e){p?f.focus():h?u.focus():s.focus()},this.bind(i,"focus",w),c&&this.bind(s,"click",m),h&&this.bind(u,"click",g),this.bind(n.body,"keyup",b),p&&this.bind(l,"submit",m),e.setTimeout(function(){f?(f.focus(),f.select()):s.focus()},50)},bind:function(e,t,n){typeof e.addEventListener=="function"?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},build:function(e){var t="",n=e.type,r=e.message,s=e.cssClass||"";t+='<div class="alertify-dialog">',n==="prompt"&&(t+='<form id="alertify-form">'),t+='<article class="alertify-inner">',t+=i.message.replace("{{message}}",r),n==="prompt"&&(t+=i.input),t+=i.buttons.holder,t+="</article>",n==="prompt"&&(t+="</form>"),t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',t+="</div>";switch(n){case"confirm":t=t.replace("{{buttons}}",i.buttons.cancel+i.buttons.ok),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":t=t.replace("{{buttons}}",i.buttons.cancel+i.buttons.submit),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":t=t.replace("{{buttons}}",i.buttons.ok),t=t.replace("{{ok}}",this.labels.ok);break;default:}return c.className="alertify alertify-show alertify-"+n+" "+s,l.className="alertify-cover",t},close:function(e,t){var n=t&&!isNaN(t)?+t:this.delay;this.bind(e,"click",function(){h.removeChild(e)}),setTimeout(function(){typeof e!="undefined"&&e.parentNode===h&&h.removeChild(e)},n)},dialog:function(e,t,r,i,o){f=n.activeElement;var a=function(){if(c&&c.scrollTop!==null)return;a()};if(typeof e!="string")throw new Error("message must be a string");if(typeof t!="string")throw new Error("type must be a string");if(typeof r!="undefined"&&typeof r!="function")throw new Error("fn must be a function");return typeof this.init=="function"&&(this.init(),a()),u.push({type:t,message:e,callback:r,placeholder:i,cssClass:o}),s||this.setup(),this},extend:function(e){if(typeof e!="string")throw new Error("extend method must have exactly one paramter");return function(t,n){return this.log(t,e,n),this}},hide:function(){u.splice(0,1),u.length>0?this.setup():(s=!1,c.className="alertify alertify-hide alertify-hidden",l.className="alertify-cover alertify-hidden",f?f.focus():null)},init:function(){n.createElement("nav"),n.createElement("article"),n.createElement("section"),l=n.createElement("div"),l.setAttribute("id","alertify-cover"),l.className="alertify-cover alertify-hidden",n.body.appendChild(l),c=n.createElement("section"),c.setAttribute("id","alertify"),c.className="alertify alertify-hidden",n.body.appendChild(c),h=n.createElement("section"),h.setAttribute("id","alertify-logs"),h.className="alertify-logs",n.body.appendChild(h),n.body.setAttribute("tabindex","0"),delete this.init},log:function(e,t,n){var r=function(){if(h&&h.scrollTop!==null)return;r()};return typeof this.init=="function"&&(this.init(),r()),this.notify(e,t,n),this},notify:function(e,t,r){var i=n.createElement("article");i.className="alertify-log"+(typeof t=="string"&&t!==""?" alertify-log-"+t:""),i.innerHTML=e,h.insertBefore(i,h.firstChild),setTimeout(function(){i.className=i.className+" alertify-log-show"},50),this.close(i,r)},set:function(e){var t;if(typeof e!="object"&&e instanceof Array)throw new Error("args must be an object");for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},setup:function(){var e=u[0];s=!0,c.innerHTML=this.build(e),typeof e.placeholder=="string"&&e.placeholder!==""&&(a("alertify-text").value=e.placeholder),this.addListeners(e.callback)},unbind:function(e,t,n){typeof e.removeEventListener=="function"?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}},{alert:function(e,t,n){return r.dialog(e,"alert",t,"",n),this},confirm:function(e,t,n){return r.dialog(e,"confirm",t,"",n),this},extend:r.extend,init:r.init,log:function(e,t,n){return r.log(e,t,n),this},prompt:function(e,t,n,i){return r.dialog(e,"prompt",t,n,i),this},success:function(e,t){return r.log(e,"success",t),this},error:function(e,t){return r.log(e,"error",t),this},set:function(e){r.set(e)},labels:r.labels}},typeof define=="function"?define([],function(){return new r}):typeof e.alertify=="undefined"&&(e.alertify=new r)})(this);</script><script>/*
 * Copyright 2010 by Dan Fabulich.
 * 
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License. 
 * You may obtain a copy of the License at
 * 
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 * 
 * See the License for the specific language governing
 * permissions and limitations under the License.
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */

function safeCall(obj, fn) {
    if (!fn) return;
    var isHeadless = typeof window == "undefined";
    var debug = false || (!isHeadless && window.debug);
    var userAgent = this.window && window.navigator && window.navigator.userAgent;
    var isSafari = /Safari/.test(userAgent);
    var isIE = /MSIE/.test(userAgent);
    if (isIE || isHeadless) {
        // just call through; onerror will be called and debugger will handle it
        if (typeof MSApp != "undefined") {
            if (obj) {
                MSApp.execUnsafeLocalFunction(function () { fn.call(obj); });
            } else {
                MSApp.execUnsafeLocalFunction(fn);
            }
        } else if (obj) {
            fn.call(obj);
        } else {
            fn.call();
        }
    } else {
        try {
            if (obj) {
                fn.call(obj);
            } else {
                fn.call();
            }
        } catch (e) {
            if (e.message) {
              window.onerror(e.message, e.fileName, e.lineNumber, e.stack);
            } else if (e.stack) {
              window.onerror(e.stack, e.fileName, e.lineNumber, e.stack);
            } else {
              window.onerror(toJson(e, '\n'));
            }

            if (window.console) {
              window.console.error(e);
              if (e.message) window.console.error("Message: " + e.message);
              if (e.stack) window.console.error("Stack: " + e.stack);
            }
            // Rethrow here so the debugger can handle it
            // On Firefox this causes a second prompt.  Meh!
            if (debug) throw e;
        }
    }
}

function safeCallback(callback) {
  return function() {
    safeCall(null, callback);
  };
}

function safeTimeout(fn, time) {
  setTimeout(function() {
    safeCall(null, fn);
  }, time);
}

function isDefined(x) {
    return "undefined" !== typeof x;
}

function jsonStringifyAscii(obj) {
  var stringified = JSON.stringify(obj, function replacer(key, value) {
    if (key == "scene") return undefined;
    return value;
  });
  var output = stringified.replace(/(.)/g, function(x) {
    var code = x.charCodeAt(0);
    if (code > 127 || code < 32) {
     var outCode = code.toString(16);
     switch (outCode.length) {
       case 4:
         return "\\u" + outCode;
       case 3:
         return "\\u0" + outCode;
       case 2:
         return "\\u00" + outCode;
       case 1:
         return "\\u000" + outCode;
       default:
         return x;
     }
    }
    return x;
  });
  return output;
}

function toJson(obj, standardized) {
 if (typeof JSON != "undefined" && JSON.stringify) {
  return jsonStringifyAscii(obj);
 }
 switch (typeof obj) {
  case 'object':
   if (obj) {
    var list = [];
    if (obj instanceof Array) {
     for (var i=0;i < obj.length;i++) {
      list.push(toJson(obj[i], standardized));
     }
     return '[' + list.join(',') + ']';
    } else {
     for (var prop in obj) {
      if (prop == "scene") continue;
      if (!standardized && /^[a-zA-Z][a-zA-Z_0-9]\w+$/.test(prop) && !/\b(abstract|boolean|break|byte|case|catch|char|class|comment|const|continue|debugger|default|delete|do|double|else|enum|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|label|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throws|transient|true|try|typeof|var|void|volatile|while|with)\b/.test(prop)) {
        list.push(prop + ':' + toJson(obj[prop], standardized));
      } else {
        list.push('"' + prop + '":' + toJson(obj[prop], standardized));
      }
     }
     return '{' + list.join(',') + '}';
    }
   } else {
    return 'null';
   }
   break;
  case 'string':
   var encoded = obj.replace(/(.)/g, function(x) {
     if (x == "'" || x == '"' || x == '\\') {
       return "\\" + x;
     }
     var code = x.charCodeAt(0);
     if (code > 127 || code < 32) {
       var outCode = code.toString(16);
       switch (outCode.length) {
         case 4:
           return "\\u" + outCode;
         case 3:
           return "\\u0" + outCode;
         case 2:
           return "\\u00" + outCode;
         case 1:
           return "\\u000" + outCode;
         default:
           return x;
       }
     }
     return x;
   });
   return '"' + encoded + '"';
  case 'number':
  case 'boolean':
   return String(obj);
  case 'function':
   return 'badfunction';
  case 'undefined':
    return 'undefined';
  default:
   throw new Error("invalid type: " + typeof obj);
 }
}

var loginUrlBase = "https://www.choiceofgames.com/api/";
function xhrAuthRequest(method, endpoint, callback) {
  var paramBuilder = new Array(arguments.length*3);
  for (var i = 3; i < arguments.length; i=i+2) {
    if (i > 3) paramBuilder.push("&");
    paramBuilder.push(arguments[i]);
    paramBuilder.push("=");
    paramBuilder.push(arguments[i+1]);
  }
  var params = paramBuilder.join("");
  var xhr = findXhr();
  if (method == "POST") {
    xhr.open(method, loginUrlBase + endpoint + ".php", true);
    xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  } else {
    xhr.open(method, loginUrlBase + endpoint + ".php?" + params, true);
  }

  var done = false;

  xhr.onreadystatechange = function() {
    if (done) return;
    if (xhr.readyState != 4) return;
    done = true;
    var ok = xhr.status == 200;
    var response = {};
    try {
      if (xhr.responseText) response = JSON.parse(xhr.responseText);
    } catch (e) {
      ok = false;
    }
    if (!ok && !response.error) response.error = "unknown error";
    if (callback) safeCall(null, function() {callback(ok, response);});
  };
  xhr.send(params);
}

function login(email, password, register, subscribe, callback) {
  xhrAuthRequest("POST", "login", callback, "email", encodeURIComponent(email), "password", encodeURIComponent(password), "register", register, "subscribe", subscribe);
}

function forgotPassword(email, callback) {
  xhrAuthRequest("POST", "forgot", callback, "email", encodeURIComponent(email));
}

function logout(callback) {
  document.cookie = 'login=0;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
  xhrAuthRequest("GET", "logout", callback);
  recordLogin(false);
  window.knownPurchases = null;
  if (typeof FB != "undefined" && FB.logout) FB.logout();
  if (typeof gapi != "undefined" && gapi.auth && gapi.auth.signOut) gapi.auth.signOut();
}

function recordLogin(registered, email, callback) {
  if (initStore()) {
    if (registered) recordEmail(email);
    window.store.set("login", registered, function() {safeCall(null, callback);});
    window.registered = registered;
  } else {
    safeTimeout(callback, 0);
  }
}

function getRemoteEmail(callback) {
  xhrAuthRequest("GET", "getuser", callback);
}

function saveCookie(callback, slot, stats, temps, lineNum, indent) {
    var value = computeCookie(stats, temps, lineNum, indent);
    return writeCookie(value, slot, callback);
}

function computeCookie(stats, temps, lineNum, indent) {
  var scene = stats.scene;
  delete stats.scene;
  if (scene) stats.sceneName = scene.name;
  var version = "UNKNOWN";
  if (typeof(window) != "undefined" && window && window.version) version = window.version;
  var value = toJson({version:version, stats:stats, temps:temps, lineNum: lineNum, indent: indent});
  stats.scene = scene;
  return value;
}

function writeCookie(value, slot, callback) {
  if (!window.pseudoSave) window.pseudoSave = {};
  if (!slot) {
    slot = "";
  }
  window.pseudoSave[slot] = value;
  if (!initStore()) {
    if (callback) safeTimeout(callback, 0);
    return;
  }
  window.store.set("state"+slot, value, safeCallback(callback));
}

function clearCookie(callback, slot) {
    writeCookie('', slot, safeCallback(callback));
}

function areSaveSlotsSupported() {
  return !!(initStore() && window.Persist.type != "cookie");
}

function recordSave(slot, callback) {
  if (!areSaveSlotsSupported()) {
    safeTimeout(callback, 0);
    return;
  }
  restoreObject(initStore(), "save_list", [], function (saveList) {
    saveList.push(slot);
    window.store.set("save_list", toJson(saveList), safeCallback(callback));
  });
}

function recordDirtySlots(slots, callback) {
  if (!areSaveSlotsSupported()) {
    safeTimeout(callback, 0);
    return;
  }
  restoreObject(initStore(), "dirty_save_list", [], function (saveList) {
    saveSet = {};
    for (var i = 0; i < saveList.length; i++) {
      saveSet[saveList[i]] = 1;
    }
    for (i = 0; i < slots.length; i++) {
      if (!saveSet[slots[i]]) saveList.push(slots[i]);
    }
    window.store.set("dirty_save_list", toJson(saveList), safeCallback(callback));
  });
}

function recordEmail(email, callback) {
  if (initStore()) {
    window.store.set("email", email, safeCallback(callback));
  } else {
    safeTimeout(callback, 0);
  }
}

function fetchEmail(callback) {
  if (!initStore()) {
    safeTimeout(function(){callback("");}, 0);
    return;
  }
  window.store.get("email", function(ok, value) {
    safeCall(null, function() {
      if (ok && value) {
        callback(value);
      } else {
        callback("");
      }
    });
  });
}

function restoreObject(store, key, defaultValue, callback) {
  if (!store) {
    safeTimeout(function() {callback(defaultValue);}, 0);
    return;
  }
  store.get(key, function(ok, value) {
    var result = defaultValue;
    if (ok && value) {
      try{
        result = jsonParse(value);
      } catch (e) {}
    }
    safeCall(null, function() {callback(result);});
  });
}

function getDirtySaveList(callback) {
  restoreObject(initStore(), "dirty_save_list", [], function (slotList) {
    callback(slotList);
  });
}

function remoteSaveMerger(i, callback) {
  var remoteStore = new Persist.Store(window.remoteStoreNames[i]);
  restoreObject(remoteStore, "save_list", [], function (remoteSlotList) {
    fetchSavesFromSlotList(remoteStore, remoteSlotList, 0, [], function(remoteSaveList) {
      mergeRemoteSaves(remoteSaveList, 0/*recordDirty*/, function() {
        i++;
        if (i < window.remoteStoreNames.length) {
          remoteSaveMerger(i, callback);
        } else {
          callback.apply(null, arguments);
        }
      });
    });
  });
}

function getSaves(callback) {
  if (window.remoteStoreNames && window.remoteStoreNames.length) {
    remoteSaveMerger(0, callback);
  } else if (window.remoteStoreName && window.storeName != window.remoteStoreName) {
    var remoteStore = new Persist.Store(window.remoteStoreName);
    restoreObject(remoteStore, "save_list", [], function (remoteSlotList) {
      fetchSavesFromSlotList(remoteStore, remoteSlotList, 0, [], function(remoteSaveList) {
        mergeRemoteSaves(remoteSaveList, 0/*recordDirty*/, callback);
      });
    });
  } else {
    restoreObject(initStore(), "save_list", [], function (localSlotList) {
      fetchSavesFromSlotList(initStore(), localSlotList, 0, [], callback);
    });
  }
}

function fetchSavesFromSlotList(store, slotList, i, saveList, callback) {
  if (i >= slotList.length) {
    return safeCall(null, function() {callback(saveList);});
  }
  restoreObject(store, "state"+slotList[i], null, function(saveState) {
    saveState.timestamp = slotList[i].substring(4/*"save".length*/);
    saveList.push(saveState);
    fetchSavesFromSlotList(store, slotList, i+1, saveList, callback);
  });
}

function isWebSavePossible() {
  if (!initStore()) return false;
  if (/^http/.test(window.location.protocol)) {
    return document.domain == window.webSaveDomain || document.domain == "localhost";
  }
  // if it's a file URL with a valid store, either you're a 3rd party developer
  // who knows what you're doing, or you're a mobile app
  return true;
}


webSaveDomain = "www.choiceofgames.com";
webSaveUrl = "https://" + webSaveDomain + "/ajax_proxy.php/websave";

function submitRemoteSave(slot, email, subscribe, callback) {
  if (!isWebSavePossible()) return safeTimeout(function() { callback(false); });
  window.store.get("state"+slot, function(ok, value) {
    if (ok) {
      var timestamp = slot.substring(4/*"save".length*/);
      var xhr = findXhr();
      var gameName = window.remoteStoreName || window.storeName;
      var params = "email="+email+"&game="+gameName+"&realGame="+window.storeName+"&json="+encodeURIComponent(value)+"&timestamp="+ timestamp+"&subscribe="+subscribe;
      xhr.open("POST", webSaveUrl,true);
      xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
      var done = false;

      xhr.onreadystatechange = function() {
        if (done) return;
        if (xhr.readyState != 4) return;
        done = true;
        var ok = xhr.status == 200;
        if (ok) {
          safeCall(null, function() {callback(true);});
        } else {
          recordDirtySlots([slot], function() {
            safeCall(null, function() {callback(false);});
          });
        }
      };
      xhr.send(params);
    } else {
      recordDirtySlots([slot], function() {
        asyncAlert("There was a problem uploading the saved game. This is probably a bug; please contact support@choiceofgames.com with code 17891.", function() {
          safeCall(null, function() {callback(false);});
        });
      });
    }
  });
}

function submitDirtySaves(dirtySaveList, email, callback) {
  function submitDirtySave(i) {
    if (dirtySaveList[i]) {
      submitRemoteSave(dirtySaveList[i], email, false, function(ok) {
        if (ok) {
          submitDirtySave(i+1);
        } else {
          safeCall(null, function() {callback(false);});
        }
      });
    } else {
      window.store.remove("dirty_save_list", function() {
        safeCall(null, function() {callback(true);});
      });
    }
  }
  submitDirtySave(0);
}

function submitAnyDirtySaves(callback) {
  if (!callback) callback = function(ok) {};
  try {
    getDirtySaveList(function(dirtySaveList) {
      if (dirtySaveList && dirtySaveList.length) {
        try {
          fetchEmail(function(email) {
            if (email) {
              submitDirtySaves(dirtySaveList, email, callback);
            } else {
              callback(false);
            }
          });
        } catch (e) {
          callback(false);
        }
      }
    });
  } catch (e) {
    callback(false);
  }
}

function getRemoteSaves(email, callback) {
  if (!isWebSavePossible()) {
    safeTimeout(function() {callback([]);}, 0);
    return;
  }
  var xhr = findXhr();
  var gameName = window.remoteStoreName || window.storeName;
  xhr.open("GET", webSaveUrl + "?email="+email+"&game="+gameName, true);
  var done = false;
  xhr.onreadystatechange = function() {
    if (done) return;
    if (xhr.readyState != 4) return;
    done = true;
    if (xhr.status != 200) {
      if (window.console) console.log("Couldn't load remote saves. " + xhr.status + ": " + xhr.responseText);
      safeCall(null, function() {callback(null);});
    } else {
      var result = xhr.responseText;
      result = jsonParse(result);
      var remoteSaveList = [];
      for (var i = 0; i < result.length; i++) {
        var save = result[i].json;
        save.timestamp = result[i].timestamp;
        remoteSaveList.push(save);
      }
      safeCall(null, function() {callback(remoteSaveList);});
    }
  };
  xhr.send();
}

function mergeRemoteSaves(remoteSaveList, recordDirty, callback) {
  if (!isWebSavePossible()) {
    safeTimeout(function() { callback([], 0, []); }, 0);
    return;
  }
  restoreObject(initStore(), "save_list", [], function (localSlotList) {
    fetchSavesFromSlotList(initStore(), localSlotList, 0, [], function(localSaveList) {
      var localSlotMap = {};
      for (var i = 0; i < localSlotList.length; i++) {
        localSlotMap[localSlotList[i]] = 1;
      }
      var remoteSlotMap = {};
      for (i = 0; i < remoteSaveList.length; i++) {
        remoteSlotMap["save"+remoteSaveList[i].timestamp] = 1;
      }
      var newRemoteSaves = 0;
      for (i = 0; i < remoteSaveList.length; i++) {
        var remoteSave = remoteSaveList[i];
        var slot = "save"+remoteSave.timestamp;
        if (!localSlotMap[slot]) {
          saveCookie(null, slot, remoteSave.stats, remoteSave.temps, remoteSave.lineNum, remoteSave.indent);
          localSlotList.push(slot);
          localSaveList.push(remoteSave);
          newRemoteSaves++;
        }
      }

      var dirtySaveList = [];
      for (i = 0; i < localSlotList.length; i++) {
        if (!remoteSlotMap[localSlotList[i]]) {
          dirtySaveList.push(localSlotList[i]);
        }
      }

      if (recordDirty) {
        window.store.set("dirty_save_list", toJson(dirtySaveList), finale);
      } else {
        finale();
      }

      function finale() {
        if (newRemoteSaves) {
          window.store.set("save_list", toJson(localSlotList), function() {
            safeCall(null, function() { callback(localSaveList, newRemoteSaves, dirtySaveList); });
          });
        } else {
          safeCall(null, function() {callback(localSaveList, newRemoteSaves, dirtySaveList);});
        }
      }
    });
  });
}

function delayBreakStart(callback) {
  var nowInSeconds = Math.floor(new Date().getTime() / 1000);
  if (!initStore()) {
    safeTimeout(function() {callback(nowInSeconds);}, 0);
    return;
  }
  window.store.get("delayBreakStart", function(ok, value) {
    var valueNum = value*1;
    safeCall(null, function() {
      if (ok && value && !isNaN(valueNum)) {
        callback(valueNum);
      } else {
        window.store.set("delayBreakStart", nowInSeconds);
        callback(nowInSeconds);
      }
    });
  });
}

function delayBreakEnd() {
  if (initStore()) window.store.remove("delayBreakStart");
}

function initStore() {
  if (!window.storeName) return false;
  if (window.store) return window.store;
  try {
    window.store = new Persist.Store(window.storeName);
  } catch (e) {}
  return window.store;
}
function loadAndRestoreGame(slot, forcedScene) {
  function valueLoaded(ok, value) {
    safeCall(null, function() {
      var state = null;
      if (ok && value && ""+value) {
        state = jsonParse(value);
      } else if (window.Persist.type == "androidStorage" && document.cookie) {
        return upgradeAndroidCookies(slot,forcedScene);
      }
      restoreGame(state, forcedScene);
    });
  }
  if (!slot) slot = "";
  if (window.pseudoSave && pseudoSave[""]) return valueLoaded(true, pseudoSave[""]);
  if (!initStore()) return restoreGame(null, forcedScene);
  window.store.get("state"+slot, valueLoaded);
}

// we used to use cookies on some Android devices; now we use androidStorage
function upgradeAndroidCookies(slot, forcedScene) {
  var ck = document.cookie;
  var components = ck.split("; ");
  function upgradeComponent(i) {
    if (!components[i]) {
      loadAndRestoreGame(slot, forcedScene);
      return;
    }
    var parts = components[i].split("=");
    var key = parts[0];
    var deletion = key + "=x; path=/; domain=localhost; expires=Thu, 01-Jan-1970 00:00:01 GMT";
    document.cookie = deletion;
    // key is in the format "storeName:actualKey"
    key = unescape(key).substring(window.storeName.length + 1);
    var value = unescape(parts[1]);
    window.store.set(key, value, function() {
      upgradeComponent(i+1);
    });
  }
  safeCall(this, function() {upgradeComponent(0);});
}

function isStateValid(state) {
  if (!state) return false;
  if (!state.stats) return false;
  if (!state.stats.sceneName) return false;
  return true;
}

function restartGame(shouldPrompt) {
  if (window.tickerRunning) {
    asyncAlert("Please wait until the timer has run out.");
    return;
  }
  function actuallyRestart(result) {
    if (!result) return;
    submitAnyDirtySaves();
    clearCookie(function() {}, 'temp');
    clearCookie(function() {
      window.nav.resetStats(window.stats);
      clearScreen(restoreGame);
    }, "");
  }
  if (shouldPrompt) {
    asyncConfirm("Start over from the beginning?", actuallyRestart);
  } else {
    actuallyRestart(true);
  }
}

function restoreGame(state, forcedScene, userRestored) {
    var scene;
    var secondaryMode = null;
    var saveSlot = "";
    if (forcedScene == "choicescript_stats") {
      secondaryMode = "stats";
      saveSlot = "temp";
    } else if (forcedScene == "choicescript_upgrade") {
      secondaryMode = "upgrade";
      saveSlot = "temp";
    }
    if (!isStateValid(state)) {
        var startupScene = forcedScene ? forcedScene : window.nav.getStartupScene();
        scene = new Scene(startupScene, window.stats, window.nav, {debugMode:window.debug, secondaryMode:secondaryMode, saveSlot:saveSlot});
        safeCall(scene, scene.execute);
    } else {
      if (forcedScene) state.stats.sceneName = forcedScene;
      window.stats = state.stats;
      // Someday, inflate the navigator using the state object
      scene = new Scene(state.stats.sceneName, state.stats, window.nav, {debugMode:state.debug || window.debug, secondaryMode:secondaryMode, saveSlot:saveSlot});
      if (!forcedScene) {
        scene.temps = state.temps;
        scene.lineNum = state.lineNum;
        scene.indent = state.indent;
      }
      if (userRestored) {
        scene.temps.choice_user_restored = true;
      }
      safeCall(scene, scene.execute);
    }
}

function redirectScene(sceneName, label, originLine) {
  var scene = new Scene(sceneName, window.stats, window.nav, {debugMode:window.debug});
  if (label) scene.targetLabel = {label:label, origin:"choicescript_stats", originLine:originLine};
  clearScreen(function() {scene.execute();});
}

function loadTempStats(defaultValue, callback) {
  function valueLoaded(ok, value) {
    var state = {};
    if (ok && value && String(value)) {
      try {
        state = jsonParse(value);
      } catch (e) {}
    }
    if (state && state.stats) {
      callback(state.stats);
    } else {
      callback(defaultValue);
    }
  }
  if (!initStore()) {
    if (window.pseudoSave && window.pseudoSave["temp"]) {
      return safeTimeout(function() {
        valueLoaded("ok", pseudoSave["temp"]);
      }, 0);
    } else {
      return safeTimeout(function() {callback(defaultValue);}, 0);
    }
  } else {
    window.store.get("statetemp", valueLoaded);
  }
}

function clearTemp(callback) {
  if (!initStore()) {
    if (window.pseudoSave) {
      delete window.pseudoSave.temp;
    }
    return safeTimeout(callback, 0);
  }
  window.store.remove("statetemp", callback);
}

function getCookieByName(cookieName, ck) {
    if (!ck) ck = window.document.cookie;
    if (!ck) return null;
    var ckPairs = ck.split(/;/);
    for (var i = 0; i < ckPairs.length; i++) {
        var ckPair = trim(ckPairs[i]);
        var ckNameValue = ckPair.split(/=/);
        var ckName = decodeURIComponent(ckNameValue[0]);
        if (ckName === cookieName) {
            return decodeURIComponent(ckNameValue[1]);
        }
    }
    return null;
}

function parseQueryString(str) {
  if (!str) return null;
  var map = {};
  var pairs = String(str).substring(1).split("&");
  var i = pairs.length;
  while (i--) {
    var pair = pairs[i];
    var parts = pair.split("=");
    map[parts[0]] = parts[1];
  }
  return map;
}
function trim(str) {
    if (str === null || str === undefined) return null;
    var result = str.replace(/^\s+/g, "");
    // strip leading
    return result.replace(/\s+$/g, "");
    // strip trailing
}


function findOptimalDomain(docDomain) {
    if (!docDomain) docDomain = document.domain;
    // localhost and 127.0.0.1 will cause cookie not to be set; just omit them, it works fine
    if (docDomain == "localhost" || docDomain == "127.0.0.1") return null;
    // ip address
    if (/^\d+\.\d+\.\d+\.\d+$/.test(docDomain)) return null;
    // dotcom
    var result = docDomain.match(/(\w+\.\w{3}$)/);
    if (result) return result[1];
    return null;
}

function num(x, line) {
    if (!line) line = "UNKNOWN";
    var x_num = x * 1;
    if (isNaN(x_num)) throw new Error("line "+line+": Not a number: " + x);
    return x_num;
}

function bool(x, line) {
  if (!line) line = "UNKNOWN";
  if ("boolean" == typeof x) {
    return x;
  } else if ("true" === x) {
    return true;
  } else if ("false" === x) {
    return false;
  }
  throw new Error("line "+line+": Neither true nor false: " + x);
}

function findXhr() {
  var ieFile = isIE && isFile;
  if (window.XMLHttpRequest && !ieFile) return new window.XMLHttpRequest();
  var ids = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];
  for (var i = 0; i < 3; i++) {
    try {
      return new ActiveXObject(ids[i]);
    } catch (e) {}
  }
  throw new Error("Couldn't create XHR object");
}

    crcTable = "00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";

    /* Number */
    function crc32( /* String */ str, /* Number */ crc ) {
        if( !crc ) crc = 0;
        var n = 0; //a number between 0 and 255 
        var x = 0; //an hex number 

        crc = crc ^ (-1);
        for( var i = 0, iTop = str.length; i < iTop; i++ ) {
            n = ( crc ^ str.charCodeAt( i ) ) & 0xFF;
            x = "0x" + crcTable.substr( n * 9, 8 );
            crc = ( crc >>> 8 ) ^ x;
        }
        return crc ^ (-1);
    }

function simpleDateTimeFormat(date) {
  var day = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][date.getDay()];
  var month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][date.getMonth()];
  var minutes = date.getMinutes();
  if (minutes < 10) minutes = "0" + (""+minutes);
  return day + " " + month + " " + date.getDate() + " " + date.getHours() + ":" + minutes;
}

function jsonParse(str) {
  if (typeof JSON != "undefined") {
    try {
      return JSON.parse(str);
    } catch (e) {
      // try to handle unquoted keys
      try {
        return eval('('+str+')');
      } catch (e2) {
        // that might have failed because eval is forbidden
        try {
          eval("1");
        } catch (e3) {
          // eval forbidden; let's try a hack to fix unquoted keys
          var str2 = (str+"").replace(/([,\{])\s*(\w+)\s*\:/g, '$1"$2":');
          try {
            return JSON.parse(str2);
          } catch (e4) {}
        }
        // at this point, just report a clear error
        return JSON.parse(str);
      }
    }
  } else {
    return eval('('+str+')');
  }
}

function cefQuerySimple(method) {
  cefQuery({
    request:method,
    onSuccess: function(response) {console.log(method + " success");},
    onFailure: function(error_code, error_message) {console.error(method + " error: " + error_message);}
  });
}
</script><script>/* * Copyright 2010 by Dan Fabulich.
 *
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 *
 * See the License for the specific language governing
 * permissions and limitations under the License.
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */


function printx(msg, parent) {
    if (msg === null || msg === undefined || msg === "") return;
    if (!parent) parent = document.getElementById('text');
    if (msg == " ") {
      // IE7 doesn't like innerHTML that's nothing but " "
      parent.appendChild(document.createTextNode(" "));
      return;
    }
    msg = (msg+"").replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/\[tm\]/g, '&reg;')
      .replace(/\[n\/\]/g, '<br>')
      .replace(/\[b\]/g, '<b>')
      .replace(/\[\/b\]/g, '</b>')
      .replace(/\[i\]/g, '<i>')
      .replace(/\[\/i\]/g, '</i>')
      .replace(/\[center\]/g, '<center>')
      .replace(/\[\/center\]/g, '</center>')
      .replace(/\[censored\]/g, '<span class="censored">')
      .replace(/\[\/censored\]/g, '</span>')
      .replace(/\[boldred\]/g, '<span style="color:red; font-weight:bold">')
      .replace(/\[\/boldred\]/g, '</span>')
      .replace(/\[boldblue\]/g, '<span style="color:blue; font-weight:bold">')
      .replace(/\[\/boldblue\]/g, '</span>');
    var frag = document.createDocumentFragment();
    temp = document.createElement('div');
    temp.innerHTML = msg;
    while (temp.firstChild) {
        frag.appendChild(temp.firstChild);
    }
    parent.appendChild(frag);
}

function println(msg, parent) {
    if (!parent) parent = document.getElementById('text');
    printx(msg, parent);
    var br = window.document.createElement("br");
    parent.appendChild(br);
}


function showStats() {
    if (document.getElementById('loading')) return;
    setButtonTitles();
    if (window.stats.scene.secondaryMode == "stats") {
      clearScreen(loadAndRestoreGame);
      return;
    }
    var currentScene = window.stats.scene;
    var scene = new Scene("choicescript_stats", window.stats, this.nav, {secondaryMode:"stats", saveSlot:"temp"});
    main.innerHTML = "<div id='text'></div>";
    scene.execute();
}

function redirectFromStats(scene, label, originLine, callback) {
  if (window.isIosApp) {
    if (!label) label = "";
    callIos("redirectfromstats", scene + " " +label  + " " + originLine);
  } else if (window.isAndroidApp) {
    statsMode.redirectFromStats(scene, label || "", originLine);
  } else {
    safeTimeout(callback, 0);
  }
}

function showAchievements(hideNextButton) {
  if (document.getElementById('loading')) return;
  var button = document.getElementById("achievementsButton");
  if (!button) return;
  if (button.innerHTML == "Return to the Game") {
    setButtonTitles();
    return clearScreen(loadAndRestoreGame);
  }
  setButtonTitles();
  button.innerHTML = "Return to the Game";
  clearScreen(function() {
    checkAchievements(function() {
      printAchievements(document.getElementById("text"));
      if (!hideNextButton) printButton("Next", main, false, function() {
        setButtonTitles();
        clearScreen(loadAndRestoreGame);
      });
    });
  });
}

function showMenu() {
  if (document.getElementById('loading')) return;
  var button = document.getElementById("menuButton");
  if (!button) return;
  if (button.innerHTML == "Return to the Game") {
    button.innerHTML = "Menu";
    return clearScreen(loadAndRestoreGame);
  }
  setButtonTitles();
  button.innerHTML = "Return to the Game";
  function menu() {
    options = [
      {name:"Return to the game.", group:"choice", resume:true},
      {name:"View the credits.", group:"choice", credits:true},
      {name:"Play more games like this.", group:"choice", moreGames:true},
      {name:"Email us at " + getSupportEmail() + ".", group:"choice", contactUs:true},
      {name:"Share this game with friends.", group:"choice", share:true},
      {name:"Email me when new games are available.", group:"choice", subscribe:true},
    ];
    printOptions([""], options, function(option) {
      if (option.resume) {
        setButtonTitles();
        return clearScreen(loadAndRestoreGame);
      } else if (option.credits) {
        absolutizeAboutLink();
        aboutClick();
      } else if (option.moreGames) {
        moreGames();
        curl();
      } else if (option.share) {
        clearScreen(function() {
          printShareLinks(document.getElementById("text"), "now");
          menu();
        });
      } else if (option.subscribe) {
        setButtonTitles();
        subscribeLink();
      } else if (option.contactUs) {
        window.location.href="mailto:"+getSupportEmail();
      }
    });
  }
  clearScreen(menu);
}

function setButtonTitles() {
  var button;
  button = document.getElementById("menuButton");
  if (button) {
    button.innerHTML = "Menu";
  }
  button = document.getElementById("statsButton");
  if (button) {
    button.innerHTML = "Show Stats";
  }
  button = document.getElementById("achievementsButton");
  if (button) {
    if (nav.achievementList.length) {
      button.style.display = "";
      button.innerHTML = "Achievements";
    } else {
      button.style.display = "none";
    }
  }

}


function spell(num) {
  if (num > 99) return num;
  var smallNumbers = ["zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen"];
  var tens = ["zero", "ten", "twenty", "thirty", "forty", "fifty", "sixty", "seventy", "eighty", "ninety"];
  if (num < 20) {
    return smallNumbers[num];
  }
  var onesDigit = num % 10;
  if (onesDigit === 0) {
    return tens[num / 10];
  }
  var tensDigit = (num - onesDigit) / 10;
  return tens[tensDigit]+"-"+smallNumbers[onesDigit];
}

function printAchievements(target) {
  var unlockedBuffer = [];
  var lockedBuffer = [];
  var achievedCount = 0, hiddenCount = 0, score = 0, totalScore = 0;
  var totalAchievements = nav.achievementList.length;
  var buffer;
  for (var i = 0; i < totalAchievements; i++) {
    var name = nav.achievementList[i];
    var achievement = nav.achievements[name];
    var points = achievement.points;
    totalScore += points;

    var description;

    if (nav.achieved[name]) {
      achievedCount++;
      score += points;
      buffer = unlockedBuffer;
      description = achievement.earnedDescription;
    } else {
      if (achievement.visible) {
        buffer = lockedBuffer;
        description = achievement.preEarnedDescription;
      } else {
        hiddenCount++;
        continue;
      }
    }

    if (buffer.length) buffer.push("<br>");
    buffer.push("<b>");
    buffer.push(achievement.title.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;'));
    buffer.push(":");
    buffer.push("</b> ");
    buffer.push(description.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;')
      .replace(/\[b\]/g, '<b>')
      .replace(/\[\/b\]/g, '</b>')
      .replace(/\[i\]/g, '<i>')
      .replace(/\[\/i\]/g, '</i>')
    );
    buffer.push(" (");
    buffer.push(points);
    buffer.push(" points)");
  }

  // What if there's exactly one achievement worth exactly one point?
  if (achievedCount === 0) {
    if (hiddenCount === 0) {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" possible achievements, worth a total of "+totalScore+" points.<p>"];
    } else if (hiddenCount == 1) {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" possible achievements (including one hidden achievement), worth a total of "+totalScore+" points.<p>"];
    } else if (hiddenCount == totalAchievements) {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" hidden achievements, worth a total of "+totalScore+" points.<p>"];
    } else {
      buffer = ["You haven't unlocked any achievements yet. There are "+spell(totalAchievements)+" possible achievements (including "+spell(hiddenCount)+" hidden achievements), worth a total of "+totalScore+" points.<p>"];
    }
    if (lockedBuffer.length) {
      buffer.push.apply(buffer, lockedBuffer);
      buffer.push("<p>");
    }
  } else if (score == totalScore) {
    if (totalAchievements == 2) {
      buffer = ["Congratulations! You have unlocked both achievements, earning a total of "+score+" points, a perfect score.<p>"];
    } else {
      buffer = ["Congratulations! You have unlocked all "+spell(totalAchievements)+" achievements, earning a total of "+score+" points, a perfect score.<p>"];
    }
    buffer.push.apply(buffer, unlockedBuffer);
    buffer.push("<p>");
  } else {
    buffer = ["You have unlocked "+spell(achievedCount)+" out of "+spell(totalAchievements)+" possible achievements, earning you a score of "+score+" out of a possible "+totalScore+" points.<p>"];
    buffer.push.apply(buffer, unlockedBuffer);
    var remaining = totalAchievements-achievedCount;
    if (remaining == hiddenCount) {
      if (remaining == 1) {
        buffer.push("<p>There is still one hidden achievement remaining.<p>");
      } else {
        buffer.push("<p>There are still " + spell(remaining) + " hidden achievements remaining.<p>");
      }
    } else if (hiddenCount > 1) {
      buffer.push("<p>There are still "+spell(remaining)+" achievements remaining, including "+spell(hiddenCount)+" hidden achievements.<p>");
    } else if (hiddenCount == 1) {
      buffer.push("<p>There are still "+spell(remaining)+" achievements remaining, including one hidden achievement.<p>");
    } else if (remaining == 1) {
      buffer.push("<p>There is still one achievement remaining.<p>");
    } else {
      buffer.push("<p>There are still "+spell(remaining)+" achievements remaining.<p>");
    }
    if (lockedBuffer.length) {
      buffer.push.apply(buffer, lockedBuffer);
      buffer.push("<p>");
    }
  }

  target.innerHTML = buffer.join("");
}

function callIos(scheme, path) {
  if (!window.isIosApp) return;
  if (path) {
    path = encodeURIComponent(path);
  } else {
    path = "";
  }
  setTimeout(function() {
    var iframe = document.createElement("IFRAME");
    iframe.setAttribute("src", scheme + "://" + path);
    iframe.setAttribute("style", "display:none");
    document.documentElement.appendChild(iframe);
    iframe.parentNode.removeChild(iframe);
    iframe = null;
  }, 0);
}

// in the iOS app, display a page curl animation
function curl() {
  // TODO force a reflow before curling the page
  callIos("curl");
}

function asyncAlert(message, callback) {
  if (!callback) callback = function(){};
  if (window.isIosApp) {
    window.alertCallback = callback;
    callIos("alert", message);
  } else if (window.isAndroidApp) {
    setTimeout(function() {
      alert(message);
      if (callback) callback();
    }, 0);
  } else if (window.isWinOldApp) {
    setTimeout(function() {
      window.external.Alert(message);
      if (callback) callback();
    }, 0);
  } else {
    alertify.alert(message, function() {safeCall(null, callback);});
  }
}

function asyncConfirm(message, callback) {
  if (false/*window.isIosApp*/) {
    // TODO asyncConfirm
    window.confirmCallback = callback;
    callIos("confirm", message);
  } else if (window.isAndroidApp) {
    setTimeout(function() {
      var result = confirm(message);
      if (callback) callback(result);
    }, 0);
  } else if (window.isWinOldApp) {
    setTimeout(function() {
      var result = window.external.Confirm(message);
      if (callback) callback(result);
    }, 0);
  } else {
    alertify.confirm(message, function(result) {safeCall(null, callback(result));});
  }
}


function clearScreen(code) {
    // can't create div via innerHTML; div mysteriously doesn't show up on iOS
    main.innerHTML = "";
    var text = document.createElement("div");
    text.setAttribute("id", "text");
    main.appendChild(text);



    var useAjax = true;
    if (isWeb && window.noAjax) {
      useAjax = false;
    }

    if (useAjax) {
      doneLoading();
      setTimeout(function() {
        if (window.isChromeApp) {
          document.body.firstElementChild.scrollIntoView();
        } else {
          window.scrollTo(0,0);
          if (window.isIosApp || (window.isSafari && window.isMobile && !window.isAndroid)) {
            // focus on text for iOS Voiceover
            main.setAttribute("tabindex", "-1");
            main.focus();
          }
        }
      }, 0);
      safeCall(null, code);
    } else {
      if (!initStore()) alert("Your browser has disabled cookies; this game requires cookies to work properly.  Please re-enable cookies and refresh this page to continue.");
      startLoading();
      var form = window.document.createElement("form");
      var axn = window.location.protocol + "//" + window.location.host + window.location.pathname;
      form.setAttribute("action", axn);
      form.setAttribute("method", "POST");
      main.appendChild(form);
      form.submit();
    }
}

function safeSubmit(code) {
    return function safelySubmitted() {
        safeCall(code);
        return false;
    };
}

function startLoading() {
    var loading = document.getElementById('loading');
    if (!loading) {
      safeCall(null, function() {
        loading = document.createElement('div');
        loading.setAttribute("id", "loading");
        loading.innerHTML = "<p>Loading...</p><p>"+
          (/MSIE [67]/.test(navigator.userAgent)?"":"<img src=\"data:image/gif;base64,R0lGODlhgAAPAPEAAPf08WJhYMvJx2JhYCH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAgAAPAAACo5QvoIC33NKKUtF3Z8RbN/55CEiNonMaJGp1bfiaMQvBtXzTpZuradUDZmY+opA3DK6KwaQTCbU9pVHc1LrDUrfarq765Ya9u+VRzLyO12lwG10yy39zY11Jz9t/6jf5/HfXB8hGWKaHt6eYyDgo6BaH6CgJ+QhnmWWoiVnI6ddJmbkZGkgKujhplNpYafr5OooqGst66Uq7OpjbKmvbW/p7UAAAIfkECQoAAAAsAAAAAIAADwAAArCcP6Ag7bLYa3HSZSG2le/Zgd8TkqODHKWzXkrWaq83i7V5s6cr2f2TMsSGO9lPl+PBisSkcekMJphUZ/OopGGfWug2Jr16x92yj3w247bh6teNXseRbyvc0rbr6/x5Ng0op4YSJDb4JxhI58eliEiYYujYmFi5eEh5OZnXhylp+RiaKQpWeDf5qQk6yprawMno2nq6KlsaSauqS5rLu8cI69k7+ytcvGl6XDtsyzxcAAAh+QQJCgAAACwAAAAAgAAPAAACvpw/oIC3IKIUb8pq6cpacWyBk3htGRk1xqMmZviOcemdc4R2kF3DvfyTtFiqnPGm+yCPQdzy2RQMF9Moc+fDArU0rtMK9SYzVUYxrASrxdc0G00+K8ruOu+9tmf1W06ZfsfXJfiFZ0g4ZvEndxjouPfYFzk4mcIICJkpqUnJWYiYs9jQVpm4edqJ+lkqikDqaZoquwr7OtHqAFerqxpL2xt6yQjKO+t7bGuMu1L8a5zsHI2MtOySVwo9fb0bVQAAIfkECQoAAAAsAAAAAIAADwAAAsucP6CAt9zSErSKZyvOd/KdgZaoeaFpRZKiPi1aKlwnfzBF4jcNzDk/e7EiLuLuhzwqayfmaNnjCCGNYhXqw9qcsWjT++TqxIKp2UhOprXf7PoNrpyvQ3p8fAdu82o+O5w3h2A1+Nfl5geHuLgXhEZVWBeZSMnY1oh5qZnyKOhgiGcJKHqYOSrVmWpHGmpauvl6CkvhaUD4qejaOqvH2+doV7tSqdsrexybvMsZrDrJaqwcvSz9i9qM/Vxs7Qs6/S18a+vNjUx9/v1TAAAh+QQJCgAAACwAAAAAgAAPAAAC0Zw/oIC33NKKUomLxct4c718oPV5nJmhGPWwU9TCYTmfdXp3+aXy+wgQuRRDSCN2/PWAoqVTCSVxilQZ0RqkSXFbXdf3ZWqztnA1eUUbEc9wm8yFe+VguniKPbNf6mbU/ubn9ieUZ6hWJAhIOKbo2Pih58C3l1a5OJiJuflYZidpgHSZCOnZGXc6l3oBWrE2aQnLWYpKq2pbV4h4OIq1eldrigt8i7d73Ns3HLjMKGycHC1L+hxsXXydO9wqOu3brPnLXL3C640sK+6cTaxNflEAACH5BAkKAAAALAAAAACAAA8AAALVnD+ggLfc0opS0SeyFnjn7oGbqJHf4mXXFD2r1bKNyaEpjduhPvLaC5nJEK4YTKhI1ZI334m5g/akJacAiDUGiUOHNUd9ApTgcTN81WaRW++Riy6Tv/S4dQ1vG4ps4NwOaBYlOEVYhYbnplexyJf3ZygGOXkWuWSZuNel+aboV0k5GFo4+qN22of6CMoq2kr6apo6m5fJWCoZm+vKu2Hr6KmqiHtJLKebRhuszNlYZ3ncewh9J9z8u3mLHA0rvetrzYjd2Wz8bB6oNO5MLq6FTp2+bVUAACH5BAkKAAAALAAAAACAAA8AAALanD+ggLfc0opS0XeX2Fy8zn2gp40ieHaZFWHt9LKNO5eo3aUhvisj6RutIDUZgnaEFYnJ4M2Z4210UykQ8BtqY0yHstk1UK+/sdk63i7VYLYX2sOa0HR41S5wi7/vcMWP1FdWJ/dUGIWXxqX3xxi4l0g4GEl5yOHIBwmY2cg1aXkHSjZXmbV4uoba5kkqelbaapo6u0rbN/SZG7trKFv7e6savKTby4voaoVpNAysiXscV4w8fSn8fN1pq1kd2j1qDLK8yYy9/ff9mgwrnv2o7QwvGO1ND049UgAAIfkECQoAAAAsAAAAAIAADwAAAticP6CAt9zSilLRd2d8onvBfV0okp/pZdamNRi7ui3yyoo4Ljio42h+w6kgNiJt5kAaasdYE7D78YKlXpX6GWphxqTT210qK1Cf9XT2SKXbYvv5Bg+jaWD5ekdjU9y4+PsXRuZHRrdnZ5inVidAyCTXF+nGlVhpdjil2OE49hjICVh4qZlpibcDKug5KAlHOWqqR8rWCjl564oLFruIucaYGlz7+XoKe2wsIqxLzMxaxIuILIs6/JyLbZsdGF063Uu6vH2tXc79LZ1MLWS96t4JH/rryzhPWgAAIfkECQoAAAAsAAAAAIAADwAAAtWcP6CAt9zSilLRd2fEe4kPCk8IjqTonZnVsQ33arGLwLV8Kyeqnyb5C60gM2LO6MAlaUukwdbcBUspYFXYcla00KfSywRzv1vpldqzprHFoTv7bsOz5jUaUMer5vL+Mf7Hd5RH6HP2AdiUKLa41Tj1Acmjp0bJFuinKKiZyUhnaBd5OLnzSNbluOnZWQZqeVdIYhqWyop6ezoquTs6O0aLC5wrHErqGnvJibms3LzKLIYMe7xnO/yL7TskLVosqa1aCy3u3FrJbSwbHpy9fr1NfR4fUgAAIfkECQoAAAAsAAAAAIAADwAAAsqcP6CAt9zSilLRd2fEW7cnhKIAjmFpZla3fh7CuS38OrUR04p5Ljzp46kgMqLOaJslkbhbhfkc/lAjqmiIZUFzy2zRe5wGTdYQuKs9N5XrrZPbFu94ZYE6ms5/9cd7/T824vdGyIa3h9inJQfA+DNoCHeomIhWGUcXKFIH6RZZ6Bna6Zg5l8JnSamayto2WtoI+4jqSjvZelt7+URKpmlmKykM2vnqa1r1axdMzPz5LLooO326Owxd7Bzam4x8pZ1t3Szu3VMOdF4AACH5BAkKAAAALAAAAACAAA8AAAK/nD+ggLfc0opS0XdnxFs3/i3CSApPSWZWt4YtAsKe/DqzXRsxDqDj6VNBXENakSdMso66WzNX6fmAKCXRasQil9onM+oziYLc8tWcRW/PbGOYWupG5Tsv3TlXe9/jqj7ftpYWaPdXBzbVF2eId+jYCAn1KKlIApfCSKn5NckZ6bnJpxB2t1kKinoqJCrlRwg4GCs4W/jayUqamaqryruES2b72StsqgvsKlurDEvbvOx8mzgazNxJbD18PN1aUgAAIfkECQoAAAAsAAAAAIAADwAAArKcP6CAt9zSilLRd2fEWzf+ecgjlKaQWZ0asqPowAb4urE9yxXUAqeZ4tWEN2IOtwsqV8YkM/grLXvTYbV4PTZpWGYU9QxTxVZyd4wu975ZZ/qsjsPn2jYpatdx62b+2y8HWMTW5xZoSIcouKjYePeTh7TnqFcpabmFSfhHeemZ+RkJOrp5OHmKKapa+Hiyyokaypo6q1CaGDv6akoLu3DLmLuL28v7CdypW6vsK9vsE1UAACH5BAkKAAAALAAAAACAAA8AAAKjnD+ggLfc0opS0XdnxFs3/nkISI2icxokanVt+JoxC8G1fNOlm6tp1QNmZj6ikDcMrorBpBMJtT2lUdzUusNSt9qurvrlhr275VHMvI7XaXAbXTLLf3NjXUnP23/qN/n8d9cHyEZYpoe3p5jIOCjoFofoKAn5CGeZZaiJWcjp10mZuRkaSAq6OGmU2lhp+vk6iioay3rpSrs6mNsqa9tb+ntQAAA7AAAAAAAAAAAA\">")+
          "</p>";
        main.appendChild(loading);
      });
    }
}

function doneLoading() {
    var loading = document.getElementById('loading');
    if (loading) loading.parentNode.removeChild(loading);
    // TODO update header?
}

function setClass(element, classString) {
  element.setAttribute("class", classString);
  element.setAttribute("className", classString);
}

function printFooter() {
  // var footer = document.getElementById('footer');
  // We could put anything we want in the footer here, but perhaps we should avoid it.
  var statsButton = document.getElementById("statsButton");
  if (statsButton) {
    if (window.stats.scene.secondaryMode == "stats") {
      statsButton.innerHTML = "Return to the Game";
    } else {
      statsButton.innerHTML = "Show Stats";
      if (window.isAndroidApp && window.statsMode.get()) {
        showStats();
      }
    }
  }
  curl();
}

// retrieve value of HTML form
function getFormValue(name) {
    var field = document.forms[0][name];
    if (!field) return "";
    // may return either one field or an array of fields
    if (field.checked) return field.value;
    for (var i = 0; i < field.length; i++) {
        var element = field[i];
        if (element.checked) return element.value;
    }
    return null;
}

function printOptions(groups, options, callback) {
  var form = document.createElement("form");
  main.appendChild(form);
  var self = this;
  form.action="#";
  form.onsubmit = function() {
      safeCall(self, function() {
        var currentOptions = options;
        var option, group;
        for (var i = 0; i < groups.length; i++) {
            if (i > 0) {
                currentOptions = option.suboptions;
            }
            group = groups[i];
            if (!group) group = "choice";
            var value = getFormValue(group);
            if (value === null || value === undefined) {
              if (groups.length == 1) {
                asyncAlert("Please choose one of the available options first.");
              } else {
                var article = "a";
                if (/^[aeiou].*/i.test(group)) article = "an";
                asyncAlert("Please choose " + article + " " + group + " first.");
              }
              return;
            }
            option = currentOptions[value];
        }

        if (groups.length > 1 && option.unselectable) {
          asyncAlert("Sorry, that combination of choices is not allowed. Please select a different " + groups[groups.length-1] + ".");
          return;
        }
        safeCall(null, function() {callback(option);});
      });
      return false;
  };

  if (!options) throw new Error(this.lineMsg()+"undefined options");
  if (!options.length) throw new Error(this.lineMsg()+"no options");
  // global num will be used to assign accessKeys to the options
  var globalNum = 1;
  var currentOptions = options;
  var div = document.createElement("div");
  form.appendChild(div);
  setClass(div, "choice");
  for (var groupNum = 0; groupNum < groups.length; groupNum++) {
      var group = groups[groupNum];
      if (group) {
          var textBuilder = ["Select "];
          textBuilder.push(/^[aeiou]/i.test(group)?"an ":"a ");
          textBuilder.push(group);
          textBuilder.push(":");

          var p = document.createElement("p");
          p.appendChild(document.createTextNode(textBuilder.join("")));
          div.appendChild(p);
      }
      var checked = null;
      for (var optionNum = 0; optionNum < currentOptions.length; optionNum++) {
          var option = currentOptions[optionNum];
          if (!checked && !option.unselectable) checked = option;
          var isLast = (optionNum == currentOptions.length - 1);
          printOptionRadioButton(div, group, option, optionNum, globalNum++, isLast, checked == option);
      }
      // for rendering, the first options' suboptions should be as good as any other
      currentOptions = currentOptions[0].suboptions;
  }

  form.appendChild(document.createElement("br"));

  var useRealForm = false;
  if (useRealForm) {
    printButton("Next", form, false);
  } else {
    printButton("Next", main, false, function() {
      form.onsubmit();
    });
  }
}

function printOptionRadioButton(div, name, option, localChoiceNumber, globalChoiceNumber, isLast, checked) {
    var line = option.name;
    var unselectable = false;
    if (!name) unselectable = option.unselectable;
    var disabledString = unselectable ? " disabled" : "";
    var id = name + localChoiceNumber;
    if (!name) name = "choice";
    var radio;
    var div2 = document.createElement("div");
    var label = document.createElement("label");
    // IE doesn't allow you to dynamically specify the name of radio buttons
    if (!/^\w+$/.test(name)) throw new Error("invalid choice group name: " + name);
    label.innerHTML = "<input type='radio' name='"+name+
            "' value='"+localChoiceNumber+"' id='"+id+
            "' "+(checked?"checked":"")+disabledString+">";

    label.setAttribute("for", id);
    if (localChoiceNumber === 0) {
      if (isLast) {
        setClass(label, "onlyChild"+disabledString);
      } else {
        setClass(label, "firstChild"+disabledString);
      }
    } else if (isLast) {
      setClass(label, "lastChild"+disabledString);
    } else if (unselectable) {
      setClass(label, "disabled");
    }
    label.setAttribute("accesskey", globalChoiceNumber);
    if (!unselectable) {
      if (window.Touch) { // Make labels clickable on iPhone
          label.onclick = function labelClick(evt) {
              try {
                var target = evt.target;
                if (!/label/i.test(target.tagName)) return;
                var button = document.getElementById(target.getAttribute("for"));
                button.checked = true;
              } catch (e) {}
          };
      } else if (/MSIE 6/.test(navigator.userAgent)) {
        label.onclick = function labelClick() {
          try {
            var target = window.event.srcElement;
            if (!/label/i.test(target.tagName)) return;
            var button = document.getElementById(target.getAttribute("for"));
            button.checked = true;
          } catch (e) {}
        };
      }
    }
    printx(line, label);
    
    div2.appendChild(label);
    div.appendChild(div2);
}

function printImage(source, alignment) {
  var img = document.createElement("img");
  img.src = source;
  setClass(img, "align"+alignment);
  document.getElementById("text").appendChild(img);
}

function playSound(source) {
  for (var existingAudios = document.getElementsByTagName("audio"); existingAudios.length;) {
    existingAudios[0].parentNode.removeChild(existingAudios[0]);
  }
  var audio = document.createElement("audio");
  if (audio.play) {
    audio.setAttribute("src", source);
    document.body.appendChild(audio);
    audio.play();
  }
}

function moreGames() {
    if (window.isIosApp) {
      window.location.href = "itms-apps://itunes.com/apps/choiceofgames";
    } else if (window.isAndroidApp) {
      if (window.isNookAndroidApp) {
        asyncAlert("Please search the Nook App Store for \"Choice of Games\" for more games like this!");
        return;
      }
      if (window.isAmazonAndroidApp) {
        var androidLink = document.getElementById('androidLink');
        if (androidLink && androidLink.href) {
          androidUrl = androidLink.href;
          var package = /id=([\.\w]+)/.exec(androidUrl)[1];
          window.location.href = "http://www.amazon.com/gp/mas/dl/android?p="+package+"&showAll=1&t=choofgam-20&ref=moreGames";
        } else {
          window.location.href = "http://www.amazon.com/gp/mas/dl/android?p=com.choiceofgames.dragon&showAll=1&t=choofgam-20&ref=moreGames";
        }
      } else {
        window.location.href = "market://search?q=pub:%22Choice+of+Games+LLC";
      }
    } else if (window.isSteamApp) {
      window.location.href = "https://www.choiceofgames.com/steam-curation.php";
    } else {
      try {
        if (window.isChromeApp) {
          window.open("https://www.choiceofgames.com/category/our-games/");
        } else {
          window.location.href = "https://www.choiceofgames.com/category/our-games/";
        }
      } catch (e) {
        // in xulrunner, this will be blocked, but it will trigger opening the external browser
      }
    }
}

function printShareLinks(target, now) {
  if (!target) target = document.getElementById('text');
  var msgDiv = document.createElement("div");
  if (window.isIosApp) {
    if (now) {
      callIos("share");
      return;
    }
    var button = document.createElement("button");
    button.appendChild(document.createTextNode("Share This Game"));
    button.onclick = function() {
      callIos("share");
    };
    msgDiv.appendChild(button);
    msgDiv.appendChild(document.createElement("br")); // insert our own paragraph break, to match <ul>
    msgDiv.appendChild(document.createElement("br"));
    target.appendChild(msgDiv);
    return;
  }

  var mobileMesg = "";
  if (window.isAndroidApp) {
    var androidLink = document.getElementById('androidLink');
    var androidUrl;
    if (window.isNookAndroidApp) {
      if (window.nookEan && nookEan != "UNKNOWN") {
        mobileMesg = "  <li><a href='choiceofgamesnook://"+window.nookEan+"'>Rate this app</a> in the Nook App Store</li>\n";
      }
    } else if (androidLink) {
      androidUrl = androidLink.href;
      if (androidUrl) {
        if (window.isAmazonAndroidApp) {
          var package = /id=([\.\w]+)/.exec(androidUrl)[1];
          androidUrl = "http://www.amazon.com/gp/mas/dl/android?p="+package+"&t=choofgam-20&ref=rate";
          mobileMesg = "  <li><a href='"+androidUrl+"'>Rate this app</a> in the Amazon Appstore</li>\n";
        } else {
          mobileMesg = "  <li><a href='"+androidUrl+"'>Rate this app</a> in the Google Play Store</li>\n";
        }

      }
    }
  } else if (/webOS/.test(navigator.userAgent) && window.isFile) {
    var palmLink = document.getElementById('palmLink');
    var palmUrl;
    if (palmLink) {
      palmUrl = palmLink.href;
      if (palmUrl) {
        mobileMesg = "  <li><a href='"+palmUrl+"'>Rate this app</a> in the Palm App Catalog</li>\n";
      }
    }
  } else if (window.isChromeApp) {
    var chromeLink = document.getElementById('chromeLink');
    var chromeUrl;
    if (chromeLink) {
      chromeUrl = chromeLink.href;
      if (chromeUrl) {
        mobileMesg = "  <li><a href='"+chromeUrl+"/reviews'>Rate this app</a> in the Chrome Web Store</li>\n";
      }
    }
  }

  var url = window.location.href;
  var links = document.getElementsByTagName("link");
  for (var i = links.length - 1; i >= 0; i--) {
    if (links[i].getAttribute("rel") == "canonical") {
      url = links[i].getAttribute("href") || url;
      break;
    }
  }

  if (/^\//.test(url)) {
    if (window.isWeb) {
      url = window.location.protocol + "//" + window.location.hostname + url;
    } else {
      url = "https://www.choiceofgames.com" + url;
    }
  }

  url = encodeURIComponent(url);
  var title = encodeURIComponent(document.title);
  var dataUriSupported = !/MSIE [67]/.test(navigator.userAgent);

  var shareLinkText = '<li>'+(dataUriSupported?'<img height="16" width="16" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAACNFBMVEUAAAD///8ASZIASpIKTI0KSIcWSX5lgZ1YcIhYbYIAUpsHTpAhVIEAWaUAWaIAVp4AU5wAVJsAVJgAUpYAUpUBWaQWU4cAYqoAXqUAW6MAXKMAWqIAXKAFXZ8IWZZihZ8AbrgAbrcAaK0AZaoDbLIFZakGZqoKbrMAb7gAbrYBc7tsm7mizecge62izuiizeYBbqgId7INh8QQdqgXg7kVeK0fgLROm8Kh0uyducgRf7QXi8MvlcRTrNdZsdlvt9qDs8l/0O2v4/aY2u7j9/2/6fP4/f7s+/32/f71/f7t/P34/v76/v77/v76/f38/v7q7Oz9/v75/vvf8eX1/vjq/fDP+9zr/fDq/e+/9Mrq/e7E+Mxm3HN24YSC3YwTwSMUtSIXuycavikfxi4izDIhyTAhyTE8ykoauiclxjEowDUsxDYPthgsxTUDyQgg2iQ08jk43z3Q9tHP9dAA0gAA0QAA0AAAzwAAwQAAvAAAuwEAtAEAswAArAAB0AEBxQIBrAEC1AICtwMDvQUF1AUJ2QkL3wwL2gsKygwKwgsMxQwO3w4T6BMZ6xko7ChH3kdDyUN623qE64R8znx1wnX+/v79/f38/Pz7+/v6+vr5+fn4+Pj39/f29vby8vLx8fHq6urp6eno6Ojl5eXj4+Pg4ODf39/W1tbMzMzGxsbFxcXDw8PCwsKvr6+urq6srKypqamoqKiUlJSSkpKQkJCKioqIiIiHh4eGhoZ+fn5xcXFwcHBUP7YxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH1wgUDigoTpImZAAAARtJREFUGNMBEAHv/gABAQEBlZeanJ2dm5iVAQEBAAGYAZVyknGMho+RpJ+YlQEAAQGVc3CNi4WBdXSIqKGalQABlXOOh4R+dnV3d3pTrKKZAJVyb39fY2ZlZG54eVc5q6AAlpODWUtHR0pPVoJ7WC8HqACZkG2VPSclJjeVaH1VLAyvAJuJbFREQj4TLZVqfVouFLIAnIqAaV1bTDU2lWt8WDgStgCclGJhYFxRMzFJXmdSPxa3AJpQTU9PRkMVDUFITkUkCLMAmKM8NDowESMYIjI7HAW7sACVn0AqISkgKCEoFwoLCLWpAAGapSsdDxsaGQ4QBAi5rqYAAZWep64fHgIDBgm6ta2nngABAZeepqqxtLi4s7Cppp6XR0lhOIfKM38AAAAASUVORK5CYII=">':"")+
        ' <a href="http://www.stumbleupon.com/submit?url='+url+'&amp;title='+title+'" class="spacedLink">StumbleUpon</a></li>'+

        '<li>'+(dataUriSupported?'<img height="16" width="16" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsklEQVQ4EWNgoBAwgvQnVq75f+vBG5KMUlMQYZjfHsLIBNJFqmZkPSzEWKsqL8zQXebJICLIDVZuEzUTrg3sAjgPBwNZM7oSolyAzWaYQUS5AKYYG43XBUeWpaPogfGRwwCvAW/efwUbAPMCjI9sKl4DArKXgNXCbIbxkQ2gOAwoNgDsBS5ONgYNJTFkl2FlG2nLwMVv3HsFZlPHBTLifAznrj6Bm47OQI42mBwoM1EFAAAnVCliRFKHdQAAAABJRU5ErkJggg==">':"")+
        ' <a href="http://www.facebook.com/sharer.php?u='+url+'&amp;t='+title+'"'+
        'onclick="if (window.isFile || window.isXul) return true; '+
        'window.open(&quot;http://www.facebook.com/sharer.php?u='+url+'&amp;t='+title+
        '&quot;,&quot;sharer&quot;,&quot;toolbar=0,status=0,width=626,height=436&quot;);return false;" class="spacedLink">Facebook</a></li>'+

        '<li>'+(dataUriSupported?'<img height="16" width="16" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/ElEQVQ4EYVTO24UQRB9/dmZkdfCIK0QBhMACQdwgDgMN4AEiYALcAFy7kNABkYkGzhAWMa2DHg9n+7iVfXMaAmAknp7tuvVq1dV3Q6j9SlJlzLEOXgIPPcmRjf5/7ZHdWQRaVPCOjucDYJlcHi8AFLOErz/J4kRQASXGfjYDmhIeDwAKx9xBzz8jxUCgjqSfE8CPWi5EpeTjOu+F36CVcGxrEBBMVDiaDOB5vqVBQu6WAU+dQmnwZuGwkACstxlRDckqWIhMQLPOtfXvfw0AmfA95thqwBNWGg04PktLbTYrEAlXxJTEciemtd+KdvZf7ESTjipEyaazAgyu/2lTTjP2ZpICZZQYSp7gg8kelh5PFj4Kd56ZvhE2IUSMOMVm/niZoPDOqJl0FSAYlYhoNoabSmBiI5pVNouv39w32G3l05wIwaqKRq00XErWGWYFvXz3uAbA4+51lyf+wy9h0JVRqAgfmehc8vmJt7n/CrKP6J81fzqfIPTVOOAo+S9soko+GkzhxgNocUkDfLmosPrsyvwtpTDP5KRWBz2Of4PB3vYr8o9mNuZncfLvRrPdmveJJVNDn0G8yKUMV/pO+p16MVmAn00yvnu9g7erpZ4xAbUrFtXMy42AE9YwmHNxo42lzAd6AtMQ48NgjVVOz+BVNQ9Zql4UI9P/TehBOJIi+EJIAAAAABJRU5ErkJggg==">':"")+
        ' <a href="https://twitter.com/intent/tweet?related=choiceofgames&amp;text=Awesome+game%3A+'+title+'&amp;url='+url+'&amp;via=choiceofgames" class="spacedLink">Twitter</a></li>';

  var nowMsg = "";
  if (now) nowMsg = "<p>Please support our work by sharing this game with friends!  The more people play, the more resources we'll have to work on the next game.</p>";
  msgDiv.innerHTML = nowMsg + "<ul id='sharelist'>\n"+
    mobileMesg+
    shareLinkText+
    "</ul><br>\n"; // just one line break; <ul> provides its own
  target.appendChild(msgDiv);
}

function isShareConfigured() {
  return !!document.getElementById("share");
}

function shareAction(e) {
  clearScreen(function() {
    var target = document.getElementById('text');
    printShareLinks(target, "now");
    printButton("Next", target, false, function () {
      clearScreen(loadAndRestoreGame);
    });
  });
}

function isFollowEnabled() {
  if (!window.isWeb) return false;
  if ("localhost" != window.location.hostname && !/\.?choiceofgames\.com$/.test(window.location.hostname)) return false;
  return true;
}

function printFollowButtons() {
  if (!isFollowEnabled()) return;
  // Just FB Like, for now
  var target = document.getElementById('text');
  var iframe = document.createElement('iframe');
  var width = 300;
  var height = 66;
  iframe.setAttribute("src", "//www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fchoiceofgames"+
    "&amp;send=false&amp;layout=standard&amp;width="+width+"&amp;show_faces=true&amp;font&amp;colorscheme=light&amp;"+
    "action=like&amp;height="+height+"&amp;appId=190439350983878");
  iframe.setAttribute("scrolling", "no");
  iframe.setAttribute("frameborder", "0");
  iframe.setAttribute("style", "border:none; overflow:hidden; width:"+width+"px; height:"+height+"px;");
  iframe.setAttribute("allowTransparency", "true");
  target.appendChild(iframe);
}

function subscribeLink(e) {
  clearScreen(function() {
    subscribe(document.getElementById('text'), "now", function() {
      clearScreen(loadAndRestoreGame);
    });
  });
}

function subscribeByMail(target, now, callback, code) {
  if (now) {
    code();
    safeTimeout(function() {callback(now);}, 0);
  } else {
    println("Click here to subscribe to our mailing list; we'll notify you when our next game is ready!");
    println("");
    printButton("Subscribe", target, false, function() {
        code();
      });
    printButton("Next", target, false, function() {
      safeTimeout(function() {callback(now);}, 0);
    });
    printFooter();
  }
}

function subscribe(target, now, callback) {
  if (!target) target = document.getElementById('text');
  if (window.isIosApp) {
    subscribeByMail(target, now, callback, function() {
      callIos("subscribe");
    });
    return;
  }
  var mailToSupported = isMobile && !window.isMacApp;
  if (window.isAndroidApp) mailToSupported = urlSupport.isSupported("mailto:support@choiceofgames.com");
  if (mailToSupported) {
    subscribeByMail(target, now, callback, function() {
      window.location.href = "mailto:subscribe-"+window.storeName+"-"+platformCode() + "@choiceofgames.com?subject=Sign me up&body=Please notify me when the next game is ready.";
    });
    return;
  }
  println("Type your email address below; we'll notify you when our next game is ready!");
  println("");
  fetchEmail(function(defaultEmail) {
    promptEmailAddress(target, defaultEmail, function(cancel, email) {
      if (cancel) {
        return safeCall(null, callback);
      }
      var head= document.getElementsByTagName('head')[0];
      var script = document.createElement('script');
      script.type = 'text/javascript';
      var timestamp = new Date().getTime();
      var timeout = setTimeout(function() {
        window["jsonp"+timestamp]({
          result:"error", msg:"Couldn't connect. Please try again later."
        });
      }, 10000);
      window["jsonp"+timestamp] = function(response) {
        clearTimeout(timeout);
        if (response.result == "error") {
          document.getElementById("errorMessage").innerHTML = response.msg;
        } else {
          clearScreen(function() {
            target = document.getElementById('text');
            println(response.msg, target);
            println("", target);
            printButton("Next", target, false, function() {
              safeCall(null, callback);
            });
          });
        }
      };
      var mailParams = "u=eba910fddc9629b2810db6182&id=e9cdee1aaa&SIGNUP="+window.storeName+"-"+platformCode()+"&EMAIL="+encodeURIComponent(email);
      if (window.isChromeApp) {
        chrome.permissions.contains({origins: ["http://choiceofgames.us4.list-manage.com/"]},function(isXhrAllowed) {
          if (isXhrAllowed) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", 'http://choiceofgames.us4.list-manage.com/subscribe/post-json?'+mailParams, true);
            xhr.onreadystatechange = function() {
              if (xhr.readyState != 4) return;
              if (xhr.status == 200) {
                var response = JSON.parse(xhr.responseText);
                window["jsonp"+timestamp](response);
              } else if (xhr.status === 0) {
                window["jsonp"+timestamp]({result:"error", msg:"There was a network error submitting your registration. Please try again later, or email subscribe@choiceofgames.com instead."});
              } else {
                window["jsonp"+timestamp]({result:"error", msg:"Sorry, our mail server had an error. It's our fault. Please try again later, or email subscribe@choiceofgames.com instead."});
              }
            };
            xhr.send();
          } else {
            window.addEventListener('message', function(event) {
              if (window["jsonp"+timestamp]) {
                var jsonpt = window["jsonp"+timestamp];
                window["jsonp"+timestamp] = null;
                if (jsonpt) jsonpt(event.data);
              }
            });
            var iframe = document.createElement("IFRAME");
            iframe.setAttribute("src", "sandbox.html");
            iframe.setAttribute("name", "sandbox");
            iframe.onload = function() {
              iframe.contentWindow.postMessage({email:email, game:window.storeName, platform:platformCode()}, "*");
            };
            document.documentElement.appendChild(iframe);
            return;
          }
        });
      } else {
        if (isWinStoreApp || window.location.protocol == "https:") {
          var xhr = findXhr();
          xhr.open("GET", 'https://www.choiceofgames.com/mailchimp_proxy.php/subscribe/post-json?'+mailParams, true);
          var done = false;
          xhr.onreadystatechange = function() {
            if (done) return;
            if (xhr.readyState != 4) return;
            done = true;
            if (xhr.status == 200) {
              var response = JSON.parse(xhr.responseText);
              window["jsonp"+timestamp](response);
            } else if (xhr.status === 0) {
                window["jsonp"+timestamp]({result:"error", msg:"There was a network error submitting your registration. Please try again later, or email subscribe@choiceofgames.com instead."});
            } else {
              window["jsonp"+timestamp]({result:"error", msg:"Sorry, our mail server had an error. It's our fault. Please try again later, or email subscribe@choiceofgames.com instead."});
            }
          };
          xhr.send();
        } else {
          script.src = 'http://choiceofgames.us4.list-manage.com/subscribe/post-json?'+mailParams+'&c=jsonp' + timestamp;
          head.appendChild(script);
        }
      }
    });
  });
}

function cacheKnownPurchases(knownPurchases) {
  if (!knownPurchases) return;
  var output = {billingSupported:true};
  for (i = 0; i < knownPurchases.length; i++) {
    var parts = knownPurchases[i].split(/\./);
    if (parts[0] != window.storeName) continue;
    output[parts[1]] = true;
  }
  window.knownPurchases = output;
}

function getKnownPurchases(callback) {
  isRegistered(function(registered){
    if (registered) {
      startLoading();
      xhrAuthRequest("GET", "get-purchases", function(ok, response) {
        doneLoading();
        if (ok) {
          cacheKnownPurchases(response);
        } else {
          if (response.error != "not registered") {
            alertify.error("There was an error downloading your purchases from Choiceofgames.com. "+
              "Please refresh this page to try again, or contact support@choiceofgames.com for assistance.", 15000);
          }
        }
        callback(ok, window.knownPurchases);
      });
    } else {
      callback("ok", {billingSupported: true});
    }
  });
}

// Callback expects a map from product ids to booleans
function checkPurchase(products, callback) {
  var i;
  if (window.isIosApp) {
    window.checkPurchaseCallback = function(purchases) {callback("ok",purchases); };
    callIos("checkpurchase", products);
  } else if (window.isAndroidApp && !window.isNookAndroidApp) {
    window.checkPurchaseCallback = function(purchases) {callback("ok",purchases); };
    androidBilling.checkPurchase(products);
  } else if (window.isWinOldApp) {
    safeTimeout(function() {
      var purchases = eval(window.external.CheckPurchase(products));
      callback("ok",purchases);
    }, 0);
  } else if (window.isMacApp && window.macPurchase) {
    safeTimeout(function() {
      var purchases = JSON.parse(macPurchase.checkPurchases_(products));
      callback("ok",purchases);
    }, 0);
  } else if (window.isCef) {
    cefQuery({
      request:"CheckPurchases " + products,
      onSuccess: function(response) {
        console.log("cp response " + response);
        callback("ok",JSON.parse(response));
      },
      onFailure: function(error_code, error_message) {
        console.error("CheckPurchases error: " + error_message);
        callback(!"ok");
      }
    });
  } else if (isWebPurchaseSupported()) {
    isRegistered(function (registered) {
      if (!registered) return callback("ok", {billingSupported: true});
      if (window.knownPurchases) {
        safeTimeout(function() { callback("ok", knownPurchases); }, 0);
      } else {
        getKnownPurchases(callback);
      }
    });
  } else {
    var productList = products.split(/ /);
    var purchases = {};
    for (i = 0; i < productList.length; i++) {
      purchases[productList[i]] = true;
    }
    purchases.billingSupported = false;
    safeTimeout(function() {callback("ok", purchases);}, 0);
  }
}

function isWebPurchaseSupported() {
  return window.isSecureWeb && isWebSavePossible() && window.stripeKey;
}

function isRestorePurchasesSupported() {
  return !!window.isIosApp || isWebPurchaseSupported();
}

function restorePurchases(callback) {
  if (window.isIosApp) {
    window.restoreCallback = callback;
    callIos("restorepurchases");
  } else if (isWebPurchaseSupported()) {
    isRegistered(function(registered) {
      var restoreCallback = function() {callback();};
      if (registered) {
        getKnownPurchases(restoreCallback);
      } else {
        clearScreen(function() {
          var target = document.getElementById('text');
          target.innerHTML="<p>Please sign in to Choiceofgames.com to restore purchases.</p>";
          loginForm(document.getElementById('text'), /*optional*/1, /*err*/null, restoreCallback);
        });
      }
    });
  } else {
    safeTimeout(callback, 0);
  }
}
// Callback expects a localized string, or "", or "free", or "guess"
function getPrice(product, callback) {
  if (window.isIosApp) {
    window.priceCallback = callback;
    callIos("price", product);
  } else if (window.isAndroidApp) {
    window.priceCallback = callback;
    androidBilling.getPrice(product);
  } else {
    safeTimeout(function () {
      callback.call(this, "guess");
    }, 0);
  }
}
// Callback expects no args, but should only be called on success
function purchase(product, callback) {
  var purchaseCallback = function() {
    window.purchaseCallback = null;
    safeCall(null, callback);
  };
  if (window.isIosApp) {
    window.purchaseCallback = purchaseCallback;
    callIos("purchase", product);
  } else if (window.isAndroidApp) {
    window.purchaseCallback = purchaseCallback;
    var androidStackTrace = androidBilling.purchase(product);
    if (androidStackTrace) throw new Error(androidStackTrace);
  } else if (window.isWinOldApp) {
    window.external.Purchase(product);
  } else if (window.isMacApp && window.macPurchase) {
    macPurchase.purchase_(product);
  } else if (window.isCef) {
    cefQuerySimple("Purchase " + product);
    // no callback; we'll refresh on purchase
  } else if (isWebPurchaseSupported()) {
    if (!window.StripeCheckout) return asyncAlert("Sorry, we weren't able to initiate payment. (Your "+
      "network connection may be down.) Please refresh the page and try again, or contact "+
      "support@choiceofgames.com for assistance.");
    startLoading();
    isRegistered(function(registered) {
      doneLoading();
      var fullProductName = window.storeName + "." + product;
      function stripe(email) {
        startLoading();
        xhrAuthRequest("GET", "product-data", function(ok, data) {
          doneLoading();
          if (!ok) return asyncAlert("Sorry, we weren't able to initiate payment. (Your "+
            "network connection may be down.) Please refresh the page and try again, or contact "+
            "support@choiceofgames.com for assistance.");
          data = data[fullProductName];
          StripeCheckout.open({
            key:         window.stripeKey,
            address:     false,
            amount:      data.amount,
            name:        data.display_name,
            email:       email,
            panelLabel:  'Buy',
            token:       function(response) {
              clearScreen(function() {
                startLoading();
                xhrAuthRequest("POST", "purchase", function(ok, response) {
                  doneLoading();
                  if (ok) {
                    cacheKnownPurchases(response);
                    return callback();
                  } else if (/^card error: /.test(response.error)) {
                    var cardError = response.error.substring("card error: ".length);
                    asyncAlert(cardError);
                    clearScreen(loadAndRestoreGame);
                  } else if ("purchase already in flight" == response.error) {
                    asyncAlert("Sorry, there was an error handling your purchase. Please wait five minutes and try again, or contact support@choiceofgames.com for assistance.");
                    clearScreen(loadAndRestoreGame);
                  } else {
                    asyncAlert("Sorry, there was an error processing your card. (Your "+
                      "network connection may be down.) Please refresh the page and try again, or contact "+
                      "support@choiceofgames.com for assistance.");
                    clearScreen(loadAndRestoreGame);
                  }
                }, "stripeToken", response.id, "product", fullProductName, "key", window.stripeKey);
              });
            }
          });
        }, "products", fullProductName);
      }
      if (registered) return fetchEmail(stripe);
      clearScreen(function() {
        var target = document.getElementById('text');
        target.innerHTML="<p>Please sign in to Choiceofgames.com to purchase.</p>";
        loginForm(document.getElementById('text'), /*optional*/1, /*err*/null, function(registered){
          if (registered) {
            checkPurchase(product, function(ok, response) {
              if (ok && response[product]) {
                callback();
              } else {
                clearScreen(loadAndRestoreGame);
                return fetchEmail(stripe);
              }
            });
          } else {
            clearScreen(loadAndRestoreGame);
          }
        });
      });
    });
  } else {
    safeTimeout(callback, 0);
  }
}

function registerNativeAchievement(name) {
  if (window.blockNativeAchievements) return;
  if (window.isIosApp) {
    callIos("achieve", name+"/");
  } else if (window.isMacApp && window.macAchievements) {
    macAchievements.achieve_(name);
  } else if (window.isWinOldApp) {
    window.external.Achieve(name);
  } else if (window.isCef) {
    cefQuerySimple("Achieve " + name);
  }
}

function achieve(name, title, description) {
  if (initStore()) window.store.set("achieved", toJson(nav.achieved));
  registerNativeAchievement(name);
  // iOS shows a prominent banner; no need to show our own
  if (window.isIosApp) return;
  var escapedTitle = title+"".replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
  var escapedDescription = description+"".replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/\[b\]/g, '<b>')
    .replace(/\[\/b\]/g, '</b>')
    .replace(/\[i\]/g, '<i>')
    .replace(/\[\/i\]/g, '</i>');
  var html = "<b>Achievement: "+escapedTitle+"</b><br>" + escapedDescription;
  alertify.log(html);
}

function checkAchievements(callback) {
  safeTimeout(function() {
    if (!initStore()) return callback();
    window.store.get("achieved", function(ok, value){
      function mergeNativeAchievements(achieved) {
        window.checkAchievementCallback = null;
        var nativeRegistered = {};
        for (var i = 0; i < achieved.length; i++) {
          nav.achieved[achieved[i]] = true;
          nativeRegistered[achieved[i]] = true;
        }
        for (var achievement in nav.achieved) {
          if (nav.achieved[achievement] && !nativeRegistered[achievement]) {
            registerNativeAchievement(achievement);
          }
        }
        callback();
      }
      var alreadyLoadingAchievements = false;
      if (ok && value) {
        var achievementRecord = jsonParse(value);
        for (var achieved in achievementRecord) {
          if (achievementRecord[achieved]) nav.achieved[achieved] = true;
        }
      }
      if (window.isIosApp) {
        alreadyLoadingAchievements = !!window.checkAchievementCallback;
        window.checkAchievementCallback = mergeNativeAchievements;
        if (!alreadyLoadingAchievements) callIos("checkachievements");
      } else if (window.isMacApp && window.macAchievements) {
        alreadyLoadingAchievements = !!window.checkAchievementCallback;
        window.checkAchievementCallback = mergeNativeAchievements;
        if (!alreadyLoadingAchievements) macAchievements.checkAchievements();
      } else if (window.isWinOldApp) {
        var checkWinAchievements = function () {
          var achieved = eval(window.external.GetAchieved());
          if (achieved) {
            mergeNativeAchievements(achieved);
          } else {
            safeTimeout(checkWinAchievements, 100);
          }
        };
        checkWinAchievements();
      } else if (window.isCef) {
        var checkCefAchievements = function() {
          cefQuery({
            request:"GetAchieved ",
            onSuccess: function(response) {
              //console.log("GetAchieved " + response);
              var achieved = eval(response);
              mergeNativeAchievements(achieved);
            },
            onFailure: function(error_code, error_message) {
              //console.error("GetAchieved error " + error_message);
              if (error_code == 1) {
                safeTimeout(checkCefAchievements, 100);
              } else {
                callback();
              }
            }
          });
        };
        checkCefAchievements();
      } else {
        callback();
      }
    });
  },0);
}

function isAdvertisingSupported() {
  return typeof window != "undefined" && (window.isIosApp || window.isAndroidApp);
}

function isFullScreenAdvertisingSupported() {
  return window.isIosApp || window.isAndroidApp;
}

function showFullScreenAdvertisement(callback) {
  if (window.isIosApp) {
    callIos("advertisement");
    safeTimeout(callback, 0);
  } else if (window.isAndroidApp && window.adBridge) {
    adBridge.displayFullScreenAdvertisement();
    safeTimeout(callback, 0);
  } else {
    safeTimeout(callback, 0);
  }
}

function showTicker(target, endTimeInSeconds, finishedCallback) {
  if (!target) target = document.getElementById('text');
  var div = document.createElement("span");
  div.setAttribute("id", "delayTicker");
  target.appendChild(div);
  var timerDisplay = document.createElement("span");
  div.appendChild(timerDisplay);
  var timer;

  var statsButton = document.getElementById("statsButton");
  if (statsButton) {
    var defaultStatsButtonDisplay = statsButton.style.display;
    statsButton.style.display = "none";
  }

  if (endTimeInSeconds > Math.floor(new Date().getTime() / 1000)) {
    if (window.isAndroidApp) {
      notificationBridge.scheduleNotification(endTimeInSeconds);
    } else if (window.isIosApp) {
      callIos("schedulenotification", endTimeInSeconds);
    }
  }

  function cleanUpTicker() {
    window.tickerRunning = false;
    if (window.isAndroidApp) {
      notificationBridge.cancelNotification();
    } else if (window.isIosApp) {
      callIos("cancelnotifications");
    }
    clearInterval(timer);
    if (statsButton) statsButton.style.display = defaultStatsButtonDisplay;
  }

  function formatSecondsRemaining(secondsRemaining, forceMinutes) {
    if (!forceMinutes && secondsRemaining < 60) {
      return ""+secondsRemaining+"s";
    } else {
      var minutesRemaining = Math.floor(secondsRemaining / 60);
      var remainderSeconds;
      if (minutesRemaining < 60) {
        remainderSeconds = secondsRemaining - minutesRemaining * 60;
        return ""+minutesRemaining+"m " + formatSecondsRemaining(remainderSeconds);
      } else {
        var hoursRemaining = Math.floor(secondsRemaining / 3600);
        remainderSeconds = secondsRemaining - hoursRemaining * 3600;
        return ""+hoursRemaining+"h " + formatSecondsRemaining(remainderSeconds, true);
      }
    }
  }

  function tick() {
    window.tickerRunning = true;
    var tickerElement = document.getElementById("delayTicker");
    var tickerStillVisible = tickerElement && tickerElement.parentNode && tickerElement.parentNode.parentNode;
    if (!tickerStillVisible) {
      cleanUpTicker();
      return;
    }
    var nowInSeconds = Math.floor(new Date().getTime() / 1000);
    var secondsRemaining = endTimeInSeconds - nowInSeconds;
    if (secondsRemaining >= 0) {
      timerDisplay.innerHTML = "" + formatSecondsRemaining(secondsRemaining) + " seconds remaining";
    } else {
      cleanUpTicker();
      tickerElement.innerHTML = "0s remaining";
      if (finishedCallback) safeCall(null, finishedCallback);
    }
  }

  timer = setInterval(tick, 1000);
  tick();
}

function printButton(name, parent, isSubmit, code) {
  var button;
  if (isSubmit) {
    button = document.createElement("input");
    button.type = "submit";
    button.value = name;
    button.name = name;
  } else {
    button = document.createElement("button");
    button.setAttribute("type", "button");
    printx(name, button);
  }
  setClass(button, "next");
  button.setAttribute("accesskey", "n");
  if (code) button.onclick = function(event) {
    if (window.isIosApp) {
      window.freezeCallback = function() {
        window.freezeCallback = null;
        code(event);
      };
      callIos("freeze");
    } else {
      safeCall(null, function() {code(event);});
    }
  };
  if (!isMobile) try { button.focus(); } catch (e) {}
  parent.appendChild(button);
  return button;
}

function printLink(target, href, anchorText, onclick) {
  if (!target) target = document.getElementById('text');
  var link = document.createElement("a");
  link.setAttribute("href", href);
  link.appendChild(document.createTextNode(anchorText));
  if (onclick) {
    if (link.addEventListener) {
      link.addEventListener("click", onclick, true);
    } else {
      link.onclick = onclick;
    }
  }
  target.appendChild(link);
  target.appendChild(document.createTextNode(" "));
}

function kindleButton(target, query, buttonName) {
  printButton(buttonName, main, false,
    function() {
      try {
        window.location.href="http://www.amazon.com/s?rh=n%3A133140011%2Ck%3A" + encodeURIComponent(query);
      } catch (e) {} // xulrunner will intercept this link and throw an exception, opening it in the external browser
    }
  );
}

function printInput(target, inputType, callback, minimum, maximum, step) {
    if (!target) target = document.getElementById('text');
    var form = document.createElement("form");
    target.appendChild(form);
    var self = this;
    form.action="#";


    if (inputType == "textarea") {
      var input = document.createElement("textarea");
      input.setAttribute("rows", 4);
    } else {
      var input = document.createElement("input");
      input.setAttribute("type", inputType);
      if (inputType == "number") {
        input.setAttribute("min", minimum);
        input.setAttribute("max", maximum);
        step = step || "any";
        input.setAttribute("step", step);
      }
    }

    input.name="text";
    input.setAttribute("style", "font-size: 25px; width: 90%;");
    form.appendChild(input);

    form.onsubmit = function(e) {
        preventDefault(e);
        if (!input.value) {
            // TODO optional value?
            // TODO configurable error message?
            asyncAlert("Don't just leave it blank!  Type something!");
            return;
        }
        if (window.isIosApp) {
          window.freezeCallback = function() {
            window.freezeCallback = null;
            safeCall(null, function() {callback(input.value);});
          };
          callIos("freeze");
        } else {
          safeCall(null, function() {callback(input.value);});
        }
        return false;
    };

    form.appendChild(document.createElement("br"));
    form.appendChild(document.createElement("br"));
    printButton("Next", form, true);

}

function promptEmailAddress(target, defaultEmail, callback) {
  if (!target) target = document.getElementById('text');
  var form = document.createElement("form");
  var self = this;
  form.action="#";

  var message = document.createElement("div");
  message.style.color = "red";
  message.style.fontWeight = "bold";
  message.setAttribute("id", "errorMessage");
  form.appendChild(message);

  var input = document.createElement("input");
  // This can fail on IE
  try { input.type="email"; } catch (e) {}
  input.name="email";
  input.value=defaultEmail;
  input.setAttribute("style", "font-size: 25px; width: 90%;");
  form.appendChild(input);
  target.appendChild(form);
  println("", form);
  println("", form);
  printButton("Next", form, true);

  printButton("No, Thanks", target, false, function() {
    callback(true);
  });

  form.onsubmit = function(e) {
    preventDefault(e);
    safeCall(this, function() {
      var email = trim(input.value);
      if (!/^\S+@\S+\.\S+$/.test(email)) {
        var messageText = document.createTextNode("Sorry, \""+email+"\" is not an email address.  Please type your email address again.");
        message.innerHTML = "";
        message.appendChild(messageText);
      } else {
        recordEmail(email, function() {
          callback(false, email);
        });
      }
    });
  };

  curl();
}

function loginForm(target, optional, errorMessage, callback) {
  if (!isRegisterAllowed() || !initStore()) return safeTimeout(function() {
    callback(!"ok");
  }, 0);
  var optional_start = 1;
  var optional_returning_subscribe = 2;
  var optional_returning_no_subscribe = 3;
  var optional_new_subscribe = 4;
  var optional_new_no_subscribe = 5;
  startLoading();
  fetchEmail(function(defaultEmail) {
    isRegistered(function(registered) {
      if (registered) {
        if (defaultEmail) {
          doneLoading();
          loginDiv(registered, defaultEmail);
          return safeTimeout(callback, 0);
        }
        // Cookie says I'm logged in, but we have no local record of the email address
        return getRemoteEmail(function(ok, response) {
          doneLoading();
          if (ok) {
            if (response.email) {
              loginDiv(registered, response.email);
              return recordEmail(response.email, callback);
            } else {
              // not really logged in after all
              logout();
              loginDiv();
              return loginForm(target, optional, errorMessage, callback);
            }
          } else {
            // missed an opportunity to record email locally. meh.
            return safeCall(null, callback);
          }
        });
      }
      doneLoading();
      var form = document.createElement("form");

    if (!errorMessage) errorMessage = "";

      var escapedEmail = defaultEmail.replace(/'/g, "&apos;");
      var passwordButton;
      if (optional == optional_start) {
        form.innerHTML = "<div id=message style='color:red; font-weight:bold'>"+errorMessage+
          "</div><div class='choice'>"+
          "<label for=yes class=firstChild><input type=radio name=choice value=yes id=yes checked> My email address is: "+
          "<input type=email name=email id=email value='"+escapedEmail+"' style='font-size: 25px; width: 11em'></label>"+
          ((isWeb && window.facebookAppId)?"<label for=facebook><input type=radio name=choice value=facebook id=facebook > Sign in with Facebook.</label>":"")+
          ((isWeb && window.googleAppId)?"<label for=google><input type=radio name=choice value=google id=google > Sign in with Google.</label>":"")+
          "<label for=no class=lastChild><input type=radio name=choice value=no id=no > No, thanks.</label>"+
          "<p><label class=noBorder for=subscribe><input type=checkbox name=subscribe id=subscribe checked> "+
          "Email me when new games are available.</label></p>";

        form.email.onclick = function() {
          setTimeout(function() {form.email.focus();}, 0);
        };
        setTimeout(function() {form.email.focus();}, 0);
      } else {
        form.innerHTML = "<div id=message style='color:red; font-weight:bold'>"+errorMessage+
          "</div><span><span>My email address is: </span><input type=email name=email id=email value='"+
          escapedEmail+"' style='font-size: 25px; width: 12em'></span><p><label class=noBorder id=subscribeLabel for=subscribe>"+
          "<input type=checkbox name=subscribe id=subscribe checked> "+
          "Email me when new games are available.</label></p><p>Do you have a Choiceofgames.com password?</p>"+
          "<div class='choice'>"+
          "<label for=new class=firstChild><input type=radio name=choice value=new id=new checked> No, I'm new.</label>"+
          "<label for=passwordButton><input type=radio name=choice value=passwordButton id=passwordButton> "+
          "Yes, I have a password: <input id=password type=password name=password disabled class=needsclick style='font-size: 25px; width: 11em'></label>"+
          "<label for=forgot><input type=radio name=choice value=forgot id=forgot> I forgot my password.</label>"+
          ((isWeb && window.facebookAppId)?"<label for=facebook><input type=radio name=choice value=facebook id=facebook> Sign in with Facebook.</label>":"")+
          ((isWeb && window.googleAppId)?"<label for=google><input type=radio name=choice value=google id=google> Sign in with Google.</label>":"")+
          (optional ? "<label for=no><input type=radio name=choice value=no id=no> Cancel.</label>" : "") +
          "</div><br>";

        var labels = form.getElementsByTagName("label");
        setClass(labels[labels.length-1], "lastChild");

        var password = form.password;
        passwordButton = form.passwordButton;

        passwordButton.parentNode.onclick = function() {
          passwordButton.checked = true;
          passwordButton.onchange();
        };

        var radioButtons = form.choice;
        var onchange = function() {
          var enabled = passwordButton.checked;
          password.disabled = !enabled;
          if (enabled) {
            password.focus();
            setTimeout(function() {password.parentNode.scrollIntoView();}, 0);
          }
        };
        for (var i = radioButtons.length - 1; i >= 0; i--) {
          radioButtons[i].onchange = onchange;
        }
        if (optional) {
          form.subscribe.checked = (optional == optional_returning_subscribe || optional == optional_new_subscribe);
          passwordButton.checked = (optional == optional_returning_subscribe || optional == optional_returning_no_subscribe);
        }
      }

      function showMessage(msg) {
        var message = document.getElementById('message');
        var messageText = document.createTextNode(msg);
        message.innerHTML = "";
        message.appendChild(messageText);
      }

      form.onsubmit = function(event) {
        preventDefault(event);
        var email = trim(form.email.value);
        var subscribe = form.subscribe.checked;
        var choice = getFormValue("choice");
        if ("facebook" == choice) {
          if (!window.FB) return asyncAlert("Sorry, we weren't able to sign you in with Facebook. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
          var loginParams = {scope:'email',return_scopes:true};
          if (window.facebookReRequest) loginParams.auth_type = "rerequest";
          return FB.login(function(response){
            if ("connected" == response.status) {
              var grantedScopes = [];
              try { grantedScopes = response.authResponse.grantedScopes.split(","); } catch (e) {}
              var grantedEmail = false;
              for (var i = 0; i < grantedScopes.length; i++) {
                if ("email" == grantedScopes[i]) {
                  grantedEmail = true;
                  break;
                }
              }
              if (grantedEmail) {
                xhrAuthRequest("POST", "facebook-login", function(ok, response){
                  if (ok) {
                    loginDiv(ok, response.email);
                    recordLogin(ok, response.email);
                    cacheKnownPurchases(response.purchases);
                    safeCall(null, function() {callback("ok");});
                  } else {
                    asyncAlert("Sorry, we weren't able to sign you in with Facebook. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                  }
                }, "app_id", facebookAppId);
              } else {
                showMessage("Sorry, we require an email address to sign you in. Please grant access to your email address, or type your email address below.");
                window.facebookReRequest = true;
              }
            }
          },loginParams);
        }
        if ("google" == choice) {
          if (!window.gapi) return asyncAlert("Sorry, we weren't able to sign you in with Google. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
          googleLoginCallbackCallback = function(ok) {
            if (ok) {
              return safeCall(null, function() {callback("ok")});
            } else {
              asyncAlert("Sorry, we weren't able to sign you in with Google. Please try again later, or contact support@choiceofgames.com for assistance.");
            }
          }
          return gapi.auth.signIn();
        }
        if (!/^\S+@\S+\.\S+$/.test(email) && "no" != choice) {
          showMessage('Sorry, "'+email+'" is not an email address.  Please type your email address again.');
        } else {
          recordEmail(email, function() {
            if ("yes" == choice) {
              clearScreen(function() {
                if (defaultEmail) {
                  optional = subscribe ? optional_returning_subscribe : optional_returning_no_subscribe;
                } else {
                  optional = subscribe ? optional_new_subscribe : optional_new_no_subscribe;
                }
                loginForm(document.getElementById("text"), optional, null, callback);
              });
            } else if ("no" == choice) {
              safeCall(null, function() {callback(false);});
            } else if ("new" == choice) {
              target.innerHTML = "";
              window.scrollTo(0,0);
              form = document.createElement("form");
              var escapedEmail = email.replace(/'/g, "&apos;");
              form.innerHTML = "<div id=message style='color:red; font-weight:bold'></div>"+
                "<div>My email address is: </div><div><input type=email name=email id=email value='"+
                escapedEmail+"' style='font-size: 25px; width: 12em'></div>"+
                "<div>Type it again: </div><div><input type=email name=email2 id=email2 autocomplete='off' style='font-size: 25px; width: 12em'></div>"+
                "<div>Enter a new password:&nbsp;</div><div>"+
                "<input type=password name=password id=password style='font-size: 25px; width: 12em'></div>";
              form.onsubmit = function(event) {
                preventDefault(event);
                var email = trim(form.email.value);
                var email2 = trim(form.email2.value);
                if (!/^\S+@\S+\.\S+$/.test(email)) {
                  showMessage('Sorry, "'+email+'" is not an email address.  Please type your email address again.');
                  return;
                } else if (email != email2) {
                  showMessage('Those email addresses don\'t match.  Please type your email address again.');
                  return;
                }
                startLoading();
                form.style.display = "none";
                window.scrollTo(0,0);
                login(email, form.password.value, /*register*/true, subscribe, function(ok, response) {
                  doneLoading();
                  if (ok) {
                    target.innerHTML = "";
                    loginDiv(ok, email);
                    recordLogin(ok, email);
                    cacheKnownPurchases(response.purchases);
                    safeCall(null, function() {callback("ok");});
                  } else if ("incorrect password" == response.error) {
                    target.innerHTML = "";
                    loginForm(target, optional, 'Sorry, the email address "'+email+'" is already in use. Please type your password below, or use a different email address.', callback);
                  } else {
                    form.style.display = "";
                    showMessage("Sorry, we weren't able to sign you in. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                  }
                });
              };
              target.appendChild(form);
              println("", form);
              printButton("Next", form, true);
              if (optional) {
                printButton("Cancel", form, false, function() {
                  safeCall(null, function() {callback(false);});
                });
              }
            } else if ("passwordButton" == choice) {
              startLoading();
              form.style.display = "none";
              window.scrollTo(0,0);
              login(email, form.password.value, /*register*/false, form.subscribe.checked, function(ok, response) {
                doneLoading();
                form.style.display = "";
                if (ok) {
                  target.innerHTML = "";
                  loginDiv(ok, email);
                  recordLogin(ok, email);
                  cacheKnownPurchases(response.purchases);
                  safeCall(null, function() {callback("ok");});
                } else if ("unknown email" == response.error) {
                  showMessage('Sorry, we can\'t find a record for the email address "'+email+'". Please try a different email address, or create a new account.');
                } else if ("incorrect password" == response.error) {
                  showMessage('Sorry, that password is incorrect. Please try again, or select "I forgot my password" to reset your password.');
                } else {
                  showMessage("Sorry, we weren't able to sign you in. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                }
              });
            } else if ("forgot" == choice) {
              startLoading();
              form.style.display = "none";
              window.scrollTo(0,0);
              forgotPassword(email, function(ok, response) {
                doneLoading();
                form.style.display = "";
                if (ok) {
                  showMessage("We've emailed you a link to reset your password. Please check your email and click on the link, then return here to sign in.");
                  document.getElementById('passwordButton').checked = true;
                  document.getElementById('passwordButton').onchange();
                } else if ("unknown email" == response.error) {
                  showMessage('Sorry, we can\'t find a record for the email address "'+email+'". Please try a different email address, or create a new account.');
                } else {
                  showMessage("Sorry, we weren't able to sign you in. (Your network connection may be down.) Please try again later, or contact support@choiceofgames.com for assistance.");
                }
              });
            }
          });
        }
      };

      target.appendChild(form);
      if (passwordButton && passwordButton.checked) passwordButton.onchange();
      if (optional && optional > 1) document.getElementById("subscribeLabel").style.display = "none";
      printButton("Next", form, true);
      printFooter();
    });
  });
}

function loginDiv(registered, email) {
  var domain = "https://www.choiceofgames.com/";
  var identity = document.getElementById("identity");
  if (!identity) return;
  if (registered) {
    var emailLink = document.getElementById("email");
    emailLink.setAttribute("href", domain + "profile" + "/");
    emailLink.innerHTML = "";
    emailLink.appendChild(document.createTextNode(email));
    identity.style.display = "block";
    var logoutLink = document.getElementById("logout");
    logoutLink.onclick = function(event) {
      preventDefault(event);
      logout();
      loginDiv();
    };
  } else {
    identity.style.display = "none";
  }
}

function isRegistered(callback) {
  if (window.isWeb) {
    return safeTimeout(function() {
      if (!window.registered) window.registered = !!getCookieByName("login");
      callback(window.registered);
    }, 0);
  } else if (initStore()) {
    return window.store.get("login", function(ok, value) {
      safeTimeout(function() {
        window.registered = ok && value && "false" != value;
        callback(window.registered);
      }, 0);
    });
  } else {
    safeCall(null, function() {
      window.registered = false;
      callback(false);
    });
  }
}

function isRegisterAllowed() {
  return window.isWeb || window.isIosApp;
}

function preventDefault(event) {
  if (!event) event = window.event;
  if (!event) return;
  if (event.preventDefault) {
    event.preventDefault();
  } else {
    event.returnValue = false;
  }
}

function getPassword(target, code) {
  if (!target) target = document.getElementById('text');
  var textArea = document.createElement("textarea");
  textArea.cols = 41;
  textArea.rows = 30;
  setClass(textArea, "savePassword");
  target.appendChild(textArea);
  println("", target);
  printButton("Next", target, false, function() {
    code(false, textArea.value);
  });

  printButton("Cancel", target, false, function() {
    code(true);
  });
}

function facebookStatusChangeCallback(response) {
  if (response.status == "connected") {
    isRegistered(function(registered) {
      if (!registered) xhrAuthRequest("POST", "facebook-login", function(ok, response){
        loginDiv(ok, response.email);
        cacheKnownPurchases(response.purchases);
        recordLogin(ok, response.email);
        if (ok) clearScreen(loadAndRestoreGame);
      }, "app_id", facebookAppId);
    });
  }
}

function showPassword(target, password) {
  if (!target) target = document.getElementById('text');

  var textBuffer = [];
  var colWidth = 40;
  for (var i = 0; i < password.length; i++) {
    textBuffer.push(password.charAt(i));
    if ((i + 1) % colWidth === 0) {
      textBuffer.push('\n');
    }
  }
  password = "----- BEGIN PASSWORD -----\n" + textBuffer.join('') + "\n----- END PASSWORD -----";

  var shouldButton = isMobile;
  if (shouldButton) {
    var button = printButton("Email My Password to Me", target, false,
      function() {
        safeCall(self, function() {
            if (isWeb) {
              // TODO more reliable system
            }
            window.location.href = "mailto:?subject=Save%20this%20password&body=" + encodeURIComponent(password);
        });
      }
    );
    setClass(button, "");
  }

  var shouldTextArea = !isMobile;
  if (shouldTextArea) {
    var textArea = document.createElement("textarea");
    textArea.cols = colWidth + 1;
    textArea.rows = 30;
    setClass(textArea, "savePassword");

    textArea.setAttribute("readonly", true);
    textArea.onclick = function() {textArea.select();};
    textArea.value = (password);
    target.appendChild(textArea);
  }
}

function changeTitle(title) {
  document.title = title;
  var h1 = document.getElementsByTagName("h1");
  if (h1) h1 = h1[0];
  h1.innerHTML = "";
  h1.appendChild(document.createTextNode(title));
  if (window.isWinOldApp) {
    window.external.SetTitle(title);
  }
}

function changeAuthor(author) {
  var authorTag = document.getElementById("author");
  authorTag.innerHTML = "";
  authorTag.appendChild(document.createTextNode("by " + author));
}


function reportBug() {
  var prompt = "Please explain the problem. Be sure to describe what you expect, as well as what actually happened.";
  alertify.prompt(prompt, function(ok, body) {
    var statMsg = "(unknown)";
    try {
        statMsg = toJson(window.stats, '\n');
    } catch (ex) {}
    body += "\n\nGame: " + window.storeName;
    if (window.stats && window.stats.scene) {
      body += "\nScene: " + window.stats.scene.name;
      body += "\nLine: " + (window.stats.scene.lineNum+1);
    }
    body += "\nUser Agent: " + navigator.userAgent;
    body += "\nLoad time: " + window.loadTime;
    if (window.Persist) body += "\nPersist: " + window.Persist.type;
    body += "\nversion=" + window.version;
    body += "\n\n" + statMsg;
    if (window.nav && window.nav.bugLog) body += "\n\n" + window.nav.bugLog.join("\n");
    console.log(body);
    if (ok) alertify.prompt("Please type your email address.", function(ok, email) {
      if (ok) xhrAuthRequest("POST", "support-mail", function(ok, response) {
        if (ok) {
          alertify.log("Thank you for reporting a bug!");
        } else {
          alertify.alert("Bug reporting failed. Please email your bug report to support@choiceofgames.com (and be sure to mention that the bug reporter failed!)");
        }
      }, "email", encodeURIComponent(email),
        "subject", encodeURIComponent("bug report " + window.storeName),
        "text", encodeURIComponent(body));
    });
  });
}

window.isWebOS = /webOS/.test(navigator.userAgent);
window.isMobile = isWebOS || /Mobile/.test(navigator.userAgent);
window.isFile = /^file:/.test(window.location.href);
window.isXul = /^chrome:/.test(window.location.href);
window.isWinOldApp = false;
try {
  isWinOldApp = window.external.IsWinOldApp();
} catch (ignored) {}
window.isWeb = !isWinOldApp && /^https?:/.test(window.location.href);
window.isAndroid = /Android/.test(navigator.userAgent);
window.isSecureWeb = /^https:?$/.test(window.location.protocol);
window.isSafari = /Safari/.test(navigator.userAgent);
window.isIE = /(MSIE|Trident)/.test(navigator.userAgent);
window.isIPad = /iPad/.test(navigator.userAgent);
window.isKindleFire = /Kindle Fire/.test(navigator.userAgent);
window.isWinStoreApp = "ms-appx:" == window.location.protocol;
window.isCef = !!window.cefQuery;

window.loadTime = new Date().getTime();
window.registered = false;

function getSupportEmail() {
  if (window.storeName) {
    return "support-" + storeName + "-" + platformCode() + "@choiceofgames.com";
  }
  try {
    return document.getElementById("supportEmail").getAttribute("href").substring(7);
  } catch (e) {
    return "support-external@choiceofgames.com";
  }
}

function absolutizeAboutLink() {
  var aboutAnchor = document.getElementById("aboutLink");
  if (aboutLink) {
    var aboutHref = aboutLink.getAttribute("href");
    if (/^https?:/.test(aboutHref)) return;

    var linkTags = document.getElementsByTagName("link");
    var canonical;
    for (var i = 0; i < linkTags.length; i++) {
      if (linkTags[i].getAttribute("rel") == "canonical") {
        canonical = linkTags[i].getAttribute("href");
        break;
      }
    }

    if (!canonical) return;

    var absoluteCanonical;
    if (/^https?:/.test(canonical)) {
      absoluteCanonical = canonical;
    } else if (/^\//.test(canonical)) {
      absoluteCanonical = "https://www.choiceofgames.com" + canonical;
    } else {
      absoluteCanonical = "https://www.choiceofgames.com/" + canonical;
    }
    if (!/\/$/.test(canonical)) {
      absoluteCanonical += "/";
    }

    aboutLink.setAttribute("href", absoluteCanonical + aboutHref);
  }
}

function aboutClick() {
    window.location.href = document.getElementById("aboutLink").href;
}

window.onerror=function(msg, file, line, stack) {
    if (window.console) {
      window.console.error(msg);
      if (file) window.console.error("file: " + file);
      if (line) window.console.error("line: " + line);
    }
    if (window.Event && msg instanceof window.Event && /WebKit/.test(navigator.userAgent)) {
      return; // ignore "adsense offline" error
    } else if (/(Error loading script|Script error)/.test(msg) && /(show_ads|google-analytics|version\.js)/.test(file)) {
      return; // ignore "adsense offline" error
    }
    alert(msg);
    if (!window.storeName) return;
    var ok = confirm("Sorry, an error occured.  Click OK to email error data to support.");
    if (ok) {
        var statMsg = "(unknown)";
        try {
            statMsg = toJson(window.stats, '\n');
        } catch (ex) {}
        var body = "What were you doing when the error occured?\n\nError: " + msg;
        if (window.stats && window.stats.scene && window.stats.scene.name) body += "\nScene: " + window.stats.scene.name;
        if (file) body += "\nFile: " + file;
        if (line) body += "\nLine: " + line;
        if (stack) body += "\nStack: " + stack;
        body += "\nUser Agent: " + navigator.userAgent;
        body += "\nLoad time: " + window.loadTime;
        if (window.Persist) body += "\nPersist: " + window.Persist.type;
        body += "\n\n" + statMsg + "\n\nversion=" + window.version;
        var supportEmailHref = "mailto:support-external@choiceofgames.com";
        try {
          supportEmailHref="mailto:"+getSupportEmail();
          supportEmailHref=supportEmailHref.replace(/\+/g,"%2B");
        } catch (e) {}
        window.location.href=(supportEmailHref + "?subject=Error Report&body=" + encodeURIComponent(body));
    }
};

window.onload=function() {
    if (window.alreadyLoaded) return;
    window.alreadyLoaded = true;
    window.main = document.getElementById("main");
    var head = document.getElementsByTagName("head")[0];
    window.nav.setStartingStatsClone(window.stats);
    if (window.achievements && window.achievements.length) {
      nav.loadAchievements(window.achievements);
      checkAchievements(function() {});
      setButtonTitles();
    }
    stats.sceneName = window.nav.getStartupScene();
    var map = parseQueryString(window.location.search);
    if (!map) {
      if (window.androidQueryString) {
        map = parseQueryString(window.androidQueryString);
      } else if (window.forcedScreenshots) {
        map = {forcedScene:"screenshots"};
      }
    }

    if (map) {
      window.forcedScene = map.forcedScene;
      window.slot = map.slot;
      window.debug = map.debug;
      if (map.restart) {
        restartGame();
      } else if (map.achievements) {
        doneLoading();
        showAchievements("hideNextButton");
      } else {
        safeCall(null, function() {loadAndRestoreGame(window.slot, window.forcedScene);});
      }
    } else {
      safeCall(null, loadAndRestoreGame);
    }
    if (window.Touch && window.isWeb) {
      // INSERT ADMOB AD
    }
    isRegistered(function(registered){
      if (registered) {
        fetchEmail(function(email) {
          loginDiv(registered, email);
        });
      } else {
        loginDiv();
      }
    });
    if (window.isWinStoreApp || window.isWinOldApp) {
        var subscribeAnchor = document.getElementById("subscribeLink");
        if (subscribeAnchor) {
            subscribeAnchor.onclick = function() {
              safeCall(null, subscribeLink);
              return false;
            };
        }
    }
    if (window.isCef) {
      var buttons = document.getElementById("buttons");
      buttons.appendChild(document.createTextNode(" "));
      var menuButton = document.createElement("button");
      menuButton.id = "menuButton";
      setClass(menuButton, "spacedLink");
      menuButton.onclick = showMenu;
      menuButton.innerHTML = "Menu";
      buttons.appendChild(menuButton);
    }
    if (window.isWinOldApp) {
        absolutizeAboutLink();
        var h1s = document.getElementsByTagName("h1");
        if (h1s.length) window.external.SetTitle(document.getElementsByTagName("h1")[0].innerText);
    }
    if (isFollowEnabled()) {
      var shareElement = document.getElementById("share");
      if (shareElement) shareElement.innerHTML = '<iframe src="//www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fchoiceofgames&amp;send=false'+
      '&amp;layout=button_count&amp;width=90&amp;show_faces=true&amp;font&amp;colorscheme=light&amp;action=like&amp;height=20&amp;appId=190439350983878"'+
      ' scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:90px; height:20px;" allowTransparency="true"></iframe>'+
      '<iframe allowtransparency="true" frameborder="0" scrolling="no" '+
      'src="//platform.twitter.com/widgets/follow_button.html?screen_name=choiceofgames&amp;show_screen_name=false"'+
      ' style="width:150px; height:20px;"></iframe>';
    }
    var supportEmailLink = document.getElementById("supportEmail");
    if (window.storeName && supportEmailLink) {
      supportEmailLink.href = "mailto:" + getSupportEmail();
    }

    submitAnyDirtySaves();
};

_global = this;

if ( document.addEventListener ) {
  document.addEventListener( "DOMContentLoaded", window.onload, false );
}

try {
  var style = document.createElement('style');
  style.type = 'text/css';
  try {style.innerHTML = 'noscript {display: none;}'; } catch (e) {}
  document.getElementsByTagName('head')[0].appendChild(style);
} catch (e) {}

if (window.isWeb) {
  document.write("<style>.webOnly { display: block !important; }</style>\n"+
    "<scr"+"ipt src='https://checkout.stripe.com/v2/checkout.js'></scr"+"ipt>");

  var metas = document.getElementsByTagName("meta");
  var facebookAppId, googleAppId;
  var googleLoginCallbackCallback;
  for (var i = 0; i < metas.length; i++) {
    var meta = metas[i];
    if ("fb:app_id" == meta.getAttribute("property")) {
      facebookAppId = meta.getAttribute("content");
      break;
    } else if ("google-signin-clientid" == meta.getAttribute("name")) {
      googleAppId = meta.getAttribute("content");
    }
  }

  if (facebookAppId) {
    window.fbAsyncInit = function() {
      FB.init({
        appId      : facebookAppId,
        cookie     : true,  // enable cookies to allow the server to access 
                            // the session
        xfbml      : true,  // parse social plugins on this page
        version    : 'v2.0' // use version 2.0
      });

      FB.getLoginStatus(function(response) {
        facebookStatusChangeCallback(response);
      });
    };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src ="//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document,'script','facebook-jssdk'));
  }

  if (googleAppId) (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/client:plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
  
}
if (!isWeb && window.isIosApp) {
  document.write("<style>"+
  "#header { display: none; }"+
  ""+
  "#emailUs { display: none; }"+
  ""+
  "#main { padding-top: 1em; }"+
  "</style>"+
  // Use UIWebView width, not screen width, on iPad
  "<meta name = 'viewport' content = 'width = "+window.innerWidth+"'>"
  );
  window.addEventListener("resize", function() {
      document.querySelector("meta[name=viewport]").setAttribute("content", "width="+window.innerWidth);
      // this dummy element seems to be required to get the viewport to stick
      var dummy = document.createElement("p");
      dummy.innerHTML = "&nbsp;";
      document.body.appendChild(dummy);
      window.setTimeout(function() {document.body.removeChild(dummy);}, 10);
    }, false);
} else if (window.isAndroidApp) {
  document.write("<style>"+
  "#header { display: none; }"+
  ""+
  "#emailUs { display: none; }"+
  ""+
  "#main { padding-top: 1em; }"+
  "</style>");
}
if (window.isWebOS) document.write("<style>body {font-family: Prelude; font-size: 14pt}\n#header {font-size: 13pt}</style>");
if (window.isMacApp || window.isWinOldApp || window.isCef || window.isAndroidApp) {
  document.write("<style>"+
    "#headerLinks { display: none; }"+
    ""+
    "#emailUs { display: none; }"+
    ""+
    "</style>");
}
if (isWeb && !window.Touch) {
  document.write("<style>label:hover {background-color: #E4DED8;}</style>");
}
if (window.isChromeApp) {
  var base = document.createElement('base');
  base.setAttribute("target", "_blank");
  document.head.appendChild(base);

  document.addEventListener( "DOMContentLoaded", function() {
    var aboutLink = document.getElementById("aboutLink");
    aboutLink.addEventListener("click", function() {
      if (chrome.app.window) {
        event.preventDefault();
        chrome.app.window.create("credits.html", {}, function(w) {
          w.contentWindow.addEventListener( "DOMContentLoaded", function() {
            var win = this;
            var back = win.document.getElementById("back");
            back.addEventListener("click", function(event) {
              event.preventDefault();
              win.close();
            }, false);
            var base = win.document.createElement('base');
            base.setAttribute("target", "_blank");
            win.document.head.appendChild(base);
            win.document.documentElement.style.overflowY = "scroll";
          }, false);
        });
      }
    }, false);

    var statsButton = document.getElementById("statsButton");
    if (statsButton) {
      statsButton.onclick = undefined;
      statsButton.addEventListener("click", function() {
        showStats();
      }, false);
    }

    var achievementsButton = document.getElementById("achievementsButton");
    if (achievementsButton) {
      achievementsButton.onclick = undefined;
      achievementsButton.addEventListener("click", function() {
        showAchievements();
      }, false);
    }

    var restartButton = document.getElementById("restartButton");
    restartButton.onclick = undefined;
    restartButton.addEventListener("click", function() {
      restartGame("prompt");
    }, false);

    var subscribeAnchor = document.getElementById("subscribeLink");
    subscribeAnchor.onclick = undefined;
    subscribeAnchor.addEventListener("click", function() {
      subscribeLink();
    }, false);

    var supportAnchor = document.getElementById("supportEmail");
    supportAnchor.addEventListener("click", function(event) {
      event.preventDefault();
    }, false);

  }, false );
}
if (window.isCef) {
  var pollPurchases = function() {
    cefQuery({
      request:"PollPurchases",
      onSuccess:function(response){
        //console.log("PollPurchases: '"+response+"'");
        if (response) {
          clearScreen(loadAndRestoreGame);
        }
        safeTimeout(pollPurchases, 100);
      },
      onFailure:function(error_code, error_message) {
        console.error("PollPurchases error: " + error_message);
      }
    });
  };
  pollPurchases();
}

function winStoreShareLinkHandler(e) {
    var request = e.request;
    var canonical = document.querySelector("link[rel=canonical]");
    var canonicalHref = canonical && canonical.getAttribute("href");
    if (!/^https?:/.test(canonicalHref)) {
        canonicalHref = "https://www.choiceofgames.com" + canonicalHref;
    }
    if (!/\/$/.test(canonicalHref)) {
        canonicalHref += "/";
    }
    canonicalHref += "redirect.php?src=winshare";
    request.data.properties.title = document.title;
    request.data.properties.description = document.querySelector("meta[name=description]").getAttribute("content");
    request.data.setUri(new Windows.Foundation.Uri(canonicalHref));
}

if (window.isWinStoreApp) {
    var dataTransferManager = Windows.ApplicationModel.DataTransfer.DataTransferManager.getForCurrentView();
    dataTransferManager.addEventListener("datarequested", winStoreShareLinkHandler);

    baseScript = document.createElement("script");
    baseScript.src = "//Microsoft.WinJS.1.0/js/base.js";
    baseScript.onload = function () {
        WinJS.Application.onsettings = function (e) {
            var privacyCmd = new Windows.UI.ApplicationSettings.SettingsCommand("privacy", "Privacy Policy", function () {
                window.open("https://www.choiceofgames.com/privacy-policy");
            });
            e.detail.e.request.applicationCommands.append(privacyCmd);
        };
        WinJS.Application.start();
    };
    document.head.appendChild(baseScript);

    uiScript = document.createElement("script");
    uiScript.src = "//Microsoft.WinJS.1.0/js/ui.js";
    document.head.appendChild(uiScript);
} else if (isWinOldApp) {
    console = {
        log: function (message) { window.external.ConsoleLog(message); },
        error: function (message) { window.external.ConsoleError(message); }
    };
    document.oncontextmenu = function() {return false;};
}

function platformCode() {
  if (window.isIosApp) return "ios";
  if (window.isAndroidApp) return "android";
  if (window.isMacApp) return "mac";
  if (window.isWinStoreApp) return "windows";
  if (window.isWinOldApp) return "csharp";
  if (window.isChromeApp) return "chrome";
  if (window.isWebOS) return "palm";
  if (window.isCef) return "cef";
  if (window.isWeb) return "web";
  return "unknown";
}

function googleLoginCallback(authResult) {
  var callback = googleLoginCallbackCallback;
  googleLoginCallbackCallback = null;
  if (!callback) callback = function(ok) { if (ok) clearScreen(loadAndRestoreGame); };
  if (authResult['status']['signed_in']) {
    isRegistered(function(registered) {
      if (!registered) xhrAuthRequest("POST", "google-login", function(ok, response){
        loginDiv(ok, response.email);
        recordLogin(ok, response.email);
        cacheKnownPurchases(response.purchases);
        callback("ok");
      }, "code", authResult['code'], "client_id", googleAppId);
    });
  } else {
    callback(!"ok");
  }
}
</script><script>/*
 * Copyright 2010 by Dan Fabulich.
 *
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 *
 * See the License for the specific language governing
 * permissions and limitations under the License.
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */
function Scene(name, stats, nav, options) {
    if (!name) name = "";
    if (!stats) stats = {};
    // the name of the scene
    this.name = name;

    // the permanent statistics and the temporary values
    this.stats = stats;
    this.temps = {choice_reuse:"allow", choice_user_restored:false};

    // the navigator determines which scene comes next
    this.nav = nav;

    options = options || {};

    // should we print debugging information?
    this.debugMode = options.debugMode || false;
    //this.debugMode = true;

    // used for stats screen, and maybe other secondary views someday
    this.secondaryMode = options.secondaryMode;

    this.saveSlot = options.saveSlot || "";

    // the array of lines in the scene file
    this.lines = [];

    // the current line number (WARNING 0-based!)
    this.lineNum = 0;
    this.rollbackLineCoverage();

    // when this is true, the main printLoop will halt
    this.finished = false;

    // map of label names to line numbers
    this.labels = {};

    // the current amount of indentation
    this.indent = 0;

    // Did the previous line contain text?
    this.prevLine = "empty";

    // Have we ever printed any text?
    this.screenEmpty = true;

    // Have we run any commands (except for create and scene_list) yet?
    this.initialCommands = true;

    this.stats.sceneName = name;

    // for easy reachability from the window
    this.stats.scene = this;

    // where should we print text?
    this.target = null;
}

Scene.prototype.reexecute = function reexecute() {
  this.lineNum = this.stats.testEntryPoint || 0;
  this.finished = 0;
  this.indent = this.getIndent(this.lines[this.lineNum]);
  this.prevLine = "empty";
  this.screenEmpty = true;
  this.execute();
};

// the main loop of the scene
Scene.prototype.printLoop = function printLoop() {
    var line;
    for (;!this.finished && this.lineNum < this.lines.length; this.lineNum++) {
        line = this.lines[this.lineNum];
        if (!trim(line)) {
            this.paragraph();
            continue;
        }
        var indent = this.getIndent(line);
        if (indent > this.indent) {
            // ignore indentation level of *comments
            if (/\s*\*comment\b/.test(line)) continue;
            throw new Error(this.lineMsg() + "increasing indent not allowed, expected " + this.indent + " was " + indent);
        } else if (indent < this.indent) {
            this.dedent(indent);
        }
        if (this.temps.fakeChoiceLines && this.temps.fakeChoiceLines[this.lineNum]) {
          this.rollbackLineCoverage();
          this.lineNum = this.temps.fakeChoiceEnd;
          this.rollbackLineCoverage();
          delete this.temps.fakeChoiceEnd;
          delete this.temps.fakeChoiceLines;
          continue;
        }
        this.indent = indent;
        if (!this.runCommand(line)) {
            if (/^\s*#/.test(line)) {
                if (this.temps.fakeChoiceEnd) {
                    this.rollbackLineCoverage();
                    this.lineNum = this.temps.fakeChoiceEnd;
                    this.rollbackLineCoverage();
                    delete this.temps.fakeChoiceEnd;
                    delete this.temps.fakeChoiceLines;
                    continue;
                } else {
                    throw new Error(this.lineMsg() + "It is illegal to fall out of a *choice statement; you must *goto or *finish before the end of the indented block.");
                }
            }
            this.prevLine = "text";
            this.screenEmpty = false;
            this.printLine(trim(line));
            printx(' ', this.target);
        }
    }
    this.rollbackLineCoverage();
    if (!this.finished) {
        this.autofinish();
    }
    this.save(null, "temp");
    if (this.skipFooter) {
        this.skipFooter = false;
    } else {
        printFooter();
    }
};

Scene.prototype.dedent = function dedent(newDent) {};

Scene.prototype.printLine = function printLine(line, parent) {
    if (!line) return null;
    line = this.replaceVariables(line);
    if (!parent) parent = this.target;
    return printx(line, parent);
};

Scene.prototype.replaceVariables = function (line) {
  if (!line.replace) line = String(line);
  var self = this;
  // replace ${variables} with values
  line = line.replace(/\$(\!?\!?)\{([a-zA-Z][_\w]*)\}/g, function (matched, capitalize, variable) {
    var value = self.getVar(variable);
    if (capitalize == "!") {
      value = ""+value;
      value = value.charAt(0).toUpperCase() + value.slice(1);
    } else if (capitalize == "!!") {
      value = (""+value).toUpperCase();
    }
    return value;
  });
  // double-check for unreplaced/invalid ${} expressions
  var unreplaced = line.search(/\$(\!?)\{/) + 1;
  if (unreplaced) {
    throw new Error(this.lineMsg() + "invalid ${} variable substitution at letter " + unreplaced);
  }
  return line;
};

Scene.prototype.paragraph = function paragraph() {
    if (this.prevLine == "text") {
        println("", this.target);
        println("", this.target);
    } else if (this.prevLine == "block") {
      println("", this.target);
    }
    this.prevLine = "empty";
};

Scene.prototype.loadSceneFast = function loadSceneFast(url) {
    if (this.loading) return;
    this.loading = true;
    var result;
    if (window.cachedResult) {
      result = window.cachedResult;
      window.cachedResult = null;
      return this.loadLinesFast(result.crc, result.lines, result.labels);
    } else if (typeof allScenes != "undefined") {
      result = allScenes[this.name];
      return this.loadLinesFast(result.crc, result.lines, result.labels);
	}
    startLoading();
    if (!url) {
        url = Scene.baseUrl + "/" + this.name.replace(/ /g, "_") + ".txt.json";
    }
    var xhr = findXhr();
    xhr.open("GET", url, true);
    var self = this;
    var done = false;
    xhr.onreadystatechange = function() {
        if (done) return;
        if (xhr.readyState != 4) return;
        if (xhr.status == 403) {
          try {
            var err = JSON.parse(xhr.responseText);
            if (err.error == "not registered") {
              return isRegistered(function(registered) {
                if (registered) {
                  logout();
                  loginDiv();
                }
                return clearScreen(function() {
                  loginForm(main, 0/*optional*/,
                    "Please sign in to access this part of the game.", function() {
                      clearScreen(loadAndRestoreGame);
                    });
                });
              });
            }
          } catch (e) {} // JSON parse failure? must not be a login prompt
        }
        if (window.isWeb && xhr.status != 200) {
          var status = xhr.status || "network";
          main.innerHTML = "<p>Our apologies; there was a " + status + " error while loading game data."+
          "  Please refresh your browser now; if that doesn't work, please click the Restart button and email "+getSupportEmail()+" with details.</p>"+
          " <p><button onclick='window.location.reload();'>Refresh Now</button></p>";
          return;
        } else if (!xhr.status && !xhr.responseText) {
          throw new Error("Couldn't load " + url);
        }
        done = true;
        var result = xhr.responseText;
        result = jsonParse(result);
        self.loadLinesFast(result.crc, result.lines, result.labels);
    };
    if (isIE) {
      // IE8 swallows errors in onreadystatechange if xhr.send is in a try block
      xhr.send(null);
    } else {
      try {
        xhr.send(null);
      } catch (e) {
        if (window.location.protocol == "file:" && !window.isMobile) {
          if (/Chrome/.test(navigator.userAgent)) {
            window.onerror("We're sorry, Google Chrome has blocked ChoiceScript from functioning.  (\"file:\" URLs cannot "+
            "load files in Chrome.)  ChoiceScript works just fine in Chrome, but only on a published website like "+
            "choiceofgames.com.  For the time being, please try another browser like Mozilla Firefox.");
            return;
          }
        }
        window.onerror("Couldn't load URL: " + url + "\n" + e);
      }
    }
};

Scene.prototype.loadLinesFast = function loadLinesFast(crc, lines, labels) {
  this.checkSum(crc);
  this.lines = lines;
  this.labels = labels;
  this.loading = false;
  this.loaded = true;
  var self = this;
  if (this.executing) {
    safeCall(this, function() {
      doneLoading();
      self.execute();
    });
  }
};

// load the scene file from the specified URL (or from default URL by name)
Scene.prototype.loadScene = function loadScene(url) {
    if (this.loading) return;
    this.loading = true;
    startLoading();
    if (!url) {
        url = Scene.baseUrl + "/" + this.name + ".txt";
    }
    var xhr = findXhr();
    xhr.open("GET", url, true);
    var self = this;
    var done = false;
    xhr.onreadystatechange = function() {
        if (done) return;
        if (xhr.readyState != 4) return;
        done = true;
        if (xhr.status == 403) {
          try {
            var err = JSON.parse(xhr.responseText);
            if (err.error == "not registered") {
              return isRegistered(function(registered) {
                if (registered) {
                  logout();
                  loginDiv();
                }
                return clearScreen(function() {
                  loginForm(main, 0/*optional*/,
                    "Please sign in to access this part of the game.", function() {
                      clearScreen(loadAndRestoreGame);
                    });
                });
              });
            }
          } catch (e) {} // JSON parse failure? must not be a login prompt
        }
        if (window.isWeb && xhr.status != 200) {
            var status = xhr.status || "network";
            main.innerHTML = "<p>Our apologies; there was a " + status + " error while loading game data."+
            "  Please refresh your browser now; if that doesn't work, please email "+getSupportEmail()+" with details.</p>"+
            " <p><button onclick='window.location.reload();'>Refresh Now</button></p>";
            return;
        } else if (!xhr.status && !xhr.responseText) {
          throw new Error("Couldn't load " + url);
        }
        var result = xhr.responseText;
        scene = result;
        scene = scene.replace(/\r/g, "");
        this.loading = false;
        self.loadLines(scene);
        if (self.executing) {
            safeCall(self, function () {
              doneLoading();
              self.execute();
            });
        }
    };
    if (isIE) {
      // IE8 swallows errors in onreadystatechange if xhr.send is in a try block
      xhr.send(null);
    } else {
      try {
        xhr.send(null);
      } catch (e) {
        if (window.location.protocol == "file:" && !window.isMobile) {
          if (/Chrome/.test(navigator.userAgent)) {
            window.onerror("We're sorry, Google Chrome has blocked ChoiceScript from functioning.  (\"file:\" URLs cannot "+
            "load files in Chrome.)  ChoiceScript works just fine in Chrome, but only on a published website like "+
            "choiceofgames.com.  For the time being, please try another browser like Mozilla Firefox.");
            return;
          }
        }
        window.onerror("Couldn't load URL: " + url + "\n" + e);
      }
    }
};

Scene.prototype.checkSum = function checkSum(crc) {
  if (this.temps.choice_crc) {
    if (this.temps.choice_crc != crc) {
      // The scene has changed; restart the scene
      var userRestored = this.temps.choice_user_restored || false;
      this.temps = {choice_reuse:"allow", choice_user_restored:userRestored, choice_crc: crc};
      this.lineNum = 0;
      this.indent = 0;
    }
  } else {
    this.temps.choice_crc = crc;
  }
};

Scene.prototype.loadLines = function loadLines(str) {
    var crc = crc32(str);
    this.checkSum(crc);
    this.lines = str.split('\n');
    this.parseLabels();
    this.loaded = true;
};

// launch the vignette as soon as it's available
Scene.prototype.execute = function execute() {
    if (!this.loaded) {
        this.executing = true;
        if (Scene.generatedFast || (typeof generatedFast != "undefined" && generatedFast) || typeof allScenes != 'undefined') {
          this.loadSceneFast();
        } else {
          this.loadScene();
        }
        return;
    }
    if (this.nav) this.nav.repairStats(stats);
    doneLoading();
    if (typeof this.targetLabel != "undefined") {
      var label = this.targetLabel.label.toLowerCase();
      if (typeof(this.labels[label]) != "undefined") {
          this.lineNum = this.labels[label];
          this.indent = this.getIndent(this.lines[this.lineNum]);
          delete this.targetLabel;
      } else {
          throw new Error(this.targetLabel.origin + " line " + (this.targetLabel.originLine+1) + ": "+this.name+" doesn't contain label " + label);
      }
    }
    this.printLoop();
};

// loop through the file looking for *label commands
Scene.prototype.parseLabels = function parseLabels() {
    var lineLength = this.lines.length;
    var oldLineNum = this.lineNum;
    for (this.lineNum = 0; this.lineNum < lineLength; this.lineNum++) {
        this.rollbackLineCoverage();
        var line = this.lines[this.lineNum];
        var result = /^(\s*)\*(\w+)(.*)/.exec(line);
        if (!result) continue;
        var indentation = result[1];
        var indent = indentation.length;
        var command = result[2].toLowerCase();
        var data = trim(result[3]);
        if ("label" == command) {
            data = data.toLowerCase();
            if (/\s/.test(data)) throw new Error(this.lineMsg() + "label '"+data+"' is not allowed to contain spaces");
            if (this.labels.hasOwnProperty(data)) {
              throw new Error(this.lineMsg() + "label '"+data+"' already defined on line " + (this.labels[data]*1+1));
            }
            this.labels[data] = this.lineNum;
        }
    }
    this.rollbackLineCoverage();
    this.lineNum = oldLineNum;
};

// if this is a command line, run it
Scene.prototype.runCommand = function runCommand(line) {
    var result = /^\s*\*(\w+)(.*)/.exec(line);
    if (!result) return false;
    var command = result[1].toLowerCase();
    var data = trim(result[2]);
    if (Scene.validCommands[command]) {
        if ("comment" == command) return true;
        if (Scene.initialCommands[command]) {
          if ("startup" != this.name || !this.initialCommands) {
            throw new Error(this.lineMsg() + "Invalid "+command+" instruction, only allowed at the top of startup.txt");
          }
        } else {
          this.initialCommands = false;
        }
        this[command](data);
    } else {
        throw new Error(this.lineMsg() + "Non-existent command '"+command+"'");
    }
    return true;
};

// *choice [group1] [group2] ...
// prompt the user with a multiple choice question.
// nested lines are options to be presented to the user
//
// Examples:
// *choice
//    good
//      Good choice
//      *finish
//    bad
//      Bad choice
//      *finish
//
// *choice toy
//    spaceship
//      Nice spaceship
//      *finish
//    train
//      Nice train
//      *finish
//    doll
//      Nice doll
//      *finish
//
// *choice color toy
//    red
//      spaceship
//        Nice red spaceship
//        *finish
//      train
//        Nice red train
//        *finish
//    blue
//       spaceship
//         Nice blue spaceship
//        *finish
//       train
//         Nice red train
//        *finish

// If a group is specified, generate a prompt message, e.g. "*choice toy" -> "Select a toy:"
// If no group is specified, don't generate a prompt message
// if multiple groups are specified, allow the user to make multiple choices simultaneously
//   all multi-dimensional choices must be valid (otherwise throw a parse error)
Scene.prototype.choice = function choice(data) {
    var startLineNum = this.lineNum;
    var groups = data.split(/ /);
    for (var i = 0; i < groups.length; i++) {
      if (!/^\w*$/.test(groups[i])) {
        throw new Error(this.lineMsg() + "invalid choice group name: " + groups[i]);
      }
    }
    var options = this.parseOptions(this.indent, groups);
    var self = this;
    this.renderOptions(groups, options, function(option) {
      self.standardResolution(option);
    });
    this.finished = true;
    if (this.fakeChoice) {
      this.temps.fakeChoiceEnd = this.lineNum;
      var fakeChoiceLines = {};
      for (i = 0; i < options.length; i++) {
        fakeChoiceLines[options[i].line-1] = 1;
      }
      this.temps.fakeChoiceLines = fakeChoiceLines;
    }
    this.lineNum = startLineNum;
};

Scene.prototype.fake_choice = function fake_choice(data) {
    this.fakeChoice = true;
    this.choice(data, true);
    delete this.fakeChoice;
};

Scene.prototype.standardResolution = function(option) {
  var self = this;
  self.lineNum = option.line;
  self.indent = self.getIndent(self.nextNonBlankLine(true/*includingThisOne*/));
  if (option.reuse && option.reuse != "allow") self.temps.choice_used[option.line-1] = 1;
  if (this.nav) this.nav.bugLog.push("#"+(option.line+1) + " " + option.name);

  self.finished = false;
  self.resetPage();
};

Scene.prototype.nextNonBlankLine = function nextNonBlankLine(includingThisOne) {
    var line;
    var i = this.lineNum;
    if (!includingThisOne) i++;
    while(isDefined(line = this.lines[i]) && !trim(line)) {
      i++;
    }
    return line;
};

// reset the page and invoke code after clearing the screen
Scene.prototype.resetPage = function resetPage() {
    var self = this;
    this.save(function() {
      self.prevLine = "empty";
      self.screenEmpty = true;
      clearScreen(function() {self.execute();});
    }, "");
};

/* The function needs some explaining.
We want the game to be "refreshable," e.g. on the web.
So we only make a "real" autosave as you click "Next"
But if we do it that way, when we visit the stat screen, it's out of date
So we make a "temp" autosave slot, right as the page finishes redrawing,
and the stat screen uses the "temp" autosave to display your current data.
When you refresh the page, the "temp" autosave is rewritten.

If you save stats on the stat screen, they're written into the "temp" autosave
In addition, setVar will mark a special choice_dirty_stats variable, to indicate
that there's something important in the "temp" autosave slot.

Back in the main game, we load the temp save slot when saving the either the
main autosave slot or the temp save slot.

If the main game is about to rewrite the temp
slot, but the temp slot has dirty stats (written by the stat screen), then
we must be returning from the stats screen, so skip saving temp.
Otherwise, save the temp slot normally.

If the main game is about to write the main slot, clear the old temp slot,
and save the temp stats as the "real" autosave slot.

Thus, stat changes on the stat screen will only be permanently saved when
the player clicks "Next" in the main game, ensuring that the game is still
refreshable.
*/
Scene.prototype.save = function save(callback, slot) {
    if (!slot) slot = this.saveSlot;
    var self = this;
    if (this.saveSlot) {
      saveCookie(callback, slot, self.stats, self.temps, self.lineNum, self.indent, self.debugMode, self.nav);
    } else {
      loadTempStats(this.stats, function(stats) {
        if (slot == "temp") {
          if (stats.choice_dirty_stats) {
            safeTimeout(callback, 0);
          } else {
            saveCookie(callback, "temp", self.stats, self.temps, self.lineNum, self.indent, self.debugMode, self.nav);
          }
        } else {
          clearTemp();
          delete stats.choice_dirty_stats;
          stats.sceneName = self.name;
          stats.scene = self;
          self.stats = stats;
          if (typeof window != "undefined") window.stats = stats;
          saveCookie(callback, slot, stats, self.temps, self.lineNum, self.indent, self.debugMode, self.nav);
        }
      });
    }
};

// *goto labelName
// Go to the line labeled with the label command *label labelName
Scene.prototype["goto"] = function scene_goto(label) {
    label = label.toLowerCase();
    if (typeof(this.labels[label]) != "undefined") {
        this.lineNum = this.labels[label];
        this.indent = this.getIndent(this.lines[this.lineNum]);
    } else {
        throw new Error(this.lineMsg() + "bad label " + label);
    }
};

Scene.prototype.gosub = function scene_gosub(label) {
    if (!this.temps.choice_substack) {
      this.temps.choice_substack = [];
    }
    this.temps.choice_substack.push({lineNum: this.lineNum, indent: this.indent});
    this["goto"](label);
};

Scene.prototype.gosub_scene = function scene_gosub_scene(data) {
    if (!this.stats.choice_subscene_stack) {
      this.stats.choice_subscene_stack = [];
    }
    this.stats.choice_subscene_stack.push({name:this.name, lineNum: this.lineNum + 1, indent: this.indent, temps: this.temps});
    this.goto_scene(data);
};

Scene.prototype["return"] = function scene_return() {
    var stackFrame;
    if (this.temps.choice_substack && this.temps.choice_substack.length) {
      stackFrame = this.temps.choice_substack.pop();
      this.lineNum = stackFrame.lineNum;
      this.indent = stackFrame.indent;
    } else if (this.stats.choice_subscene_stack && this.stats.choice_subscene_stack.length) {
      stackFrame = this.stats.choice_subscene_stack.pop();
      this.finished = true;
      this.skipFooter = true;
      var scene = new Scene(stackFrame.name, this.stats, this.nav, {debugMode:this.debugMode, secondaryMode:this.secondaryMode});
      scene.temps = stackFrame.temps;
      scene.screenEmpty = this.screenEmpty;
      scene.prevLine = this.prevLine;
      scene.lineNum = stackFrame.lineNum;
      scene.indent = stackFrame.indent;
      scene.execute();
    } else if (!this.temps.choice_substack && !this.stats.choice_subscene_stack) {
      throw new Error(this.lineMsg() + "invalid return; gosub has not yet been called");
    } else {
      throw new Error(this.lineMsg() + "invalid return; we've already returned from the last gosub");
    }
    
};

// *gotoref expression
// Go to the label identified by the expression
//
// *temp foo
// *set foo "bar"
// *gotoref foo
// Skipped!
// *label bar
Scene.prototype["gotoref"] = function scene_gotoref(expression) {
    var stack = this.tokenizeExpr(expression);
    var value = this.evaluateExpr(stack);
    this["goto"](value);
};


// *finish
// halt the scene
Scene.prototype.finish = function finish(buttonName) {
    this.paragraph();
    this.finished = true;
    var self = this;
    if (this.secondaryMode == "stats") {
      if (typeof window == "undefined") return;
      if (window.forcedScene == "choicescript_stats") return;
      if (window.isAndroidApp && window.statsMode.get()) return;
      printButton(buttonName || "Next", main, false,
        function() {
          clearScreen(loadAndRestoreGame);
        }
      );
      return;
    }
    var nextSceneName = this.nav && nav.nextSceneName(this.name);
    // if there are no more scenes, then just halt
    if (!nextSceneName) {
        if (!this.secondaryMode) this.ending();
        return;
    }
    if (this.screenEmpty) {
      this.goto_scene(nextSceneName);
      return;
    }
    if (!buttonName) buttonName = "Next Chapter";
    buttonName = this.replaceVariables(buttonName);


    printButton(buttonName, main, false,
      function() {
        safeCall(self, function() {
            var scene = new Scene(nextSceneName, self.stats, self.nav, {debugMode:self.debugMode, secondaryMode:self.secondaryMode});
            scene.resetPage();
        });
      }
    );
    if (this.debugMode) {
    	println(toJson(this.stats));
    	//alert(this.stats);
    	//alert(scene.testPath);
    }
};

Scene.prototype.autofinish = function autofinish(buttonName) {
  this.finish(buttonName);
};

// *reset
// clear all stats
Scene.prototype.reset = function reset() {
    this.nav.resetStats(this.stats);
    this.stats.scene = this;
};

// *goto_scene foo
//
Scene.prototype.goto_scene = function gotoScene(data) {
    var args = trim(data).split(/ /);
    var sceneName, label;
    if (args.length == 1) {
      sceneName = data;
    } else {
      sceneName = args[0];
      label = args[1];
    }
    this.finished = true;
    this.skipFooter = true;
    var scene = new Scene(sceneName, this.stats, this.nav, {debugMode:this.debugMode, secondaryMode:this.secondaryMode});
    scene.screenEmpty = this.screenEmpty;
    scene.prevLine = this.prevLine;
    if (typeof label != "undefined") scene.targetLabel = {label:label, origin:this.name, originLine:this.lineNum};
    scene.execute();
};

// *redirect_scene foo
Scene.prototype.redirect_scene = function redirectScene(data) {
  if (this.secondaryMode != "stats") throw new Error(this.lineMsg() + "The *redirect_scene command can only be used from the stats screen.");
  var args = trim(data).split(/ /);
  var sceneName, label;
  if (args.length == 1) {
    sceneName = data;
  } else {
    sceneName = args[0];
    label = args[1];
  }
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  redirectFromStats(sceneName, label, this.lineNum, function() {
    delete self.secondaryMode;
    self.goto_scene(data);
  });
};

Scene.prototype.restore_purchases = function scene_restorePurchases(data) {
  var self = this;
  var target = this.target;
  if (!target) target = document.getElementById('text');
  var button = printButton("Restore Purchases", target, false,
    function() {
      safeCall(self, function() {
          restorePurchases(function() {
            self["goto"](data);
            self.finished = false;
            self.resetPage();
          });
      });
    }
  );

  setClass(button, "");
  this.prevLine = "block";
};

Scene.prototype.check_purchase = function scene_checkPurchase(data) {
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  checkPurchase(data, function(ok, result) {
    self.finished = false;
    self.skipFooter = false;
    if (!ok) {
      result = {billingSupported:true};
      self.temps.choice_purchase_error = true;
    }
    result = result || {};
    var products = data.split(/ /);
    var everything = true;
    for (var i = 0; i < products.length; i++) {
      var purchasedProduct = result[products[i]] || false;
      self.temps["choice_purchased_"+products[i]] = purchasedProduct;
      if (!purchasedProduct) everything = false;
    }
    self.temps.choice_purchased_everything = everything;
    self.temps.choice_purchase_supported = !!result.billingSupported;
    self.execute();
  });
};

Scene.prototype.purchase = function purchase_button(data) {
  var result = /^(\w+)\s+(\S+)\s+(.*)/.exec(data);
  if (!result) throw new Error(this.lineMsg() + "invalid line; can't parse purchaseable product: " + data);
  var product = result[1];
  var priceGuess = trim(result[2]);
  var label = trim(result[3]);
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  getPrice(product, function (price) {
    if (!price || "free" == price) {
      self["goto"](label);
      self.finished = false;
      self.resetPage();
    } else {
      if (price == "guess") price = priceGuess;
      var target = self.target;
      if (!target) target = document.getElementById('text');
      self.paragraph();
      var button = printButton("Buy It Now for " + price, target, false,
        function() {
          safeCall(self, function() {
              purchase(product, function() {
                safeCall(self, function() {
                  self["goto"](label);
                  self.finished = false;
                  self.resetPage();
                });
              });
          });
        }
      );
      self.prevLine = "block";
      if (isRestorePurchasesSupported()) {
        self.prevLine = "text";
        printLink(target, "#", "Restore Purchases",
          function() {
            safeCall(self, function() {
                restorePurchases(function(error) {
                  checkPurchase([product], function(ok, purchases) {
                    if (purchases[product]) {
                      self["goto"](label);
                      self.finished = false;
                      self.resetPage();
                    } else {
                      if (error) {
                        asyncAlert("Restore failed. Please try again.");
                      } else {
                        asyncAlert("Restore completed. This product is not yet purchased.");
                      }
                      // refresh, in case we're on web showing a full-screen login. Not necessary on mobile? But, meh.
                      if (!self.secondaryMode) clearScreen(loadAndRestoreGame);
                    }
                  });
                });
            });
          }
        );
      }
      
      self.skipFooter = false;
      self.finished = false;
      self.execute();
    }
  });
};

// *abort
// halt the scene without showing a button
Scene.prototype.abort = function() {
  this.paragraph();
  this.finished = true;
};

// *create
// create a new permanent stat
Scene.prototype.create = function create(line) {
    var result = /^(\w*)(.*)/.exec(line);
    if (!result) throw new Error(this.lineMsg()+"Invalid create instruction, no variable specified: " + line);
    var variable = result[1];
    this.validateVariable(variable);
    variable = variable.toLowerCase();
    var expr = result[2];
    var stack = this.tokenizeExpr(expr);
    if (stack.length === 0) throw new Error(this.lineMsg()+"Invalid create instruction, no value specified: " + line);
    var self = this;
    function complexError() {
      throw new Error(self.lineMsg()+"Invalid create instruction, value must be a a number, true/false, or a quoted string: " + line);
    }
    if (stack.length > 1) complexError();
    var token = stack[0];
    if (!/STRING|NUMBER|VAR/.test(token.name)) complexError();
    if ("VAR" == token.name && !/^true|false$/i.test(token.value)) complexError();
    if ("STRING" == token.name && /\$!?!?{/.test(token.value)) throw new Error(this.lineMsg() + "Invalid create instruction, value must be a simple string without ${}: " + line);
    var value = this.evaluateExpr(stack);
    this.stats[variable] = value;
    if (this.nav) this.nav.startingStats[variable] = value;
};

// *temp
// create a temporary stat for the current scene
Scene.prototype.temp = function temp(line) {
    var result = /^(\w*)(.*)/.exec(line);
    if (!result) throw new Error(this.lineMsg()+"Invalid temp instruction, no variable specified: " + line);
    var variable = result[1];
    this.validateVariable(variable);
    var expr = result[2];
    var stack = this.tokenizeExpr(expr);
    if (stack.length === 0) {
      this.temps[variable.toLowerCase()] = null;
      return;
    }
    var value = this.evaluateExpr(stack);
    this.temps[variable.toLowerCase()] = value;
};

// retrieve the value of the variable, preferring temp scope
Scene.prototype.getVar = function getVar(variable) {
    var value;
    variable = String(variable).toLowerCase();
    if (variable == "true") return true;
    if (variable == "false") return false;
    if (variable == "choice_subscribe_allowed") return true;
    if (variable == "choice_register_allowed") return isRegisterAllowed();
    if (variable == "choice_registered") return typeof window != "undefined" && !!window.registered;
    if (variable == "choice_is_web") return typeof window != "undefined" && !!window.isWeb;
    if (variable == "choice_is_advertising_supported") return typeof isAdvertisingSupported != "undefined" && !!isAdvertisingSupported();
    if (variable == "choice_is_trial") return !!(typeof isTrial != "undefined" && isTrial);
    if (variable == "choice_kindle") return false;
    if (variable == "choice_randomtest") return !!this.randomtest;
    if (variable == "choice_restore_purchases_allowed") return isRestorePurchasesSupported();
    if (variable == "choice_save_allowed") return areSaveSlotsSupported();
    if (variable == "choice_time_stamp") return Math.floor(new Date()/1000);
    if ("undefined" === typeof this.temps[variable]) {
        if ("undefined" === typeof this.stats[variable]) {
            throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
        }
        value = this.stats[variable];
        if (value === null || value === undefined) {
            throw new Error(this.lineMsg() + "Variable '"+variable+"' exists but has no value");
        }
        if (this.debugMode) println("stats["+ variable + "]==" + value);
        return value;
    }
    value = this.temps[variable];
    if (value === null || value === undefined) {
        throw new Error(this.lineMsg() + "Variable '"+variable+"' exists but has no value");
    }
    if (this.debugMode) println("temps["+ variable + "]==" + value);
    return value;
};

// set the value of the variable, preferring temp scope
Scene.prototype.setVar = function setVar(variable, value) {
    variable = variable.toLowerCase();
    if (this.debugMode) println(variable +"="+ value);
    if ("undefined" === typeof this.temps[variable]) {
        if ("undefined" === typeof this.stats[variable]) {
            throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
        }
        this.stats[variable] = value;
        if (this.saveSlot == "temp") this.stats.choice_dirty_stats = true;
    } else {
        this.temps[variable] = value;
    }
};

// *delete variable
// deletes the named variable
Scene.prototype["delete"] = function scene_delete(variable) {
    variable = variable.toLowerCase();
    if ("undefined" === typeof this.temps[variable]) {
        if ("undefined" === typeof this.stats[variable]) {
            throw new Error(this.lineMsg() + "Non-existent variable '"+variable+"'");
        }
        delete this.stats[variable];
    } else {
        delete this.temps[variable];
    }
};

// during a choice, recursively parse the options
Scene.prototype.parseOptions = function parseOptions(startIndent, choicesRemaining, expectedSubOptions) {
    // nextIndent: the level of indentation after the current line
    // For example, in the color/toy sample above, we start at 0
    // then the nextIndent is 2 for "red"
    // then the nextIndent is 4 for "spaceship"
    var nextIndent = null;
    var options = [];
    var line;
    var currentChoice = choicesRemaining[0];
    if (!currentChoice) currentChoice = "choice";
    var suboptionsEncountered = false;
    var bodyExpected = false;
    var previousSubOptions;
    var namesEncountered = {};
    var atLeastOneSelectableOption = false;
    var prevOption, ifResult;
    var startingLine = this.lineNum;
    function removeModifierCommand() {
      line = trim(line.replace(/^\s*\*(\w+)(.*)/, "$2"));
      parsed = /^\s*\*(\w+)(.*)/.exec(line);
      if (parsed) {
        command = parsed[1].toLowerCase();
        data = trim(parsed[2]);
      } else {
        command = "";
      }
    }
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent <= startIndent) {
                throw new Error(this.lineMsg() + "invalid indent, expected at least one '" + currentChoice + "'");
            }
            this.indent = nextIndent = indent;
        }
        if (indent <= startIndent) {
            // it's over!
            // TODO is this error test valid?
            if (choicesRemaining.length>1 && !suboptionsEncountered) {
                throw new Error(this.lineMsg() + "invalid indent, there were subchoices remaining: [" + choicesRemaining.join(",") + "]");
            }
            if (bodyExpected && !this.fakeChoice) {
                throw new Error(this.lineMsg() + "Expected choice body");
            }
            if (!atLeastOneSelectableOption) this.conflictingOptions("line " + (startingLine+1) + ": No selectable options");
            if (expectedSubOptions) {
                this.verifyOptionsMatch(expectedSubOptions, options);
            }
            this.rollbackLineCoverage();
            prevOption = options[options.length-1];
            if (!prevOption.endLine) prevOption.endLine = this.lineNum;
            this.lineNum--;
            this.rollbackLineCoverage();
            return options;
        }
        if (indent < this.indent) {
            // TODO drift detection
            if (false) /*(indent != nextIndent)*/ {
                // error: indentation has decreased, but not all the way back
                // Example:
                // *choice
                //     red
                //   blue
                throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
            }

            // we must be falling out of a sub-block
            this.dedent(indent);
            this.indent = indent;
        }
        if (indent > this.indent) {
            // body of the choice
            // ...unless we haven't identified our choices yet
            // TODO is this error test valid?
            if (choicesRemaining.length>1) throw new Error(this.lineMsg() + "invalid indent, there were subchoices remaining: [" + choicesRemaining.join(",") + "]");
            this.rollbackLineCoverage();
            bodyExpected = false;
            continue;
        }

        // here's the end of the previous option
        if (options.length) {
          prevOption = options[options.length-1];
          if (!prevOption.endLine) prevOption.endLine = this.lineNum;
        }

        // Execute *if commands (etc.) during option loop
        // sub-commands may modify this.indent
        var parsed = /^\s*\*(\w+)(.*)/.exec(line);
        var unselectable = false;
        var inlineIf = null;
        var selectableIf = null;
        var self = this;

        var overrideDefaultReuseSetting = false;
        var reuse = this.temps.choice_reuse;
        if (parsed) {
            var command = parsed[1].toLowerCase();
            var data = trim(parsed[2]);
            // TODO whitelist commands
            if ("hide_reuse" == command) {
              reuse = "hide";
              overrideDefaultReuseSetting = true;
              removeModifierCommand();
            }
            if ("disable_reuse" == command) {
              reuse = "disable";
              overrideDefaultReuseSetting = true;
              removeModifierCommand();
            }
            if ("allow_reuse" == command) {
              reuse = "allow";
              overrideDefaultReuseSetting = true;
              removeModifierCommand();
            }

            if ("print" == command) {
                line = this.evaluateExpr(this.tokenizeExpr(data));
            } else if ("if" == command) {
              ifResult = this.parseOptionIf(data, command);
              if (ifResult) {
                inlineIf = ifResult.condition;
                if (ifResult.result) {
                  line = ifResult.line;
                } else {
                  continue;
                }
              } else {
                this["if"](data, true /*inChoice*/);
                continue;
              }
            } else if (/^(else|elseif|elsif)$/.test(command)) {
              this[command](data, true /*inChoice*/);
              continue;
            } else if ("selectable_if" == command) {
              ifResult = this.parseOptionIf(data, command);
              if (!ifResult) throw new Error(this.lineMsg() + "Couldn't parse the line after *selectable_if: " + data);
              line = ifResult.line;
              selectableIf = ifResult.condition;
              unselectable = unselectable || !ifResult.result;
            } else if ("comment" == command) {
                continue;
            } else if (!command) {
              // command was rewritten by earlier modifier
            } else {
                if (Scene.validCommands[command]) {
                  throw new Error(this.lineMsg() + "Invalid indent? Expected an #option here, not *"+command);
                }  else {
                    throw new Error(this.lineMsg() + "Non-existent command '"+command+"'");
                }
            }
        }

        if ("allow" != reuse) {
          if (!this.temps.choice_used) this.temps.choice_used = {};
          if (this.temps.choice_used[this.lineNum]) {
            if ("hide" == reuse) continue;
            unselectable = true;
          }
        }

        // this line should be a valid option
        if (!/^\s*\#\s*\S/.test(line)) {
            throw new Error(this.lineMsg() + "Expected option starting with #");
        }
        // replace variables here and discard the result, so error messages display the correct line
        this.replaceVariables(line);
        line = trim(trim(line).substring(1));
        var option = {name:line, group:currentChoice};
        if (reuse != "allow") option.reuse = reuse;
        if (this.displayOptionConditions) {
          option.displayIf = [];
          for (var i = 0; i < this.displayOptionConditions.length; i++) {
            option.displayIf[i] = this.displayOptionConditions[i];
          }
          if (inlineIf) option.displayIf.push(inlineIf);
        } else if (inlineIf) {
          option.displayIf = [inlineIf];
        }
        if (selectableIf) {
          option.selectableIf = selectableIf;
        }
        option.line = this.lineNum + 1;
        if (unselectable) {
          option.unselectable = true;
        }
        if (namesEncountered[line]) {
            this.conflictingOptions(this.lineMsg() + "Invalid option; conflicts with option '"+option.name+"' on line " + namesEncountered[line]);
        } else {
            namesEncountered[line] = option.line;
        }
        options.push(option);
        if (choicesRemaining.length>1) {
            // recursive call will modify this.indent
            option.suboptions = this.parseOptions(this.indent, choicesRemaining.slice(1), previousSubOptions);
            // now restore it
            this.indent = nextIndent;
            if (!previousSubOptions) previousSubOptions = option.suboptions;
            suboptionsEncountered = true;
        } else {
            bodyExpected = true;
        }
        if (!unselectable) atLeastOneSelectableOption = true;
    }
    if (bodyExpected && !this.fakeChoice) {
        throw new Error(this.lineMsg() + "Expected choice body");
    }
    prevOption = options[options.length-1];
    if (!prevOption.endLine) prevOption.endLine = this.lineNum;
    if (!atLeastOneSelectableOption) this.conflictingOptions("line " + (startingLine+1) + ": No selectable options");
    return options;
};

// compute *if statement during options
Scene.prototype.parseOptionIf = function parseOptionIf(data) {
  var parsed = /^\s*\((.*)\)\s+(#.*)/.exec(data);
  if (!parsed) {
    return;
  }
  var condition = parsed[1];
  var stack = this.tokenizeExpr(condition);
  var result = this.evaluateExpr(stack);
  if (this.debugMode) println(condition + " :: " + result);
  result = bool(result, this.lineNum+1);
  // In the autotester, all conditionals are enabled
  result = result || this.testPath;
  return {result:result, line:parsed[2], condition:null};
};

// Add this as a separate method so we can override it elsewhere
// We want this error during randomtest but not during autotest
// Because autotest makes impossible situations happen
Scene.prototype.conflictingOptions = function conflictingOptions(str) {
  throw new Error(str);
};

// verify that the current option set corresponds to the previous option set
// (for multichoices)
Scene.prototype.verifyOptionsMatch = function verifyOptionsMatch(prev, current) {
    // find matching option by name
    function findMatch(name, options) {
        for (var i = 0; i < options.length; i++) {
            var option = options[i];
            if (option && name == option.name) {
                return option;
            }
        }
        return null;
    }

    var prevOpt, curOpt;
    for (var i = 0; i < prev.length; i++) {
        prevOpt = prev[i];
        curOpt = findMatch(prevOpt.name, current);
        if (!curOpt) throw new Error(this.lineMsg()+"Missing expected suboption '"+prevOpt.name+"'; all suboptions must have same option list");
    }

    if (prev.length == current.length) return;

    for (i = 0; i < current.length; i++) {
        curOpt = current[i];
        prevOpt = findMatch(curOpt.name, prev);
        if (!prevOpt) throw new Error(this.lineMsg()+"Added unexpected suboption '"+curOpt.name+"'; all suboptions must have same option list");
    }

    throw new Error(this.lineMsg()+"Bug? previous options and current options mismatch, but no particular missing element");
};

// render the prompt and the radio buttons
Scene.prototype.renderOptions = function renderOptions(groups, options, callback) {
    for (var i = 0; i < options.length; i++) {
      var option = options[i];
      option.name = this.replaceVariables(option.name);
    }
    this.paragraph();
    printOptions(groups, options, callback);

    if (this.debugMode) {
    	println(toJson(this.stats));
    	//alert(toJson(this.stats));
    }

    if (this.finished) printFooter();
};

// *page_break
// pause and prompt the user to press "Next"
Scene.prototype.page_break = function page_break(buttonName) {
    if (this.screenEmpty) return;
    if (!buttonName) buttonName = "Next";
    buttonName = this.replaceVariables(buttonName);
    this.paragraph();
    this.finished = true;

    var self = this;
    printButton(buttonName, main, false,
      function() {
        self.finished = false;
        self.resetPage();
      }
    );
    if (this.debugMode) println(toJson(this.stats));
};

// *line_break
// single line break in the middle of a paragraph
Scene.prototype.line_break = function line_break() {
    println("", this.target);
};

// *image
// display named image
Scene.prototype.image = function image(data) {
    data = data || "";
    var args = data.split(" ");
    if (args > 2) throw new Error(this.lineMsg()+"Too many words; expected filename and alignment: " + data);
    var source = args[0];
    var alignment = args[1];
    alignment = alignment || "center";
    if (!/(right|left|center|none)/.test(alignment)) throw new Error(this.lineMsg()+"Invalid alignment, expected right, left, center, or none: " + data);
    printImage(source, alignment);
    if (this.verifyImage) this.verifyImage(source);
};

// *sound
// play named sound file
Scene.prototype.sound = function sound(source) {
    if (typeof playSound == "function") playSound(source);
    if (this.verifyImage) this.verifyImage(source);
};

// *link
// Display URL with anchor text
Scene.prototype.link = function link(data) {
    var result = /^(\S+)\s*(.*)/.exec(data);
    if (!result) throw new Error(this.lineMsg() + "invalid line; this line should have an URL: " + data);
    var href = result[1];
    var anchorText = trim(result[2]) || href;
    printLink(this.target, href, anchorText);
    this.prevLine = "text";
    this.screenEmpty = false;
};

// *link_button
// Display button that takes you to an URL
Scene.prototype.link_button = function linkButton(data) {
    if (typeof window == "undefined") return;
    var result = /^(\S+)\s*(.*)/.exec(data);
    if (!result) throw new Error(this.lineMsg() + "invalid line; this line should have an URL: " + data);
    var href = result[1];
    var anchorText = trim(result[2]) || href;
    var target = this.target;
    if (!target) target = document.getElementById('text');
    printButton(anchorText, target, false, function() {
      window.location.href = href;
    });
    this.prevLine = "empty";
    this.screenEmpty = false;
};

// how many spaces is this line indented?
Scene.prototype.getIndent = function getIndent(line) {
    if (line === null || line === undefined) return 0;
    var spaces = line.match(/^([ \t]*)/);
    if (spaces === null || spaces === undefined) return 0;
    var whitespace = spaces[0];
    var len = whitespace.length;
    if (0 === len) return 0;
    var tab = /\t/.test(whitespace);
    var space = / /.test(whitespace);
    if (tab && space) {
        throw new Error(this.lineMsg()+"Tabs and spaces appear on the same line");
    }
    if (tab) {
        this.firstTab = this.lineNum+1;
        if (this.firstSpace) {
            throw new Error(this.lineMsg()+"Illegal mixing of spaces and tabs; this line has a tab, but there were spaces on line " + this.firstSpace);
        }
    } else {
        this.firstSpace = this.lineNum + 1;
        if (this.firstTab) {
            throw new Error(this.lineMsg()+"Illegal mixing of spaces and tabs; this line has a space, but there were tabs on line " + this.firstTab);
        }
    }
    return len;
};

// *comment ignorable text
Scene.prototype.comment = function comment(line) {
    if (this.debugMode) println("*comment " + line);
};

Scene.prototype.advertisement = function advertisement() {
  if (typeof isFullScreenAdvertisingSupported != "undefined" && isFullScreenAdvertisingSupported()) {
    this.finished = true;
    this.skipFooter = true;

    var self = this;
    showFullScreenAdvertisement(function() {
      self.finished = false;
      self.skipFooter = false;
      self.resetPage();
    });
  }

};

// *looplimit 5
// The number of times a given line is allowed to be accessed
Scene.prototype.looplimit = function looplimit() {}; // TODO looplimit

Scene.prototype.hide_reuse = function hide_reuse() {
  this.temps.choice_reuse = "hide";
};

Scene.prototype.disable_reuse = function disable_reuse() {
  this.temps.choice_reuse = "disable";
};

Scene.prototype.allow_reuse = function allow_reuse() {
  this.temps.choice_reuse = "allow";
};

// *label labelName
// Labels a line for use later in *goto
// Do nothing here; these labels are parsed in this.parseLabel
Scene.prototype.label = function label() {};

// *print expr
// print the value of the specified expression
Scene.prototype.print = function scene_print(expr) {
    var value = this.evaluateExpr(this.tokenizeExpr(expr));
    this.prevLine = "text";
    this.screenEmpty = false;
    this.printLine(value);
    printx(' ', this.target);
};

// *input_text var
// record text typed by the user and store it in the specified variable
Scene.prototype.input_text = function input_text(variable) {
    var inputType = "text";
    var longMatch = /^\S+(\s+long)/.exec(variable);
    if (longMatch) {
      variable = variable.substring(0, variable.length-longMatch[1].length);
      inputType = "textarea";
    }
    this.validateVariable(variable);
    this.finished = true;
    this.paragraph();
    var self = this;
    printInput(this.target, inputType, function(value) {
      safeCall(self, function() {
        value = ""+value || "";
        value = value.replace(/\n/g, "[n/]");
        if (self.nav) self.nav.bugLog.push("*input_text " + variable + " " + value);
        self.finished = false;
        self.save(function() {
          self.setVar(variable, value);
          self.resetPage();
        }, "");
      });
    });
    if (this.debugMode) println(toJson(this.stats));
};

// *input_number var min max
// record number typed by the user and store it in the specified variable
Scene.prototype.input_number = function input_number(data) {
    var args = data.split(/ /);
    if (args.length != 3) {
        throw new Error(this.lineMsg() + "Invalid input_number statement, expected three args: varname min max");
    }
    var variable, minimum, maximum;
    variable = args[0];
    this.validateVariable(variable);
    minimum = this.evaluateValueExpr(args[1]);
    if (isNaN(minimum*1)) throw new Error(this.lineMsg() + "Invalid minimum, not numeric: " + minimum);
    maximum = this.evaluateValueExpr(args[2]);
    if (isNaN(maximum*1)) throw new Error(this.lineMsg() + "Invalid maximum, not numeric: " + maximum);

    if (parseFloat(minimum) > parseFloat(maximum)) throw new Error(this.lineMsg() + "Minimum " + minimum+ " should not be greater than maximum " + maximum);

    function isInt(x) {
       var y=parseInt(x,10);
       if (isNaN(y)) return false;
       return x==y && x.toString()==y.toString();
    }
    var intRequired;
    if (isInt(minimum) && isInt(maximum)) {
      intRequired = 1;
    }
    this.finished = true;
    this.paragraph();
    var self = this;
    printInput(this.target, "number", function(value) {
      safeCall(self, function() {
        var numValue = parseFloat(""+value);
        if (isNaN(numValue)) {
          asyncAlert("Please type in a number.");
          return;
        }
        if (intRequired && !isInt(value)) {
          asyncAlert("Please type in an integer number.");
          return;
        }
        if (numValue < minimum * 1) {
          asyncAlert("Please use a number greater than or equal to " + minimum);
          return;
        }
        if (numValue > maximum * 1) {
          asyncAlert("Please use a number less than or equal to " + maximum);
          return;
        }
        if (self.nav) self.nav.bugLog.push("*input_number " + variable + " " + value);
        self.finished = false;
        self.save(function() {
          self.setVar(variable, numValue);
          self.resetPage();
        }, "");
      });
    }, minimum, maximum, intRequired);
    if (this.debugMode) println(toJson(this.stats));
};

// *script code
// evaluate the specified ECMAScript
Scene.prototype.script = function script(code) {
    var stats = this.stats;
    var temps = this.temps;
    if (typeof window == "undefined") {
      (function() {
        var window = _global;
        eval(code);
      }).call(this);
    } else {
      eval(code);
    }
};

// is this a valid variable name?
Scene.prototype.validateVariable = function validateVariable(variable) {
    if (!variable || !/^[a-zA-Z]/.test(variable)) {
        throw new Error(this.lineMsg()+"Invalid variable name, must start with a letter: " + variable);
    }
    if (!/^\w+$/.test(variable)) {
        throw new Error(this.lineMsg()+"Invalid variable name: '" + variable + "'");
    }
    if (/^(and|or|true|false)$/.test(variable)) throw new Error(this.lineMsg()+"Invalid variable name, '" + variable + "' is a reserved word");
    if (/^choice_/.test(variable)) throw new Error(this.lineMsg()+"Invalid variable name, variables may not start with 'choice_'; this is a reserved prefix");
};

// *rand varname min max
// Set varname to a random number from min to max
//
// Example:
// *rand foo 1 6
//   roll a cube die
// *rand foo 1.0 6.0
//   compute a decimal from [1.0,6.0)
Scene.prototype.rand = function rand(data) {
    // TODO make this parser more general
    var args = data.split(/ /);
    if (args.length != 3) {
        throw new Error(this.lineMsg() + "Invalid rand statement, expected three args: varname min max");
    }
    var variable, minimum, maximum, diff;
    variable = args[0];
    this.validateVariable(variable);
    minimum = this.evaluateValueExpr(args[1]);
    maximum = this.evaluateValueExpr(args[2]);
    diff = maximum - minimum;
    if (isNaN(diff)) {
        throw new Error(this.lineMsg() + "Invalid rand statement, min and max must be numbers");
    }
    if (diff < 0) {
        throw new Error(this.lineMsg() + "Invalid rand statement, min must be less than max: " + minimum + " > " + maximum);
    }
    if (diff === 0) {
      this.setVar(variable, minimum);
      return;
    }
    function isInt(x) {
       var y=parseInt(x,10);
       if (isNaN(y)) return false;
       return x==y && x.toString()==y.toString();
    }
    var result;
    var random = Math.random();
    if (isInt(minimum) && isInt(maximum)) {
        // int random
        result = 1*minimum + Math.floor(random*(diff+1));
    } else {
        result = 1*minimum + random*diff;
    }
    this.setVar(variable, result);
    if (this.randomLog) {
      this.randomLog("*rand " + variable + " " + result);
    }
    if (this.nav) this.nav.bugLog.push("*rand " + variable + " " + result);
};

// *set varname expr
// sets the specified varname to the value of the expr
//
// Examples:
//
// literal
//     literal int: 2
//     literal decimal: 2.3
//     boolean value: true
//     quoted string: "fie"
//         with backslash escaping "she said it was \"ironic\"!"  "c:\\foo"
//     variable name: foo
//
// math
//     +: 2+2
//     -: foo-3
//     *: 2*3
//     /: 8/2
//     if one operand is a string, we'll try to parse it as a number, fail if that doesn't work
//
// fairmath
//     %+: foo%+30
//     %-: foo%-20
//
// concatenate
//     &: "foo"&bar
//
// may omit leading operand
//     *set foo +2
//     *set foo %+30
//     *set foo &"blah blah"
//
// spaces optional
//     *set foo+2
//     *set foo bar + 2
//     *set bar% +30
//
// multiple operators in one line, parentheses mandatory
//     *set foo (foo+2)/4
//     *set foo 2+(foo/2)
//     *set foo (foo/2)+(bar/3)
//     *set foo +(bar/3)
//
Scene.prototype.set = function set(line) {
    var result = /^(\w*)(.*)/.exec(line);
    if (!result) throw new Error(this.lineMsg()+"Invalid set instruction, no variable specified: " + line);
    var variable = result[1];
    this.validateVariable(variable);
    var expr = result[2];
    var stack = this.tokenizeExpr(expr);
    if (stack.length === 0) throw new Error(this.lineMsg()+"Invalid set instruction, no expression specified: " + line);
    // if the first token is an operator, then it's implicitly based on the variable
    if (/OPERATOR|FAIRMATH/.test(stack[0].name)) stack.unshift({name:"VAR", value:variable, pos:"(implicit)"});
    var value = this.evaluateExpr(stack);
    this.setVar(variable, value);
};

// *setref variableExpr expr
// just like *set, but variableExpr is a string expression naming a variable reference
//
// Example:
// *set foo "bar"
// *setref foo 3
// *comment now bar=3
Scene.prototype.setref = function setref(line) {
    var stack = this.tokenizeExpr(line);
    var reference = this.evaluateValueToken(stack.shift(), stack);
    var referenceExpressionString;
    try {
        referenceExpressionString = trim(line.substring(0, stack[0].pos - stack[0].value.length));
    } catch (e) {}

    try {
      this.validateVariable(reference);
    } catch (e) {
      if (typeof referenceExpressionString !== undefined) {
        throw new Error(this.lineMsg()+
          "The expression ("+referenceExpressionString+") was \""+reference+"\", which is invalid:\n" + e.message);
      }
    }
    // if the first token is an operator, then it's implicitly based on the variable
    if (/OPERATOR|FAIRMATH/.test(stack[0].name)) stack.unshift({name:"VAR", value:reference, pos:"(implicit)"});
    var value = this.evaluateExpr(stack);
    this.setVar(reference, value);
};

Scene.prototype.share_this_game = function share_links(now) {
  now = !!trim(now);
  this.paragraph();
  printShareLinks(this.target, now);
  this.prevLine = "empty"; // printShareLinks provides its own paragraph break
};

Scene.prototype.more_games = function more_games(now) {
  if (typeof window == "undefined" || typeof moreGames == "undefined") return;
  if (!!trim(now)) {
    moreGames();
    return;
  }
  var self = this;
  var target = this.target;
  if (!target) target = document.getElementById('text');
  var button = printButton("Play More Games Like This", target, false,
    function() {
      safeCall(self, moreGames);
    }
  );

  setClass(button, "");
  this.prevLine = "block";
};

Scene.prototype.ending = function ending() {
    if (typeof window == "undefined") return;
    this.paragraph();
    var groups = [""];
    options = [];
    options.push({name:"Play again.", group:"choice", restart:true});
    options.push({name:"Play more games like this.", group:"choice", moreGames:true});
    options.push({name:"Share this game with friends.", group:"choice", share:true});
    options.push({name:"Email me when new games are available.", group:"choice", subscribe:true});

    var self = this;
    function endingMenu() {
      printFollowButtons();
      self.renderOptions([""], options, function(option) {
        if (option.restart) {
          self.restart();
          return;
        } else if (option.moreGames) {
          self.more_games("now");
          if (typeof curl != "undefined") curl();
        } else if (option.share) {
          clearScreen(function() {
            self.share_this_game("now");
            endingMenu();
          });
        } else if (option.subscribe) {
          subscribeLink();
        }
      });
    }
    endingMenu();
    this.finished = true;
};

Scene.prototype.restart = function restart() {
  if (this.secondaryMode) throw new Error(this.lineMsg() + "Cannot *restart in " + this.secondaryMode + " mode");
  this.finished = true;
  this.reset();
  delayBreakEnd();
  var startupScene = this.nav.getStartupScene();
  var scene = new Scene(startupScene, this.stats, this.nav, {debugMode:this.debugMode, secondaryMode:false});
  scene.resetPage();
};

Scene.prototype.subscribe = function scene_subscribe(now) {
  // "now" means we should immediately display the signup form
  // otherwise, we should display a Subscribe button which displays the form
  // On some platforms, "now" is impossible, so we ignore it.
  now = ("now" == now);
  this.prevLine = "block";
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  subscribe(this.target, now, function(now) {
    self.finished = false;
    // if "now" actually worked, then continue the scene
    // otherwise, reset the page before continuing
    if (now) {
      self.skipFooter = false;
      self.execute();
    } else {
      self.resetPage();
    }
  });
};

Scene.prototype.restore_game = function restore_game() {
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  var unrestorableScenes = this.parseRestoreGame(false/*alreadyFinished*/);
  function renderRestoreMenu(saveList, dirtySaveList) {
    self.paragraph();
    var options = [];
    for (var i = 0; i < saveList.length; i++) {
      var save = saveList[i];
      var date = new Date(save.timestamp*1);
      if (!save) continue;
      var name = "";
      if (save.temps && save.temps.choice_restore_name) name = save.temps.choice_restore_name;
      options.push({name:name + " ("+simpleDateTimeFormat(date)+")", group:"choice", state:save});
    }
    if (false) options.push({name:"Restore using a password.", group:"choice", password:true});
    options.push({name:"Retrieve saved games online from choiceofgames.com.", group:"choice", fetch:true});
    if (dirtySaveList.length) options.push({name:"Upload saved games to choiceofgames.com.", group:"choice", upload:true});
    options.push({name:"Cancel.", group:"choice", cancel:true});
    var groups = [""];
    self.renderOptions(groups, options, function(option) {
      if (option.upload) {
        clearScreen(function() {
          fetchEmail(function(defaultEmail){
            self.printLine("Please type your email address to identify yourself.");
            promptEmailAddress(this.target, defaultEmail, function(cancel, email) {
              if (cancel) {
                self.finished = false;
                self.resetPage();
                return;
              }
              clearScreen(function() {
                startLoading();
                submitDirtySaves(dirtySaveList, email, function(ok) {
                  doneLoading();
                  self.prevLine = "text"; // Put some space between the message and the option list
                  if (!ok) {
                    self.printLine("Error uploading saves. Please try again later.");
                    renderRestoreMenu(saveList, dirtySaveList);
                  } else {
                    var count = dirtySaveList.length + (dirtySaveList.length == 1 ? " save" : " saves");
                    self.printLine("Uploaded " + count + ".");
                    renderRestoreMenu(saveList, []);
                  }
                });
              });
            });
          });
        });
      } else if (option.fetch) {
        clearScreen(function() {
          fetchEmail(function(defaultEmail){
            self.printLine("Please type your email address to identify yourself.");
            promptEmailAddress(this.target, defaultEmail, function(cancel, email) {
              if (cancel) {
                self.finished = false;
                self.resetPage();
                return;
              }
              clearScreen(function() {
                startLoading();
                getRemoteSaves(email, function (remoteSaveList) {
                  doneLoading();
                  self.prevLine = "text";
                  if (!remoteSaveList) {
                    self.printLine("Error downloading saves. Please try again later.");
                    renderRestoreMenu(saveList, dirtySaveList);
                  } else {
                    mergeRemoteSaves(remoteSaveList, "recordDirty", function(saveList, newRemoteSaves, dirtySaveList) {
                      if (!remoteSaveList.length) {
                        self.printLine("No saves downloaded for email address \""+email+"\". (Is that the correct email address?) If you're having trouble, please contact support at "+getSupportEmail()+".");
                        renderRestoreMenu(saveList, dirtySaveList);
                      } else {
                        var downloadCount = remoteSaveList.length + " saved " + (remoteSaveList.length == 1 ? "game" : "games");
                        var newCount = newRemoteSaves + " new saved " + (newRemoteSaves == 1 ? "game" : "games");
                        self.printLine("Synchronized " + downloadCount + ". Downloaded " + newCount + ".");
                        renderRestoreMenu(saveList, dirtySaveList);
                      }
                    });
                  }
                });
              });
            });
          });
        });
      } else if (option.password) {
        clearScreen(function() {
          self.restore_password();
        });
      } else {
        if (option.cancel) {
          self.finished = false;
          self.resetPage();
        } else {
          var state = option.state;
          var sceneName = null;
          if (state.stats && state.stats.sceneName) sceneName = (""+state.stats.sceneName).toLowerCase();
          var unrestorable = unrestorableScenes[sceneName];

          if (unrestorable) {
            asyncAlert(unrestorable);
            self.finished = false;
            self.resetPage();
            return;
          }

          saveCookie(function() {
            clearScreen(function() {
              restoreGame(state, null, /*userRestored*/true);
            });
          }, "", state.stats, state.temps, state.lineNum, state.indent, this.debugMode, this.nav);
        }
      }
    });
  }
  getDirtySaveList(function(dirtySaveList) {
    getSaves(function(saveList) {
      renderRestoreMenu(saveList, dirtySaveList);
    });
  });
};

Scene.prototype.restore_password = function restore_password() {
  var alreadyFinished = this.finished;
  this.finished = true;
  this.paragraph();
  this.printLine('Please paste your password here, then press "Next" below to continue.');
  this.prevLine = "text";
  this.paragraph();
  var self = this;
  var unrestorableScenes = this.parseRestoreGame(alreadyFinished);
  getPassword(this.target, function (cancel, password) {
    if (cancel) {
      self.finished = false;
      self.resetPage();
      return;
    }
    password = password.replace(/\s/g, "");
    password = password.replace(/^.*BEGINPASSWORD-----/, "");
    var token = self.deobfuscatePassword(password);
    token = token.replace(/^[^\{]*/, "");
    token = token.replace(/[^\}]*$/, "");
    var state;
    try {
      state = jsonParse(token);
    } catch (e) {
      asyncAlert("Sorry, that password was invalid. Please contact " + getSupportEmail() + " for assistance. Be sure to include your password in the email.");
      return;
    }

    var sceneName = null;
    if (state.stats && state.stats.sceneName) sceneName = (""+state.stats.sceneName).toLowerCase();

    var unrestorable = unrestorableScenes[sceneName];
    if (unrestorable) {
      asyncAlert(unrestorable);
      self.finished = false;
      self.resetPage();
      return;
    }

    saveCookie(function() {
      clearScreen(function() {
        // we're going to pretend not to be user restored, so we get reprompted to save
        restoreGame(state, null, /*userRestored*/false);
      });
    }, "", state.stats, state.temps, state.lineNum, state.indent, this.debugMode, this.nav);
  });
  if (alreadyFinished) printFooter();
};

Scene.prototype.parseRestoreGame = function parseRestoreGame(alreadyFinished) {
    if (alreadyFinished) {
      // if we're already finished, the printLoop bumped us an extra line ahead
      this.lineNum--;
      this.rollbackLineCoverage();
    }
    // nextIndent: the level of indentation after the current line
    var nextIndent = null;
    var unrestorableScenes = {};
    var line;
    var startIndent = this.indent;
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent > startIndent) {
                this.indent = nextIndent = indent;
            }
        }
        if (indent <= startIndent) {
            // it's over!
            if (!alreadyFinished) {
              this.lineNum--;
              this.rollbackLineCoverage();
            }
            return unrestorableScenes;
        }
        if (indent != this.indent) {
            // all chart rows are supposed to be at the same indentation level
            // anything at the wrong indentation level might be a mis-indented title/definition
            // or just a typo
            throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
        }

        //
        // *restore_game
        //   ending You can't restore to the ending.

        line = trim(line);
        var result = /^(\w+)\s+(.*)/.exec(line);
        if (!result) throw new Error(this.lineMsg() + "invalid line; this line should have a scene name followed by an error message: " + line);
        var sceneName = result[1].toLowerCase();
        var error = trim(result[2]);
        unrestorableScenes[sceneName] = error;
    }
    if (!alreadyFinished) {
      this.lineNum--;
      this.rollbackLineCoverage();
    }
    return unrestorableScenes;
};

Scene.prototype.check_registration = function scene_checkRegistration() {
  if (typeof window == "undefined" || typeof isRegistered == "undefined") return;
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  isRegistered(function() {
    self.finished = false;
    self.skipFooter = false;
    self.execute();
  });
};

Scene.prototype.login = function scene_login(optional) {
  if (typeof window == "undefined" || typeof loginForm == "undefined") return;
  optional = trim(optional);
  if (optional) {
    if (optional != "optional") throw new Error(this.lineMsg() + "invalid *login option: " + optional);
    optional = 1;
  }
  var self = this;
  this.finished = true;
  this.skipFooter = true;
  this.paragraph();
  var target = this.target;
  if (!target) target = document.getElementById('text');
  loginForm(target, optional, null, function() {
    clearScreen(function() {
      self.finished = false;
      self.prevLine = "empty";
      self.screenEmpty = true;
      self.execute();
    });
  });
};

Scene.prototype.save_game = function save_game(destinationSceneName) {
  if (!destinationSceneName) throw new Error(this.lineMsg()+"*save_game requires a destination file name, e.g. *save_game Episode2");
  if (this.temps.choice_user_restored) return;
  var self = this;
  this.finished = true;
  this.skipFooter = true;
  fetchEmail(function(defaultEmail){
    self.paragraph();
    var form = document.createElement("form");
    setClass(form, "saveGame");

    form.action="#";

    var message = document.createElement("div");
    message.style.color = "red";
    message.style.fontWeight = "bold";
    form.appendChild(message);

    var saveName = document.createElement("input");
    saveName.type="text";
    saveName.name="saveName";
    saveName.setAttribute("placeholder", "Type a name for your saved game");
    saveName.setAttribute("style", "font-size: 25px; width: 90%;");
    form.appendChild(saveName);

    if (_global.automaticCloudStorage) {
      println("", form);
    } else {
      println("", form);
      println("", form);
      println("Please login to the choiceofgames.com save system with your email address below.", form);

      var emailInput = document.createElement("input");
      // This can fail on IE
      try { emailInput.type="email"; } catch (e) {}
      emailInput.name="email";
      emailInput.value=defaultEmail;
      emailInput.setAttribute("placeholder", "you@example.com");
      emailInput.setAttribute("style", "font-size: 25px; width: 90%;");
      form.appendChild(emailInput);

      println("", form);
      println("", form);

      var subscribeLabel = document.createElement("label");
      subscribeLabel.setAttribute("for", "subscribeBox");
      var subscribeBox = document.createElement("input");
      subscribeBox.type = "checkbox";
      subscribeBox.name = "subscribe";
      subscribeBox.setAttribute("id", "subscribeBox");
      subscribeBox.setAttribute("checked", true);
      subscribeLabel.appendChild(subscribeBox);
      subscribeLabel.appendChild(document.createTextNode("Email me when new games are available."));
      form.appendChild(subscribeLabel);
    }

    println("", form);
    var target = this.target;
    if (!target) target = document.getElementById('text');
    target.appendChild(form);
    printButton("Next", form, true);

    printButton("Cancel", target, false, function() {
      clearScreen(function() {
        self.finished = false;
        self.prevLine = "empty";
        self.screenEmpty = true;
        self.execute();
      });
    });

    form.onsubmit = function(e) {
      preventDefault(e);
      safeCall(this, function() {
        var messageText;
        if (!trim(saveName.value)) {
          messageText = document.createTextNode("Please type a name for your saved game.");
          message.innerHTML = "";
          message.appendChild(messageText);
          return;
        }

        var slot = "save" + new Date().getTime();
        // create a clone stats object whose scene name is the destination scene
        var saveStats = {};
        for (var stat in self.stats) {
          if ("scene" == stat) continue;
          saveStats[stat] = self.stats[stat];
        }
        saveStats.scene = {name:destinationSceneName};

        if (_global.automaticCloudStorage) {
          clearScreen(function() {
            saveCookie(function() {
              recordSave(slot, function() {
                self.finished = false;
                self.prevLine = "empty";
                self.screenEmpty = true;
                self.execute();
              });
            }, slot, saveStats, {choice_reuse:"allow", choice_user_restored:true, choice_restore_name:saveName.value}, 0, 0, false, self.nav);
          });
          return;
        }

        var shouldSubscribe = subscribeBox.checked;
        var email = trim(emailInput.value);
        if (!/^\S+@\S+\.\S+$/.test(email)) {
          messageText = document.createTextNode("Sorry, \""+email+"\" is not an email address.  Please type your email address again.");
          message.innerHTML = "";
          message.appendChild(messageText);
          return;
        }
        
        recordEmail(email, function() {
          clearScreen(function() {
            saveCookie(function() {
              recordSave(slot, function() {
                startLoading();
                submitRemoteSave(slot, email, shouldSubscribe, function(ok) {
                  doneLoading();
                  if (!ok) {
                    asyncAlert("Couldn't upload your saved game to choiceofgames.com. You can try again later from the Restore menu.", function() {
                      self.finished = false;
                      self.prevLine = "empty";
                      self.screenEmpty = true;
                      self.execute();
                    });
                  } else {
                    self.finished = false;
                    self.prevLine = "empty";
                    self.screenEmpty = true;
                    self.execute();
                  }
                });
              });
            }, slot, saveStats, {choice_reuse:"allow", choice_user_restored:true, choice_restore_name:saveName.value}, 0, 0, false, self.nav);
          });
        });
      });
    };

    printFooter();
  });
};

Scene.prototype.show_password = function show_password() {
  if (this.temps.choice_user_restored) return;
  this.paragraph();
  if (typeof(window) != "undefined" && !window.isMobile) {
    this.printLine('Please copy and paste the password in a safe place, then press "Next" below to continue.');
    println("", this.target);
    println("", this.target);
  }
  var password = computeCookie(this.stats, this.temps, this.lineNum, this.indent);
  password = this.obfuscate(password);
  showPassword(this.target, password);
  this.prevLine = "block";
};

Scene.prototype.obfuscate = function obfuscate(password) {
  var self = this;
  return password.replace(/./g,
    function(x) {
      var y = self.obfuscator[x];
      return y;
    }
  );
};

// The obfuscator must take US-ASCII and obfuscate it
// for use in a password.  This password will be sent via
// HTML email and its whitespace handling will be unpredictable,
// So we can't output any of these characters: [ <>&]
// Since we're losing four characters of output, we JSON-escape
// four characters of input [^`|~].
Scene.prototype.obfuscator = {
  " ": "k",
  "!": "E",
  "\"": "`",
  "#": "\\",
  "$": "r",
  "%": "J",
  "&": "o",
  "'": "0",
  "(": "Z",
  ")": "M",
  "*": "G",
  "+": "t",
  ",": "Y",
  "-": "f",
  ".": "2",
  "/": "!",
  "0": "i",
  "1": "*",
  "2": "1",
  "3": "3",
  "4": "[",
  "5": "6",
  "6": "v",
  "7": "\"",
  "8": "F",
  "9": "9",
  ":": "{",
  ";": "Q",
  "<": "?",
  "=": "5",
  ">": "#",
  "?": "K",
  "@": "/",
  "A": "=",
  "B": "N",
  "C": "z",
  "D": "$",
  "E": "W",
  "F": "(",
  "G": ")",
  "H": "q",
  "I": "C",
  "J": "+",
  "K": "U",
  "L": ".",
  "M": "H",
  "N": "B",
  "O": "S",
  "P": "X",
  "Q": "I",
  "R": "-",
  "S": "m",
  "T": "D",
  "U": "^",
  "V": "A",
  "W": "a",
  "X": "y",
  "Y": ",",
  "Z": "d",
  "[": "O",
  "\\": "s",
  "]": "8",
  "^": "sVii6h",
  "_": "]",
  "`": "sViivi",
  "a": "4",
  "b": "g",
  "c": "%",
  "d": "w",
  "e": "h",
  "f": "n",
  "g": "b",
  "h": "7",
  "i": "x",
  "j": "~",
  "k": "_",
  "l": "l",
  "m": ":",
  "n": "c",
  "o": "L",
  "p": "j",
  "q": "u",
  "r": "R",
  "s": "}",
  "t": "p",
  "u": "V",
  "v": "P",
  "w": "'",
  "x": "T",
  "y": "|",
  "z": "@",
  "{": "e",
  "|": "sVii\"%",
  "}": ";",
  "~": "sVii\"h"
};
Scene.prototype.deobfuscator = {
  "k": " ",
  "E": "!",
  "`": "\"",
  "\\": "#",
  "r": "$",
  "J": "%",
  "o": "&",
  "0": "'",
  "Z": "(",
  "M": ")",
  "G": "*",
  "t": "+",
  "Y": ",",
  "f": "-",
  "2": ".",
  "!": "/",
  "i": "0",
  "*": "1",
  "1": "2",
  "3": "3",
  "[": "4",
  "6": "5",
  "v": "6",
  "\"": "7",
  "F": "8",
  "9": "9",
  "{": ":",
  "Q": ";",
  "?": "<",
  "5": "=",
  "#": ">",
  "K": "?",
  "/": "@",
  "=": "A",
  "N": "B",
  "z": "C",
  "$": "D",
  "W": "E",
  "(": "F",
  ")": "G",
  "q": "H",
  "C": "I",
  "+": "J",
  "U": "K",
  ".": "L",
  "H": "M",
  "B": "N",
  "S": "O",
  "X": "P",
  "I": "Q",
  "-": "R",
  "m": "S",
  "D": "T",
  "^": "U",
  "A": "V",
  "a": "W",
  "y": "X",
  ",": "Y",
  "d": "Z",
  "O": "[",
  "s": "\\",
  "8": "]",
  "]": "_",
  "4": "a",
  "g": "b",
  "%": "c",
  "w": "d",
  "h": "e",
  "n": "f",
  "b": "g",
  "7": "h",
  "x": "i",
  "~": "j",
  "_": "k",
  "l": "l",
  ":": "m",
  "c": "n",
  "L": "o",
  "j": "p",
  "u": "q",
  "R": "r",
  "}": "s",
  "p": "t",
  "V": "u",
  "P": "v",
  "'": "w",
  "T": "x",
  "|": "y",
  "@": "z",
  "e": "{",
  ";": "}"
};

Scene.prototype.deobfuscatePassword = function deobfuscatePassword(password) {
  var self = this;
  password = password.replace(/./g,
    function(x) {
      var y = self.deobfuscator[x];
      return y;
    }
  );
  return password;
};

Scene.prototype.stat_chart = function stat_chart() {
  var rows = this.parseStatChart();
  var target = this.target;
  if (!target) target = document.getElementById('text');

  if (this.prevLine == "text") println("", target);

  var barWidth = 0;
  var standardFontSize = 0;

  function fixFontSize(span1, span2) {
    if (!standardFontSize) {
      if (window.getComputedStyle) {
        standardFontSize = parseInt(getComputedStyle(document.body).fontSize, 10);
      } else if (document.body.currentStyle) {
        standardFontSize = parseInt(document.body.currentStyle.fontSize, 10);
      } else {
        standardFontSize = 16;
      }
    }
    if (!barWidth) barWidth = span1.parentNode.offsetWidth;
    var spanMaxWidth, biggestSpanWidth;
    if (span2) {
      spanMaxWidth = barWidth / 2 - 1; /* minus one as a fudge factor; why is this needed? */
      biggestSpanWidth = Math.max(span1.offsetWidth, span2.offsetWidth);
    } else {
      spanMaxWidth = barWidth;
      biggestSpanWidth = span1.offsetWidth;
    }

    if (biggestSpanWidth > spanMaxWidth) {
      span1.parentNode.style.fontSize = Math.floor(standardFontSize * spanMaxWidth / biggestSpanWidth) + "px";
    }

  }

  for (i = 0; i < rows.length; i++) {
    var row = rows[i];
    var type = row.type;
    var variable = row.variable;
    var value = this.getVar(variable);
    var label = this.replaceVariables(row.label);
    var definition = this.replaceVariables(row.definition || "");

    var statWidth, div, span, statValue;
    if (type == "text") {
      div = document.createElement("div");
      setClass(div, "statLine");
      span = document.createElement("span");
      if (trim(label) || trim(value)) {
        printx("\u00a0\u00a0"+label + ": " + value, span);
      } else {
        // unofficial line_break
        printx(" ", span);
      }
      div.appendChild(span);
      target.appendChild(div);
    } else if (type == "percent") {
      div = document.createElement("div");
      setClass(div, "statBar statLine");
      span = document.createElement("span");
      printx("\u00a0\u00a0"+label+": "+value+"%", span);
      div.appendChild(span);
      statValue = document.createElement("div");
      setClass(statValue, "statValue");
      statValue.style.width = value+"%";
      statValue.innerHTML = "&nbsp;";
      div.appendChild(statValue);
      target.appendChild(div);
      fixFontSize(span);
    } else if (type == "opposed_pair") {
      div = document.createElement("div");
      setClass(div, "statBar statLine opposed");
      span0 = document.createElement("span");
      printx("\u00a0\u00a0"+label+": "+value+"% ", span0);
      div.appendChild(span0);
      span = document.createElement("span");
      span.setAttribute("style", "float: right");
      printx(row.opposed_label+": "+(100-value)+"%\u00a0\u00a0", span);
      div.appendChild(span);
      statValue = document.createElement("div");
      setClass(statValue, "statValue");
      statValue.style.width = value+"%";
      statValue.innerHTML = "&nbsp;";
      div.appendChild(statValue);
      target.appendChild(div);
      fixFontSize(span0, span);
    } else {
      throw new Error("Bug! Parser accepted an unknown row type: " + type);
    }
  }
  this.prevLine = "block";
  this.screenEmpty = false;
};

Scene.prototype.parseStatChart = function parseStatChart() {
    // nextIndent: the level of indentation after the current line
    var nextIndent = null;
    var rows = [];
    var line, line1, line2, line2indent;
    var startIndent = this.indent;
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent <= startIndent) {
                throw new Error(this.lineMsg() + "invalid indent, expected at least one row");
            }
            this.indent = nextIndent = indent;
        }
        if (indent <= startIndent) {
            // it's over!
            this.rollbackLineCoverage();
            this.lineNum--;
            this.rollbackLineCoverage();
            return rows;
        }
        if (indent != this.indent) {
            // all chart rows are supposed to be at the same indentation level
            // anything at the wrong indentation level might be a mis-indented title/definition
            // or just a typo
            throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
        }

        //
        // *stat_chart
        //   text wounds Wounds
        //     Definition
        //   percent Infamy Infamy
        //     Definition
        //   opposed_pair brutality
        //     Brutality
        //       Strength and cruelty
        //     Finesse
        //       Precision and aerial maneuverability
        //

        // TODO opposed_pair
        // TODO definitions
        // TODO variable substitutions
        // TODO *if/*else
        // TODO *line_break
        line = trim(line);
        var result = /^(text|percent|opposed_pair)\s+(.*)/.exec(line);
        if (!result) throw new Error(this.lineMsg() + "invalid line; this line should start with 'percent', 'text', or 'opposed_pair'");
        var type = result[1].toLowerCase();
        var data = trim(result[2]);
        if ("opposed_pair" == type) {
          this.getVar(data);
          line1 = this.lines[++this.lineNum];
          this.replaceVariables(line1);
          line1indent = this.getIndent(line1);
          if (line1indent <= this.indent) throw new Error(this.lineMsg() + "invalid indent; expected at least one indented line to indicate opposed pair name. indent: " + line1indent + ", expected greater than " + this.indent);
          line2 = this.lines[this.lineNum + 1];
          line2indent = this.getIndent(line2);
          if (line2indent <= this.indent) {
            // line1 was the only line
            rows.push({type: type, variable: data, label: data, opposed_label: trim(line1)});
          } else {
            this.lineNum++;
            this.replaceVariables(line2);
            if (line2indent == line1indent) {
              // two lines: first label, second label
              rows.push({type: type, variable: data, label: trim(line1), opposed_label: trim(line2)});
            } else if (line2indent > line1indent) {
              // line 2 is a definition; therefore the opposed_label and its definition must be on lines 3 and 4
              var line1definition = line2;
              var line3 = this.lines[++this.lineNum];
              this.replaceVariables(line3);
              var line3indent = this.getIndent(line3);
              if (line3indent != line1indent) throw new Error(this.lineMsg() + "invalid indent; this line should be the opposing label name. expected " + line1indent + " was " + line3indent);
              var line4 = this.lines[++this.lineNum];
              this.replaceVariables(line4);
              var line4indent = this.getIndent(line4);
              if (line4indent != line2indent) throw new Error(this.lineMsg() + "invalid indent; this line should be the opposing label definition. expected " + line2indent + " was " + line4indent);
              rows.push({type: type, variable: data, label: trim(line1), definition:trim(line2), opposed_label: trim(line3), opposed_definition: trim(line4)});
            } else {
              throw new Error(this.lineMsg() + "invalid indent; expected a second line with indent " + line1indent + " to match line " + this.lineNum + ", or else no more opposed_pair lines");
            }
          }
        } else {
          var variable, label;
          if (!/ /.test(data)) {
            variable = data;
            label = data;
          } else {
            result = /^(\S+) (.*)/.exec(data);
            if (!result) throw new Error(this.lineMsg() + "Bug! can't find a space when a space was found");
            variable = result[1];
            label = result[2];
          }
          this.getVar(variable);
          this.replaceVariables(label);
          line2 = this.lines[this.lineNum + 1];
          line2indent = this.getIndent(line2);
          if (line2indent <= this.indent) {
            // No definition line
            rows.push({type: type, variable: variable, label: label});
          } else {
            this.lineNum++;
            this.replaceVariables(line2);
            rows.push({type: type, variable: variable, label: label, definition: trim(line2)});
          }
        }
    }
    return rows;
};

Scene.prototype.delay_break = function(durationInSeconds) {
  if (isNaN(durationInSeconds * 1)) throw new Error(this.lineMsg() + "invalid duration");
  this.finished = true;
  this.skipFooter = true;
  var target = this.target;
  if (!target) {
    target = document.createElement("p");
    document.getElementById('text').appendChild(target);
  }
  var self = this;
  delayBreakStart(function(delayStart) {
    var endTimeInSeconds = durationInSeconds * 1 + delayStart * 1;
    showTicker(target, endTimeInSeconds, function() {
      printButton("Next", target, false, function() {
        delayBreakEnd();
        self.finished = false;
        self.resetPage();
      });
    });
    printFooter();
  });
};

Scene.prototype.delay_ending = function(data) {
  var args = data.split(/ /);
  var durationInSeconds = args[0];
  var fullPriceGuess = args[1];
  var singleUsePriceGuess = args[2];
  if (isNaN(durationInSeconds * 1)) throw new Error(this.lineMsg() + "invalid duration");
  if (!/^\$/.test(fullPriceGuess)) throw new Error(this.lineMsg() + "invalid fullPriceGuess: \""+fullPriceGuess+"\"");
  if (singleUsePriceGuess && !/^\$/.test(singleUsePriceGuess)) throw new Error(this.lineMsg() + "invalid singleUsePriceGuess: \""+singleUsePriceGuess+"\"");
  this.finished = true;
  this.skipFooter = true;
  var self = this;
  checkPurchase("adfree", function(ok, result) {
    if (result.adfree || !result.billingSupported || (typeof window != "undefined" && window.isWeb)) {
      self.ending();
      return;
    }
    getPrice("adfree", function (fullPrice) {
      if (fullPrice == "guess") fullPrice = fullPriceGuess;
      getPrice("skiponce", function (singleUsePrice) {
        if (singleUsePrice == "guess") singleUsePrice = singleUsePriceGuess;

        options = [];
        var finishedWaiting = {name: "Play again after a short wait. ", unselectable: true};
        options.push(finishedWaiting);
        var upgradeSkip = {name: "Upgrade to the unlimited version for " + fullPrice + " to skip the wait forever."};
        options.push(upgradeSkip);
        var skipOnce = {name: "Skip the wait one time for " + singleUsePrice + "."};
        if (singleUsePriceGuess) options.push(skipOnce);
        var restorePurchasesOption = {name: "Restore purchases from another device."};
        if (isRestorePurchasesSupported()) options.push(restorePurchasesOption);
        var playMoreGames = {name: "Play more games like this."};
        options.push(playMoreGames);
        var emailMe = {name: "Email me when new games are available."};
        options.push(emailMe);
        
        self.paragraph();
        printOptions([""], options, function(option) {
          if (option == playMoreGames) {
            self.more_games("now");
            if (typeof curl != "undefined") curl();
          } else if (option == emailMe) {
            subscribeLink();
          } else if (option == upgradeSkip) {
            purchase("adfree", function() {
              safeCall(self, function() {
                self.restart();
              });
            });
          } else if (option == skipOnce) {
            purchase("skiponce", function() {
              safeCall(self, function() {
                self.restart();
              });
            });
          } else if (option == restorePurchasesOption) {
            restorePurchases(function() {
              clearScreen(loadAndRestoreGame);
            });
          } else {
            self.restart();
          }
        });

        var target = document.getElementById("0").parentElement;

        delayBreakStart(function(delayStart) {
          var endTimeInSeconds = durationInSeconds * 1 + delayStart * 1;
          showTicker(target, endTimeInSeconds, function() {
            clearScreen(function() {
              self.ending();
            });
          });
          printFooter();
        });
      });
    });
  });

};

// *if booleanExpr
// execute different code depending on whether the booleanExpr is true or false
//
// Examples:
// *if bool-expression
//     blah
//     blah
// *elseif bool-expression
//     blah
//     blah
// *else
//     blah
//     blah
// bool-expression
//     by reference
//         *set foo true
//         *if foo ...
//     equality
//         foo=2
//         foo="blah"
//         2="2"
//             true
//     inequality
//         foo>2
//         foo<2
//         foo<=2
//         foo>=2
//     and/or logic, parentheses mandatory
//         (foo=2) or (foo=3)
//         ((foo>4) and (foo<8)) or (bar=0)
//
// NOTE: *if commands may be used inside *choices, to make some choices conditionally available
Scene.prototype["if"] = function scene_if(line) {
    var stack = this.tokenizeExpr(line);
    var result = this.evaluateExpr(stack);
    if (this.debugMode) println(line + " :: " + result);
    result = bool(result, this.lineNum+1);
    if (result) {
        // "true" branch, just go on to the next line
        this.indent = this.getIndent(this.nextNonBlankLine());
    } else {
        // "false" branch; skip over the true branch
        this.skipTrueBranch(false);
    }
};

// TODO Rename this function to just skipBranch
Scene.prototype.skipTrueBranch = function skipTrueBranch(inElse) {
  var startIndent = this.indent;
  var nextIndent = null;
  while (isDefined(line = this.lines[++this.lineNum])) {
      this.rollbackLineCoverage();
      if (!trim(line)) continue;
      var indent = this.getIndent(line);
      if (nextIndent === null || nextIndent === undefined) {
          if (indent <= startIndent) throw new Error(this.lineMsg() + "invalid indent, expected at least one line in 'if' true block");
          nextIndent = indent;
      }
      if (indent <= startIndent) {
          // true block is over
          var parsed;
          // check to see if this is an *else or *elseif
          if (indent == startIndent) parsed = /^\s*\*(\w+)(.*)/.exec(line);
          if (!parsed || inElse) {
              this.lineNum--;
              this.rollbackLineCoverage();
              this.indent = indent;
              return;
          }
          var command = parsed[1].toLowerCase();
          var data = trim(parsed[2]);
          if ("else" == command) {
              if (data) {
                if (/^if\b/.test(data)) {
                  throw new Error(this.lineMsg() + "'else if' is invalid, use 'elseif'");
                }
                throw new Error(this.lineMsg() + "nothing should appear on a line after 'else': " + data);
              }
              this.lineNum = this.lineNum; // code coverage
              // go on to the next line
              this.indent = this.getIndent(this.nextNonBlankLine());
          } else if (/^else?if$/.test(command)) {
              this.lineNum = this.lineNum; // code coverage
              this["if"](data);
          } else {
              this.lineNum--;
              this.rollbackLineCoverage();
              this.indent = this.getIndent(this.nextNonBlankLine());
          }
          return;
      }
      if (indent < nextIndent) {
          // *if foo
          //      foo
          //    bar
          throw new Error(this.lineMsg() + "invalid indent, expected "+nextIndent+", was " + indent);
      }
  }
};

Scene.prototype["else"] = Scene.prototype.elsif = Scene.prototype.elseif = function scene_else(data, inChoice) {
    if (inChoice) {
      this.skipTrueBranch(true);
      return;
    }
    throw new Error(this.lineMsg() + "It is illegal to fall in to an *else statement; you must *goto or *finish before the end of the indented block.");
};

// break the string up into a stack of tokens, defined in Scene.tokens below
Scene.prototype.tokenizeExpr = function tokenizeExpr(str) {
    var stack = [];
    var tokenTypes = Scene.tokens;
    var tokenTypesLength = tokenTypes.length;
    var pos = 0;
    while (str) {
        var matched = false;
        for (var i = 0; i < tokenTypesLength; i++) {
            var tokenType = tokenTypes[i];
            var token = tokenType.test(str, this.lineNum+1);
            if (token) {
                matched = true;
                str = str.substr(token.length);
                pos += token.length;
                if ("WHITESPACE" == tokenType.name) {
                    break;
                }
                stack.push({name:tokenType.name, value:token, pos:pos});
                break;
            }
        }
        if (!matched) throw new Error(this.lineMsg()+"Invalid expression, couldn't extract another token: " + str);
    }
    return stack;
};

// evaluate the stack of tokens
// parenthetical == true if we're evaluating a parenthetical expression
// all expressions consist of either a "singleton" value (2) or two values and one operator (2+2)
Scene.prototype.evaluateExpr = function evaluateExpr(stack, parenthetical) {
    if (!stack.length) {
        throw new Error(this.lineMsg() + "no expression specified");
    }
    var self = this;
    function getToken() {
        var token = stack.shift();
        if (!token) throw new Error(self.lineMsg() + "null token");
        return token;
    }

    var token, value1, value2, operator, result;

    value1 = this.evaluateValueToken(getToken(), stack);

    if (!stack.length) {
        if (parenthetical) {
            throw new Error(this.lineMsg() + "Invalid expression, expected final closing parenthesis");
        }
        return value1;
    }

    token = getToken();

    if (parenthetical && parenthetical == token.name) {
        return value1;
    }

    // Since this isn't a singleton, it must be an operator
    operator = Scene.operators[token.value];
    if (!operator) throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected OPERATOR, was: " + token.name + " [" + token.value + "]");

    // fetch the final value
    value2 = this.evaluateValueToken(getToken(), stack);

    // and do the operator
    result = operator(value1, value2, this.lineNum+1);

    if (parenthetical) {
        // expect close parenthesis
        if (stack.length) {
            token = getToken();
            if (parenthetical == token.name) {
                return result;
            } else {
                throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected closing parenthesis, was: " + token.name + " [" + token.value + "]");
            }
        } else {
            throw new Error(this.lineMsg() + "Invalid expression, expected final closing parenthesis");
        }
    } else {
        // if not parenthetical, expect no more tokens
        if (stack.length) {
            token = getToken();
            throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected no more tokens, found: " + token.name + " [" + token.value + "]");
        } else {
            return result;
        }
    }
    throw new Error(this.lineMsg() + "bug, how did I get here?");
};

// turn a number, string, or var token into its value
// or, if this is an open parenthesis, evaluate the parenthetical expression
Scene.prototype.evaluateValueToken = function evaluateValueToken(token, stack) {
    var name = token.name;
    var value;
    if ("OPEN_PARENTHESIS" == name) {
        return this.evaluateExpr(stack, "CLOSE_PARENTHESIS");
    } else if ("OPEN_CURLY" == name) {
        value = this.evaluateExpr(stack, "CLOSE_CURLY");
        return this.getVar(value);
    } else if ("FUNCTION" == name) {
        var functionName = /^\w+/.exec(token.value)[0];
        if (!this.functions[functionName]) throw new Error(this.lineMsg + "Unknown function " + functionName);
        value = this.evaluateExpr(stack, "CLOSE_PARENTHESIS");
        return this.functions[functionName].call(this, value);
    } else if ("NUMBER" == name) {
        return token.value;
    } else if ("STRING" == name) {
        // strip off the quotes and unescape backslashes
        return this.replaceVariables(token.value.slice(1,-1).replace(/\\(.)/g, "$1"));
    } else if ("VAR" == name) {
        return this.getVar(token.value);
    } else {
        throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected NUMBER, STRING, VAR or PARENTHETICAL, was: " + name + " [" + token.value + "]");
    }
};

Scene.prototype.functions = {
  not: function(value) {
    return !bool(value, this.lineNum+1);
  },
  round: function(value) {
    if (isNaN(value*1)) throw new Error(this.lineMsg()+"round() value is not a number: " + value);
    return Math.round(value);
  },
  timestamp: function(value) {
    return Date.parse(value)/1000;
  },
  log: function(value) {
    if (isNaN(value*1)) throw new Error(this.lineMsg()+"log() value is not a number: " + value);
    return Math.log(value)/Math.log(10);
  }
};

Scene.prototype.evaluateValueExpr = function evaluateValueExpr(expr) {
    var stack = this.tokenizeExpr(expr);
    var token = stack.shift();
    if (!token) throw new Error(this.lineMsg() + "null token");
    var value = this.evaluateValueToken(token, stack);
    if (stack.length) {
        token = stack.shift();
        if (!token) throw new Error(this.lineMsg() + "null token");
        throw new Error(this.lineMsg() + "Invalid expression at char "+token.pos+", expected no more tokens, found: " + token.name + " [" + token.value + "]");
    }
    return value;
};

Scene.prototype.goto_random_scene = function gotoRandomScene(data) {
  var parsed = this.parseGotoRandomScene(data);
  var allowReuseGlobally = /\ballow_reuse\b/.test(data);
  var allowNoSelection = /\ballow_no_selection\b/.test(data);
  var option = this.computeRandomSelection(Math.random(), parsed, allowReuseGlobally);

  if (option) {
    this.goto_scene(option.name);
  } else {
    if (allowNoSelection) {
      return;
    } else {
      throw new Error(this.lineMsg() + "No selectable scenes");
    }
  }

};

Scene.prototype.parseGotoRandomScene = function parseGotoRandomScene(data) {
    data = data || "";
    var directives = data.split(" ");
    var allowReuseGlobally = false;
    var allowNoSelection = false;
    for (var i = 0; i < directives; i++) {
      var directive = trim(directives[i]);
      if (!directive) continue;
      if (directive == "allow_reuse") {
        allowReuseGlobally = true;
      } else if (directive == "allow_no_selection") {
        allowNoSelection = true;
      } else {
        throw new Error(this.lineMsg() + "invalid command: '" + directive + "'");
      }
    }

    // nextIndent: the level of indentation after the current line
    var nextIndent = null;
    var options = [];
    var line;
    var startIndent = this.indent;
    while(isDefined(line = this.lines[++this.lineNum])) {
        if (!trim(line)) {
            this.rollbackLineCoverage();
            continue;
        }
        var indent = this.getIndent(line);
        if (nextIndent === null || nextIndent === undefined) {
            // initialize nextIndent with whatever indentation the line turns out to be
            // ...unless it's not indented at all
            if (indent <= startIndent) {
                throw new Error(this.lineMsg() + "invalid indent, expected at least one line in *goto_random_scene");
            }
            this.indent = nextIndent = indent;
        }
        if (indent <= startIndent) {
            // it's over!
            this.rollbackLineCoverage();
            this.lineNum--;
            this.rollbackLineCoverage();
            break;
        }
        if (indent != this.indent) {
            // all chart rows are supposed to be at the same indentation level
            // anything at the wrong indentation level might be a mis-indented title/definition
            // or just a typo
            throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
        }
        line = trim(line);

        var option = {allowReuse:allowReuseGlobally};
        var command;
        while(!!(command = /^\*(\S+)/.exec(line))) {
          command = command[1];
          if ("allow_reuse" == command) {
            option.allowReuse = true;
            line = trim(line.substring("*allow_reuse".length));
            command = /^\*(\S+)/.exec(line);
            continue;
          } else if ("if" == command) {
            var conditional = /^\*if\s+\((.+)\)\s+([^\)]+)/.exec(line);
            if (!conditional) throw new Error(this.lineMsg() + " invalid *if, expected () followed by scene name: " + line);
            line = conditional[2];
            var stack = this.tokenizeExpr(conditional[1]);
            this.evaluateExpr(stack);
            option.conditional = conditional[1];
          } else {
            throw new Error(this.lineMsg() + " invalid command: " + line);
          }
        }
        // TODO weights
        option.name = trim(line);
        options.push(option);
    }
    return options;
};

Scene.prototype.computeRandomSelection = function computeRandomSelection(randomFloat, options, allowReuseGlobally) {
  var filtered = [];
  var finished = {};
  if (!allowReuseGlobally) {
    if (!this.stats.choice_grs) this.stats.choice_grs = [];
  }
  var grs = this.stats.choice_grs;
  for (var i = 0; i < grs.length; i++) {
    finished[grs[i]] = 1;
  }
  var option;
  for (i = 0; i < options.length; i++) {
    option = options[i];
    if (!option.allowReuse) {
      if (finished[option.name]) continue;
    }
    if (option.conditional) {
      var stack = this.tokenizeExpr(option.conditional);
      var pass = this.evaluateExpr(stack);
      if (!pass) continue;
    }
    filtered.push(option);
  }
  if (!filtered.length) return null;
  // TODO weights
  var randomSelection = Math.floor(randomFloat*filtered.length);
  option = filtered[randomSelection];
  if (!option.allowReuse) {
    this.stats.choice_grs.push(option.name);
  }
  return option;
};

Scene.prototype.end_trial = function endTrial() {
  this.paragraph();
  printLink(this.target, "#", "Start Over from the Beginning", function(e) {
    preventDefault(e);
    return restartGame("prompt");
  });
  this.prevLine = "block";
  this.screenEmpty = false;
  this.finished = true;
};

Scene.prototype.achieve = function scene_achieve(name) {
  name = name.toLowerCase();
  if (!this.nav.achievements.hasOwnProperty(name)) {
    throw new Error(this.lineMsg() + "the achievement name "+name+" was not declared as an *achievement in startup");
  }
  var achievement = this.nav.achievements[name];
  this.nav.achieved[name] = true;
  if (typeof window != "undefined" && typeof achieve != "undefined") {
    achieve(name, achievement.title, achievement.earnedDescription);
  }
};

Scene.prototype.check_achievements = function scene_checkAchievements() {
  var self = this;
  function callback(immediately) {
    for (var achievement in nav.achievements) {

      self.temps["choice_achieved_"+achievement] = nav.achieved.hasOwnProperty(achievement);
    }
    if (!immediately) {
      self.finished = false;
      self.skipFooter = false;
      self.execute();
    }
  }
  if (typeof checkAchievements == "undefined") {
    callback("immediately");
  } else {
    this.finished = true;
    this.skipFooter = true;
    checkAchievements(callback);
  }
};

Scene.prototype.scene_list = function scene_list() {
  var scenes = this.parseSceneList();
  this.nav.setSceneList(scenes);
};

Scene.prototype.parseSceneList = function parseSceneList() {
  var nextIndent = null;
  var scenes = [];
  var line;
  var startIndent = this.indent;
  while(isDefined(line = this.lines[++this.lineNum])) {
      if (!trim(line)) {
          this.rollbackLineCoverage();
          continue;
      }
      var indent = this.getIndent(line);
      if (nextIndent === null || nextIndent === undefined) {
          // initialize nextIndent with whatever indentation the line turns out to be
          // ...unless it's not indented at all
          if (indent <= startIndent) {
              throw new Error(this.lineMsg() + "invalid indent, expected at least one row");
          }
          this.indent = nextIndent = indent;
      }
      if (indent <= startIndent) {
          // it's over!
          this.rollbackLineCoverage();
          this.lineNum--;
          this.rollbackLineCoverage();
          return scenes;
      }
      if (indent != this.indent) {
          // all scenes are supposed to be at the same indentation level
          throw new Error(this.lineMsg() + "invalid indent, expected "+this.indent+", was " + indent);
      }

      line = trim(line);
      var purchaseMatch = /^\$(\w*)\s+(.*)/.exec(line);
      if (purchaseMatch) {
        line = purchaseMatch[2];
      }
      if (!scenes.length && "startup" != line) scenes.push("startup");
      scenes.push(line);
  }
  return scenes;
};

Scene.prototype.title = function scene_title(title) {
  if (typeof changeTitle != "undefined") {
    changeTitle(title);
  }
};

Scene.prototype.author = function scene_author(author) {
  if (typeof changeAuthor != "undefined") {
    changeAuthor(author);
  }
};

// *achievement name hidden|visible 100 Achievement Title
//     Earned description
//     Pre-earned description
Scene.prototype.achievement = function scene_achievement(data) {
  var parsed = /(\S+)\s+(\S+)\s+(\S+)\s+(.*)/.exec(data);
  if (!parsed) throw new Error(this.lineMsg() + "Invalid *achievement, requires short name, visibility, points, and display title: " + data);
  var achievementName = parsed[1].toLowerCase();
  if (!/[a-z]+/.test(achievementName)) throw new Error(this.lineMsg()+"Invalid achievement name: " +achievementName);

  
  if (this.nav.achievements.hasOwnProperty(achievementName)) {
    // this achievement already exists...
    if (!this.nav.achievements[achievementName].lineNumber) {
      // blow away pre-existing mygame.js achievements
      this.nav.achievements = {};
      this.nav.achievementList = [];
    } else if (this.nav.achievements[achievementName].lineNumber != (this.lineNum+1)) {
      // don't allow redefining achievements
      // restarting/randomtest will naturally re-run *achievements; ignore those
      throw new Error(this.lineMsg()+"Achievement "+achievementName+" already defined on line " + this.nav.achievements[achievementName].lineNumber);
    }
  }

  var lineNumber = this.lineNum+1;
  var visibility = parsed[2];
  if (visibility != "hidden" && visibility != "visible") {
    throw new Error(this.lineMsg()+"Invalid *achievement, the second word should be either 'hidden' or 'visible': " +visibility);
  }
  var visible = (visibility != "hidden");
  var pointString = parsed[3];
  if (!/[1-9][0-9]*/.test(pointString)) {
    throw new Error(this.lineMsg()+"Invalid *achievement, the third word should be an integer number of points: " + pointString);
  }
  var points = parseInt(pointString, 10);
  if (points > 100) throw new Error(this.lineMsg()+"Invalid *achievement, no achievement may be worth more than 100 points: " + points);
  if (!this.achievementTotal) this.achievementTotal = 0;
  this.achievementTotal += points;
  if (this.achievementTotal > 1000) {
    throw new Error(this.lineMsg()+"Invalid achievements. Adding " + points + " would add up to more than 1,000 points: " + this.achievementTotal);
  }
  var title = parsed[4];
  if (/(\$\{)/.test(title)) throw new Error(this.lineMsg()+"Invalid *achievement. ${} not permitted in achievement title: " + title);
  if (/(\[)/.test(title)) throw new Error(this.lineMsg()+"Invalid *achievement. [] not permitted in achievement title: " + title);

  // Get the description from the next indented line
  var line = this.lines[++this.lineNum];
  var indent = this.getIndent(line);
  if (!indent) {
    throw new Error(this.lineMsg()+"Invalid *achievement. An indented description is required.");
  }
  var preEarnedDescription = trim(line);
  if (/(\$\{)/.test(preEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. ${} not permitted in achievement description: " + preEarnedDescription);
  if (/(\[)/.test(preEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. [] not permitted in achievement description: " + preEarnedDescription);

  if (!visible) {
    if (preEarnedDescription.toLowerCase() != "hidden") throw new Error(this.lineMsg()+"Invalid *achievement. Hidden achievements must set their pre-earned description to 'hidden'.");
  }

  // Optionally get a post-earned description from the next line
  var postEarnedDescription = null;
  while(isDefined(line = this.lines[++this.lineNum])) {
    if (trim(line)) break;
    this.rollbackLineCoverage();
  }
  indent = this.getIndent(line);
  if (indent) {
    postEarnedDescription = trim(line);
    if (/(\$\{)/.test(postEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. ${} not permitted in achievement description: " + postEarnedDescription);
    if (/(\[)/.test(postEarnedDescription)) throw new Error(this.lineMsg()+"Invalid *achievement. [] not permitted in achievement description: " + postEarnedDescription);
  } else {
    // No indent means the next line is not a post-earned description
    this.rollbackLineCoverage();
    this.lineNum--;
    this.rollbackLineCoverage();
  }

  if (!postEarnedDescription) {
    if (!visible) throw new Error(this.lineMsg()+"Invalid *achievement. Hidden achievements must set a post-earned description.");
    postEarnedDescription = preEarnedDescription;
  }

  if (!this.nav.achievements.hasOwnProperty(achievementName)) {
    this.nav.achievementList.push(achievementName);
    if (this.nav.achievementList.length > 100) {
      throw new Error(this.lineMsg()+"Too many *achievements. Each game can have up to 100 achievements.");
    }
  }
  this.nav.achievements[achievementName] = {
    visible: visible,
    points: points,
    title: title,
    earnedDescription: postEarnedDescription,
    preEarnedDescription: preEarnedDescription,
    lineNumber: lineNumber
  };

  if (typeof setButtonTitles != "undefined") setButtonTitles();
};


Scene.prototype.bug = function scene_bug(message) {
  if (message) {
    message = "Bug: " + this.replaceVariables(message);
  } else {
    message = "Bug";
  }
  throw new Error(this.lineMsg() + message);
};

Scene.prototype.lineMsg = function lineMsg() {
    return this.name + " line " + (this.lineNum+1) + ": ";
};

Scene.prototype.rollbackLineCoverage = function() {};

Scene.baseUrl = "scenes";
Scene.regexpMatch = function regexpMatch(str, re) {
    var result = re.exec(str);
    if (!result) return null;
    return result[0];
};
// Each token has a name and a test, which returns the matching string
Scene.tokens = [
    {name:"OPEN_PARENTHESIS", test:function(str){ return Scene.regexpMatch(str,/^\(/); } },
    {name:"CLOSE_PARENTHESIS", test:function(str){ return Scene.regexpMatch(str,/^\)/); } },
    {name:"OPEN_CURLY", test:function(str){ return Scene.regexpMatch(str,/^\{/); } },
    {name:"CLOSE_CURLY", test:function(str){ return Scene.regexpMatch(str,/^\}/); } },
    {name:"FUNCTION", test:function(str){ return Scene.regexpMatch(str,/^(not|round|timestamp|log)\s*\(/); } },
    {name:"NUMBER", test:function(str){ return Scene.regexpMatch(str,/^\d+(\.\d+)?/); } },
    {name:"STRING", test:function(str, line) {
            var i;
            if (!/^\"/.test(str)) return null;
            for (i = 1; i < str.length; i++) {
                var x = str.charAt(i);
                if ("\\" == x) {
                    i++;
                } else if ('"' == x) {
                    return str.substring(0,i+1);
                }
            }
            throw new Error("line "+line+": Invalid string, open quote with no close quote: " + str);
        }
    },
    {name:"WHITESPACE", test:function(str){ return Scene.regexpMatch(str,/^\s+/); } },
    {name:"BOOLEAN_OPERATOR", test:function(str){ return Scene.regexpMatch(str,/^(and|or)\b/); } },
    {name:"VAR", test:function(str){ return Scene.regexpMatch(str,/^[a-zA-Z]\w*/); } },
    {name:"FAIRMATH", test:function(str){ return Scene.regexpMatch(str,/^%[\+\-]/); } },
    {name:"OPERATOR", test:function(str){ return Scene.regexpMatch(str,/^[\+\-\*\/\&\%\^]/); } },
    {name:"INEQUALITY", test:function(str){ return Scene.regexpMatch(str,/^[\!<>]\=?/); } },
    {name:"EQUALITY", test:function(str){ return Scene.regexpMatch(str,/^=/); } }
    //
];
Scene.operators = {
    "+": function add(v1,v2,line) { return num(v1,line) + num(v2,line); },
    "-": function subtract(v1,v2,line) { return num(v1,line) - num(v2,line); },
    "*": function multiply(v1,v2,line) { return num(v1,line) * num(v2,line); },
    "/": function divide(v1,v2,line) { return num(v1,line) / num(v2,line); },
    "%": function modulo(v1,v2,line) { return num(v1,line) % num(v2,line); },
    "^": function exponent(v1,v2,line) { return Math.pow(num(v1,line), num(v2,line)); },
    "&": function concatenate(v1,v2) { return [v1,v2].join(""); },
    "%+": function fairAdd(v1, v2, line) {
        v1 = num(v1,line);
        v2 = num(v2,line);
        var validValue = (v1 >= 0 && v1 <= 100);
        if (!validValue) {
            throw new Error("line "+line+": Can't fairAdd to non-percentile value: " + v1);
        }
        var multiplier = (100 - v1) / 100;
        var actualModifier = v2 * multiplier;
        var value = 1 * v1 + actualModifier;
        value = Math.floor(value);
        if (value > 99) value = 99;
        return value;
    },
    "%-": function fairSubtract(v1, v2, line) {
        v1 = num(v1,line);
        v2 = num(v2,line);
        var validValue = (v1 >= 0 && v1 <= 100);
        if (!validValue) {
            throw new Error("line "+line+": Can't fairAdd to non-percentile value: " + v1);
        }
        var multiplier = v1 / 100;
        var actualModifier = v2 * multiplier;
        var value = v1 - actualModifier;
        value = Math.ceil(value);
        if (value < 1) value = 1;
        return value;
    },
    "=": function equals(v1,v2) { return v1 == v2; },
    "<": function lessThan(v1,v2,line) {
        return num(v1,line) < num(v2,line); },
    ">": function greaterThan(v1,v2,line) { return num(v1,line) > num(v2,line); },
    "<=": function lessThanOrEquals(v1,v2,line) { return num(v1,line) <= num(v2,line); },
    ">=": function greaterThanOrEquals(v1,v2,line) { return num(v1,line) >= num(v2,line); },
    "!=": function notEquals(v1,v2) { return v1 != v2; },
    "and": function and(v1, v2, line) {
        return bool(v1,line) && bool(v2,line);
    },
    "or": function or(v1, v2, line) {
        return bool(v1,line) || bool(v2,line);
    }
};

Scene.initialCommands = {"create":1,"scene_list":1,"title":1,"author":1,"comment":1,"achievement":1};

Scene.validCommands = {"comment":1, "goto":1, "gotoref":1, "label":1, "looplimit":1, "finish":1, "abort":1,
    "choice":1, "create":1, "temp":1, "delete":1, "set":1, "setref":1, "print":1, "if":1, "rand":1,
    "page_break":1, "line_break":1, "script":1, "else":1, "elseif":1, "elsif":1, "reset":1,
    "goto_scene":1, "fake_choice":1, "input_text":1, "ending":1, "share_this_game":1, "stat_chart":1,
    "subscribe":1, "show_password":1, "gosub":1, "return":1, "hide_reuse":1, "disable_reuse":1, "allow_reuse":1,
    "check_purchase":1,"restore_purchases":1,"purchase":1,"restore_game":1,"advertisement":1,
    "save_game":1,"delay_break":1,"image":1,"link":1,"input_number":1,"goto_random_scene":1,
    "restart":1,"more_games":1,"delay_ending":1,"end_trial":1,"login":1,"achieve":1,"scene_list":1,"title":1,
    "bug":1,"link_button":1,"check_registration":1,"sound":1,"author":1,"gosub_scene":1,"achievement":1,
    "check_achievements":1,"redirect_scene":1
    };
</script><script>/*
 * Copyright 2010 by Dan Fabulich.
 * 
 * Dan Fabulich licenses this file to you under the
 * ChoiceScript License, Version 1.0 (the "License"); you may
 * not use this file except in compliance with the License. 
 * You may obtain a copy of the License at
 * 
 *  http://www.choiceofgames.com/LICENSE-1.0.txt
 * 
 * See the License for the specific language governing
 * permissions and limitations under the License.
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied.
 */
function SceneNavigator(sceneList) {
    this.setSceneList(sceneList);
    this.startingStats = {};
}

SceneNavigator.prototype.setSceneList = function setSceneList(sceneList) {
    this._sceneList = sceneList;
    this._sceneMap = {};
    for (var i = 0; i < sceneList.length-1; i++) {
        var scene1 = sceneList[i];
        var scene2 = sceneList[i+1];
        this._sceneMap[scene1] = scene2;
    }
    this._startupScene = sceneList[0];
};

SceneNavigator.prototype.nextSceneName = function nextSceneName(currentSceneName) {
    var nextScene = this._sceneMap[currentSceneName];
    //if (!nextScene) throw new Error("No scene follows " + currentSceneName);
    return nextScene;
};

SceneNavigator.prototype.getStartupScene = function getStartupScene() {
    return this._startupScene;
};

SceneNavigator.prototype.setStartingStatsClone = function setStartingStatsClone(stats) {
  this.startingStats = {};
  for (var i in stats) {
    this.startingStats[i] = stats[i];
  }
};

SceneNavigator.prototype.resetStats = function resetStats(stats) {
  for (var i in stats) {
    delete stats[i];
  }
  for (i in this.startingStats) {
    stats[i] = this.startingStats[i];
  }
  this.bugLog = [];
};

SceneNavigator.prototype.repairStats = function repairStats(stats) {
  for (var i in this.startingStats) {
    var startingStat = this.startingStats[i];
    if (startingStat === null || startingStat === undefined) continue;
    if (typeof(stats[i]) === "undefined" || stats[i] === null) {
      stats[i] = this.startingStats[i];
    }
  }
};

SceneNavigator.prototype.bugLog = [];
SceneNavigator.prototype.achievements = {};
SceneNavigator.prototype.achievementList = [];
SceneNavigator.prototype.achieved = {};

SceneNavigator.prototype.loadAchievements = function(achievementArray) {
  if (!achievementArray) return;
  for (var i = 0; i < achievementArray.length; i++) {
    var achievement = achievementArray[i];
    var achievementName = achievement[0];
    var visible = achievement[1];
    var points = achievement[2];
    var title = achievement[3];
    var earnedDescription = achievement[4];
    var preEarnedDescription = achievement[5];
    this.achievements[achievementName] = {
      visible: visible,
      points: points,
      title: title,
      earnedDescription: earnedDescription,
      preEarnedDescription: preEarnedDescription
    };
    this.achievementList.push(achievementName);
  }
};</script><script>nav = new SceneNavigator(["startup"]);
stats = {};

</script><style>.alertify-show,
.alertify-log {
	-webkit-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1); /* older webkit */
	-webkit-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	   -moz-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	    -ms-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	     -o-transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275);
	        transition: all 500ms cubic-bezier(0.175, 0.885, 0.320, 1.275); /* easeOutBack */
}
.alertify-hide {
	-webkit-transition: all 250ms cubic-bezier(0.600, 0, 0.735, 0.045); /* older webkit */
	-webkit-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	   -moz-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	    -ms-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	     -o-transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045);
	        transition: all 250ms cubic-bezier(0.600, -0.280, 0.735, 0.045); /* easeInBack */
}
.alertify-cover {
	position: fixed; z-index: 99999;
	top: 0; right: 0; bottom: 0; left: 0;
}
.alertify {
	position: fixed; z-index: 99999;
	top: 50px; left: 50%;
	width: 550px;
	margin-left: -275px;
}
	.alertify-hidden {
		top: -50px;
		visibility: hidden;
	}
.alertify-logs {
	position: fixed;
	z-index: 5000;
	bottom: 10px;
	right: 10px;
	width: 300px;
}
	.alertify-log {
		display: block;
		margin-top: 10px;
		position: relative;
		right: -300px;
	}
	.alertify-log-show {
		right: 0;
	}
	.alertify-dialog {
		padding: 25px;
	}
		.alertify-resetFocus {
			border: 0;
			clip: rect(0 0 0 0);
			height: 1px;
			margin: -1px;
			overflow: hidden;
			padding: 0;
			position: absolute;
			width: 1px;
		}
		.alertify-inner {
			text-align: center;
		}
		.alertify-text {
			margin-bottom: 15px;
			width: 100%;
			-webkit-box-sizing: border-box;
			   -moz-box-sizing: border-box;
			        box-sizing: border-box;
			font-size: 100%;
		}
		.alertify-buttons {
		}
			.alertify-button {
				/* line-height and font-size for input button */
				line-height: 1.5;
				font-size: 100%;
				display: inline-block;
				cursor: pointer;
				margin-left: 5px;
			}

@media only screen and (max-width: 680px) {
	.alertify,
	.alertify-logs {
		width: 90%;
		-webkit-box-sizing: border-box;
		   -moz-box-sizing: border-box;
		        box-sizing: border-box;
	}
	.alertify {
		left: 5%;
		margin: 0;
	}
}
/**
 * Default Look and Feel
 */
.alertify,
.alertify-log {
	font-family: sans-serif;
}
.alertify {
	background: #FFF;
	border: 10px solid #333; /* browsers that don't support rgba */
	border: 10px solid rgba(0,0,0,.7);
	border-radius: 8px;
	box-shadow: 0 3px 3px rgba(0,0,0,.3);
	-webkit-background-clip: padding;     /* Safari 4? Chrome 6? */
	   -moz-background-clip: padding;     /* Firefox 3.6 */
	        background-clip: padding-box; /* Firefox 4, Safari 5, Opera 10, IE 9 */
}
	.alertify-text {
		border: 1px solid #CCC;
		padding: 10px;
		border-radius: 4px;
	}
	.alertify-button {
		border-radius: 4px;
		color: #FFF;
		font-weight: bold;
		padding: 6px 15px;
		text-decoration: none;
		text-shadow: 1px 1px 0 rgba(0,0,0,.5);
		box-shadow: inset 0 1px 0 0 rgba(255,255,255,.5);
		background-image: -webkit-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:    -moz-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:     -ms-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:      -o-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
		background-image:         linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
	}
	.alertify-button:hover,
	.alertify-button:focus {
		outline: none;
		box-shadow: 0 0 15px #2B72D5;
		background-image: -webkit-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:    -moz-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:     -ms-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:      -o-linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
		background-image:         linear-gradient(top, rgba(0,0,0,.1), rgba(0,0,0,0));
	}
	.alertify-button:active {
		position: relative;
		top: 1px;
	}
		.alertify-button-cancel {
			background-color: #FE1A00;
			border: 1px solid #D83526;
		}
		.alertify-button-ok {
			background-color: #5CB811;
			border: 1px solid #3B7808;
		}
		
.alertify-log {
	background: #1F1F1F;
	background: rgba(0,0,0,.9);
	padding: 15px;
	border-radius: 4px;
	color: #FFF;
	text-shadow: -1px -1px 0 rgba(0,0,0,.5);
}
	.alertify-log-error {
		background: #FE1A00;
		background: rgba(254,26,0,.9);
	}
	.alertify-log-success {
		background: #5CB811;
		background: rgba(92,184,17,.9);
	}body {
  max-width: 680px;
  _width:expression(this.scrollWidth > 680 ? "680px" : "auto");
  background-image: url("images/28-faded-parchment-background-sml.jpg");  
  font-family: "DejaVu Sans", Georgia,"Times New Roman",serif;
  font-size: 16px; /* reset, specified in px so IE currentStyle works */
  background-color: #F7F4F1;
  color: rgba(0, 0, 0, 0.85);
  margin: 8px auto; 
  padding: 0 8px;
  -webkit-user-select: text; /* selectable text for Chrome app support */
}

a {
  /* colored underlined links for XULRunner support */
  color: blue;
  text-decoration: underline;
  cursor: pointer;
}

  
#quickstats {
  	color: white;
  	background-color: black;
  	padding: 2px 3px 0px 3px;
}

#main {
	color: black;
  background-color: white;
  background-color: rgba(255, 255, 255, 0.4);
  border-width:1px 1px 1px 1px; 
  border-color:black; 
  border-style:solid; 
  padding: 10px;
}

.censored {
	color: transparent;
   text-shadow: 0 0 8px black, 1px 1px 7px black, -1px -1px 6px black;
}

#text {
	line-height: 1.5;
}

#text img {
  max-width: 100%;
}

.statBar {
  background-color: #949291;
  height: 2em;
  line-height: 2em;
  margin: 4px 0;
  width: 300px;
  color: #f7f4f1;
  position: relative; /* to allow absolute positioned value */
  z-index: 0;
}
.opposed {
  background-color: #6D6DFC;
}

table {
  margin-bottom: 1.5em;
}

.statBar > span, .statLine > span {
  position: relative;
  z-index: 1; /* visible over stat value */
  white-space: nowrap; /* remain on single line so we can resize font based on width */
}
.statValue {
  background-color: #ff5955;
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  z-index: -1;
  /* width will be determined at runtime, 0-100% */
}

.choice label{
    line-height:20px;
    padding: 11px 8px 12px;
    display:block;
    border-color:#a9acaf;
    border-style:solid;
    border-width: 1px 1px 0px 1px
}

.choice .firstChild{
    border-top-width:1px;
    -webkit-border-top-right-radius:8px;
    -webkit-border-top-left-radius:8px;
    border-top-right-radius:8px;
    border-top-left-radius:8px;
}
/* IE doesn't support label:last-child */
.choice .lastChild{
    border-bottom-width:1px;
    -webkit-border-bottom-right-radius:8px;
    -webkit-border-bottom-left-radius:8px;
    -moz-border-radius:0px 0px 8px 8px;
    border-bottom-right-radius:8px;
    border-bottom-left-radius:8px;
}
.choice .onlyChild{
    border-width:1px;
    -webkit-border-radius:8px;
    -moz-border-radius:8px;
    border-radius:8px;
}

.choice .noBorder {
  border-width: 0;
}

input[type="radio"], input[type="checkbox"] {
  margin-right: 8px;
}

.saveGame>label {
  display:block;
}

.choice .disabled {
  color: gray;
}

input[type=password]:disabled {
  background-color: lightgray;
}

/* Reset for Firefox vs. Chrome */
input[type=email],input[type=password] {
  padding: 1px;
  margin: 2px 0;
}

.next {
    clear: both;
    display:block;
    width:100%;
    font-size:25px;
    font-weight:bolder;
    font-family: sans-serif; /* reset, for Android */
    margin-bottom: 16px; /* reset button margin */
    -webkit-appearance: none; /* Safari, don't override my CSS styles */
    //color: #f7f4f1; /* Match background color */ 
    //background-color: #626160;
    color: white;
    background-color: olivedrab;
    border: none;
    -webkit-border-radius: 0.5em;
    -moz-border-radius: 0.5em;
    border-radius: 0.5em;
    padding: 6px;
}

.next:hover {
  color: #E4DED8;
}

h1 {
  font-size: x-large;
  font-weight: normal;
}

h2 {
  font-size: large;
  font-weight: normal;
}

#identity {
  float: right;
  display: none;
}

#identity > a {
  display: block;
  text-align: end;
}

#footer {
  margin:10px 0px 75px 0px;
}

#mobileLinks a img {
  border: 0;
}

.mobileBadges {
  margin: 0;
}

.spacedLink {
  margin-right:0.5em;
}

.spacedLink:last-child {
  margin-right:0;
}

#sharelist {
  margin: 0; /* Eliminate leading space before share links */
}

#sharelist li {
  line-height: 1cm; /* Don't let the links bunch up */
}

.alertify-cover {
  background-color: black;
  filter:alpha(opacity=50);
  opacity: 0.5;
}

#greybackground {
    position: fixed;
    width:100%;
    height:100%;
    background-color: black;
    filter:alpha(opacity=50);
    opacity: 0.5;
    top:0;
    left:0;
}

.savePassword {
  font-family: monospace;
  display: block;
}

.webOnly { /* We'll override this in JavaScript */
  display: none;
}

.alignleft {
  display: inline;
  float: left;
  margin-right: 1.625em;
  margin-bottom: 1em;
}
.alignright {
  display: inline;
  float: right;
  margin-left: 1.625em;
  margin-bottom: 1em;
}
.aligncenter {
  clear: both;
  display: block;
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 1em;
}

#main form {
  clear: both;
}

@media only screen and (max-width: 480px) {
  .definition{
    display: none;
  }
  
  #headerLinks {
    line-height: 2; /* For tapability */
  }

  .gameTitle {
    display: none;
  }

  #advertisement {
    margin: -8px;
  }
  
  .mobileBadges {
    float: none;
  }
  
  #header {
    margin-top: 30px;
  }

  /** Floating images should leave enough room for text */
  #text .alignleft, #text .alignright {
    max-width: 45%;
  }

}
</style></head>
<body>
<div id="advertisement">
</div>
<div id="header">
  <div id="identity"><a href="#" id="email">you@example.com</a><a href="#" id="logout">Sign Out</a></div>

  <h1 class='gameTitle'>SeductQuest: The Dragon and the Princess</h1>
<h2 id="author" class="gameTitle"><!--by INSERTINSERTINSERT --></h2>

  <p id="headerLinks">
      <!-- <a href="credits.html" id="aboutLink" class="spacedLink">About</a> -->
    </p>
  <p id="buttons"><button id="statsButton" class="spacedLink" onclick="showStats()">Show Stats</button> <button id="restartButton" class="spacedLink" onclick="restartGame('prompt')">Restart</button> <button id="achievementsButton" onclick="showAchievements()" class="spacedLink" style="display: none">Achievements</button></p>
</div>
<div id="quickstats">Gold: 22</div>
<div id="main">
<div id="text">
</div>
<script>
startLoading();
</script>
</div>
<div id="mobileLinks" class="webOnly">
  <!-- INSERT fixed links
  <p class="mobileBadges">
    <a class='spacedLink' id='iphoneLink' href='http://itunes.apple.com/us/app/choice-of-broadsides/id365660770'><img src='../icons/appstore.png' style='height: 3em;'></a>
    <a class='spacedLink' id='androidLink' href='https://play.google.com/store/apps/details?id=com.choiceofgames.broadsides'><img src='../icons/droid.png' style='height: 3em;'></a>
    <a class='spacedLink' id='kindleLink' href='http://www.amazon.com/Choice-of-Broadsides/dp/B004FRH3PO'><img src='../icons/kindle.png' style='height: 3em;'></a>
    <a class='spacedLink' id='chromeLink' href='https://chrome.google.com/webstore/detail/donhlnjhcdnocioldondhgngncepnpch'><img src='../icons/chrome.png' style='height: 3em;'></a>
  </p>
  -->
</div>
<p id="emailUs">Love it?  Hate it?  Write us at <a id="supportEmail" href='mailto:support-external@choiceofgames.com'>support@choiceofgames.com</a></p>
<noscript>
<p>This game requires JavaScript; please enable JavaScript and refresh this page.</p>
<p>If you can't get the game to work, please write to us at
<a href="mailto:support-external@choiceofgames.com">support-external@choiceofgames.com</a> for assistance.</p>
</noscript>
</body>
</html>
